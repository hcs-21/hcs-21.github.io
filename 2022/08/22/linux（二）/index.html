<!DOCTYPE HTML>
<html lang="zh-CN">
    <!-- hcs-21 郝帅  modify 2022.06.24-->



<head>
    <meta charset="utf-8">
    <meta name="keywords" content="linux的使用教程（二）, BigData">
    <meta name="baidu-site-verification" content="fmlEuI34ir" />
    <meta name="google-site-verification" content="KeoTn_OFy4ndJwXNmm2gMeQfPhd7alqE9vQDwI32KCY" />
    <meta name="description" content="阅读须知
本篇文章仅供参考


十二、使用Vsftpd服务传输文件
12.1、文件传输协议
FTP是一种在互联网中进行文件传输的协议，基于客户端&amp;#x2F;服务器模式，默认使用20、21号端口，其中端
口20用于进行数据传输，端口21用于接">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>linux的使用教程（二） | 郝春帅的博客</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/aos/3.0.0-beta.6/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/lightgallery/1.6.12/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <style type="text/css">
        
    </style>
    
    <script src="https://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?46e79e71af0709a5b9106bf20cecc493";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    
    
    
        <script>
            (function(){
                var bp = document.createElement('script');
                var curProtocol = window.location.protocol.split(':')[0];
                if (curProtocol === 'https') {
                    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
                }
                else {
                    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                }
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(bp, s);
            })();
        </script>
    

<meta name="generator" content="Hexo 6.2.0"></head>

    <body>

        <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">郝春帅的博客</span>
                </a>
            </div>
            


<!-- <a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/AV" class="waves-effect waves-light">
            
            <i class="fa fa-music"></i>
            
            <span>视听</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/galleries" class="waves-effect waves-light">
            
            <i class="fa fa-photo"></i>
            
            <span>相册</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于我</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul> -->

<!-- 支持二级菜单特性 洪卫 shw2018 modify 2019.09.17  -->
<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right nav-menu">
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/" class="waves-effect waves-light">
              
                <i class="fa fa-home"></i>
              
              <span>首页</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/tags" class="waves-effect waves-light">
              
                <i class="fa fa-tags"></i>
              
              <span>标签</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/categories" class="waves-effect waves-light">
              
                <i class="fa fa-bookmark"></i>
              
              <span>分类</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/archives" class="waves-effect waves-light">
              
                <i class="fa fa-archive"></i>
              
              <span>归档</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/AV" class="waves-effect waves-light">
              
                <i class="fa fa-music"></i>
              
              <span>视听</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/galleries" class="waves-effect waves-light">
              
                <i class="fa fa-photo"></i>
              
              <span>相册</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/about" class="waves-effect waves-light">
              
                <i class="fa fa-user-circle-o"></i>
              
              <span>关于我</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/friends" class="waves-effect waves-light">
              
                <i class="fa fa-address-book"></i>
              
              <span>友情链接</span>
            </a>

            
      </li>
    

    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>

</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">郝春帅的博客</div>
        <div class="logo-desc">
            
            什么也不会的小白
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/AV" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-music"></i>
                
                视听
            </a>
        </li>
        
        <li>
            <a href="/galleries" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-photo"></i>
                
                相册
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于我
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/hcs-21/hcs-21.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>

   
   
<!-- 支持二级菜单特性 洪卫 shw2018 modify 2019.09.17  -->
<!-- <ul class="menu-list mobile-menu-list">
    
        <li class="m-nav-item">
                
                    <a href="/" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-home"></i>
                        
                        首页
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/tags" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-tags"></i>
                        
                        标签
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/categories" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-bookmark"></i>
                        
                        分类
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/archives" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-archive"></i>
                        
                        归档
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/AV" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-music"></i>
                        
                        视听
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/galleries" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-photo"></i>
                        
                        相册
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/about" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-user-circle-o"></i>
                        
                        关于我
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/friends" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-address-book"></i>
                        
                        友情链接
                    </a>
              
            </li>
        

        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/hcs-21/hcs-21.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul> -->

</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/hcs-21/hcs-21.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

        
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/18.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        linux的使用教程（二）
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- shw2018 洪卫  modify 2019.08.15-->
<!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/linux/" target="_blank">
                                <span class="chip bg-color">linux</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E7%B3%BB%E7%BB%9F/" class="post-category" target="_blank">
                                系统
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-08-22
                </div>
    
                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>作者:&nbsp;&nbsp;
                    
                        郝帅
                    
                </div>
    
                
                
                        <span id="busuanzi_container_site_pv" style='display:none'></span>
                        <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv" ></span>
    
                
    
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="阅读须知"><a href="#阅读须知" class="headerlink" title="阅读须知"></a>阅读须知</h2><blockquote>
<p>本篇文章仅供参考</p>
</blockquote>
<hr>
<h2 id="十二、使用Vsftpd服务传输文件"><a href="#十二、使用Vsftpd服务传输文件" class="headerlink" title="十二、使用Vsftpd服务传输文件"></a>十二、使用<code>Vsftpd</code>服务传输文件</h2><hr>
<h3 id="12-1、文件传输协议"><a href="#12-1、文件传输协议" class="headerlink" title="12.1、文件传输协议"></a>12.1、文件传输协议</h3><blockquote>
<p><code>FTP</code>是一种在互联网中进行文件传输的协议，基于客户端&#x2F;服务器模式，<strong>默认使用20、21号端口</strong>，其中端</p>
<p>口20用于进行<strong>数据传输</strong>，端口21用于接受客户端发出的相关**<code>FTP</code>命令与参数**。<code>FTP</code>服务器普遍部署于内网中，具有容易搭建、方便管理的特点。而且有些<code>FTP</code>客户端工具还可以支持文件的多点下载以及断点续传技术，因此得到了广大用户的青睐。FTP的传输拓扑如图12-1所示。</p>
</blockquote>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220822133149004.png" alt="图12-1  FTP协议的传输拓扑"></p>
<blockquote>
<p>FTP协议有下面两种工作模式：</p>
<ul>
<li><strong>主动模式</strong>：FTP服务器主动向客户端发起连接请求。</li>
<li><strong>被动模式</strong>：FTP服务器等待客户端发起连接请求（默认工作模式）</li>
</ul>
</blockquote>
<blockquote>
<p>我们可以在<code>grep</code>后面添加-v参数，过滤并反选出没有包含井号（#）的参数行（即过滤掉所有的注释信</p>
<p>息），然后将过滤后的参数行通过输出重定向符写回原始的主配置文件中</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# mv /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf_bak
[root@linuxprobe ~]# grep -v &quot;#&quot; /etc/vsftpd/vsftpd.conf_bak &gt; /etc/vsftpd/vsftpd.conf
[root@linuxprobe ~]# cat /etc/vsftpd/vsftpd.conf
anonymous_enable=NO
local_enable=YES
write_enable=YES
local_umask=022
dirmessage_enable=YES
xferlog_enable=YES
connect_from_port_20=YES
xferlog_std_format=YES
listen=NO
listen_ipv6=YES
pam_service_name=vsftpd
userlist_enable=YES
</code></pre>
<blockquote>
<p> <code>vsftpd</code>服务程序常用的参数以及作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>&#96;listen&#x3D;[YES</td>
<td>NO] &#96;</td>
</tr>
<tr>
<td><code>listen_address=IP地址</code></td>
<td>设置要监听的IP地址</td>
</tr>
<tr>
<td><code>listen_port=21</code></td>
<td>设置FTP服务的监听端口</td>
</tr>
<tr>
<td>&#96;download_enable＝[YES</td>
<td>NO] &#96;</td>
</tr>
<tr>
<td>&#96;userlist_enable&#x3D;[YES</td>
<td>NO] <code> &lt;br /&gt;</code>userlist_deny&#x3D;[YES</td>
</tr>
<tr>
<td><code>max_clients=0</code></td>
<td>最大客户端连接数，0为不限制</td>
</tr>
<tr>
<td><code>max_per_ip=0</code></td>
<td>同一IP地址的最大连接数，0为不限制</td>
</tr>
<tr>
<td>&#96;anonymous_enable&#x3D;[YES</td>
<td>NO]&#96;</td>
</tr>
<tr>
<td>&#96;anon_upload_enable&#x3D;[YES</td>
<td>NO]&#96;</td>
</tr>
<tr>
<td><code>anon_umask=022</code></td>
<td>匿名用户上传文件的umask值</td>
</tr>
<tr>
<td><code>anon_root=/var/ftp</code></td>
<td>匿名用户的FTP根目录</td>
</tr>
<tr>
<td>&#96;anon_mkdir_write_enable&#x3D;[YES</td>
<td>NO]&#96;</td>
</tr>
<tr>
<td>&#96;anon_other_write_enable&#x3D;[YES</td>
<td>NO]&#96;</td>
</tr>
<tr>
<td><code>anon_max_rate=0</code></td>
<td>匿名用户的最大传输速率（字节&#x2F;秒），0为不限制</td>
</tr>
<tr>
<td>&#96;local_enable&#x3D;[YES</td>
<td>NO]&#96;</td>
</tr>
<tr>
<td><code>local_umask=022</code></td>
<td>本地用户上传文件的umask值</td>
</tr>
<tr>
<td><code>local_root=/var/ftp</code></td>
<td>本地用户的FTP根目录</td>
</tr>
<tr>
<td>&#96;chroot_local_user&#x3D;[YES</td>
<td>NO]&#96;</td>
</tr>
<tr>
<td><code>local_max_rate=0</code></td>
<td>本地用户最大传输速率（字节&#x2F;秒），0为不限制</td>
</tr>
</tbody></table>
<h3 id="12-2、Vsftp服务程序"><a href="#12-2、Vsftp服务程序" class="headerlink" title="12.2、Vsftp服务程序"></a>12.2、<code>Vsftp</code>服务程序</h3><blockquote>
<p><code>vsftpd</code>作为更加安全的文件传输协议服务程序，允许用户以3种认证模式登录FTP服务器：</p>
<ul>
<li><p><strong>匿名开放模式</strong>：是最不安全的一种认证模式，任何人都可以无须密码验证而直接登录到FTP服务器。</p>
</li>
<li><p><strong>本地用户模式</strong>：是通过Linux系统本地的账户密码信息进行认证的模式，相较于匿名开放模式更安</p>
<p>全，而且配置起来也很简单。但是如果黑客破解了账户的信息，就可以畅通无阻地登录FTP服务器，</p>
<p>从而完全控制整台服务器。</p>
</li>
<li><p><strong>虚拟用户模式</strong>：更安全的一种认证模式，它需要为FTP服务单独建立用户数据库文件，虚拟出用来进</p>
<p>行密码验证的账户信息，而这些账户信息在服务器系统中实际上是不存在的，仅供FTP服务程序进行</p>
<p>认证使用。这样，即使黑客破解了账户信息也无法登录服务器，从而有效降低了破坏范围和影响。</p>
</li>
</ul>
</blockquote>
<h4 id="12-2-1、匿名访问模式"><a href="#12-2-1、匿名访问模式" class="headerlink" title="12.2.1、匿名访问模式"></a>12.2.1、匿名访问模式</h4><blockquote>
<p>开放匿名用户的上传、下载文件的权限，以及让匿名用户创建、删除、更名文件的权限</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/vsftpd/vsftpd.conf
  1 anonymous_enable=YES
  2 anon_umask=022
  3 anon_upload_enable=YES
  4 anon_mkdir_write_enable=YES
  5 anon_other_write_enable=YES
  6 local_enable=YES
  7 write_enable=YES
  8 local_umask=022
  9 dirmessage_enable=YES
 10 xferlog_enable=YES
 11 connect_from_port_20=YES
 12 xferlog_std_format=YES
 13 listen=NO
 14 listen_ipv6=YES
 15 pam_service_name=vsftpd
 16 userlist_enable=YES
</code></pre>
<blockquote>
<p>在<code>vsftpd</code>服务程序的主配置文件中正确填写参数，然后保存并退出。还需要重启<code>vsftpd</code>服务程序，让</p>
<p>新的配置参数生效</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# systemctl restart vsftpd
[root@linuxprobe ~]# systemctl enable vsftpd
Created symlink /etc/systemd/system/multi-user.target.wants/vsftpd.service → /usr/lib/systemd/system/vsftpd.service.
</code></pre>
<blockquote>
<p>在<code>vsftpd</code>服务程序的匿名开放认证模式下，其账户统一为<code>anonymous</code>，密码为空。而且在连接<code>FTP</code>服</p>
<p>务器后，默认访问的是<code>/var/ftp</code>目录。可以切换到该目录下的<code>pub</code>目录中，然后尝试创建一个新的目录</p>
<p>文件，以检验是否拥有写入权限</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# systemctl restart vsftpd
[root@linuxprobe ~]# systemctl enable vsftpd
Created symlink /etc/systemd/system/multi-user.target.wants/vsftpd.service → /usr/lib/systemd/system/vsftpd.service.
</code></pre>
<blockquote>
<p>现在就可以在客户端执行ftp命令连接到远程的<code>FTP</code>服务器了。在vsftpd服务程序的匿名开放认证模式</p>
<p>下，其账户统一为<code>anonymous</code>，密码为空。而且在连接<code>FTP</code>服务器后，默认访问的是<code>/var/ftp</code>目</p>
<p>录。可以切换到该目录下的<code>pub</code>目录中，然后尝试创建一个新的目录文件，以检验是否拥有写入权限</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# ftp 192.168.10.10
Connected to 192.168.10.10 (192.168.10.10).
220 (vsFTPd 3.0.3)
Name (192.168.10.10:root): anonymous
331 Please specify the password.
Password:此处敲击回车即可
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; cd pub
250 Directory successfully changed.
ftp&gt; mkdir files
550 Permission denied.
</code></pre>
<blockquote>
<p>下面将目录的所有者身份改成系统账户<code>ftp</code>即可</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# ls -ld /var/ftp/pub
drwxr-xr-x. 2 root root 6 Aug 13 2021 /var/ftp/pub
[root@linuxprobe ~]# chown -R ftp /var/ftp/pub
[root@linuxprobe ~]# ls -ld /var/ftp/pub
drwxr-xr-x. 2 ftp root 6 Aug 13 2021 /var/ftp/pub
[root@linuxprobe ~]# ftp 192.168.10.10
Connected to 192.168.10.10 (192.168.10.10).
220 (vsFTPd 3.0.3)
Name (192.168.10.10:root): anonymous
331 Please specify the password.
Password:此处敲击回车即可
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; cd pub
250 Directory successfully changed.
ftp&gt; mkdir files
550 Create directory operation failed.
</code></pre>
<blockquote>
<p>下面使用<code>getsebool</code>命令查看与<code>FTP</code>相关的<code>SELinux</code>域策略都有哪些</p>
</blockquote>
<pre><code class="bahs">[root@linuxprobe ~]# getsebool -a | grep ftp
ftpd_anon_write --&gt; off
ftpd_connect_all_unreserved --&gt; off
ftpd_connect_db --&gt; off
ftpd_full_access --&gt; off
ftpd_use_cifs --&gt; off
ftpd_use_fusefs --&gt; off
ftpd_use_nfs --&gt; off
ftpd_use_passive_mode --&gt; off
httpd_can_connect_ftp --&gt; off
httpd_enable_ftp_server --&gt; off
tftp_anon_write --&gt; off
tftp_home_dir --&gt; off
</code></pre>
<blockquote>
<p>我们可以根据经验（需要长期培养，别无它法）和策略的名称判断出是f<code>tpd_full_access--&gt; off</code>策略</p>
<p>规则导致了操作失败。接下来修改该策略规则，并且在设置时使用-P参数让修改过的策略永久生效，确</p>
<p>保在服务器重启后依然能够顺利写入文件</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# setsebool -P ftpd_full_access=on
</code></pre>
<blockquote>
<p>等<code>SELinux</code>域策略修改完毕后，就能够顺利执行文件的创建、修改及删除等操作了</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# ftp 192.168.10.10
Connected to 192.168.10.10 (192.168.10.10).
220 (vsFTPd 3.0.3)
Name (192.168.10.10:root): anonymous
331 Please specify the password.
Password:此处敲击回车即可
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; cd pub
250 Directory successfully changed.
ftp&gt; mkdir files
257 &quot;/pub/files&quot; created
ftp&gt; rename files database
350 Ready for RNTO.
250 Rename successful.
ftp&gt; rmdir database
250 Remove directory operation successful.
ftp&gt; exit
221 Goodbye.
</code></pre>
<h4 id="12-2-2、本地用户模式"><a href="#12-2-2、本地用户模式" class="headerlink" title="12.2.2、本地用户模式"></a>12.2.2、本地用户模式</h4><blockquote>
<p>相较于匿名开放模式，本地用户模式要更安全，而且配置起来也很简单</p>
</blockquote>
<blockquote>
<p>本地用户模式使用的权限参数以及作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>anonymous_enable=NO</code></td>
<td>禁止匿名访问模式</td>
</tr>
<tr>
<td><code>local_enable=YES</code></td>
<td>允许本地用户模式</td>
</tr>
<tr>
<td><code>write_enable=YES</code></td>
<td>设置可写权限</td>
</tr>
<tr>
<td><code>local_umask=022</code></td>
<td>本地用户模式创建文件的umask值</td>
</tr>
<tr>
<td><code>userlist_deny=YES</code></td>
<td>启用“禁止用户名单”，名单文件为<code>ftpusers</code>和<code>user_list</code></td>
</tr>
<tr>
<td><code>userlist_enable=YES</code></td>
<td>开启用户作用名单文件功能</td>
</tr>
</tbody></table>
<blockquote>
<p>普通文件的默认权限是666，目录的默认权限是777，这都是写在系统配置文件中的。但默认值不等于最</p>
<p>终权限值。<code>umask</code>参数的默认值是022，根据公式“默认权限−umask＝实际权限”，所以普通文件的默认</p>
<p>权限到手后就剩下644，而目录文件就剩下755了。</p>
</blockquote>
<blockquote>
<p>配置本地用户的参数</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/vsftpd/vsftpd.conf
  1 anonymous_enable=NO
  2 local_enable=YES
  3 write_enable=YES
  4 local_umask=022
  5 dirmessage_enable=YES
  6 xferlog_enable=YES
  7 connect_from_port_20=YES
  8 xferlog_std_format=YES
  9 listen=NO
 10 listen_ipv6=YES
 11 pam_service_name=vsftpd
 12 userlist_enable=YES
</code></pre>
<blockquote>
<p>在<code>vsftpd</code>服务程序的主配置文件中正确填写参数，然后保存并退出。还需要重启<code>vsftpd</code>服务程序，让</p>
<p>新的配置参数生效</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# systemctl restart vsftpd
[root@linuxprobe ~]# systemctl enable vsftpd
Created symlink /etc/systemd/system/multi-user.target.wants/vsftpd.service → /usr/lib/systemd/system/vsftpd.service.
</code></pre>
<blockquote>
<p>可见，在我们输入<code>root</code>管理员的密码之前，就已经被系统拒绝访问了。这是因为<code>vsftpd</code>服务程序所在</p>
<p>的目录中默认存放着两个名为“用户名单”的文件（<code>ftpusers</code>和<code>user_list</code>）。<code>vsftpd</code>服务程序目录中</p>
<p>的这两个文件—只要里面写有某位用户的名字，就不再允许这位用户登录到<code>FTP</code>服务器上。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# cat /etc/vsftpd/user_list 
# vsftpd userlist
# If userlist_deny=NO, only allow users in this file
# If userlist_deny=YES (default), never allow users in this file, and
# do not even prompt for a password.
# Note that the default vsftpd pam config also checks /etc/vsftpd/ftpusers
# for users that are denied.
root
bin
daemon
adm
lp
sync
shutdown
halt
mail
news
uucp
operator
games
nobody
[root@linuxprobe ~]# cat /etc/vsftpd/ftpusers 
# Users that are not allowed to login via ftp
root
bin
daemon
adm
lp
sync
shutdown
halt
mail
news
uucp
operator
games
nobody
</code></pre>
<blockquote>
<p>在采用本地用户模式登录FTP服务器后，默认访问的是该用户的家目录，而且该目录的默认所有者、所属</p>
<p>组都是该用户自己，因此不存在写入权限不足的情况。但是当前的操作仍然被拒绝，这是因为我们刚才</p>
<p>将虚拟机系统还原到最初的状态了。为此，需要再次开启<code>SELinux</code>域中对FTP服务的允许策略</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# getsebool -a | grep ftp
ftpd_anon_write --&gt; off
ftpd_connect_all_unreserved --&gt; off
ftpd_connect_db --&gt; off
ftpd_full_access --&gt; off
ftpd_use_cifs --&gt; off
ftpd_use_fusefs --&gt; off
ftpd_use_nfs --&gt; off
ftpd_use_passive_mode --&gt; off
httpd_can_connect_ftp --&gt; off
httpd_enable_ftp_server --&gt; off
tftp_anon_write --&gt; off
tftp_home_dir --&gt; off
[root@linuxprobe ~]# setsebool -P ftpd_full_access=on
</code></pre>
<blockquote>
<p>配置妥当后再使用本地用户尝试登录FTP服务器，分别执行文件的创建、重命名及删除等命令。操作均成</p>
<p>功！</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe vsftpd]# ftp 192.168.10.10
Connected to 192.168.10.10 (192.168.10.10).
220 (vsFTPd 3.0.3)
Name (192.168.10.10:root): root
331 Please specify the password.
Password:此处输入该用户的密码
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; mkdir files
257 &quot;/root/files&quot; created
ftp&gt; rename files database
350 Ready for RNTO.
250 Rename successful.
ftp&gt; rmdir database
250 Remove directory operation successful.
ftp&gt; exit
221 Goodbye.
</code></pre>
<h4 id="12-2-3、虚拟用户模式"><a href="#12-2-3、虚拟用户模式" class="headerlink" title="12.2.3、虚拟用户模式"></a>12.2.3、虚拟用户模式</h4><blockquote>
<p>拟用户模式是专门创建出一个账号来登录FTP传输服务的，而且这个账号不能用于以<code>SSH</code>方式登录服务</p>
<p>器。当然，因为它的安全性较之于前面两种模式有了提升，所以配置流程也会稍微复杂一些。</p>
</blockquote>
<blockquote>
<p><strong>第1步</strong>：重新安装<code>vsftpd</code>服务。创建用于进行<code>FTP</code>认证的用户数据库文件，其中奇数行为账户名，偶数</p>
<p>行为密码。例如，分别创建<code>zhangsan</code>和<code>lisi</code>两个用户，密码均为<code>redhat</code></p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# cd /etc/vsftpd/
[root@linuxprobe vsftpd]# vim vuser.list
zhangsan
redhat
lisi
redhat
</code></pre>
<blockquote>
<p>由于明文信息既不安全，也不符合让<code>vsftpd</code>服务程序直接加载的格式，因此需要使用<code>db_load</code>命令用哈</p>
<p>希（<code>hash</code>）算法将原始的明文信息文件转换成数据库文件，并且降低数据库文件的权限（避免其他人看</p>
<p>到数据库文件的内容），然后再把原始的明文信息文件删除</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe vsftpd]# db_load -T -t hash -f vuser.list vuser.db
[root@linuxprobe vsftpd]# chmod 600 vuser.db
[root@linuxprobe vsftpd]# rm -f vuser.list
</code></pre>
<blockquote>
<p><strong>第2步</strong>：创建<code>vsftpd</code>服务程序用于存储文件的根目录以及用于虚拟用户映射的系统本地用户。<code>vsftpd</code>服</p>
<p>务用于存储文件的根目录指的是，当虚拟用户登录后所访问的默认位置。</p>
</blockquote>
<blockquote>
<p>由于<code>Linux</code>系统中的每一个文件都有所有者、所属组属性，例如使用虚拟账户“张三”新建了一个文件，但</p>
<p>是系统中找不到账户“张三”，就会导致这个文件的权限出现错误。为此，需要再创建一个可以映射到虚拟</p>
<p>用户的系统本地用户。简单来说，就是让虚拟用户默认登录到与之有映射关系的这个系统本地用户的家</p>
<p>目录中。虚拟用户创建的文件的属性也都归属于这个系统本地用户，从而避免Linux系统无法处理虚拟用</p>
<p>户所创建文件的属性权限。</p>
<p>为了方便管理<code>FTP</code>服务器上的数据，可以把这个系统本地用户的家目录设置为<code>/var</code>目录（该目录用来存</p>
<p>放经常发生改变的数据）。并且为了安全起见，将这个系统本地用户设置为不允许登录FTP服务器，这不</p>
<p>会影响虚拟用户登录，而且还能够避免黑客通过这个系统本地用户进行登录。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# useradd -d /var/ftproot -s /sbin/nologin virtual
[root@linuxprobe ~]# ls -ld /var/ftproot/
drwx------. 3 virtual virtual 74 Jul 14 17:50 /var/ftproot/
[root@linuxprobe ~]# chmod -Rf 755 /var/ftproot/
</code></pre>
<blockquote>
<p><strong>第3步</strong>：建立用于支持虚拟用户的PAM文件。</p>
</blockquote>
<blockquote>
<p><code>PAM</code>（可插拔认证模块）是一种认证机制，通过一些动态链接库和统一的<code>API</code>把系统提供的服务与认证</p>
<p>方式分开，使得系统管理员可以根据需求灵活调整服务程序的不同认证方式。通俗来讲，<code>PAM</code>是一组安</p>
<p>全机制的模块，系统管理员可以用来轻易地调整服务程序的认证方式，而不必对应用程序进行任何修</p>
<p>改。<code>PAM</code>采取了分层设计（应用程序层、应用接口层、鉴别模块层）的思想，其结构如图12-2所示</p>
</blockquote>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220822140938952.png" alt="图12-2 PAM的分层设计结构"></p>
<blockquote>
<p>新建一个用于虚拟用户认证的<code>PAM</code>文件<code>vsftpd.vu</code>，其中<code>PAM</code>文件内的“<code>db</code>&#x3D;”参数为使用<code>db_load</code>命令</p>
<p>生成的账户密码数据库文件的路径，但不用写数据库文件的后缀</p>
</blockquote>
<pre><code class="bahs">[root@linuxprobe ~]# vim /etc/pam.d/vsftpd.vu
auth       required     pam_userdb.so db=/etc/vsftpd/vuser
account    required     pam_userdb.so db=/etc/vsftpd/vuser
</code></pre>
<blockquote>
<p><strong>第4步</strong>：在<code>vsftpd</code>服务程序的主配置文件中通过<code>pam_service_name</code>参数将<code>PAM</code>认证文件的名称修改为</p>
<p><code>vsftpd.vu</code>。<code>PAM</code>作为应用程序层与鉴别模块层的连接纽带，可以让应用程序根据需求灵活地在自身插</p>
<p>入所需的鉴别功能模块。当应用程序需要<code>PAM</code>认证时，则需要在应用程序中定义负责认证的<code>PAM</code>配置文</p>
<p>件，实现所需的认证功能。</p>
</blockquote>
<blockquote>
<p>例如，在<code>vsftpd</code>服务程序的主配置文件中默认就带有参数<code>pam_service_name=vsftpd</code>，表示登录</p>
<p><code>FTP</code>服务器时是根据<code>/etc/pam.d/vsftpd</code>文件进行安全认证的。现在我们要做的就是把<code>vsftpd</code>主</p>
<p>配置文件中原有的<code>PAM</code>认证文件<code>vsftpd</code>修改为新建的<code>vsftpd.vu</code>文件即可。该操作中用到的参数以及</p>
<p>作用如下表所示。</p>
</blockquote>
<blockquote>
<p>利用<code>PAM</code>文件进行认证时使用的参数以及作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>anonymous_enable=NO</code></td>
<td>禁止匿名开放模式</td>
</tr>
<tr>
<td><code>local_enable=YES</code></td>
<td>允许本地用户模式</td>
</tr>
<tr>
<td><code>guest_enable=YES</code></td>
<td>开启虚拟用户模式</td>
</tr>
<tr>
<td><code>guest_username=virtual</code></td>
<td>指定虚拟用户账户</td>
</tr>
<tr>
<td><code>pam_service_name=vsftpd.vu</code></td>
<td>指定PAM文件</td>
</tr>
<tr>
<td><code>allow_writeable_chroot=YES</code></td>
<td>允许对禁锢的FTP根目录执行写入操作，而且不拒绝用户的登录请求</td>
</tr>
</tbody></table>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/vsftpd/vsftpd.conf  
  1 anonymous_enable=NO
  2 local_enable=YES
  3 write_enable=YES
  4 guest_enable=YES
  5 guest_username=virtual
  6 allow_writeable_chroot=YES
  7 local_umask=022
  8 dirmessage_enable=YES
  9 xferlog_enable=YES
 10 connect_from_port_20=YES
 11 xferlog_std_format=YES
 12 listen=NO
 13 listen_ipv6=YES
 14 pam_service_name=vsftpd.vu
 15 userlist_enable=YES
</code></pre>
<blockquote>
<p><strong>第5步</strong>：为虚拟用户设置不同的权限。虽然账户z<code>hangsan</code>和<code>lisi</code>都是用于<code>vsftpd</code>服务程序认证的虚拟</p>
<p>账户，但是我们依然想对这两人进行区别对待。比如，<strong>允许张三上传、创建、修改、查看、删除文件</strong>，</p>
<p>只允许李四<strong>查看文件</strong>。这可以通过<code>vsftpd</code>服务程序来实现。只需新建一个目录，在里面分别创建两个以</p>
<p><code>zhangsan</code>和<code>lisi</code>命名的文件，其中在名为<code>zhangsan</code>的文件中写入允许的相关权限（使用匿名用户的</p>
<p>参数）</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# mkdir /etc/vsftpd/vusers_dir/
[root@linuxprobe ~]# cd /etc/vsftpd/vusers_dir/
[root@linuxprobe vusers_dir]# touch lisi
[root@linuxprobe vusers_dir]# vim zhangsan
anon_upload_enable=YES
anon_mkdir_write_enable=YES
anon_other_write_enable=YES
</code></pre>
<blockquote>
<p>然后再次修改<code>vsftpd</code>主配置文件，通过添加<code>user_config_dir</code>参数来定义这两个虚拟用户不同权限的</p>
<p>配置文件所存放的路径。为了让修改后的参数立即生效，需要重启vsftpd服务程序并将该服务添加到开</p>
<p>机启动项中</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/vsftpd/vsftpd.conf
  1 anonymous_enable=NO
  2 local_enable=YES
  3 write_enable=YES
  4 guest_enable=YES
  5 guest_username=virtual
  6 allow_writeable_chroot=YES
  7 local_umask=022
  8 dirmessage_enable=YES
  9 xferlog_enable=YES
 10 connect_from_port_20=YES
 11 xferlog_std_format=YES
 12 listen=NO
 13 listen_ipv6=YES
 14 pam_service_name=vsftpd.vu
 15 userlist_enable=YES
 16 user_config_dir=/etc/vsftpd/vusers_dir
[root@linuxprobe ~]# systemctl restart vsftpd
[root@linuxprobe ~]# systemctl enable vsftpd
Created symlink /etc/systemd/system/multi-user.target.wants/vsftpd.service → /usr/lib/systemd/system/vsftpd.service.
</code></pre>
<blockquote>
<p><strong>第6步</strong>：设置<code>SELinux</code>域允许策略，然后使用虚拟用户模式登录<code>FTP</code>服务器。相信大家可以猜到，</p>
<p><code>SELinux</code>会继续来捣乱。所以，先按照前面实验中的步骤开启<code>SELinux</code>域的允许策略，以免再次出现操</p>
<p>作失败的情况</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# getsebool -a | grep ftp
ftpd_anon_write --&gt; off
ftpd_connect_all_unreserved --&gt; off
ftpd_connect_db --&gt; off
ftpd_full_access --&gt; off
ftpd_use_cifs --&gt; off
ftpd_use_fusefs --&gt; off
ftpd_use_nfs --&gt; off
ftpd_use_passive_mode --&gt; off
httpd_can_connect_ftp --&gt; off
httpd_enable_ftp_server --&gt; off
tftp_anon_write --&gt; off
tftp_home_dir --&gt; off
[root@linuxprobe ~]# setsebool -P ftpd_full_access=on
</code></pre>
<h3 id="12-3、TFTP简单文件传输协议"><a href="#12-3、TFTP简单文件传输协议" class="headerlink" title="12.3、TFTP简单文件传输协议"></a>12.3、TFTP简单文件传输协议</h3><blockquote>
<p>简单文件传输协议（<code>Trivial File Transfer Protocol</code>，<code>TFTP</code>）是一种基于<code>UDP</code>协议在客户端和服</p>
<p>务器之间进行简单文件传输的协议。顾名思义，它提供不复杂、开销不大的文件传输服务，可将其当作</p>
<p><code>FTP</code>协议的简化版本。</p>
</blockquote>
<blockquote>
<p><code>TFTP</code>的命令功能不如<code>FTP</code>服务强大，甚至不能遍历目录，在安全性方面也弱于<code>FTP</code>服务。而且，由于</p>
<p><code>TFTP</code>在传输文件时采用的是<code>UDP</code>协议，占用的端口号为69，因此文件的传输过程也不像<code>FTP</code>协议那样可</p>
<p>靠。但是，因为<code>TFTP</code>不需要客户端的权限认证，也就减少了无谓的系统和网络带宽消耗，因此在传输琐</p>
<p>碎（<code>trivial</code>）不大的文件时，效率更高</p>
</blockquote>
<blockquote>
<p>接下来在系统上安装相关的软件包，进行体验。其中，<code>tftp-server</code>是服务程序，<code>tftp</code>是用于连接测</p>
<p>试的客户端工具，<code>xinetd</code>是管理服务</p>
</blockquote>
<blockquote>
<p>在<code>Linux</code>系统中，<code>TFTP</code>服务是使用<code>xinetd</code>服务程序来管理的。<code>xinetd</code>服务可以用来管理多种轻量级</p>
<p>的网络服务，而且具有强大的日志功能。它专门用于控制那些比较小的应用程序的开启与关闭，有点类</p>
<p>似于带有独立开关的插线板（见图12-3），想开启那个服务，就编辑对应的<code>xinetd</code>配置文件的开关参</p>
<p>数。</p>
</blockquote>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220822141955448.png" alt="图12-3 一个带有独立开关的插线板"></p>
<blockquote>
<p>简单来说，在安装<code>TFTP</code>软件包后，还需要在<code>xinetd</code>服务程序中将其开启。在<code>RHEL 8</code>系统中，<code>tftp</code>所</p>
<p>对应的配置文件默认不存在，需要用户根据示例文件（<code>/usr/share/doc/xinetd/sample.conf</code>）自行创建</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/xinetd.d/tftp
service tftp
&#123;
        socket_type             = dgram
        protocol                = udp
        wait                    = yes
        user                    = root
        server                  = /usr/sbin/in.tftpd
        server_args             = -s /var/lib/tftpboot
        disable                 = no
        per_source              = 11
        cps                     = 100 2
        flags                   = IPv4
&#125;
</code></pre>
<blockquote>
<p>然后，重启<code>xinetd</code>服务并将它添加到系统的开机启动项中，以确保TFTP服务在系统重启后依然处于</p>
<p>运行状态。考虑到有些系统的防火墙默认没有允许<code>UDP</code>协议的69端口，因此需要手动将该端口号加入</p>
<p>到防火墙的允许策略中</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# systemctl restart tftp
[root@linuxprobe ~]# systemctl enable tftp
[root@linuxprobe ~]# systemctl restart xinetd
[root@linuxprobe ~]# systemctl enable xinetd
[root@linuxprobe ~]# firewall-cmd --zone=public --permanent --add-port=69/udp
success
[root@linuxprobe ~]# firewall-cmd --reload 
success
</code></pre>
<blockquote>
<p> <code>TFTP</code>的根目录为<code>/var/lib/tftpboot</code>。可以使用刚才安装好的<code>tftp</code>命令尝试访问其中的文件，亲身</p>
<p>体验<code>TFTP</code>服务的文件传输过程。在使用<code>tftp</code>命令访问文件时，可能会用到表中的参数</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>?</code></td>
<td>帮助信息</td>
</tr>
<tr>
<td><code>put</code></td>
<td>上传文件</td>
</tr>
<tr>
<td><code>get</code></td>
<td>下载文件</td>
</tr>
<tr>
<td><code>verbose</code></td>
<td>显示详细的处理信息</td>
</tr>
<tr>
<td><code>status</code></td>
<td>显示当前的状态信息</td>
</tr>
<tr>
<td><code>binary</code></td>
<td>使用二进制进行传输</td>
</tr>
<tr>
<td><code>ascii</code></td>
<td>使用ASCII码进行传输</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td>设置重传的超时时间</td>
</tr>
<tr>
<td><code>quit</code></td>
<td>退出</td>
</tr>
</tbody></table>
<pre><code class="bash">[root@linuxprobe ~]# echo &quot;i love linux&quot; &gt; /var/lib/tftpboot/readme.txt
[root@linuxprobe ~]# tftp 192.168.10.10
tftp&gt; get readme.txt
tftp&gt; quit
[root@linuxprobe ~]# ls
anaconda-ks.cfg  Documents  initial-setup-ks.cfg  Pictures  readme.txt  Videos
Desktop          Downloads  Music                 Public    Templates
[root@linuxprobe ~]# cat readme.txt 
i love linux
</code></pre>
<h2 id="十三、使用Samba或NFS实现文件共享"><a href="#十三、使用Samba或NFS实现文件共享" class="headerlink" title="十三、使用Samba或NFS实现文件共享"></a>十三、使用Samba或NFS实现文件共享</h2><hr>
<h3 id="13-1、SAMBA文件共享服务"><a href="#13-1、SAMBA文件共享服务" class="headerlink" title="13.1、SAMBA文件共享服务"></a>13.1、<code>SAMBA</code>文件共享服务</h3><p>1987年，微软公司和英特尔公司共同制定了<code>SMB</code>（<code>Server Messages Block</code>，服务器消息块）协议，旨在</p>
<p>解决局域网内的文件或打印机等资源的共享问题，这也使得在多个主机之间共享文件变得越来越简单。到了</p>
<p>1991年，当时还在读大学的<code>Tridgwell</code>为了解决<code>Linux</code>系统与<code>Windows</code>系统之间的文件共享问题，基于<code>SMB</code></p>
<p>协议开发出了<code>SMBServer</code>服务程序。这是一款开源的文件共享软件，经过简单配置就能够实现<code>Linux</code>系统与</p>
<p><code>Windows</code>系统之间的文件共享工作。当时，<code>Tridgwell</code>想把这款软件的名字<code>SMBServer</code>注册成为商标，但却</p>
<p>被商标局以“SMB是没有意义的字符”为由而拒绝了申请。后来<code>Tridgwell</code>不断翻看词典，突然看到一个拉丁</p>
<p>舞蹈的名字—<code>Samba</code>，而且这个热情洋溢的舞蹈名字中又恰好包含了“SMB”，于是<code>Samba</code>服务程序的名字由此</p>
<p>诞生（见图13-1）。<code>Samba</code>服务程序现在已经成为在<code>Linux</code>系统与<code>Windows</code>系统之间共享文件的最佳选择。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220822152004052.png" alt="图13-1 Samba服务程序的logo"></p>
<blockquote>
<p><code>Samba</code>服务程序的配置方法与之前讲解的很多服务的配置方法类似，首先需要先通过软件仓库来安装</p>
<p><code>Samba</code>服务程序（<code>Samba</code>服务程序的名字也恰巧是软件包的名字）。顺带再安装一个<code>samba-client</code>软</p>
<p>件包，这是一会儿用于测试共享目录的客户端程序：</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# yum install samba samba-client
</code></pre>
<blockquote>
<p>安装完毕后打开<code>Samba</code>服务程序的主配置文件，好在参数并不多，只有37行。其中第17～22行代表共享</p>
<p><strong>每位登录用户的家目录内容</strong>。虽然在某些情况下这可以更方便地共享文件，但这个默认操作着实有些危</p>
<p>险，建议不要共享，将其删除掉。第24～29行是用SMB协议共享<strong>本地的打印机设备</strong>，方便局域网内的用</p>
<p>户远程使用打印机设备。当前我们没有打印机设备，因此建议也将其删除掉，不共享。最后的第31～37</p>
<p>行依然为<strong>共享打印机设备的参数</strong>，同样建议予以删除。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/samba/smb.conf
  1 # See smb.conf.example for a more detailed config file or
  2 # read the smb.conf manpage.
  3 # Run &#39;testparm&#39; to verify the config is correct after
  4 # you modified it.
  5 
  6 [global]
  7         workgroup = SAMBA
  8         security = user
  9 
 10         passdb backend = tdbsam
 11 
 12         printing = cups
 13         printcap name = cups
 14         load printers = yes
 15         cups options = raw
 16 
 17 [homes]
 18         comment = Home Directories
 19         valid users = %S, %D%w%S
 20         browseable = No
 21         read only = No
 22         inherit acls = Yes
 23 
 24 [printers]
 25         comment = All Printers
 26         path = /var/tmp
 27         printable = Yes
 28         create mask = 0600
 29         browseable = No
 30 
 31 [print$]
 32         comment = Printer Drivers
 33         path = /var/lib/samba/drivers
 34         write list = @printadmin root
 35         force group = @printadmin
 36         create mask = 0664
 37         directory mask = 0775
</code></pre>
<blockquote>
<p>在对<code>Samba</code>服务的主配置文件进行一顿删减操作之后，最后的有效配置参数只剩下了8行。所剩不多的参</p>
<p>数中，还能继续删除不需要的参数。例如，第5～8行参数中所提到的<code>cups</code>的全称为<code>Common UNIX </code></p>
<p><code>Printing System</code>（通用UNIX打印系统），依然是用于打印机或打印服务器的，继续予以删除。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# cat /etc/samba/smb.conf
  1 [global]
  2         workgroup = SAMBA
  3         security = user
  4         passdb backend = tdbsam
  5         printing = cups
  6         printcap name = cups
  7         load printers = yes
  8         cups options = raw
</code></pre>
<blockquote>
<p> <code>Samba</code>服务程序中的参数以及作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>行数</th>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><code># See smb.conf.example for a more detailed config file or</code></td>
<td>注释信息</td>
</tr>
<tr>
<td>2</td>
<td><code># read the smb.conf manpage.</code></td>
<td>注释信息</td>
</tr>
<tr>
<td>3</td>
<td><code># Run &#39;testparm&#39; to verify the config is correct after</code></td>
<td>注释信息</td>
</tr>
<tr>
<td>4</td>
<td><code># you modified it.</code></td>
<td>注释信息</td>
</tr>
<tr>
<td>5</td>
<td><code>[global]</code></td>
<td>全局参数</td>
</tr>
<tr>
<td>6</td>
<td><code>workgroup = SAMBA</code></td>
<td>工作组名称</td>
</tr>
<tr>
<td>7</td>
<td></td>
<td></td>
</tr>
<tr>
<td>8</td>
<td><code>security = user</code></td>
<td>安全验证的方式，总共有4种</td>
</tr>
<tr>
<td>9</td>
<td></td>
<td></td>
</tr>
<tr>
<td>10</td>
<td><code>passdb backend = tdbsam</code></td>
<td>定义用户后台的类型，总共有3种</td>
</tr>
<tr>
<td>11</td>
<td></td>
<td></td>
</tr>
<tr>
<td>12</td>
<td><code>printing = cups</code></td>
<td>打印服务协议</td>
</tr>
<tr>
<td>13</td>
<td><code>printcap name = cups</code></td>
<td>打印服务名称</td>
</tr>
<tr>
<td>14</td>
<td><code>load printers = yes</code></td>
<td>是否加载打印机</td>
</tr>
<tr>
<td>15</td>
<td><code>cups options = raw</code></td>
<td>打印机的选项</td>
</tr>
<tr>
<td>16</td>
<td></td>
<td></td>
</tr>
<tr>
<td>17</td>
<td><code>[homes]</code></td>
<td>共享名称</td>
</tr>
<tr>
<td>18</td>
<td><code>comment = Home Directories</code></td>
<td>描述信息</td>
</tr>
<tr>
<td>19</td>
<td><code>valid users = %S, %D%w%S</code></td>
<td>可用账户</td>
</tr>
<tr>
<td>20</td>
<td><code>browseable = No</code></td>
<td>指定共享信息是否在“网上邻居”中可见</td>
</tr>
<tr>
<td>21</td>
<td><code>read only = No</code></td>
<td>是否只读</td>
</tr>
<tr>
<td>22</td>
<td><code>inherit acls = Yes</code></td>
<td>是否继承访问控制列表</td>
</tr>
<tr>
<td>23</td>
<td></td>
<td></td>
</tr>
<tr>
<td>24</td>
<td><code>[printers]</code></td>
<td>共享名称</td>
</tr>
<tr>
<td>25</td>
<td><code>comment = All Printers</code></td>
<td>描述信息</td>
</tr>
<tr>
<td>26</td>
<td><code>path = /var/tmp</code></td>
<td>共享路径</td>
</tr>
<tr>
<td>27</td>
<td><code>printable = Yes</code></td>
<td>是否可打印</td>
</tr>
<tr>
<td>28</td>
<td><code>create mask = 0600</code></td>
<td>文件权限</td>
</tr>
<tr>
<td>29</td>
<td><code>browseable = No</code></td>
<td>指定共享信息是否在“网上邻居”中可见</td>
</tr>
<tr>
<td>30</td>
<td></td>
<td></td>
</tr>
<tr>
<td>31</td>
<td><code>[print$]</code></td>
<td>共享名称</td>
</tr>
<tr>
<td>32</td>
<td><code>comment = Printer Drivers</code></td>
<td>描述信息</td>
</tr>
<tr>
<td>33</td>
<td><code>path = /var/lib/samba/drivers</code></td>
<td>共享路径</td>
</tr>
<tr>
<td>34</td>
<td><code>write list = @printadmin root</code></td>
<td>可写入文件的用户列表</td>
</tr>
<tr>
<td>35</td>
<td><code>force group = @printadmin</code></td>
<td>用户组列表</td>
</tr>
<tr>
<td>36</td>
<td><code>create mask = 0664</code></td>
<td>文件权限</td>
</tr>
<tr>
<td>37</td>
<td><code>directory mask = 0775</code></td>
<td>目录权限</td>
</tr>
</tbody></table>
<blockquote>
<p> <code>security</code>参数代表用户登录<code>Samba</code>服务时采用的验证方式。总共有4种可用参数：</p>
<ul>
<li><strong>share</strong>：代表主机无须验证密码。这相当于vsftpd服务的匿名公开访问模式，比较方便，但安全性很差。</li>
<li><strong>user</strong>：代表登录Samba服务时需要使用账号密码进行验证，通过后才能获取到文件。这是默认的验证方式，最为常用。</li>
<li><strong>domain</strong>：代表通过<strong>域控制器</strong>进行身份验证，用来限制用户的来源域。</li>
<li><strong>server</strong>：代表使用独立主机验证来访用户提供的密码。这相当于集中管理账号，并不常用。</li>
</ul>
</blockquote>
<h4 id="13-1-1、配置共享资源"><a href="#13-1-1、配置共享资源" class="headerlink" title="13.1.1、配置共享资源"></a>13.1.1、配置共享资源</h4><p><code>Samba</code>服务程序的主配置文件与前面<code>Apache</code>服务很相似，包括<strong>全局配置参数</strong>和<strong>区域配置参数</strong>。全局配置参</p>
<p>数用于设置整体的资源共享环境，对里面的每一个独立的共享资源都有效。区域配置参数则用于设置单独的共</p>
<p>享资源，且仅对该资源有效。创建共享资源的方法很简单，只要将表中的参数写入到<code>Samba</code>服务程序的主</p>
<p>配置文件中，然后重启该服务即可。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>[database]</code></td>
<td>共享名称为database</td>
</tr>
<tr>
<td><code>comment = Do not arbitrarily modify the database file</code></td>
<td>警告用户不要随意修改数据库</td>
</tr>
<tr>
<td><code>path = /home/database</code></td>
<td>共享目录为&#x2F;home&#x2F;database</td>
</tr>
<tr>
<td><code>public = no</code></td>
<td>关闭“所有人可见”</td>
</tr>
<tr>
<td><code>writable = yes</code></td>
<td>允许写入操作</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>第1步</strong>：<strong>创建用于访问共享资源的账户信息</strong>。在RHEL 8系统中，<code>Samba</code>服务程序默认使用的是用户密码</p>
<p>认证模式（<code>user</code>）。这种认证模式可以确保仅让有密码且受信任的用户访问共享资源，而且认证过程也</p>
<p>十分简单。不过，只有建立账户信息数据库之后，才能使用用户密码认证模式。另外，<code>Samba</code>服<strong>务程序</strong></p>
<p><strong>的数据库要求账户必须在当前系统中已经存在</strong>，否则日后创建文件时将导致文件的权限属性混乱不堪，</p>
<p>由此引发错误。</p>
</blockquote>
<blockquote>
<p> <code>pdbedit</code>用于管理<code>Samba</code>服务程序的账户信息数据库，格式为“<code>pdbedit</code> [选项]账户”。在第一次把账户</p>
<p>信息写入到数据库时需要使用<code>-a</code>参数，以后在执行修改密码、删除账户等操作时就不再需要该参数了。</p>
<p><code>pdbedit</code>中使用的参数以及作用如下表所示。</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-a </code>用户名</td>
<td>建立<code>Samba</code>用户</td>
</tr>
<tr>
<td><code>-x</code> 用户名</td>
<td>删除<code>Samba</code>用户</td>
</tr>
<tr>
<td><code>-L</code></td>
<td>列出用户列表</td>
</tr>
<tr>
<td><code>-Lv</code></td>
<td>列出用户详细信息的列表</td>
</tr>
</tbody></table>
<pre><code class="bash">[root@linuxprobe ~]# id linuxprobe
uid=1000(linuxprobe) gid=1000(linuxprobe) groups=1000(linuxprobe)
[root@linuxprobe ~]# pdbedit -a -u linuxprobe
new password:此处输入该账户在Samba服务数据库中的密码
retype new password:再次输入密码进行确认
Unix username:        linuxprobe
NT username:          
Account Flags:        [U          ]
User SID:             S-1-5-21-650031181-3622628401-3290108334-1000
Primary Group SID:    S-1-5-21-650031181-3622628401-3290108334-513
Full Name:            linuxprobe
Home Directory:       \\linuxprobe\linuxprobe
HomeDir Drive:        
Logon Script:         
Profile Path:         \\linuxprobe\linuxprobe\profile
Domain:               LINUXPROBE
Account desc:         
Workstations:         
Munged dial:          
Logon time:           0
Logoff time:          Wed, 06 Feb 2036 23:06:39 CST
Kickoff time:         Wed, 06 Feb 2036 23:06:39 CST
Password last set:    Fri, 05 Mar 2021 18:52:35 CST
Password can change:  Fri, 05 Mar 2021 18:52:35 CST
Password must change: never
Last bad password   : 0
Bad password count  : 0
Logon hours         : FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
</code></pre>
<blockquote>
<p><strong>第2步</strong>：<strong>创建用于共享资源的文件目录</strong>。在创建时，不仅要考虑到文件读写权限的问题，而且由于</p>
<p><code>/home</code>目录是系统中普通用户的家目录，因此还需要考虑应用于该目录的<code>SELinux</code>安全上下文所带来的</p>
<p>限制。在<code>Samba</code>的帮助手册中显示，正确的文件上下文值应该是<code>samba_share_t</code>，所以只需要修改完毕</p>
<p>后执行<code>restorecon</code>命令，就能让应用于目录的新<code>SELinux</code>安全上下文立即生效。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# mkdir /home/database
[root@linuxprobe ~]# chown -Rf linuxprobe:linuxprobe /home/database
[root@linuxprobe ~]# semanage fcontext -a -t samba_share_t /home/database
[root@linuxprobe ~]# restorecon -Rv /home/database
Relabeled /home/database from unconfined_u:object_r:user_home_dir_t:s0 to unconfined_u:object_r:samba_share_t:s0
</code></pre>
<blockquote>
<p><strong>第3步</strong>：<strong>设置<code>SELinux</code>服务与策略，使其允许通过<code>Samba</code>服务程序访问普通用户家目录</strong>。</p>
<p>执行<code>getsebool</code>命令，筛选出所有与<code>Samba</code>服务程序相关的<code>SELinux</code>域策略，根据策略的名称（</p>
<p>和经验）选择出正确的策略条目进行开启即可</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# getsebool -a | grep samba
samba_create_home_dirs --&gt; off
samba_domain_controller --&gt; off
samba_enable_home_dirs --&gt; off
samba_export_all_ro --&gt; off
samba_export_all_rw --&gt; off
samba_load_libgfapi --&gt; off
samba_portmapper --&gt; off
samba_run_unconfined --&gt; off
samba_share_fusefs --&gt; off
samba_share_nfs --&gt; off
sanlock_use_samba --&gt; off
tmpreaper_use_samba --&gt; off
use_samba_home_dirs --&gt; off
virt_use_samba --&gt; off
[root@linuxprobe ~]# setsebool -P samba_enable_home_dirs on
</code></pre>
<blockquote>
<p><strong>第4步</strong>：在<code>Samba</code>服务程序的主配置文件中，根写入共享信息。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/samba/smb.conf 
[global]
        workgroup = SAMBA
        security = user
        passdb backend = tdbsam
[database]
        comment = Do not arbitrarily modify the database file
        path = /home/database
        public = no
        writable = yes
</code></pre>
<blockquote>
<p><strong>第5步</strong>：<code>Samba</code>服务程序的配置工作基本完毕。<code>Samba</code>服务程序在<code>Linux</code>系统中的名字为smb，所以重启</p>
<p><code>smb</code>服务并加入到启动项中，保证在重启服务器后依然能够为用户持续提供服务。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# systemctl restart smb 
[root@linuxprobe ~]# systemctl enable smb 
Created symlink /etc/systemd/system/multi-user.target.wants/smb.service → /usr/lib/systemd/system/smb.service.
</code></pre>
<blockquote>
<p>为了避免防火墙限制用户访问，这里将<code>iptables</code>防火墙清空，再把<code>Samba</code>服务添加到<code>firewalld</code>防火</p>
<p>墙中，确保万无一失。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# iptables -F
[root@linuxprobe ~]# iptables-save 
[root@linuxprobe ~]# firewall-cmd --zone=public --permanent --add-service=samba
success
[root@linuxprobe ~]# firewall-cmd --reload
success
</code></pre>
<blockquote>
<p><strong>第6步：</strong>可以使用“<code>systemctl status smb</code>”命令查看服务器是否启动了<code>Samba</code>服务。如果想进一步查看</p>
<p><code>Samba</code>服务都共享了哪些目录，则可以使用<code>smbclient</code>命令来查看共享详情；-<code>U</code>参数指定了用户名称</p>
<p>（用哪位用户挂载了<code>Samba</code>服务，就用哪位用户的身份进行查看）；<code>-L</code>参数列出了共享清单。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# smbclient -U linuxprobe -L 192.168.10.10
Enter SAMBA\linuxprobe&#39;s password: 此处输入该账户在Samba服务数据库中的密码

    Sharename       Type      Comment
    ---------       ----      -------
    database        Disk      Do not arbitrarily modify the database file
    IPC$            IPC       IPC Service (Samba 4.9.1)
Reconnecting with SMB1 for workgroup listing.

    Server               Comment
    ---------            -------

    Workgroup            Master
    ---------            -------
</code></pre>
<h4 id="13-1-2、Windows挂载共享"><a href="#13-1-2、Windows挂载共享" class="headerlink" title="13.1.2、Windows挂载共享"></a>13.1.2、<code>Windows</code>挂载共享</h4><p>无论<code>Samba</code>共享服务是部署<code>Windows</code>系统上还是部署在<code>Linux</code>系统上，通过<code>Windows</code>系统进行访问时，其步</p>
<p>骤和方法都是一样的。下面假设<code>Samba</code>共享服务部署在<code>Linux</code>系统上，并通过<code>Windows</code>系统来访问<code>Samba</code>服</p>
<p>务。<code>Samba</code>共享服务器和<code>Windows</code>客户端的<code>IP</code>地址可以根据下表来设置。</p>
<blockquote>
<p> <code>Samba</code>服务器和<code>Windows</code>客户端使用的操作系统以及<code>IP</code>地址</p>
</blockquote>
<table>
<thead>
<tr>
<th>主机名称</th>
<th>操作系统</th>
<th>IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>Samba共享服务器</td>
<td>RHEL 8</td>
<td>192.168.10.10</td>
</tr>
<tr>
<td>Linux客户端</td>
<td>RHEL 8</td>
<td>192.168.10.20</td>
</tr>
<tr>
<td>Windows客户端</td>
<td>Windows 10</td>
<td>192.168.10.30</td>
</tr>
</tbody></table>
<p>要在<code>Windows</code>系统中访问共享资源，只需要单击<code>Windows</code>系统的“开始”按钮后输入两个反斜杠，然后再添加</p>
<p>服务器的<code>IP</code>地址即可，如图13-2所示</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220822155530601.png" alt="图13-2 在Windows系统中访问共享资源"></p>
<p>现在应该就能看到<code>Samba</code>共享服务的登录界面了。先使用<code>linuxprobe</code>账户的系统本地密码尝试登录，结果出</p>
<p>现了如图13-3所示的报错信息。由此可以验证，在<code>RHEL 8</code>系统中，<code>Samba</code>服务程序使用的是独立的账户信息</p>
<p>数据库。所以，即便在<code>Linux</code>系统中有一个<code>linuxprobe</code>账户，<code>Samba</code>服务程序使用的账户信息数据库中也有</p>
<p>一个同名的<code>linuxprobe</code>账户，大家一定要弄清楚它们各自所对应的密码，它们仅仅是名称相同而已。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220822155701123.png" alt="图13-3 访问Samba共享服务提示出错"></p>
<p>在正确输入<code>Samba</code>服务数据库中的<code>linuxprobe</code>账户名以及使用<code>pdbedit</code>命令设置的密码后，就可以登录到</p>
<p><code>Samba</code>服务程序的共享界面中了，如图13-4所示。此时，可以尝试执行查看、写入、更名、删除文件等操</p>
<p>作。</p>
<p>由于<code>Windows</code>系统的缓存原因，有可能您在第二次登录时提供了正确的账户和密码，依然会报错，这时只需</p>
<p>要重新启动一下<code>Windows</code>客户端就没问题了（如果<code>Windows</code>系统依然报错，请检查上述步骤是否有做错的地</p>
<p>方）。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220822160329092.png" alt="图13-4 成功访问Samba共享服务"></p>
<h4 id="13-1-3、Linux挂载共享"><a href="#13-1-3、Linux挂载共享" class="headerlink" title="13.1.3、Linux挂载共享"></a>13.1.3、<code>Linux</code>挂载共享</h4><p>上面的实验操作可能会让各位读者误以为<code>Samba</code>服务程序只是为了解决<code>Linux</code>系统和<code>Windows</code>系统的资源共</p>
<p>享问题而设计的。其实，<code>Samba</code>服务程序还可以实现<code>Linux</code>系统之间的文件共享。请各位读者按照下表来设</p>
<p>置<code>Samba</code>服务程序所在主机（即<code>Samba</code>共享服务器）和<code>Linux</code>客户端使用的<code>IP</code>地址，然后在客户端安装支持</p>
<p>文件共享服务的软件包（<code>cifs-utils</code>）。</p>
<blockquote>
<p><code>Samba</code>共享服务器和<code>Linux</code>客户端各自使用的操作系统以及<code>IP</code>地址</p>
</blockquote>
<table>
<thead>
<tr>
<th>主机名称</th>
<th>操作系统</th>
<th>IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>Samba共享服务器</td>
<td>RHEL 8</td>
<td>192.168.10.10</td>
</tr>
<tr>
<td>Linux客户端</td>
<td>RHEL 8</td>
<td>192.168.10.20</td>
</tr>
<tr>
<td>Windows客户端</td>
<td>Windows 10</td>
<td>192.168.10.30</td>
</tr>
</tbody></table>
<pre><code class="bash">[root@linuxprobe ~]# dnf install cifs-utils
Updating Subscription Management repositories.
Unable to read consumer identity
This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.
AppStream                                                    3.1 MB/s | 3.2 kB     00:00    
BaseOS                                                       2.7 MB/s | 2.7 kB     00:00    
Dependencies resolved.
=============================================================================================
 Package                Arch               Version                  Repository          Size
=============================================================================================
Installing:
 cifs-utils             x86_64             6.8-2.el8                BaseOS              93 k

Transaction Summary
=============================================================================================
Install  1 Package         
………………省略部分输出信息………………    
Installed:
  cifs-utils-6.8-2.el8.x86_64                                                     
Complete!
</code></pre>
<p>安装好软件包后，在<code>Linux</code>客户端创建一个用于挂载<code>Samba</code>服务共享资源的目录。这个目录可以与服务器上</p>
<p>的共享名称同名，以便于日后查找。<code>mount</code>命令中的<code>-t</code>参数用于指定协议类型，<code>-o</code>参数用于指定用户名和</p>
<p>密码，最后追加上服务器<code>IP</code>地址、共享名称和本地挂载目录即可。服务器IP地址后面的共享名称指的是配置</p>
<p>文件中[<code>database</code>]的值，而不是服务器本地挂载的目录名称。虽然这两个值可能一样，但大家应该认出它们</p>
<p>的区别。</p>
<pre><code class="bash">[root@linuxprobe ~]# mkdir /database
[root@linuxprobe ~]# mount -t cifs -o username=linuxprobe,password=redhat //192.168.10.10/database /database
[root@linuxprobe ~]# df -h
Filesystem                Size  Used Avail Use% Mounted on
devtmpfs                  969M     0  969M   0% /dev
tmpfs                     984M     0  984M   0% /dev/shm
tmpfs                     984M  9.6M  974M   1% /run
tmpfs                     984M     0  984M   0% /sys/fs/cgroup
/dev/mapper/rhel-root      17G  3.9G   14G  23% /
/dev/sr0                  6.7G  6.7G     0 100% /media/cdrom
/dev/sda1                1014M  152M  863M  15% /boot
tmpfs                     197M   16K  197M   1% /run/user/42
tmpfs                     197M  3.4M  194M   2% /run/user/0
//192.168.10.10/database   17G  3.9G   14G  23% /database
</code></pre>
<p>如果在每次重启电脑后都需要使用<code>mount</code>命令手动挂载远程共享目录，是不是觉得很麻烦呢？其实可以按照</p>
<p><code>Samba</code>服务的用户名、密码、共享域的顺序将相关信息写入一个认证文件中，然后让<code>/etc/fstab</code>文件和系统</p>
<p>自动加载它。为了保证不被其他人随意看到，最后把这个认证文件的权限修改为仅<code>root</code>管理员才能够读写：</p>
<pre><code class="bash">[root@linuxprobe ~]# vim auth.smb
username=linuxprobe
password=redhat
domain=MYGROUP
[root@linuxprobe ~]# chmod 600 auth.smb
</code></pre>
<p>将挂载信息写入<code>/etc/fstab</code>文件中，以确保共享挂载信息在服务器重启后依然生效</p>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/fstab
#
# /etc/fstab
# Created by anaconda on Thu Feb 25 10:42:11 2021
#
# Accessible filesystems, by reference, are maintained under &#39;/dev/disk/&#39;.
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.
#
# After editing this file, run &#39;systemctl daemon-reload&#39; to update systemd
# units generated from this file.
#
/dev/mapper/rhel-root                      /             xfs     defaults                    0 0
UUID=37d0bdc6-d70d-4cc0-b356-51195ad90369  /boot         xfs     defaults                    1 0
/dev/mapper/rhel-swap                      swap          swap    defaults                    0 0
/dev/cdrom                                 /media/cdrom  iso9660 defaults                    0 0 
//192.168.10.10/database                   /database     cifs    credentials=/root/auth.smb  0 0
[root@linuxprobe ~]# mount -a
</code></pre>
<p><code>Linux</code>客户端成功地挂载了<code>Samba</code>服务的共享资源。进入到挂载目录<code>/database</code>后就可以看到<code>Windows</code>系统</p>
<p>访问<code>Samba</code>服务程序时留下来的文件了（即文件<code>Memo.txt</code>）。当然，也可以对该文件进行读写操作并保存。</p>
<pre><code class="bash">[root@linuxprobe ~]# cat /database/Memo.txt
i can edit it .
</code></pre>
<h3 id="13-2、NFS网络文件系统"><a href="#13-2、NFS网络文件系统" class="headerlink" title="13.2、NFS网络文件系统"></a>13.2、<code>NFS</code>网络文件系统</h3><p><code>NFS</code>网络文件系统服务可以将远程<code>Linux</code>系统上的文件共享资源挂载到本地主机的目录上，从而使得本地</p>
<p>主机（<code>Linux</code>客户端）基于<code>TCP/IP</code>协议，像使用本地主机上的资源那样读写远程<code>Linux</code>系统上的共享文件。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220822165956177.png"></p>
<blockquote>
<p>安装<code>NFS</code></p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# dnf install nfs-utils
Updating Subscription Management repositories.
Unable to read consumer identity
This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.
Last metadata expiration check: 0:00:12 ago on Sat 06 Mar 2021 04:48:38 AM CST.
Package nfs-utils-1:2.3.3-14.el8.x86_64 is already installed.
Dependencies resolved.
Nothing to do.
Complete!
</code></pre>
<blockquote>
<p> <strong>第1步</strong>：为了检验<code>NFS</code>服务配置的效果，我们需要使用两台<code>Linux</code>主机（一台充当<code>NFS</code>服务器，一台充</p>
<p>当<code>NFS</code>客户端）</p>
</blockquote>
<blockquote>
<p>  两台Linux主机所使用的操作系统以及IP地址</p>
</blockquote>
<table>
<thead>
<tr>
<th>主机名称</th>
<th>操作系统</th>
<th>IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>NFS服务器</td>
<td>RHEL 8</td>
<td>192.168.10.10</td>
</tr>
<tr>
<td>NFS客户端</td>
<td>RHEL 8</td>
<td>192.168.10.20</td>
</tr>
</tbody></table>
<blockquote>
<p>要忘记配置好防火墙，以免默认的防火墙策略禁止正常的<code>NFS</code>共享服务。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# iptables -F
[root@linuxprobe ~]# iptables-save
[root@linuxprobe ~]# firewall-cmd --permanent --zone=public --add-service=nfs
success
[root@linuxprobe ~]# firewall-cmd --permanent --zone=public --add-service=rpc-bind
success
[root@linuxprobe ~]# firewall-cmd --permanent --zone=public --add-service=mountd
success
[root@linuxprobe ~]# firewall-cmd --reload
success
</code></pre>
<blockquote>
<p><strong>第2步</strong>：在<code>NFS</code>服务器上建立用于<code>NFS</code>文件共享的目录，并设置足够的权限确保其他人也有写入权限</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# mkdir /nfsfile
[root@linuxprobe ~]# chmod -R 777 /nfsfile
[root@linuxprobe ~]# echo &quot;welcome to linuxprobe.com&quot; &gt; /nfsfile/readme
</code></pre>
<blockquote>
<p><strong>第3步</strong>：<code>NFS</code>服务程序的配置文件为<code>/etc/exports</code>，默认情况下里面没有任何内容。我们可以按照“共享</p>
<p>目录的路径 允许访问的<code>NFS</code>客户端（共享权限参数）”的格式，定义要共享的目录与相应的权限。</p>
</blockquote>
<p>例如，如果想要把<code>/nfsfile</code>目录共享给192.168.10.0&#x2F;24网段内的所有主机，让这些主机都拥有读写权</p>
<p>限，在将数据写入到NFS服务器的硬盘中后才会结束操作，最大限度保证数据不丢失，以及把来访客户端</p>
<p><code>root</code>管理员映射为本地的匿名用户等，则可以按照下面命令中的格式，将表中的参数写到NFS服务程序</p>
<p>的配置文件中。</p>
<blockquote>
<p>用于配置<code>NFS</code>服务程序配置文件的参数</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>ro</code></td>
<td>只读</td>
</tr>
<tr>
<td><code>rw</code></td>
<td>读写</td>
</tr>
<tr>
<td><code>root_squash</code></td>
<td>当NFS客户端以root管理员访问时，映射为NFS服务器的匿名用户</td>
</tr>
<tr>
<td><code>no_root_squash</code></td>
<td>当NFS客户端以root管理员访问时，映射为NFS服务器的root管理员</td>
</tr>
<tr>
<td><code>all_squash</code></td>
<td>无论NFS客户端使用什么账户访问，均映射为NFS服务器的匿名用户</td>
</tr>
<tr>
<td><code>sync</code></td>
<td>同时将数据写入到内存与硬盘中，保证不丢失数据</td>
</tr>
<tr>
<td><code>async</code></td>
<td>优先将数据保存到内存，然后再写入硬盘；这样效率更高，但可能会丢失数据</td>
</tr>
</tbody></table>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/exports
/nfsfile 192.168.10.*(rw,sync,root_squash)
</code></pre>
<p>在NFS服务的配置文件中巧用通配符能够实现很多便捷功能，就比如匹配IP地址就有三种方法：</p>
<ul>
<li>第一种是直接写<em>号，代表任何主机都可以访问；</em></li>
<li>*第二种则是实验中采用的192.168.10.*通配格式，代表来自192.168.10.0&#x2F;24网段的主机；</li>
<li>第三种则是直接写对方的IP地址，如192.168.10.20，代表仅允许某个主机进行访问。</li>
</ul>
<blockquote>
<p> <strong>第4步</strong>：启动和启用<code>NFS</code>服务程序。由于在使用<code>NFS</code>服务进行文件共享之前，需要使用<code>RPC</code></p>
<p>（<code>Remote Procedure Call</code>，远程过程调用）服务将<code>NFS</code>服务器的<code>IP</code>地址和端口号等信息发送给客户</p>
<p>端。因此，在启动<code>NFS</code>服务之前，还需要顺带重启并启用<code>rpcbind</code>服务程序，并将这两个服务一并加入</p>
<p>开机启动项中。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# systemctl restart rpcbind
[root@linuxprobe ~]# systemctl enable rpcbind
[root@linuxprobe ~]# systemctl start nfs-server
[root@linuxprobe ~]# systemctl enable nfs-server
Created symlink /etc/systemd/system/multi-user.target.wants/nfs-server.service → /usr/lib/systemd/system/nfs-server.service.
</code></pre>
<p><code>NFS</code>客户端的配置步骤也十分简单。先使用<code>showmount</code>命令查<strong>询NFS服务器的远程共享信息</strong>，必要的参数见</p>
<p>表，其输出格式为“共享的目录名称 允许使用客户端地址”。</p>
<blockquote>
<p> <code>showmount</code>命令中可用的参数以及作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-e</code></td>
<td>显示NFS服务器的共享列表</td>
</tr>
<tr>
<td><code>-a</code></td>
<td>显示本机挂载的文件资源的情况NFS资源的情况</td>
</tr>
<tr>
<td><code>-v</code></td>
<td>显示版本号</td>
</tr>
</tbody></table>
<pre><code class="bash">[root@linuxprobe ~]# showmount -e 192.168.10.10
Export list for 192.168.10.10:
/nfsfile 192.168.10.*
</code></pre>
<p>然后在<code>NFS</code>客户端创建一个挂载目录。使用<code>mount</code>命令并结合-t参数，指定要挂载的文件系统的类型，并在命</p>
<p>令后面写上服务器的<code>IP</code>地址、服务器上的共享目录以及要挂载到本地系统（即客户端）的目录。</p>
<pre><code class="bash">[root@linuxprobe ~]# mkdir /nfsfile
[root@linuxprobe ~]# mount -t nfs 192.168.10.10:/nfsfile /nfsfile
[root@linuxprobe ~]# df -h
Filesystem              Size  Used Avail Use% Mounted on
devtmpfs                969M     0  969M   0% /dev
tmpfs                   984M     0  984M   0% /dev/shm
tmpfs                   984M  9.6M  974M   1% /run
tmpfs                   984M     0  984M   0% /sys/fs/cgroup
/dev/mapper/rhel-root    17G  3.9G   14G  23% /
/dev/sr0                6.7G  6.7G     0 100% /media/cdrom
/dev/sda1              1014M  152M  863M  15% /boot
tmpfs                   197M   16K  197M   1% /run/user/42
tmpfs                   197M  3.4M  194M   2% /run/user/0
192.168.10.10:/nfsfile   17G  3.9G   14G  23% /nfsfile
</code></pre>
<p>挂载成功后就应该能够顺利地看到在执行前面的操作时写入的文件内容了。如果希望<code>NFS</code>文件共享服务能一</p>
<p>直有效，则需要将其写入到<code>fstab</code>文件中</p>
<pre><code class="bash">[root@linuxprobe ~]# cat /nfsfile/readme
welcome to linuxprobe.com
[root@linuxprobe ~]# vim /etc/fstab 
#
# /etc/fstab
# Created by anaconda on Thu Feb 25 10:42:11 2021
#
# Accessible filesystems, by reference, are maintained under &#39;/dev/disk/&#39;.
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.
#
# After editing this file, run &#39;systemctl daemon-reload&#39; to update systemd
# units generated from this file.
#
/dev/mapper/rhel-root                     /                       xfs     defaults        0 0
UUID=37d0bdc6-d70d-4cc0-b356-51195ad90369 /boot                   xfs     defaults        0 0
/dev/mapper/rhel-swap                     swap                    swap    defaults        0 0
/dev/cdrom                                /media/cdrom            iso9660 defaults        0 0 
192.168.10.10:/nfsfile                    /nfsfile                nfs     defaults        0 0   
</code></pre>
<h3 id="13-3、AutoFs自动挂载服务"><a href="#13-3、AutoFs自动挂载服务" class="headerlink" title="13.3、AutoFs自动挂载服务"></a>13.3、<code>AutoFs</code>自动挂载服务</h3><p><code>autofs</code>服务程序是一种<code>Linux</code>系统守护进程，当检测到用户试图访问一个尚未挂载的文件系统时，将自动挂</p>
<p>载该文件系统。</p>
<blockquote>
<p>安装<code>autofs</code>服务程序</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# yum install autofs
</code></pre>
<p>在<code>autofs</code>服务程序的主配置文件中需要按照“挂载目录 子配置文件”的格式进行填写。挂载目录是设备挂载位</p>
<p>置的上一级目录。例如，光盘设备一般挂载到<code>/media/cdrom</code>目录中，那么挂载目录写成<code>/media</code>即可。对应</p>
<p>的子配置文件则是对这个挂载目录内的挂载设备信息作进一步的说明。子配置文件需要用户自行定义，文件名</p>
<p>字没有严格要求，但后缀建议以<code>.misc</code>结束。</p>
<pre><code>[root@linuxprobe ~]# vim /etc/auto.master
#
# Sample auto.master file
# This is a &#39;master&#39; automounter map and it has the following format:
# mount-point [map-type[,format]:]map [options]
# For details of the format look at auto.master(5).
#
/media  /etc/iso.misc    ##加粗
/misc   /etc/auto.misc
#
# NOTE: mounts done from a hosts map will be mounted with the
#       &quot;nosuid&quot; and &quot;nodev&quot; options unless the &quot;suid&quot; and &quot;dev&quot;
#       options are explicitly given.
#
/net    -hosts
#
# Include /etc/auto.master.d/*.autofs
# The included files must conform to the format of this file.
#
+dir:/etc/auto.master.d
#
# If you have fedfs set up and the related binaries, either
# built as part of autofs or installed from another package,
# uncomment this line to use the fedfs program map to access
# your fedfs mounts.
#/nfs4  /usr/sbin/fedfs-map-nfs4 nobind
#
# Include central master map if it can be found using
# nsswitch sources.
#
# Note that if there are entries for /net or /misc (as
# above) in the included master map any keys that are the
# same will not be seen as the first read key seen takes
# precedence.
#
+auto.master
</code></pre>
<p>在子配置文件中，应按照“挂载目录 挂载文件类型及权限 :设备名称”的格式进行填写。例如，要把光盘设备挂</p>
<p>载到<code>/media/iso</code>目录中，可将挂载目录写为<code>iso</code>，而<code>-fstype</code>为文件系统格式参数，<code>iso9660</code>为光盘设备</p>
<p>格式，<code>ro</code>、<code>nosuid</code>及<code>nodev</code>为光盘设备具体的权限参数，<code>/dev/cdrom</code>则是定义要挂载的设备名称。配置完</p>
<p>成后再顺手将<code>autofs</code>服务程序启动并加入到系统启动项中</p>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/iso.misc
iso   -fstype=iso9660,ro,nosuid,nodev :/dev/cdrom
[root@linuxprobe ~]# systemctl start autofs 
[root@linuxprobe ~]# systemctl enable autofs 
Created symlink /etc/systemd/system/multi-user.target.wants/autofs.service → /usr/lib/systemd/system/autofs.service.
</code></pre>
<p>先查看当前的光盘设备挂载情况，确认光盘设备没有被挂载上，而且<code>/media</code>目录中根本就没有<code>iso</code>子目录</p>
<pre><code class="bash">[root@linuxprobe ~]# umount /dev/cdrom
[root@linuxprobe ~]# df -h
Filesystem              Size  Used Avail Use% Mounted on
devtmpfs                969M     0  969M   0% /dev
tmpfs                   984M     0  984M   0% /dev/shm
tmpfs                   984M  9.6M  974M   1% /run
tmpfs                   984M     0  984M   0% /sys/fs/cgroup
/dev/mapper/rhel-root    17G  3.9G   14G  23% /
/dev/sda1              1014M  152M  863M  15% /boot
tmpfs                   197M   16K  197M   1% /run/user/42
tmpfs                   197M  3.4M  194M   2% /run/user/0
192.168.10.10:/nfsfile   17G  3.9G   14G  23% /nfsfile
[root@linuxprobe ~]# cd /media
[root@linuxprobe media]# ls
[root@linuxprobe media]#
</code></pre>
<p>我们却可以使用<code>cd</code>命令切换到这个<code>iso</code>子目录中，而且光盘设备会被立即自动挂载上，然后也就能顺利查看</p>
<p>光盘内的内容了</p>
<pre><code class="bash">[root@linuxprobe media]# cd iso
[root@linuxprobe iso]# ls
AppStream  EULA              images      RPM-GPG-KEY-redhat-beta
BaseOS     extra_files.json  isolinux    RPM-GPG-KEY-redhat-release
EFI        GPL               media.repo  TRANS.TBL
[root@linuxprobe iso]# df -h
Filesystem              Size  Used Avail Use% Mounted on
devtmpfs                969M     0  969M   0% /dev
tmpfs                   984M     0  984M   0% /dev/shm
tmpfs                   984M  9.6M  974M   1% /run
tmpfs                   984M     0  984M   0% /sys/fs/cgroup
/dev/mapper/rhel-root    17G  3.9G   14G  23% /
/dev/sda1              1014M  152M  863M  15% /boot
tmpfs                   197M   16K  197M   1% /run/user/42
tmpfs                   197M  3.4M  194M   2% /run/user/0
192.168.10.10:/nfsfile   17G  3.9G   14G  23% /nfsfile
/dev/sr0                6.7G  6.7G     0 100% /media/iso
</code></pre>
<h2 id="十四、使用Bind提供域名解析服务"><a href="#十四、使用Bind提供域名解析服务" class="headerlink" title="十四、使用Bind提供域名解析服务"></a>十四、使用Bind提供域名解析服务</h2><hr>
<h3 id="14-1、DNS域名解析服务"><a href="#14-1、DNS域名解析服务" class="headerlink" title="14.1、DNS域名解析服务"></a>14.1、<code>DNS</code>域名解析服务</h3><p>这是一项用于管理和解析域名与IP地址对应关系的技术。简单来说，就是能够接受用户输入的域名或<code>IP</code>地</p>
<p>址，然后自动查找与之匹配（或者说具有映射关系）的<code>IP</code>地址或域名，即将域名解析为<code>IP</code>地址（正向解</p>
<p>析），或将<code>IP</code>地址解析为域名（反向解析）。</p>
<p>鉴于互联网中的域名和<code>IP</code>地址对应关系数据库太过庞大，<code>DNS</code>域名解析服务采用了类似目录树的层次结构来</p>
<p>记录域名与<code>IP</code>地址之间的对应关系，从而形成了一个分布式的数据库系统，如图14-1所示。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823084457513.png" alt="图14-1 DNS域名解析服务采用的目录树层次结构"></p>
<p>域名后缀一般分为国际域名和国内域名。原则上来讲，域名后缀都有严格的定义，但在实际使用时可以不必严</p>
<p>格遵守。目前最常见的域名后缀有<code>.com</code>（商业组织）、<code>.org</code>（非营利组织）、<code>.gov（</code>政府部门）、</p>
<p><code>.net</code>（网络服务商）、<code>.edu</code>（教育机构）、<code>.pub</code>（公共大众）、<code>.cn</code>（中国国家顶级域名）等</p>
<blockquote>
<p><code>DNS</code>技术作为互联网基础设施中重要的一环，为了为网民提供不间断、稳定且快速的域名查询服务，保</p>
<p>证互联网的正常运转，提供了下面3种类型的服务器：</p>
<ul>
<li><strong>主服务器</strong>：在特定区域内具有唯一性，负责维护该区域内的域名与<code>IP</code>地址之间的对应关系。</li>
<li><strong>从服务器</strong>：从主服务器中获得域名与<code>IP</code>地址的对应关系并进行维护，以防主服务器宕机等情况。</li>
<li><strong>缓存服务器</strong>：通过向其他域名解析服务器查询获得域名与<code>IP</code>地址的对应关系，并将经常查询的域名信息保存到服务器本地，以此来提高重复查询时的效率</li>
</ul>
</blockquote>
<p>简单来说，<strong>主服务器是用于管理域名和IP地址对应关系的真正服务器，从服务器帮助主服务器“打下手”，分散</strong></p>
<p><strong>部署在各个国家、省市或地区，以便让用户就近查询域名，从而减轻主服务器的负载压力</strong>。缓存服务器</p>
<p>不太常用，一般部署在企业内网的网关位置，用于加速用户的域名查询请求。</p>
<p><code>DNS</code>域名解析服务采用分布式的数据结构来存放海量的“区域数据”信息，在执行用户发起的域名查询请求时，</p>
<p>具有<strong>递归查询</strong>和<strong>迭代查询</strong>两种方式。所谓<strong>递归查询</strong>，是指<code>DNS</code>服务器在收到用户发起的请求时，必须向用户</p>
<p>返回一个准确的查询结果。如果<code>DNS</code>服务器本地没有存储与之对应的信息，则该服务器需要询问其他服务</p>
<p>器，并将返回的查询结果提交给用户。而<strong>迭代查询</strong>则是指，<code>DNS</code>服务器在收到用户发起的请求时，并不直接</p>
<p>回复查询结果，而是告诉另一台<code>DNS</code>服务器的地址，用户再向这台<code>DNS</code>服务器提交请求，这样依次反复，直</p>
<p>到返回查询结果。</p>
<p>由此可见，当用户向就近的一台<code>DNS</code>服务器发起对某个域名的查询请求之后（这里以<a target="_blank" rel="noopener" href="https://www.linuxprobe.com/">www.linuxprobe.com</a>为</p>
<p>例），其查询流程大致如图14-2所示。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823085012984.png" alt="图14-2 向DNS服务器发起域名查询请求的流程"></p>
<p>当用户向网络指定的<code>DNS</code>服务器发起一个域名请求时，通常情况下会有本地<code>DNS</code>服务器向上级的<code>DNS</code>服务器</p>
<p>发送迭代查询请求；如果该<code>DNS</code>服务器没有要查询的信息，则会进一步向上级<code>DNS</code>服务器发送迭代查询请</p>
<p>求，直到获得准确的查询结果为止。其中<strong>最高级、最权威的根DNS服务器总共有13台</strong>，分布在世界各地，其</p>
<p>管理单位、具体的地理位置，以及IP地址如表所示。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>管理单位</th>
<th>地理位置</th>
<th>IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td>INTERNIC.NET</td>
<td>美国-弗吉尼亚州</td>
<td>198.41.0.4</td>
</tr>
<tr>
<td>B</td>
<td>美国信息科学研究所</td>
<td>美国-加利弗尼亚州</td>
<td>128.9.0.107</td>
</tr>
<tr>
<td>C</td>
<td>PSINet公司</td>
<td>美国-弗吉尼亚州</td>
<td>192.33.4.12</td>
</tr>
<tr>
<td>D</td>
<td>马里兰大学</td>
<td>美国-马里兰州</td>
<td>128.8.10.90</td>
</tr>
<tr>
<td>E</td>
<td>美国航空航天管理局</td>
<td>美国加利弗尼亚州</td>
<td>192.203.230.10</td>
</tr>
<tr>
<td>F</td>
<td>因特网软件联盟</td>
<td>美国加利弗尼亚州</td>
<td>192.5.5.241</td>
</tr>
<tr>
<td>G</td>
<td>美国国防部网络信息中心</td>
<td>美国弗吉尼亚州</td>
<td>192.112.36.4</td>
</tr>
<tr>
<td>H</td>
<td>美国陆军研究所</td>
<td>美国-马里兰州</td>
<td>128.63.2.53</td>
</tr>
<tr>
<td>I</td>
<td>Autonomica公司</td>
<td>瑞典-斯德哥尔摩</td>
<td>192.36.148.17</td>
</tr>
<tr>
<td>J</td>
<td>VeriSign公司</td>
<td>美国-弗吉尼亚州</td>
<td>192.58.128.30</td>
</tr>
<tr>
<td>K</td>
<td>RIPE NCC</td>
<td>英国-伦敦</td>
<td>193.0.14.129</td>
</tr>
<tr>
<td>L</td>
<td>IANA</td>
<td>美国-弗吉尼亚州</td>
<td>199.7.83.42</td>
</tr>
<tr>
<td>M</td>
<td>WIDE Project</td>
<td>日本-东京</td>
<td>202.12.27.33</td>
</tr>
</tbody></table>
<h3 id="14-2、安装Bind服务程序"><a href="#14-2、安装Bind服务程序" class="headerlink" title="14.2、安装Bind服务程序"></a>14.2、安装<code>Bind</code>服务程序</h3><p><code>BIND</code>（<code>Berkeley Internet Name Domain</code>，伯克利因特网名称域）服务是全球范围内使用最广泛、最安全</p>
<p>可靠且高效的域名解析服务程序。<code>DNS</code>域名解析服务作为互联网基础设施服务，其责任之重可想而知，因此</p>
<p>建议大家在生产环境中安装部署<code>bind</code>服务程序时加上<code>chroot</code>（俗称牢笼机制）扩展包，以便有效地限制</p>
<p><code>bind</code>服务程序仅能对自身的配置文件进行操作，以确保整个服务器的安全。</p>
<pre><code class="bash">[root@linuxprobe ~]# yum install bind-chroot
</code></pre>
<blockquote>
<p><code>bind</code>服务程序的配置并不简单，因为要想为用户提供健全的<code>DNS</code>查询服务，要在本地保存相关的域名数</p>
<p>据库，而如果把所有域名和<code>IP</code>地址的对应关系都写入到某个配置文件中，估计要有上千万条的参数，这</p>
<p>样既不利于程序的执行效率，也不方便日后的修改和维护。因此在<code>bind</code>服务程序中有下面这3个比较关</p>
<p>键的文件：</p>
<ul>
<li><strong>主配置文件（<code>/etc/named.conf</code>）</strong>：只有59行，而且在去除注释信息和空行之后，实际有效的参数仅有30行左右，这些参数用来定义<code>bind</code>服务程序的运行。</li>
<li><strong>区域配置文件（<code>etc/named.rfc1912.zones</code>）</strong>：<strong>用来保存域名和IP地址对应关系的所在位置</strong>。类似于图书的目录，对应着每个域和相应<code>IP</code>地址所在的具体位置，当需要查看或修改时，可根据这个位置找到相关文件。</li>
<li><strong>数据配置文件目录（<code>/var/named</code>）</strong>：该目录用来保存域名和<code>IP</code>地址真实对应关系的数据配置文件。</li>
</ul>
</blockquote>
<p>在<code>Linux</code>系统中，bind服务程序的名称为<code>named</code>。首先需要在<code>/etc</code>目录中找到该服务程序的主配置文件，然</p>
<p>后把第11行和第19行的地址均修改为<code>any</code>，分别表示服务器上的所有<code>IP</code>地址均可提供<code>DNS</code>域名解析服务，以</p>
<p>及允许所有人对本服务器发送<code>DNS</code>查询请求。这两个地方一定要修改准确。</p>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/named.conf
  1 //
  2 // named.conf
  3 //
  4 // Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
  5 // server as a caching only nameserver (as a localhost DNS resolver only).
  6 //
  7 // See /usr/share/doc/bind*/sample/ for example named configuration files.
  8 //
  9 
 10 options &#123;
 11         listen-on port 53 &#123; any; &#125;;
 12         listen-on-v6 port 53 &#123; ::1; &#125;;
 13         directory       &quot;/var/named&quot;;
 14         dump-file       &quot;/var/named/data/cache_dump.db&quot;;
 15         statistics-file &quot;/var/named/data/named_stats.txt&quot;;
 16         memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;
 17         secroots-file   &quot;/var/named/data/named.secroots&quot;;
 18         recursing-file  &quot;/var/named/data/named.recursing&quot;;
 19         allow-query     &#123; any; &#125;;
 20 
 21         /* 
 22          - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.
 23          - If you are building a RECURSIVE (caching) DNS server, you need to enable 
 24            recursion. 
 25          - If your recursive DNS server has a public IP address, you MUST enable access 
 26            control to limit queries to your legitimate users. Failing to do so will
 27            cause your server to become part of large scale DNS amplification 
 28            attacks. Implementing BCP38 within your network would greatly
 29            reduce such attack surface 
 30         */
 31         recursion yes;
 32 
 33         dnssec-enable yes;
 34         dnssec-validation yes;
 35 
 36         managed-keys-directory &quot;/var/named/dynamic&quot;;
 37 
 38         pid-file &quot;/run/named/named.pid&quot;;
 39         session-keyfile &quot;/run/named/session.key&quot;;
 40 
 41         /* https://fedoraproject.org/wiki/Changes/CryptoPolicy */
 42         include &quot;/etc/crypto-policies/back-ends/bind.config&quot;;
 43 &#125;;
 44 
 45 logging &#123;
 46         channel default_debug &#123;
 47                 file &quot;data/named.run&quot;;
 48                 severity dynamic;
 49         &#125;;
 50 &#125;;
 51 
 52 zone &quot;.&quot; IN &#123;
 53         type hint;
 54         file &quot;named.ca&quot;;
 55 &#125;;
 56 
 57 include &quot;/etc/named.rfc1912.zones&quot;;
 58 include &quot;/etc/named.root.key&quot;;
 59 
</code></pre>
<p>如前所述，<code>bind</code>服务程序的区域配置文件（<code>/etc/named.rfc1912.zones</code>）用来保存域名和<code>IP</code>地址对应关</p>
<p>系的所在位置。在这个文件中，定义了域名与<code>IP</code>地址解析规则保存的文件位置以及服务类型等内容，而没有</p>
<p>包含具体的域名、<code>IP</code>地址对应关系等信息。<strong>服务类型</strong>有3种，分别为<code>hint</code>（根区域）、<code>master</code>（主区</p>
<p>域）、<code>slave</code>（辅助区域），其中常用的<code>master</code>和<code>slave</code>指的就是主服务器和从服务器。将域名解析为<code>IP</code></p>
<p>地址的正向解析参数和将IP地址解析为域名的反向解析参数分别如图14-3和图14-4所示。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823090209284.png" alt="图14-3 正向解析参数"></p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823090226880.png" alt="图14-4 反向解析参数"></p>
<blockquote>
<p> 下面的实验中会分别修改<code>bind</code>服务程序的主配置文件、区域配置文件与数据配置文件。如果在实验中遇</p>
<p>到了<code>bind</code>服务程序启动失败的情况，而您认为这是由于参数写错而导致的，</p>
<p>则可以执行<code>named-checkconf</code>命令和<code>named-checkzone</code>命令，分别检查主配置文件与数据配置文件中</p>
<p>语法或参数的错误。</p>
</blockquote>
<h4 id="14-2-1、正向解析实验"><a href="#14-2-1、正向解析实验" class="headerlink" title="14.2.1、正向解析实验"></a>14.2.1、正向解析实验</h4><p>在<code>DNS</code>域名解析服务中，正向解析是指根据域名（主机名）查找到对应的IP地址。也就是说，当用户输入了一</p>
<p>个域名后，<code>bind</code>服务程序会自动进行查找，并将匹配到的IP地址返给用户，如图14-5所示。这也是最常用的</p>
<p><code>DNS</code>工作模式</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823090506759.png" alt="图14-5 正向解析技术示意图"></p>
<blockquote>
<p><strong>第1步</strong>：编辑区域配置文件。该文件中默认已经有了一些无关紧要的解析参数，旨在让用户有一个参考。</p>
<p>可以将下面的参数添加到区域配置文件的最下面。当然，也可以将该文件中的原有信息全部清空，而只</p>
<p>保留自己的域名解析信息。</p>
<p><strong>配置文件中的代码缩进仅是为了提升阅读体验，有无缩进对参数效果均没有任何影响。</strong></p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/named.rfc1912.zones
zone &quot;linuxprobe.com&quot; IN &#123;
        type master;
        file &quot;linuxprobe.com.zone&quot;;
        allow-update &#123;none;&#125;;
&#125;;
</code></pre>
<blockquote>
<p><strong>第2步</strong>：编辑数据配置文件。可以从<code>/var/named</code>目录中复制一份正向解析的模板文件</p>
<p>（<code>named.localhost</code>），然后把域名和<code>IP</code>地址的对应数据填写数据配置文件中并保存。</p>
<p>在复制时记得加上<code>-a</code>参数，这可以保留原始文件的所有者、所属组、权限属性等信息，</p>
<p>以便让<code>bind</code>服务程序顺利读取文件内容。</p>
<p><strong>在保存并退出后文件后记得重启named服务程序，让新的解析数据生效。</strong></p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# cd /var/named/
[root@linuxprobe named]# ls -al named.localhost
-rw-r-----. 1 root named 152 Jun 21 2007 named.localhost
[root@linuxprobe named]# cp -a named.localhost linuxprobe.com.zone
</code></pre>
<table>
<thead>
<tr>
<th>$TTL 1D</th>
<th>#生存周期为1天</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>@</td>
<td>IN SOA</td>
<td>linuxprobe.com.</td>
<td>root.linuxprobe.com.</td>
<td>(</td>
<td></td>
</tr>
<tr>
<td></td>
<td>#授权信息开始:</td>
<td>#DNS区域的地址</td>
<td>#域名管理员的邮箱(不要用@符号)</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>0;serial</td>
<td>#更新序列号</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1D;refresh</td>
<td>#更新时间</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1H;retry</td>
<td>#重试延时</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1W;expire</td>
<td>#失效时间</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>3H );minimum</td>
<td>#无效解析记录的缓存时间</td>
</tr>
<tr>
<td></td>
<td>NS</td>
<td>ns.linuxprobe.com.</td>
<td></td>
<td>#域名服务器记录</td>
<td></td>
</tr>
<tr>
<td>ns</td>
<td>IN A</td>
<td>192.168.10.10</td>
<td></td>
<td>#地址记录(ns.linuxprobe.com.)</td>
<td></td>
</tr>
<tr>
<td>www</td>
<td>IN A</td>
<td>192.168.10.10</td>
<td></td>
<td>#地址记录(<a target="_blank" rel="noopener" href="http://www.linuxprobe.com/">www.linuxprobe.com</a>.)</td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p> 在解析文件中，A记录类型表示将域名指向一个<code>IPv4</code>地址，而<code>AAAA</code>表示将域名指向一个<code>IPv6</code>地址。此外，还有8种记录类型</p>
</blockquote>
<table>
<thead>
<tr>
<th>记录类型</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td>将域名指向一个IPV4地址</td>
</tr>
<tr>
<td>CNAME</td>
<td>将域名指向另外一个域名</td>
</tr>
<tr>
<td>AAAA</td>
<td>将域名指向一个IPV6地址</td>
</tr>
<tr>
<td>NS</td>
<td>将子域名指定其他DNS服务器解析</td>
</tr>
<tr>
<td>MX</td>
<td>将域名指向邮件服务器地址</td>
</tr>
<tr>
<td>SRV</td>
<td>记录提供特定的服务的服务器</td>
</tr>
<tr>
<td>TXT</td>
<td>文本内容一般为512字节，常作为反垃圾邮件的SPF记录</td>
</tr>
<tr>
<td>CAA</td>
<td>CA证书办法机构授权校验</td>
</tr>
<tr>
<td>显性URL</td>
<td>将域名重定向到另外一个地址</td>
</tr>
<tr>
<td>隐性URL</td>
<td>与显性URL类型，但是会隐藏真实目标地址</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>第3步</strong>：检验解析结果。为了检验解析结果，一定要先把<code>Linux</code>系统网卡中的<code>DNS</code>地址参数修改成本机</p>
<p><code>IP</code>地址（见图14-6），这样就可以使用由本机提供的<code>DNS</code>查询服务了。<code>nslookup</code>用于检测能否从</p>
<p><code>DNS</code>服务器中查询到域名与<code>IP</code>地址的解析记录，进而更准确地检验<code>DNS</code>服务器是否已经能够为用户提供</p>
<p>服务。</p>
</blockquote>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823091747030.png" alt="图14-6 配置网卡DNS参数信息"></p>
<pre><code class="bash">[root@linuxprobe named]# nmcli connection up ens160 
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/4)
[root@linuxprobe named]# nslookup
Name:	www.linuxprobe.com
Address: 192.168.10.10
&gt; ns.linuxprobe.com
Server:		192.168.10.10
Address:	192.168.10.10#53

Name:	ns.linuxprobe.com
Address: 192.168.10.10
</code></pre>
<p>若解析出的结果不是192.168.10.10，则很有可能是虚拟机选择了联网模式，并由互联网<code>DNS</code>服务器进行了解</p>
<p>析。此时应确认服务器信息是否为“Address: 192.168.10.10#53”，即由本地服务器192.168.10.10的53端口号</p>
<p>进行解析；若不是，则重启网络后再试一下。</p>
<h4 id="14-2-2、反向解析实验"><a href="#14-2-2、反向解析实验" class="headerlink" title="14.2.2、反向解析实验"></a>14.2.2、反向解析实验</h4><p>在<code>DNS</code>域名解析服务中，反向解析的作用是将用户提交的<code>IP</code>地址解析为对应的域名信息，它一般用于对某个</p>
<p><code>IP</code>地址上绑定的所有域名进行整体屏蔽，屏蔽由某些域名发送的垃圾邮件。它也可以针对某个<code>IP</code>地址进行反</p>
<p>向解析，大致判断出有多少个网站运行在上面。当购买虚拟主机时，可以使用这一功能验证虚拟主机提供商是</p>
<p>否有严重的超售问题。图14-7所示为对IP地址所关联的域名信息进行反推。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823093849817.png" alt="图14-7 反向解析技术示意图"></p>
<blockquote>
<p><strong>第1步</strong>：编辑区域配置文件。在编辑该文件时，除了不要写错格式之外，还需要记住此处定义的数据配置</p>
<p>文件名称，因为一会儿还需要在<code>/var/named</code>目录中建立与其对应的同名文件。反向解析是把<code>IP</code>地址解</p>
<p>析成域名格式，因此在定义<code>zone</code>（区域）时应该要把<code>IP</code>地址反写，比如原来是192.168.10.0，反写后</p>
<p>应该就是10.168.192，而且只需写出IP地址的网络位即可。把下列参数添加至正向解析参数的后面。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/named.rfc1912.zones
zone &quot;linuxprobe.com&quot; IN &#123;
        type master;
        file &quot;linuxprobe.com.zone&quot;;
        allow-update &#123;none;&#125;;
&#125;;
zone &quot;10.168.192.in-addr.arpa&quot; IN &#123;
        type master;
        file &quot;192.168.10.arpa&quot;;
        allow-update &#123;none;&#125;;
&#125;;
</code></pre>
<blockquote>
<p><strong>第2步</strong>：编辑数据配置文件。首先从<code>/var/named</code>目录中复制一份反向解析的模板文件</p>
<p>（<code>named.loopback</code>），然后把下面的参数填写到文件中。其中，<code>IP</code>地址仅需要写主机位，</p>
<p>如图14-8所示。</p>
</blockquote>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823094119999.png" alt="图14-8 反向解析文件中IP地址参数规范"></p>
<pre><code class="bash">[root@linuxprobe ~]# cd /var/named
[root@linuxprobe named]# cp -a named.loopback 192.168.10.arpa
[root@linuxprobe named]# vim 192.168.10.arpa
[root@linuxprobe named]# systemctl restart named
</code></pre>
<table>
<thead>
<tr>
<th>$TTL 1D</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>@</td>
<td>IN SOA</td>
<td>linuxprobe.com.</td>
<td>root.linuxprobe.com.</td>
<td>(</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>0;serial</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1D;refresh</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1H;retry</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1W;expire</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>3H);minimum</td>
</tr>
<tr>
<td></td>
<td>NS</td>
<td>ns.linuxprobe.com.</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ns</td>
<td>A</td>
<td>192.168.10.10</td>
<td></td>
<td></td>
</tr>
<tr>
<td>10</td>
<td>PTR</td>
<td>ns.linuxprobe.com.</td>
<td>#PTR为指针记录，仅用于反向解析中。</td>
<td></td>
</tr>
<tr>
<td>10</td>
<td>PTR</td>
<td><a target="_blank" rel="noopener" href="http://www.linuxprobe.com/">www.linuxprobe.com</a>.</td>
<td></td>
<td></td>
</tr>
<tr>
<td>20</td>
<td>PTR</td>
<td>bbs.linuxprobe.com.</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p><strong>第3步</strong>：检验解析结果。在前面的正向解析实验中，已经把系统网卡中的<code>DNS</code>地址参数修改成了本</p>
<p>机<code>IP</code>地址，因此可以直接使用&#96;nslookup解析析结果，仅需输入IP地址即可查询到对应的域名信息。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# nslookup
&gt; 192.168.10.10
10.10.168.192.in-addr.arpa	name = www.linuxprobe.com.
&gt; 192.168.10.20
20.10.168.192.in-addr.arpa	name = bbs.linuxprobe.com.
</code></pre>
<h3 id="14-3、部署从服务器"><a href="#14-3、部署从服务器" class="headerlink" title="14.3、部署从服务器"></a>14.3、部署从服务器</h3><p>作为重要的互联网基础设施服务，保证<code>DNS</code>域名解析服务的正常运转至关重要，只有这样才能提供稳定、快</p>
<p>速且不间断的域名查询服务。在<code>DNS</code>域名解析服务中，从服务器可以从主服务器上获取指定的区域数据文</p>
<p>件，从而起到备份解析记录与负载均衡的作用。因此，通过部署从服务器不仅可以减轻主服务器的负载压力，</p>
<p>还可以提升用户的查询效率。</p>
<blockquote>
<p>主服务器与从服务器分别使用的操作系统与IP地址信息</p>
</blockquote>
<table>
<thead>
<tr>
<th>主机名称</th>
<th>操作系统</th>
<th>IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>主服务器</td>
<td>RHEL 8</td>
<td>192.168.10.10</td>
</tr>
<tr>
<td>从服务器</td>
<td>RHEL 8</td>
<td>192.168.10.20</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>第1步</strong>：在主服务器的区域配置文件中允许该从服务器的更新请求，即修改<code>allow-update</code> {允许更新区</p>
<p>域信息的主机地址;};参数，然后重启主服务器的<code>DNS</code>服务程序。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/named.rfc1912.zones
zone &quot;linuxprobe.com&quot; IN &#123;
        type master;
        file &quot;linuxprobe.com.zone&quot;;
        allow-update &#123; 192.168.10.20;&#125;;
&#125;;
zone &quot;10.168.192.in-addr.arpa&quot; IN &#123;
        type master;
        file &quot;192.168.10.arpa&quot;;
        allow-update &#123; 192.168.10.20;&#125;;
&#125;;
[root@linuxprobe ~]# systemctl restart named
</code></pre>
<blockquote>
<p><strong>第2步</strong>：在主服务器上配置防火墙放行规则，让<code>DNS</code>协议流量可以被顺利传递。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# iptables -F 
[root@linuxprobe ~]# firewall-cmd --permanent --zone=public --add-service=dns
success
[root@linuxprobe ~]# firewall-cmd --reload
success
</code></pre>
<blockquote>
<p><strong>第3步</strong>：在从服务器上安装<code>bind-chroot</code>软件包（输出信息省略）。修改配置文件，让从服务器也能够</p>
<p>对外提供DNS服务，并且测试其与主服务器的网络连通性。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# dnf install bind-chroot
[root@linuxprobe ~]# vim /etc/named.conf
  1 //
  2 // named.conf
  3 //
  4 // Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
  5 // server as a caching only nameserver (as a localhost DNS resolver only).
  6 //
  7 // See /usr/share/doc/bind*/sample/ for example named configuration files.
  8 //
  9 
 10 options &#123;
 11         listen-on port 53 &#123; any; &#125;;
 12         listen-on-v6 port 53 &#123; ::1; &#125;;
 13         directory       &quot;/var/named&quot;;
 14         dump-file       &quot;/var/named/data/cache_dump.db&quot;;
 15         statistics-file &quot;/var/named/data/named_stats.txt&quot;;
 16         memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;
 17         secroots-file   &quot;/var/named/data/named.secroots&quot;;
 18         recursing-file  &quot;/var/named/data/named.recursing&quot;;
 19         allow-query     &#123; any; &#125;;
………………省略部分输出信息………………
[root@linuxprobe ~]# ping -c 4 192.168.10.10 
PING 192.168.10.10 (192.168.10.10) 56(84) bytes of data.
64 bytes from 192.168.10.10: icmp_seq=1 ttl=64 time=2.44 ms
64 bytes from 192.168.10.10: icmp_seq=2 ttl=64 time=3.31 ms
64 bytes from 192.168.10.10: icmp_seq=3 ttl=64 time=0.503 ms
64 bytes from 192.168.10.10: icmp_seq=4 ttl=64 time=0.359 ms

--- 192.168.10.10 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 15ms
rtt min/avg/max/mdev = 0.359/1.654/3.311/1.262 ms
</code></pre>
<blockquote>
<p><strong>第4步</strong>：在从服务器中填写主服务器的IP地址与要抓取的区域信息，然后重启服务。注意此时的服务类型</p>
<p>应该是<code>slave</code>（从），而不再是<code>master</code>（主）。<code>masters</code>参数后面应该为主服务器的<code>IP</code>地址，而且</p>
<p><code>file</code>参数后面定义的是同步数据配置文件后要保存到的位置，稍后可以在该目录内看到同步的文件。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/named.rfc1912.zones
zone &quot;linuxprobe.com&quot; IN &#123;
        type slave;
        masters &#123; 192.168.10.10; &#125;;
        file &quot;slaves/linuxprobe.com.zone&quot;;
&#125;;
zone &quot;10.168.192.in-addr.arpa&quot; IN &#123;
        type slave;
        masters &#123; 192.168.10.10; &#125;;
        file &quot;slaves/192.168.10.arpa&quot;;
&#125;;
[root@linuxprobe ~]# systemctl restart named
</code></pre>
<blockquote>
<p> <strong>第5步</strong>：检验解析结果。当从服务器的DNS服务程序在重启后，一般就已经自动从主服务器上同步了数据</p>
<p>配置文件，而且该文件默认会放置在区域配置文件中所定义的目录位置中。随后修改从服务器的网络参</p>
<p>数，把DNS地址参数修改成<code>192.168.10.20</code>，这样即可使用从服务器自身提供的DNS域名解析服务。最</p>
<p>后就可以使用<code>nslookup</code>命令顺利看到解析结果了</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# cd /var/named/slaves
[root@linuxprobe slaves]# ls 
192.168.10.arpa linuxprobe.com.zone
[root@linuxprobe slaves]# nslookup
&gt; www.linuxprobe.com
Server:		192.168.10.20
Address:	192.168.10.20#53

Name:	www.linuxprobe.com
Address: 192.168.10.10
&gt; 192.168.10.10
10.10.168.192.in-addr.arpa	name = www.linuxprobe.com.
</code></pre>
<h3 id="14-4、安全的加密传输"><a href="#14-4、安全的加密传输" class="headerlink" title="14.4、安全的加密传输"></a>14.4、安全的加密传输</h3><p>互联网中的绝大多数<code>DNS</code>服务器（超过95%）都是基于<code>BIND</code>域名解析服务搭建的，而bind服务程序为了提供</p>
<p>安全的解析服务，已经对<code>TSIG</code>（见<code>RFC 2845</code>）加密机制提供了支持。<code>TSIG</code>主要是利用了密码编码的方式来</p>
<p>保护区域信息的传输（<code>Zone Transfer</code>），即<code>TSIG</code>加密机制保证了<code>DNS</code>服务器之间传输域名区域信息的安全</p>
<p>性。</p>
<pre><code class="bash">[root@linuxprobe ~]# ls -al /var/named/slaves/
total 8
drwxrwx---. 2 named named  56 Mar 12 09:53 .
drwxrwx--T. 6 root  named 141 Mar 12 09:57 ..
-rw-r--r--. 1 named named 436 Mar 12 09:53 192.168.10.arpa
-rw-r--r--. 1 named named 282 Mar 12 09:53 linuxprobe.com.zone
[root@linuxprobe ~]# rm -rf /var/named/slaves/*
</code></pre>
<blockquote>
<p><strong>第1步</strong>：<strong>在主服务器中生成密钥</strong>。<code>dnssec-keygen</code>命令用于生成安全的DNS服务密钥，其格式</p>
<p>为“<code>dnssec-keygen</code> [参数]”，常用的参数以及作用如表所示。</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>-a</td>
<td>指定加密算法，包括RSAMD5（RSA）、RSASHA1、DSA、NSEC3RSASHA1、NSEC3DSA等</td>
</tr>
<tr>
<td>-b</td>
<td>密钥长度（HMAC-MD5的密钥长度在1~512位之间）</td>
</tr>
<tr>
<td>-n</td>
<td>密钥的类型（HOST表示与主机相关）</td>
</tr>
</tbody></table>
<p>使用下述命令生成一个主机名称为<code>master-slave</code>的128位<code>HMAC-MD5</code>算法的密钥文件。在执行该命令后默认</p>
<p>会在当前目录中生成<strong>公钥</strong>和<strong>私钥</strong>文件，我们需要把私钥文件中Key参数后面的值记录下来，一会儿要将其写入</p>
<p>传输配置文件中。</p>
<pre><code class="bash">[root@linuxprobe ~]# dnssec-keygen -a HMAC-MD5 -b 128 -n HOST master-slave
Kmaster-slave.+157+62533
[root@linuxprobe ~]# ls -l Kmaster-slave.+157+62533.*
-rw-------. 1 root root  56 Mar 14 09:54 Kmaster-slave.+157+62533.key
-rw-------. 1 root root 165 Mar 14 09:54 Kmaster-slave.+157+62533.private
[root@linuxprobe ~]# cat Kmaster-slave.+157+62533.private 
Private-key-format: v1.3
Algorithm: 157 (HMAC_MD5)
Key: NI6icnb74FxHx2gK+0MVOg==
Bits: AAA=
Created: 20210314015436
Publish: 20210314015436
Activate: 20210314015436
</code></pre>
<blockquote>
<p> <strong>第2步</strong>：<strong>在主服务器中创建密钥验证文件</strong>。进入<code>bind</code>服务程序用于保存配置文件的目录，把刚刚生成的</p>
<p>密钥名称、加密算法和私钥加密字符串按照下面的格式写入<code>tansfer.key</code>传输配置文件中。为了安全起</p>
<p>见，需要将文件的所属组修改成<code>named</code>，并将文件权限设置得要小一点，然后设置该文件的一个硬链</p>
<p>接，并指向<code>/etc</code>目录。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# cd /var/named/chroot/etc/
[root@linuxprobe etc]# vim transfer.key
key &quot;master-slave&quot; &#123;
        algorithm hmac-md5;
        secret &quot;NI6icnb74FxHx2gK+0MVOg==&quot;;
&#125;;
[root@linuxprobe etc]# chown root:named transfer.key
[root@linuxprobe etc]# chmod 640 transfer.key
[root@linuxprobe etc]# ln transfer.key /etc/transfer.key
</code></pre>
<blockquote>
<p><strong>第3步</strong>：开<strong>启并加载<code>bind</code>服务的密钥验证功能</strong>。首先需要在主服务器的主配置文件中加载密钥验证文</p>
<p>件，然后进行设置，使得只允许带有<code>master-slave</code>密钥认证的DNS服务器同步数据配置文件。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/named.conf
  1 //
  2 // named.conf
  3 //
  4 // Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
  5 // server as a caching only nameserver (as a localhost DNS resolver only).
  6 //
  7 // See /usr/share/doc/bind*/sample/ for example named configuration files.
  8 //
  9 include &quot;/etc/transfer.key&quot;;
 10 options &#123;
 11         listen-on port 53 &#123; any; &#125;;
 12         listen-on-v6 port 53 &#123; ::1; &#125;;
 13         directory       &quot;/var/named&quot;;
 14         dump-file       &quot;/var/named/data/cache_dump.db&quot;;
 15         statistics-file &quot;/var/named/data/named_stats.txt&quot;;
 16         memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;
 17         secroots-file   &quot;/var/named/data/named.secroots&quot;;
 18         recursing-file  &quot;/var/named/data/named.recursing&quot;;
 19         allow-query     &#123; any; &#125;;
 20         allow-transfer &#123; key master-slave; &#125;;
………………省略部分输出信息………………
[root@linuxprobe ~]# systemctl restart named
</code></pre>
<p>至此，<code>DNS</code>主服务器的TSIG密钥加密传输功能就已经配置完成。然后清空<code>DNS</code>从服务器同步目录中所有的数</p>
<p>据配置文件，再次重启<code>bind</code>服务程序。这时就已经不能像刚才那样自动获取到数据配置文件了。</p>
<pre><code class="bash">[root@linuxprobe ~]# rm -rf /var/named/slaves/*
[root@linuxprobe ~]# systemctl restart named
[root@linuxprobe ~]# ls  /var/named/slaves/
</code></pre>
<blockquote>
<p><strong>第4步</strong>：<strong>配置从服务器，使其支持密钥验证</strong>。配置<code>DNS</code>从服务器和主服务器的方法大致相同，都需要在</p>
<p><code>bind</code>服务程序的配置文件目录中创建密钥认证文件，并设置相应的权限，然后设置该文件的一个硬链</p>
<p>接，并指向<code>/etc</code>目录。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# cd /var/named/chroot/etc/
[root@linuxprobe etc]# vim transfer.key
key &quot;master-slave&quot; &#123;
        algorithm hmac-md5;
        secret &quot;NI6icnb74FxHx2gK+0MVOg==&quot;;
&#125;;
[root@linuxprobe etc]# chown root:named transfer.key
[root@linuxprobe etc]# chmod 640 transfer.key
[root@linuxprobe etc]# ln transfer.key /etc/transfer.key
</code></pre>
<blockquote>
<p><strong>第5步</strong>：开启并加载从服务器的密钥验证功能。这一步的操作步骤也同样是在主配置文件中加载密钥认证</p>
<p>文件，然后按照指定的格式写上主服务器的IP地址和密钥名称。<strong>注意，密钥名称等参数位置不要太靠</strong></p>
<p><strong>前，大约在第51行比较合适，否则bind服务程序会因为没有加载完预设参数而报错</strong></p>
</blockquote>
<pre><code class="bash">[root@linuxprobe etc]# vim /etc/named.conf
  1 //
  2 // named.conf
  3 //
  4 // Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
  5 // server as a caching only nameserver (as a localhost DNS resolver only).
  6 //
  7 // See /usr/share/doc/bind*/sample/ for example named configuration files.
  8 //
  9 include &quot;/etc/transfer.key&quot;;
 10 options &#123;
 11         listen-on port 53 &#123; any; &#125;;
 12         listen-on-v6 port 53 &#123; ::1; &#125;;
 13         directory       &quot;/var/named&quot;;
 14         dump-file       &quot;/var/named/data/cache_dump.db&quot;;
 15         statistics-file &quot;/var/named/data/named_stats.txt&quot;;
 16         memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;
 17         secroots-file   &quot;/var/named/data/named.secroots&quot;;
 18         recursing-file  &quot;/var/named/data/named.recursing&quot;;
 19         allow-query     &#123; any; &#125;;
 20 
 21         /* 
 22          - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.
 23          - If you are building a RECURSIVE (caching) DNS server, you need to enable 
 24            recursion. 
 25          - If your recursive DNS server has a public IP address, you MUST enable access 
 26            control to limit queries to your legitimate users. Failing to do so will
 27            cause your server to become part of large scale DNS amplification 
 28            attacks. Implementing BCP38 within your network would greatly
 29            reduce such attack surface 
 30         */
 31         recursion yes;
 32 
 33         dnssec-enable yes;
 34         dnssec-validation yes;
 35 
 36         managed-keys-directory &quot;/var/named/dynamic&quot;;
 37 
 38         pid-file &quot;/run/named/named.pid&quot;;
 39         session-keyfile &quot;/run/named/session.key&quot;;
 40 
 41         /* https://fedoraproject.org/wiki/Changes/CryptoPolicy */
 42         include &quot;/etc/crypto-policies/back-ends/bind.config&quot;;
 43 &#125;;
 44 
 45 logging &#123;
 46         channel default_debug &#123;
 47                 file &quot;data/named.run&quot;;
 48                 severity dynamic;
 49         &#125;;
 50 &#125;;
 51 server 192.168.10.10
 52 &#123;
 53         keys &#123; master-slave; &#125;;
 54 &#125;;
 55 zone &quot;.&quot; IN &#123;
 56         type hint;
 57         file &quot;named.ca&quot;;
 58 &#125;;
 59 
 60 include &quot;/etc/named.rfc1912.zones&quot;;
 61 include &quot;/etc/named.root.key&quot;;
</code></pre>
<blockquote>
<p><strong>第6步</strong>：<code>DNS</code><strong>从服务器同步域名区域数据</strong>。现在，两台服务器的<code>bind</code>服务程序都已经配置妥当，并匹配</p>
<p>到了相同的密钥认证文件。接下来在从服务器上重启<code>bind</code>服务程序，可以发现又能顺利地同步到数据配</p>
<p>置文件了。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# systemctl restart named
[root@linuxprobe ~]# ls /var/named/slaves/
192.168.10.arpa  linuxprobe.com.zone
</code></pre>
<blockquote>
<p><strong>第7步</strong>：再次进行解析验证。功能正常。请大家注意观察，是由192.168.10.20从服务器进行解析的。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe etc]# nslookup www.linuxprobe.com
Server:		192.168.10.20
Address:	192.168.10.20#53

Name:	www.linuxprobe.com
Address: 192.168.10.10

[root@linuxprobe etc]# nslookup 192.168.10.10
10.10.168.192.in-addr.arpa	name = www.linuxprobe.com.
</code></pre>
<h3 id="14-5、部署缓存服务器"><a href="#14-5、部署缓存服务器" class="headerlink" title="14.5、部署缓存服务器"></a>14.5、部署缓存服务器</h3><p><code>DNS</code>缓存服务器是<strong>一种不负责域名数据维护的<code>DNS</code>服务器</strong>。简单来说，缓存服务器就是把用户经常使用到的</p>
<p>域名与IP地址的解析记录保存在主机本地，从而提升下次解析的效率。<code>DNS</code>缓存服务器一般用于经常访问某些</p>
<p>固定站点而且对这些网站的访问速度有较高要求的企业内网中，但实际的应用并不广泛。而且，缓存服务器是</p>
<p>否可以成功解析还与指定的上级<code>DNS</code>服务器的允许策略有关，因此当前仅需了解即可。</p>
<blockquote>
<p> <strong>第1步</strong>：<strong>配置系统的双网卡参数</strong>。前面讲到，缓存服务器一般用于企业内网，旨在降低内网用户查询</p>
<p><code>DNS</code>的时间消耗。因此，为了更加贴近真实的网络环境，实现外网查询功能，我们需要在缓存服务器中</p>
<p>再添加一块网卡，并按照表所示的信息配置出两台<code>Linux</code>虚拟机系统。图14-9所示为缓存服务器实验环</p>
<p>境的结构拓扑，客户端不局限于一台。</p>
</blockquote>
<blockquote>
<p>用于配置<code>Linux</code>虚拟机系统所需的参数信息</p>
</blockquote>
<table>
<thead>
<tr>
<th>主机名称</th>
<th>操作系统</th>
<th>IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>缓存服务器</td>
<td>RHEL 8</td>
<td>网卡（外网）：根据物理设备的网络参数进行配置（通过DHCP或手动方式指定IP地址与网关等信息）</td>
</tr>
<tr>
<td>缓存服务器</td>
<td>RHEL 8</td>
<td>网卡（内网）：192.168.10.10</td>
</tr>
<tr>
<td>客户端</td>
<td>RHEL 8</td>
<td>192.168.10.20</td>
</tr>
</tbody></table>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823103613155.png" alt="图14-9 缓存服务器实验环境拓扑"></p>
<blockquote>
<p><strong>第2步</strong>：<strong>还需要在虚拟机软件中将新添加的网卡设置为“桥接模式”</strong>，如图14-10所示。然后设置成与物理</p>
<p>设备相同的网络参数（此处需要大家按照物理设备真实的网络参数来配置）。图14-11所示为以<code>DHCP</code></p>
<p>方式获取IP地址与网关等信息，重启网络服务后的效果如   图14-12所示。</p>
</blockquote>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823103714451.png" alt="图14-10 新添加一块桥接网卡"></p>
<p>​	<img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823103737795.png" alt="图14-11 以DHCP方式获取网络参数"></p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823103822572.png" alt="图14-12 查看网卡的工作状态"></p>
<blockquote>
<p><strong>第3步</strong>：在<code>bind</code>服务程序的主配置文件中添加缓存转发参数。在大约第20行处添加一行参</p>
<p>数“<code>forwarders </code>{ 上级<code>DNS</code>服务器地址; };”，上级<code>DNS</code>服务器地址指的是获取数据配置文件的服务器。</p>
<p>考虑到查询速度、稳定性、安全性等因素，这里使用的是北京市公共<code>DNS</code>服务器的地址210.73.64.1。</p>
<p>如果大家也使用该地址，请先测试是否可以<code>ping</code>通，以免导致<code>DNS</code>域名解析失败。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/named.conf
  1 //
  2 // named.conf
  3 //
  4 // Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
  5 // server as a caching only nameserver (as a localhost DNS resolver only).
  6 //
  7 // See /usr/share/doc/bind*/sample/ for example named configuration files.
  8 //
  9 
 10 options &#123;
 11         listen-on port 53 &#123; any; &#125;;
 12         listen-on-v6 port 53 &#123; ::1; &#125;;
 13         directory       &quot;/var/named&quot;;
 14         dump-file       &quot;/var/named/data/cache_dump.db&quot;;
 15         statistics-file &quot;/var/named/data/named_stats.txt&quot;;
 16         memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;
 17         secroots-file   &quot;/var/named/data/named.secroots&quot;;
 18         recursing-file  &quot;/var/named/data/named.recursing&quot;;
 19         allow-query     &#123; any; &#125;;
 20         forwarders &#123; 210.73.64.1; &#125;;
………………省略部分输出信息………………
[root@linuxprobe ~]# systemctl restart named
</code></pre>
<p>防火墙的放行规则</p>
<pre><code class="bash">[root@linuxprobe ~]# iptables -F
[root@linuxprobe ~]# iptables-save
[root@linuxprobe ~]# firewall-cmd --permanent --zone=public --add-service=dns
success
[root@linuxprobe ~]# firewall-cmd --reload
success
</code></pre>
<blockquote>
<p> <strong>第4步</strong>：重启<code>DNS</code>服务，验证成果。把客户端主机的<code>DNS</code>服务器地址参数修改为<code>DNS</code>缓存服务器的IP地址</p>
<p>192.168.10.10，如图14-13所示。这样即可让客户端使用本地DNS缓存服务器提供的域名查询解析服</p>
<p>务。</p>
</blockquote>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823104053449.png" alt="图14-13 设置客户端主机的DNS服务器地址参数"></p>
<blockquote>
<p>使用<code>nslookup</code>命令来验证实验结果</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# nmcli connection up ens160 
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/4)
[root@linuxprobe ~]# nslookup
&gt; www.linuxprobe.com
Server:		192.168.10.10
Address:	192.168.10.10#53

Non-authoritative answer:
www.linuxprobe.com	canonical name = www.linuxprobe.com.w.kunlunno.com.
Name:	www.linuxprobe.com.w.kunlunno.com
Address: 139.215.131.226
</code></pre>
<h3 id="14-6、分离解析技术"><a href="#14-6、分离解析技术" class="headerlink" title="14.6、分离解析技术"></a>14.6、分离解析技术</h3><p><code>DNS</code>服务的分离解析功能，即可让位于不同地理范围内的读者通过访问相同的网址，从不同的服务器获取到</p>
<p>相同的数据。例如，我们可以按照表所示，分别为处于北京的<code>DNS</code>服务器和处于美国的<code>DNS</code>服务器分配不同</p>
<p>的<code>IP</code>地址，然后让国内读者在访问时自动匹配到北京的服务器，而让海外读者自动匹配到美国的服务器，如</p>
<p>图14-14所示。</p>
<table>
<thead>
<tr>
<th>DNS服务器</th>
<th>RHEL 8</th>
<th>北京网络：122.71.115.10</th>
</tr>
</thead>
<tbody><tr>
<td>主机名称</td>
<td>操作系统</td>
<td>IP地址</td>
</tr>
<tr>
<td>主机名称</td>
<td>操作系统</td>
<td>美国网络：106.185.25.10</td>
</tr>
<tr>
<td>北京用户</td>
<td>Windows 10</td>
<td>122.71.115.1</td>
</tr>
<tr>
<td>海外用户</td>
<td>Windows 10</td>
<td>106.185.25.1</td>
</tr>
</tbody></table>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823104352649.png" alt="图14-14 DNS分离解析技术"></p>
<blockquote>
<p><strong>第1步</strong>：修改<code>bind</code>服务程序的主配置文件，把第11行的监听端口与第19行的允许查询主机修改为any。</p>
<p>由于配置的<code>DNS</code>分离解析功能与<code>DNS</code>根服务器配置参数有冲突，所以需要把第52～55行的根域信息删</p>
<p>除。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/named.conf
………………省略部分输出信息………………
 44 
 45 logging &#123;
 46         channel default_debug &#123;
 47                 file &quot;data/named.run&quot;;
 48                 severity dynamic;
 49         &#125;;
 50 &#125;;
 51 
 52 zone &quot;.&quot; IN &#123;
 53         type hint;
 54         file &quot;named.ca&quot;;
 55 &#125;;
 56 
 57 include &quot;/etc/named.rfc1912.zones&quot;;
 58 include &quot;/etc/named.root.key&quot;;
 59 
………………省略部分输出信息………………
</code></pre>
<blockquote>
<p><strong>第2步</strong>：<strong>编辑区域配置文件</strong>。把区域配置文件中原有的数据清空，然后按照以下格式写入参数。首先使用</p>
<p><code>acl</code>参数分别定义两个变量名称（<code>china</code>与<code>america</code>），当下面需要匹配<code>IP</code>地址时只需写入变量名称即</p>
<p>可，这样不仅容易阅读识别，而且也利于修改维护。这里的难点是理解<code>view</code>参数的作用。它的作用是通</p>
<p>过判断用户的<code>IP</code>地址是中国的还是美国的，然后去分别加载不同的数据配置文件</p>
<p>（<code>linuxprobe.com.china或linuxprobe.com.america</code>）。这样，当把相应的<code>IP</code>地址分别写入到数据</p>
<p>配置文件后，即可实现<code>DNS</code>的分离解析功能。这样一来，当中国的用户访问<code>linuxprobe.com</code>域名时，</p>
<p>便会按照<code>linuxprobe.com.china</code>数据配置文件内的<code>IP</code>地址找到对应的服务器。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/named.rfc1912.zones
acl &quot;china&quot; &#123; 122.71.115.0/24; &#125;;
acl &quot;america&quot; &#123; 106.185.25.0/24; &#125;;
view &quot;china&quot;&#123;
        match-clients &#123; &quot;china&quot;; &#125;;
        zone &quot;linuxprobe.com&quot; &#123;
        type master;
        file &quot;linuxprobe.com.china&quot;;
        &#125;;
&#125;;
view &quot;america&quot; &#123;
        match-clients &#123; &quot;america&quot;; &#125;;
        zone &quot;linuxprobe.com&quot; &#123;
        type master;
        file &quot;linuxprobe.com.america&quot;;
        &#125;;
&#125;;   
</code></pre>
<blockquote>
<p><strong>第3步</strong>：<strong>建立数据配置文件</strong>。分别通过模板文件创建出两份不同名称的区域数据文件，其名称应与上面区域配置文件中的参数相对应。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# cd /var/named
[root@linuxprobe named]# cp -a named.localhost linuxprobe.com.china
[root@linuxprobe named]# cp -a named.localhost linuxprobe.com.america
[root@linuxprobe named]# vim linuxprobe.com.china
</code></pre>
<table>
<thead>
<tr>
<th>$TTL 1D</th>
<th>#生存周期为1天</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>@</td>
<td>IN SOA</td>
<td>linuxprobe.com.</td>
<td>root.linuxprobe.com.</td>
<td>(</td>
<td></td>
</tr>
<tr>
<td></td>
<td>#授权信息开始:</td>
<td>#DNS区域的地址</td>
<td>#域名管理员的邮箱(不要用@符号)</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>0;serial</td>
<td>#更新序列号</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1D;refresh</td>
<td>#更新时间</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1H;retry</td>
<td>#重试延时</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1W;expire</td>
<td>#失效时间</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>3H);minimum</td>
<td>#无效解析记录的缓存时间</td>
</tr>
<tr>
<td></td>
<td>NS</td>
<td>ns.linuxprobe.com.</td>
<td></td>
<td>#域名服务器记录</td>
<td></td>
</tr>
<tr>
<td>ns</td>
<td>IN A</td>
<td>122.71.115.10</td>
<td></td>
<td></td>
<td>#地址记录(ns.linuxprobe.com.)</td>
</tr>
<tr>
<td>www</td>
<td>IN A</td>
<td>122.71.115.15</td>
<td></td>
<td></td>
<td>#地址记录(<a target="_blank" rel="noopener" href="http://www.linuxprobe.com/">www.linuxprobe.com</a>.)</td>
</tr>
</tbody></table>
<pre><code class="bash">[root@linuxprobe named]# vim linuxprobe.com.america
</code></pre>
<table>
<thead>
<tr>
<th>$TTL 1D</th>
<th>#生存周期为1天</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>@</td>
<td>IN SOA</td>
<td>linuxprobe.com.</td>
<td>root.linuxprobe.com.</td>
<td>(</td>
<td></td>
</tr>
<tr>
<td></td>
<td>#授权信息开始:</td>
<td>#DNS区域的地址</td>
<td>#域名管理员的邮箱(不要用@符号)</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>0;serial</td>
<td>#更新序列号</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1D;refresh</td>
<td>#更新时间</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1H;retry</td>
<td>#重试延时</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1W;expire</td>
<td>#失效时间</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>3H);minimum</td>
<td>#无效解析记录的缓存时间</td>
</tr>
<tr>
<td></td>
<td>NS</td>
<td>ns.linuxprobe.com.</td>
<td></td>
<td>#域名服务器记录</td>
<td></td>
</tr>
<tr>
<td>ns</td>
<td>IN A</td>
<td>106.185.25.10</td>
<td></td>
<td>#地址记录(ns.linuxprobe.com.)</td>
<td></td>
</tr>
<tr>
<td>www</td>
<td>IN A</td>
<td>106.185.25.15</td>
<td></td>
<td>#地址记录(<a target="_blank" rel="noopener" href="http://www.linuxprobe.com/">www.linuxprobe.com</a>.)</td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p><strong>第4步</strong>：重新启动<code>named</code>服务程序，验证结果。将客户端主机（<code>Windows</code>系统或<code>Linux</code>系统均可）的<code>IP</code></p>
<p>地址分别设置为122.71.115.1与106.185.25.1，将<code>DNS</code>地址分别设置为服务器主机的两个<code>IP</code>地址。这</p>
<p>样，当尝试使用<code>nslookup</code>命令解析域名时就能清晰地看到解析结果，分别如图14-15与图14-16所示</p>
</blockquote>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823105216915.png" alt="图14-15  模拟中国用户的域名解析操作"></p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823105231230.png" alt="图14-16 模拟美国用户的域名解析"></p>
<h2 id="十五、使用DHCP动态管理主机地址"><a href="#十五、使用DHCP动态管理主机地址" class="headerlink" title="十五、使用DHCP动态管理主机地址"></a>十五、使用DHCP动态管理主机地址</h2><hr>
<h3 id="15-1、动态主机地址管理协议"><a href="#15-1、动态主机地址管理协议" class="headerlink" title="15.1、动态主机地址管理协议"></a>15.1、动态主机地址管理协议</h3><p>动态主机配置协议（<code>DHCP</code>）是一种基于<code>UDP</code>协议且仅限于在局域网内部使用的网络协议，主要用于大型的局</p>
<p>域网环境或者存在较多移动办公设备的局域网环境中，用途是为局域网内部的设备或网络供应商自动分配<code>IP</code></p>
<p>地址等参数，提供网络配置的“全家桶”服务。</p>
<p>简单来说，<code>DHCP</code>就是让局域网中的主机自动获得网络参数的服务。在图15-1所示的拓扑图中存在多台主机，</p>
<p>如果手动配置每台主机的网络参数会相当麻烦，日后维护起来也让人头大。而且当机房内的主机数量进一步增</p>
<p>加时（比如有100台，甚至1000台），这个手动配置以及维护工作的工作量足以让运维人员崩溃。借助于</p>
<p><code>DHCP</code>，不仅可以为主机自动分配网络参数，还可以确保主机使用的<code>IP</code>地址是唯一的，更重要的是，还能为</p>
<p>特定主机分配固定的IP地址。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823110750133.png" alt="图15-1 DHCP协议的拓扑示意图"></p>
<blockquote>
<p><code>DHCP</code>涉及的常见术语：</p>
<ul>
<li><strong>作用域</strong>：一个完整的IP地址段，DHCP根据作用域来管理网络的分布、IP地址的分配及其他配置参数。</li>
<li><strong>超级作用域</strong>：用于管理处于同一个物理网络中的多个逻辑子网段，它包含了可以统一管理的作用域列表。</li>
<li><strong>排除范围</strong>：把作用域中的某些IP地址排除，确保这些IP地址不会分配给DHCP客户端。</li>
<li><strong>地址池</strong>：在定义了DHCP的作用域并应用了排除范围后，剩余的用来动态分配给客户端的IP地址范围。</li>
<li><strong>租约</strong>：DHCP客户端能够使用动态分配的IP地址的时间。</li>
<li><strong>预约</strong>：保证网络中的特定设备总是获取到相同的IP地址。</li>
</ul>
</blockquote>
<h3 id="15-2、部署dhcpd服务程序"><a href="#15-2、部署dhcpd服务程序" class="headerlink" title="15.2、部署dhcpd服务程序"></a>15.2、部署<code>dhcpd</code>服务程序</h3><blockquote>
<p>安装<code>dhcpd</code>服务程序，其软件包名称为<code>dhcp-server</code></p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# yum install -y dhcp-server
</code></pre>
<blockquote>
<p>查看<code>dhcpd</code>服务程序的配置文件内容</p>
</blockquote>
<pre><code>bash[root@linuxprobe ~]# cat /etc/dhcp/dhcpd.conf
#
# DHCP Server Configuration file.
#   see /usr/share/doc/dhcp-server/dhcpd.conf.example
#   see dhcpd.conf(5) man page
#
</code></pre>
<p><code>dhcp</code>的服务程序的配置文件中只有3行注释语句，这意味着我们需要自行编写这个文件。可以看一下配置文</p>
<p>件中第2行的参考示例文件</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823111447119.png" alt="图15-2 dhcpd服务程序配置文件的架构"></p>
<p>一个标准的配置文件应该包括<strong>全局配置参数</strong>、<strong>子网网段声明</strong>、<strong>地址配置选项</strong>以及<strong>地址配置参数</strong>。其中，全局配</p>
<p>置参数用于定义<code>dhcpd</code>服务程序的整体运行参数；子网网段声明用于配置整个子网段的地址属性。</p>
<blockquote>
<p> <code>dhcpd</code>服务程序配置文件中使用的常见参数以及作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>ddns-update-style 类型</td>
<td>定义DNS服务动态更新的类型，类型包括： none（不支持动态更新）、interim（互动更新模式）与ad-hoc（特殊更新模式）</td>
</tr>
<tr>
<td>allow&#x2F;ignore client-updates</td>
<td>允许&#x2F;忽略客户端更新DNS记录</td>
</tr>
<tr>
<td>default-lease-time 21600</td>
<td>默认超时时间</td>
</tr>
<tr>
<td>max-lease-time 43200</td>
<td>最大超时时间</td>
</tr>
<tr>
<td>option domain-name-servers 8.8.8.8</td>
<td>定义DNS服务器地址</td>
</tr>
<tr>
<td>option domain-name “domain.org”</td>
<td>定义DNS域名</td>
</tr>
<tr>
<td>range</td>
<td>定义用于分配的IP地址池</td>
</tr>
<tr>
<td>option subnet-mask</td>
<td>定义客户端的子网掩码</td>
</tr>
<tr>
<td>option routers</td>
<td>定义客户端的网关地址</td>
</tr>
<tr>
<td>broadcast-address 广播地址</td>
<td>定义客户端的广播地址</td>
</tr>
<tr>
<td>ntp-server IP地址</td>
<td>定义客户端的网络时间服务器（NTP）</td>
</tr>
<tr>
<td>nis-servers IP地址</td>
<td>定义客户端的NIS域服务器的地址</td>
</tr>
<tr>
<td>hardware 硬件类型 MAC地址</td>
<td>指定网卡接口的类型与MAC地址</td>
</tr>
<tr>
<td>server-name 主机名</td>
<td>向DHCP客户端通知DHCP服务器的主机名</td>
</tr>
<tr>
<td>fixed-address IP地址</td>
<td>将某个固定的IP地址分配给指定主机</td>
</tr>
<tr>
<td>time-offset 偏移差</td>
<td>指定客户端与格林尼治时间的偏移差</td>
</tr>
</tbody></table>
<h3 id="15-3、自动管理IP地址"><a href="#15-3、自动管理IP地址" class="headerlink" title="15.3、自动管理IP地址"></a>15.3、自动管理<code>IP</code>地址</h3><blockquote>
<p>机房所用的网络地址以及参数信息</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>值</th>
</tr>
</thead>
<tbody><tr>
<td>默认租约时间</td>
<td>21600秒</td>
</tr>
<tr>
<td>最大租约时间</td>
<td>43200秒</td>
</tr>
<tr>
<td>IP地址范围</td>
<td>192.168.10.50~192.168.10.150</td>
</tr>
<tr>
<td>子网掩码</td>
<td>255.255.255.0</td>
</tr>
<tr>
<td>网关地址</td>
<td>192.168.10.1</td>
</tr>
<tr>
<td>DNS服务器地址</td>
<td>192.168.10.1</td>
</tr>
<tr>
<td>搜索域</td>
<td>linuxprobe.com</td>
</tr>
</tbody></table>
<blockquote>
<p><code>DHCP</code>服务器以及客户端的配置信息</p>
</blockquote>
<table>
<thead>
<tr>
<th>主机类型</th>
<th>操作系统</th>
<th>IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>DHCP服务器</td>
<td>RHEL 8</td>
<td>192.168.10.1</td>
</tr>
<tr>
<td>DHCP客户端</td>
<td>Windows 10</td>
<td>DHCP自动获取地址</td>
</tr>
</tbody></table>
<p>作用域一般是个完整的<code>IP</code>地址段，而地址池中的<code>IP</code>地址才是真正供客户端使用的，因此地址池应该小于或等</p>
<p>于作用域的<code>IP</code>地址范围。另外，由于<code>VMware Workstation</code>虚拟机软件自带<code>DHCP</code>服务，为了避免与自己配</p>
<p>置的<code>dhcpd</code>服务程序产生冲突，应该先按照图15-3和图15-4将虚拟机软件自带的<code>DHCP</code>功能关闭。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823112042181.png" alt="图15-4 关闭虚拟机自带的DHCP功能"></p>
<p>可随意开启几台客户端，准备进行验证。但是一定要注意，<code>DHCP</code>客户端与服务器需要处于同一种网络模式</p>
<p>—仅主机模式（<code>Hostonly</code>），否则就会产生物理隔离，从而无法获取<code>IP</code>地址。建议开启1～3台客户端虚拟</p>
<p>机验证一下效果就好，以免物理主机的<code>CPU</code>和内存的负载太高。</p>
<blockquote>
<p>在确认<code>DHCP</code>服务器的<code>IP</code>地址等网络信息配置妥当后，就可以配置<code>dhcpd</code>服务程序了。请注意，在配置</p>
<p><code>dhcpd</code>服务程序时，配置文件中的每行参数后面都需要以分号（;）结尾，这是规定。另外，<code>dhcpd</code>服务</p>
<p>程序配置文件内的参数都十分重要，因此在表中罗列出了每一行参数，并对其用途进行了简单介绍。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/dhcp/dhcpd.conf
ddns-update-style none;
ignore client-updates;
subnet 192.168.10.0 netmask 255.255.255.0 &#123;
        range 192.168.10.50 192.168.10.150;
        option subnet-mask 255.255.255.0;
        option routers 192.168.10.1;
        option domain-name &quot;linuxprobe.com&quot;;
        option domain-name-servers 192.168.10.1;
        default-lease-time 21600;
        max-lease-time 43200;
&#125;
</code></pre>
<blockquote>
<p> <code>dhcpd</code>服务程序配置文件中使用的参数以及作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>ddns-update-style none;</td>
<td>设置DNS服务不自动进行动态更新</td>
</tr>
<tr>
<td>ignore client-updates;</td>
<td>忽略客户端更新DNS记录</td>
</tr>
<tr>
<td>subnet 192.168.10.0 netmask 255.255.255.0 {</td>
<td>作用域为192.168.10.0&#x2F;24网段</td>
</tr>
<tr>
<td>range 192.168.10.50 192.168.10.150;</td>
<td>IP地址池为192.168.10.50-150（约100个IP地址）</td>
</tr>
<tr>
<td>option subnet-mask 255.255.255.0;</td>
<td>定义客户端默认的子网掩码</td>
</tr>
<tr>
<td>option routers 192.168.10.1;</td>
<td>定义客户端的网关地址</td>
</tr>
<tr>
<td>option domain-name “linuxprobe.com”;</td>
<td>定义默认的搜索域</td>
</tr>
<tr>
<td>option domain-name-servers 192.168.10.1;</td>
<td>定义客户端的DNS地址</td>
</tr>
<tr>
<td>default-lease-time 21600;</td>
<td>定义默认租约时间（单位：秒）</td>
</tr>
<tr>
<td>max-lease-time 43200;</td>
<td>定义最大预约时间（单位：秒）</td>
</tr>
</tbody></table>
<blockquote>
<p>把配置过的<code>dhcpd</code>服务加入到开机启动项中，以确保当服务器下次开机后<code>dhcpd</code>服务依然能自动启动，</p>
<p>并顺地为客户端分配IP地址等信息。</p>
<pre><code class="bash">[root@linuxprobe ~]# systemctl start dhcpd
[root@linuxprobe ~]# systemctl enable dhcpd
Created symlink /etc/systemd/system/multi-user.target.wants/dhcpd.service → /usr/lib/systemd/system/dhcpd.service.
</code></pre>
</blockquote>
<p>把<code>dhcpd</code>服务程序配置妥当之后就可以开启客户端来检验IP分配效果了。在日常工作中，<code>Windows 10</code>是主流</p>
<p>的桌面操作系统，所以只要确保两个主机都处于同一个网络模式内，然后像如图15-5那样设置<code>Windows</code>系统</p>
<p>的网络为<code>DHCP</code>模式，再稍等片刻即可自动获取到网卡信息了，如图15-6所示。特别方便！</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823112532277.png" alt="图15-5 设置网卡模式"></p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823112548824.png" alt="图15-6 自动获取到IP地址"></p>
<blockquote>
<p>防火墙放行<code>DHCP</code>		</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# firewall-cmd --zone=public --permanent --add-service=dhcp
success
[root@linuxprobe ~]# firewall-cmd --reload
success
</code></pre>
<h3 id="15-4、分配固定的IP地址"><a href="#15-4、分配固定的IP地址" class="headerlink" title="15.4、分配固定的IP地址"></a>15.4、分配固定的<code>IP</code>地址</h3><p>在<code>DHCP</code>协议中有个术语是“预约”，它用来确保局域网中特定的设备总是获取到固定的<code>IP</code>地址。换句话说，</p>
<p>就是<code>dhcpd</code>服务程序会把某个<code>IP</code>地址私藏下来，只将其用于相匹配的特定设备。</p>
<p>要想把某个<code>IP</code>地址与某台主机进行绑定，就需要用到这台主机的<code>MAC</code>地址。这个<code>MAC</code>地址即网卡上一串独立</p>
<p>的标识符，具备唯一性，因此不会存在冲突的情况。在<code>Linux</code>系统中查看<code>MAC</code>地址的示例如图15-7所示，在</p>
<p><code>Windows</code>系统中查<code>MAC</code>地址的示例如图15-8所示。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823141911649.png" alt="图15-7 在Linux系统中查看网卡MAC地址"></p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823141930513.png" alt="图15-8 在Windows系统中查看网卡MAC地址"></p>
<blockquote>
<p>在<code>dhcpd</code>服务程序的配置文件中，按照如下格式将<code>IP</code>地址与<code>MAC</code>地址进行绑定。</p>
</blockquote>
<table>
<thead>
<tr>
<th>host 主机名称 {</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>hardware</td>
<td>ethernet</td>
<td>该主机的MAC地址;</td>
<td></td>
</tr>
<tr>
<td></td>
<td>fixed-address</td>
<td>欲指定的IP地址;</td>
<td></td>
<td></td>
</tr>
<tr>
<td>}</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>如果不方便查看主机的<code>MAC</code>地址，该怎么办呢？比如，要给老板使用的主机绑定<code>IP</code>地址，总不能随便就去</p>
<p>查看老板的主机信息吧。针对这种情况，这里告诉大家一个好办法。我们首先启动<code>dhcpd</code>服务程序，为老板</p>
<p>的主机分配一个<code>IP</code>地址，这样就会在<code>DHCP</code>服务器本地的日志文件中保存这次的<code>IP</code>地址分配记录。然后查看</p>
<p>日志文件，就可以获悉主机的<code>MAC</code>地址了（即下面加粗的内容）</p>
<pre><code class="bash">[root@linuxprobe ~]# tail -f /var/log/messages
………………省略部分输出信息………………
Mar 22 00:28:54 linuxprobe cupsd[1206]: REQUEST linuxprobe.com- - &quot;POST / HTTP/1.1&quot; 200 183 Renew-Subscription client-error-not-found
Mar 22 00:29:35 linuxprobe dhcpd[30959]: DHCPREQUEST for 192.168.10.50 from 00:0c:29:dd:f2:22 (DESKTOP-3OGV50E) via ens160
Mar 22 00:29:35 linuxprobe dhcpd[30959]: DHCPACK on 192.168.10.50 to 00:0c:29:dd:f2:22 (DESKTOP-3OGV50E) via ens160
</code></pre>
<p>在<code>Windows</code>系统中看到的<code>MAC</code>地址，其格式类似于00-0c-29-dd-f2-22，间隔符为减号（-）。但是在<code>Linux</code></p>
<p>系统中，<code>MAC</code>地址的间隔符则变成了冒号（:）</p>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/dhcp/dhcpd.conf 
ddns-update-style none;
ignore client-updates;
subnet 192.168.10.0 netmask 255.255.255.0 &#123;
        range 192.168.10.50 192.168.10.150;
        option subnet-mask 255.255.255.0;
        option routers 192.168.10.1;
        option domain-name &quot;linuxprobe.com&quot;;
        option domain-name-servers 192.168.10.1;
        default-lease-time 21600;
        max-lease-time 43200;
        host linuxprobe &#123;
                hardware ethernet 00:0c:29:dd:f2:22;
                fixed-address 192.168.10.88;
                &#125;
&#125;
</code></pre>
<p>确认参数填写正确后就可以保存并退出配置文件，然后就可以重启<code>dhcpd</code>服务程序了。</p>
<pre><code class="bash">[root@linuxprobe ~]# systemctl restart dhcpd
</code></pre>
<p>需要说明的是，如果您刚刚为这台主机分配了<code>IP</code>地址，由于它的<code>IP</code>地址租约时间还没有到期，因此不会立即</p>
<p>换成新绑定的<code>IP</code>地址。要想立即查看绑定效果，则需要重启一下客户端的网络服务，如图15-9所示。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823142327945.png" alt="图15-9 重启网卡设备"></p>
<p>然后就能看到效果了，如图15-10所示。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220823142349471.png" alt="图15-10 查看绑定后的网卡信息"></p>
<h2 id="十六、使用Postfix与Dovecot部署邮件系统"><a href="#十六、使用Postfix与Dovecot部署邮件系统" class="headerlink" title="十六、使用Postfix与Dovecot部署邮件系统"></a>十六、使用Postfix与Dovecot部署邮件系统</h2><hr>
<h3 id="16-1、电子邮件系统"><a href="#16-1、电子邮件系统" class="headerlink" title="16.1、电子邮件系统"></a>16.1、电子邮件系统</h3><blockquote>
<p>电子邮件系统基于邮件协议来完成电子邮件的传输，常见的邮件协议有：</p>
<ul>
<li><strong>简单邮件传输协议（<code>Simple Mail Transfer Protocol，SMTP</code>）</strong>：用于发送和中转发出的电子邮件，占用服务器的TCP&#x2F;25端口。</li>
<li><strong>邮局协议版本3（<code>Post Office Protocol 3</code>）</strong>：用于将电子邮件存储到本地主机，占用服务器的TCP&#x2F;110端口。</li>
<li><strong>Internet消息访问协议版本4（<code>Internet Message Access Protocol 4</code>）</strong>：用于在本地主机上访问邮件，占用服务器的TCP&#x2F;143端口。</li>
</ul>
</blockquote>
<p>在电子邮件系统中，为用户收发邮件的服务器名为<strong>邮件用户代理</strong>（<code>Mail User Agent，MUA</code>）。另外，既然</p>
<p>电子邮件系统能够让用户在离线的情况下依然可以完成数据的接收，肯定得有一个用于保存用户邮件的“信</p>
<p>箱”服务器，这个服务器的名字为邮件投递代理（<code>Mail Delivery Agent</code>，<code>MDA</code>），其工作职责是把来自于</p>
<p>邮件传输代理（<code>Mail Transfer Agent</code>，<code>MTA</code>）的邮件保存到本地的收件箱中。其中，这个<code>MTA</code>的工作职责</p>
<p>是转发处理不同电子邮件服务供应商之间的邮件，把来自于MUA的邮件转发到合适的<code>MTA</code>服务器。例如，我</p>
<p>们从新浪信箱向谷歌信箱发送一封电子邮件，这封电子邮件的传输过程如图16-1所示。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824093925464.png" alt="图16-1 电子邮件的传输过程"></p>
<blockquote>
<p>生产环境中部署企业级的电子邮件系统时，有4个注意事项请留意：</p>
<ul>
<li><strong>添加反垃圾与反病毒模块</strong>：它能够很有效地阻止垃圾邮件或病毒邮件对企业信箱的干扰。</li>
<li><strong>对邮件加密：</strong>可有效保护邮件内容不被黑客盗取和篡改。</li>
<li><strong>添加邮件监控审核模块</strong>：可有效地监控企业全体员工的邮件中是否有敏感词，是否有透露企业资料等违规行为。</li>
<li><strong>保障稳定性</strong>：电子邮件系统的稳定性至关重要，运维人员应做到保证电子邮件系统的稳定运行，并及时做好防范分布式拒绝服务（<code>Distributed Denial of Service</code>，<code>DDoS</code>）攻击的准备。</li>
</ul>
</blockquote>
<h3 id="16-2、部署基础的电子邮件系统"><a href="#16-2、部署基础的电子邮件系统" class="headerlink" title="16.2、部署基础的电子邮件系统"></a>16.2、部署基础的电子邮件系统</h3><p>一个最基础的电子邮件系统肯定要能提供发件服务和收件服务，为此需要使用基于<code>SMTP</code>的<code>Postfix</code>服务程序</p>
<p>提供发件服务功能，并使用基于<code>POP3</code>协议的<code>Dovecot</code>服务程序提供收件服务功能。这样一来，用户就可以使</p>
<p>用<code>Outlook Express</code>或<code>Foxmail</code>等客户端服务程序正常收发邮件了。电子邮件系统的工作流程如图16-2所</p>
<p>示。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824094219650.png" alt="图16-2 电子邮件系统的工作流程"></p>
<p>一般而言，我们的信箱地址类似于<a href="mailto:&#114;&#111;&#111;&#x74;&#x40;&#108;&#105;&#110;&#117;&#x78;&#112;&#114;&#x6f;&#x62;&#101;&#x2e;&#x63;&#x6f;&#109;">&#114;&#111;&#111;&#x74;&#x40;&#108;&#105;&#110;&#117;&#x78;&#112;&#114;&#x6f;&#x62;&#101;&#x2e;&#x63;&#x6f;&#109;</a>这样，也就是按照“用户名@主机地址（域名）”格式</p>
<p>来规范的。如果您给我一串“<a href="mailto:&#114;&#111;&#x6f;&#116;&#64;&#x31;&#x39;&#x32;&#46;&#49;&#x36;&#x38;&#46;&#49;&#48;&#x2e;&#x31;&#x30;">&#114;&#111;&#x6f;&#116;&#64;&#x31;&#x39;&#x32;&#46;&#49;&#x36;&#x38;&#46;&#49;&#48;&#x2e;&#x31;&#x30;</a>”的信息，我可能猜不到这是一个邮箱地址，没准会将它当</p>
<p>作SSH协议的连接信息。因此，要想更好地检验电子邮件系统的配置效果，需要先部署<code>bind</code>服务程序，为电</p>
<p>子邮件服务器和客户端提供<code>DNS</code>域名解析服务。</p>
<blockquote>
<p><strong>第1步</strong>：配置服务器主机名称，需要保证服务器主机名称与发信域名保持一致。</p>
</blockquote>
<pre><code>[root@linuxprobe ~]# vim /etc/hostname
mail.linuxprobe.com
[root@linuxprobe ~]# hostname
mail.linuxprobe.com
[root@linuxprobe ~]#hostnamectl set-hostname mail.linuxprobe.com
</code></pre>
<blockquote>
<p><strong>第2步</strong>：清空<code>iptables</code>防火墙默认策略，并保存策略状态，避免因防火墙中默认存在的策略阻止了客</p>
<p>户端<code>DNS</code>解析域名及收发邮件。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# iptables -F
[root@linuxprobe ~]# iptables-save
</code></pre>
<p>把DNS协议加入到<code>firewalld</code>防火墙的允许列表中</p>
<pre><code class="bash">[root@linuxprobe ~]# firewall-cmd --permanent --zone=public --add-service=dns
success
[root@linuxprobe ~]# firewall-cmd --reload
success
</code></pre>
<blockquote>
<p><strong>第3步</strong>：为电子邮件系统提供域名解析。</p>
</blockquote>
<pre><code class="bash">bash
[root@linuxprobe ~]# dnf install bind-chroot
 [root@linuxprobe ~]# cat /etc/named.conf
  1 //
  2 // named.conf
  3 //
  4 // Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
  5 // server as a caching only nameserver (as a localhost DNS resolver only).
  6 //
  7 // See /usr/share/doc/bind*/sample/ for example named configuration files.
  8 //
  9 
 10 options &#123;
 11         listen-on port 53 &#123; any; &#125;;
 12         listen-on-v6 port 53 &#123; ::1; &#125;;
 13         directory       &quot;/var/named&quot;;
 14         dump-file       &quot;/var/named/data/cache_dump.db&quot;;
 15         statistics-file &quot;/var/named/data/named_stats.txt&quot;;
 16         memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;
 17         secroots-file   &quot;/var/named/data/named.secroots&quot;;
 18         recursing-file  &quot;/var/named/data/named.recursing&quot;;
 19         allow-query     &#123; any; &#125;;
 20 
 ………………省略部分输出信息………………
</code></pre>
<pre><code class="bash">[root@linuxprobe ~]# cat /etc/named.rfc1912.zones
zone &quot;linuxprobe.com&quot; IN &#123;
        type master;
        file &quot;linuxprobe.com.zone&quot;;
        allow-update &#123;none;&#125;;
&#125;;
</code></pre>
<p>建议在复制正向解析模板文件时，在<code>cp</code>命令后面追加<code>-a</code>参数，以便让新文件继承原文件的属性和权限信息</p>
<pre><code class="bash">[root@linuxprobe ~]# cp -a /var/named/named.localhost /var/named/linuxprobe.com.zone
[root@linuxprobe ~]# cat /var/named/linuxprobe.com.zone
</code></pre>
<table>
<thead>
<tr>
<th>$TTL 1D</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>@</td>
<td>IN SOA</td>
<td>linuxprobe.com.</td>
<td>root.linuxprobe.com.</td>
<td>(</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>0;serial</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1D;refresh</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1H;retry</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1W;expire</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>3H);minimum</td>
</tr>
<tr>
<td></td>
<td>NS</td>
<td>ns.linuxprobe.com.</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ns</td>
<td>IN A</td>
<td>192.168.10.10</td>
<td></td>
<td></td>
</tr>
<tr>
<td>@</td>
<td>IN MX 10</td>
<td>mail.linuxprobe.com.</td>
<td></td>
<td></td>
</tr>
<tr>
<td>mail</td>
<td>IN A</td>
<td>192.168.10.10</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<pre><code class="bash">[root@linuxprobe ~]# systemctl restart named
[root@linuxprobe ~]# systemctl enable  named
Created symlink /etc/systemd/system/multi-user.target.wants/named.service → /usr/lib/systemd/system/named.service.
</code></pre>
<p>修改好配置文件后记得重启bind服务程序，这样电子邮件系统所对应的服务器主机名即为</p>
<p><code>mail.linuxprobe.com</code>，而邮件域为<code>@linuxprobe.com</code>。把服务器的<code>DNS</code>地址修改成本</p>
<p>地<code>IP</code>地址，如图16-3所示。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824094748533.png" alt="图16-3 配置服务器的DNS地址"></p>
<p>让新配置的网卡参数立即生效</p>
<pre><code class="bash">[root@linuxprobe ~]# nmcli connection up ens160 
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/4)
</code></pre>
<p>最后，对主机名执行<code>ping</code>命令，若能<code>ping</code>通，则证明上述操作全部正确。注意，在执行<code>ping</code>操作时，也会</p>
<p>获得主机名对应的IP地址，证明上述操作全部正确：</p>
<pre><code class="bash">[root@linuxprobe ~]# ping -c 4  mail.linuxprobe.com 
PING mail.linuxprobe.com (192.168.10.10) 56(84) bytes of data.
64 bytes from mail.linuxprobe.com (192.168.10.10): icmp_seq=1 ttl=64 time=0.040 ms
64 bytes from mail.linuxprobe.com (192.168.10.10): icmp_seq=2 ttl=64 time=0.057 ms
64 bytes from mail.linuxprobe.com (192.168.10.10): icmp_seq=3 ttl=64 time=0.037 ms
64 bytes from mail.linuxprobe.com (192.168.10.10): icmp_seq=4 ttl=64 time=0.052 ms

--- mail.linuxprobe.com ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 45ms
rtt min/avg/max/mdev = 0.037/0.046/0.057/0.010 ms
</code></pre>
<h4 id="16-2-1、配置Postfix服务程序"><a href="#16-2-1、配置Postfix服务程序" class="headerlink" title="16.2.1、配置Postfix服务程序"></a>16.2.1、配置<code>Postfix</code>服务程序</h4><p><code>Postfix</code>是一款由<code>IBM</code>资助研发的免费开源电子邮件服务程序，能够很好地兼容<code>Sendmail</code>服务程序，可以方</p>
<p>便<code>Sendmail</code>用户迁移到<code>Postfix</code>服务上。<code>Postfix</code>服务程序的邮件收发能力强于<code>Sendmail</code>服务，而且能自</p>
<p>动增加、减少进程的数量来保证电子邮件系统的高性能与稳定性。另外，<code>Postfix</code>服务程序由许多小模块组</p>
<p>成，每个小模块都可以完成特定的功能，因此可在生产工作环境中根据需求灵活搭配。</p>
<blockquote>
<p><strong>第1步</strong>：安装<code>Postfix</code>服务程序</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# yum install postfix
</code></pre>
<blockquote>
<p><strong>第2步</strong>：配置<code>Postfix</code>服务程序。大家如果是首次看到<code>Postfix</code>服务程序主配置文件</p>
<p>（<code>/etc/ postfix/main.cf</code>），估计会被738行的内容给吓到。其实不用担心，这里</p>
<p>面绝大多数的内容依然是注释信息。</p>
</blockquote>
<blockquote>
<p> <code>Postfix</code>服务程序主配置文件中的重要参数</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>myhostname</code></td>
<td>邮局系统的主机名</td>
</tr>
<tr>
<td><code>mydomain</code></td>
<td>邮局系统的域名</td>
</tr>
<tr>
<td><code>myorigin</code></td>
<td>从本机发出邮件的域名名称</td>
</tr>
<tr>
<td><code>inet_interfaces</code></td>
<td>监听的网卡接口</td>
</tr>
<tr>
<td><code>mydestination</code></td>
<td>可接收邮件的主机名或域名</td>
</tr>
<tr>
<td><code>mynetworks</code></td>
<td>设置可转发哪些主机的邮件</td>
</tr>
<tr>
<td><code>relay_domains</code></td>
<td>设置可转发哪些网域的邮件</td>
</tr>
</tbody></table>
<p>在<code>Postfix</code>服务程序的主配置文件中，总计需要修改5处。首先是在第95行定义一个名为<code>myhostname</code>的变</p>
<p>量，用来保存服务器的主机名称。请大家记住这个变量的名称，下面的参数需要调用它</p>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/postfix/main.cf
 86 
 87 # INTERNET HOST AND DOMAIN NAMES
 88 # 
 89 # The myhostname parameter specifies the internet hostname of this
 90 # mail system. The default is to use the fully-qualified domain name
 91 # from gethostname(). $myhostname is used as a default value for many
 92 # other configuration parameters.
 93 #
 94 #myhostname = host.domain.tld
 95 myhostname = mail.linuxprobe.com
 96 
</code></pre>
<p>然后在第102行定义一个名为<code>mydomain</code>的变量，用来保存邮件域的名称。大家也要记住这个变量名称，下面</p>
<p>将调用它</p>
<pre><code class="bash"> 96 
 97 # The mydomain parameter specifies the local internet domain name.
 98 # The default is to use $myhostname minus the first component.
 99 # $mydomain is used as a default value for many other configuration
100 # parameters.
101 #
102 mydomain = linuxprobe.com
103 
</code></pre>
<p>在第118行调用前面的<code>mydomain</code>变量，用来定义发出邮件的域。调用变量的好处是避免重复写入信息，以及</p>
<p>便于日后统一修改b</p>
<pre><code class="bash">105 # 
106 # The myorigin parameter specifies the domain that locally-posted
107 # mail appears to come from. The default is to append $myhostname,
108 # which is fine for small sites.  If you run a domain with multiple
109 # machines, you should (1) change this to $mydomain and (2) set up
110 # a domain-wide alias database that aliases each user to
111 # user@that.users.mailhost.
112 #
113 # For the sake of consistency between sender and recipient addresses,
114 # myorigin also specifies the default domain name that is appended
115 # to recipient addresses that have no @domain part.
116 #
117 #myorigin = $myhostname
118 myorigin = $mydomain
119 
</code></pre>
<p>第4处修改是在第135行定义网卡监听地址。可以指定要使用服务器的哪些IP地址对外提供电子邮件服务；也</p>
<p>可以干脆写成all，表示所有IP地址都能提供电子邮件服务</p>
<pre><code class="bash">121 
122 # The inet_interfaces parameter specifies the network interface
123 # addresses that this mail system receives mail on.  By default,
124 # the software claims all active interfaces on the machine. The
125 # parameter also controls delivery of mail to user@[ip.address].
126 #
127 # See also the proxy_interfaces parameter, for network addresses that
128 # are forwarded to us via a proxy or network address translator.
129 #
130 # Note: you need to stop/start Postfix when this parameter changes.
131 #
132 #inet_interfaces = all
133 #inet_interfaces = $myhostname
134 #inet_interfaces = $myhostname, localhost
135 inet_interfaces = all
136 
</code></pre>
<p>最后一处修改是在第183行定义可接收邮件的主机名或域名列表。这里可以直接调用前面定义好的</p>
<p><code>myhostname</code>和<code>mydomain</code>变量</p>
<pre><code class="bash">151 
152 # The mydestination parameter specifies the list of domains that this
153 # machine considers itself the final destination for.
154 #
155 # These domains are routed to the delivery agent specified with the
156 # local_transport parameter setting. By default, that is the UNIX
157 # compatible delivery agent that lookups all recipients in /etc/passwd
158 # and /etc/aliases or their equivalent.
159 #
160 # The default is $myhostname + localhost.$mydomain + localhost.  On
161 # a mail domain gateway, you should also include $mydomain.
162 #
163 # Do not specify the names of virtual domains - those domains are
164 # specified elsewhere (see VIRTUAL_README).
165 #
166 # Do not specify the names of domains that this machine is backup MX
167 # host for. Specify those names via the relay_domains settings for
168 # the SMTP server, or use permit_mx_backup if you are lazy (see
169 # STANDARD_CONFIGURATION_README).
170 #
171 # The local machine is always the final destination for mail addressed
172 # to user@[the.net.work.address] of an interface that the mail system
173 # receives mail on (see the inet_interfaces parameter).
174 #
175 # Specify a list of host or domain names, /file/name or type:table
176 # patterns, separated by commas and/or whitespace. A /file/name
177 # pattern is replaced by its contents; a type:table is matched when
178 # a name matches a lookup key (the right-hand side is ignored).
179 # Continue long lines by starting the next line with whitespace.
180 #
181 # See also below, section &quot;REJECTING MAIL FOR UNKNOWN LOCAL USERS&quot;.
182 #
183 mydestination = $myhostname, $mydomain
184 #mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain
185 #mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain,
186 #       mail.$mydomain, www.$mydomain, ftp.$mydomain
187 
</code></pre>
<p><strong>第3步</strong>：创建电子邮件系统的登录账户。<code>Postfix</code>与<code>vsftpd</code>服务程序一样，都可以调用本地系统的账户和密</p>
<p>码，因此在本地系统创建常规账户即可。最后重启配置妥当的<code>postfix</code>服务程序，并将其添加到开机启动项</p>
<p>中。大功告成！</p>
<pre><code class="bash">b[root@linuxprobe ~]# useradd liuchuan
[root@linuxprobe ~]# echo &quot;linuxprobe&quot; | passwd --stdin liuchuan
Changing password for user liuchuan.
passwd: all authentication tokens updated successfully.
[root@linuxprobe ~]# systemctl restart postfix
[root@linuxprobe ~]# systemctl enable  postfix
Created symlink /etc/systemd/system/multi-user.target.wants/postfix.service → /usr/lib/systemd/system/postfix.service.
</code></pre>
<h4 id="16-2-2、配置Dovecot服务程序"><a href="#16-2-2、配置Dovecot服务程序" class="headerlink" title="16.2.2、配置Dovecot服务程序"></a>16.2.2、配置<code>Dovecot</code>服务程序</h4><p><code>Dovecot</code>是一款能够为<code>Linux</code>系统提供<code>IMAP</code>和<code>POP3</code>电子邮件服务的开源服务程序，安全性极高，配置简</p>
<p>单，执行速度快，而且占用的服务器硬件资源也较少，因此是一款值得推荐的收件服务程序。</p>
<blockquote>
<p><strong>第1步</strong>：安装<code>Dovecot</code>服务程序软件包。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# yum install -y dovecot
</code></pre>
<p><strong>第2步</strong>：配置部署<code>Dovecot</code>服务程序。在<code>Dovecot</code>服务程序的主配置文件中进行如下修改。首先是第24行，</p>
<p>把<code>Dovecot</code>服务程序支持的电子邮件协议修改为<code>imap</code>、<code>pop3</code>和<code>lmtp</code>。然后在这一行下面添加一行参数，允</p>
<p>许用户使用明文进行密码验证。之所以这样操作，是因为<code>Dovecot</code>服务程序为了保证电子邮件系统的安全而</p>
<p>默认强制用户使用加密方式进行登录，而由于当前还没有加密系统，因此需要添加该参数来允许用户的明文登</p>
<p>录。</p>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/dovecot/dovecot.conf
………………省略部分输出信息………………
 22 
 23 # Protocols we want to be serving.
 24 protocols = imap pop3 lmtp
 25 disable_plaintext_auth = no
 26 
………………省略部分输出信息………………
</code></pre>
<p>在主配置文件的第49行，<strong>设置允许登录的网段地址</strong>，也就是说我们可以在这里限制只有来自于某个网段的用</p>
<p>户才能使用电子邮件系统。如果想允许所有人都能使用，则不用修改本参数：</p>
<pre><code class="bash">bas 44 
 45 # Space separated list of trusted network ranges. Connections from these
 46 # IPs are allowed to override their IP addresses and ports (for logging and
 47 # for authentication checks). disable_plaintext_auth is also ignored for
 48 # these networks. Typically you&#39;d specify your IMAP proxy servers here.
 49 login_trusted_networks = 192.168.10.0/24
 50 
</code></pre>
<p><strong>第3步</strong>：<strong>配置邮件格式与存储路径</strong>。在<code>Dovecot</code>服务程序单独的子配置文件中，定义一个路径，用于指定要将</p>
<p>收到的邮件存放到服务器本地的哪个位置。这个路径默认已经定义好了，只需要将该配置文件中第25行前面</p>
<p>的井号（#）删除即可。</p>
<pre><code class="bash">[root@linuxprobe ~]# vim /etc/dovecot/conf.d/10-mail.conf
  1 ##
  2 ## Mailbox locations and namespaces
  3 ##
  4 
  5 # Location for users&#39; mailboxes. The default is empty, which means that Dovecot
  6 # tries to find the mailboxes automatically. This won&#39;t work if the user
  7 # doesn&#39;t yet have any mail, so you should explicitly tell Dovecot the full
  8 # location.
  9 #
 10 # If you&#39;re using mbox, giving a path to the INBOX file (eg. /var/mail/%u)
 11 # isn&#39;t enough. You&#39;ll also need to tell Dovecot where the other mailboxes are
 12 # kept. This is called the &quot;root mail directory&quot;, and it must be the first
 13 # path given in the mail_location setting.
 14 #
 15 # There are a few special variables you can use, eg.:
 16 #
 17 #   %u - username
 18 #   %n - user part in user@domain, same as %u if there&#39;s no domain
 19 #   %d - domain part in user@domain, empty if there&#39;s no domain
 20 #   %h - home directory
 21 #
 22 # See doc/wiki/Variables.txt for full list. Some examples:
 23 #
 24 #   mail_location = maildir:~/Maildir
 25     mail_location = mbox:~/mail:INBOX=/var/mail/%u
 26 #   mail_location = mbox:/var/mail/%d/%1n/%n:INDEX=/var/indexes/%d/%1n/%n
 27 #
………………省略部分输出信息………………
</code></pre>
<p>然后切换到配置<code>Postfix</code>服务程序时创建的<code>boss</code>账户，并在家目录中建立用于保存邮件的目录。记得要重启</p>
<p><code>Dovecot</code>服务并将其添加到开机启动项中。至此，对<code>Dovecot</code>服务程序的配置部署步骤全部结束。</p>
<pre><code class="bash">[root@linuxprobe ~]# su - liuchuan
[liuchuan@linuxprobe ~]$ mkdir -p mail/.imap/INBOX
[liuchuan@linuxprobe ~]$ exit
logout
[root@linuxprobe ~]# systemctl restart dovecot
[root@linuxprobe ~]# systemctl enable  dovecot
Created symlink /etc/systemd/system/multi-user.target.wants/dovecot.service → /usr/lib/systemd/system/dovecot.service.
</code></pre>
<p>把上面提到的邮件协议在防火墙中的策略予以放行，这样客户端就能正常访问了</p>
<pre><code class="bash">[root@linuxprobe ~]# firewall-cmd --permanent --zone=public --add-service=imap
success
[root@linuxprobe ~]# firewall-cmd --permanent --zone=public --add-service=pop3
success
[root@linuxprobe ~]# firewall-cmd --permanent --zone=public --add-service=smtp
success
[root@linuxprobe ~]# firewall-cmd --reload
success
</code></pre>
<h4 id="16-2-3、客户使用电子邮件系统"><a href="#16-2-3、客户使用电子邮件系统" class="headerlink" title="16.2.3、客户使用电子邮件系统"></a>16.2.3、客户使用电子邮件系统</h4><p>如何得知电子邮件系统已经能够正常收发邮件了呢？可以使用<code>Windows</code>操作系统中自带的<code>Outlook</code>软件来进</p>
<p>行测试（也可以使用其他电子邮件客户端来测试，比如<code>Foxmail</code>）。请按照表来设置电子邮件系统及<code>DNS</code>服</p>
<p>务器和客户端主机的IP地址，以便能正常解析邮件域名。设置后的结果如图16-4所示。</p>
<blockquote>
<p> 服务器与客户端的操作系统与IP地址</p>
</blockquote>
<table>
<thead>
<tr>
<th>主机名称</th>
<th>操作系统</th>
<th>IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>电子邮件系统及DNS服务器</td>
<td>RHEL 8</td>
<td>192.168.10.10</td>
</tr>
<tr>
<td>客户端主机</td>
<td>Windows 10</td>
<td>192.168.10.30</td>
</tr>
</tbody></table>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824102824671.png" alt="图16-4 配置Windows 10系统的网络参数"></p>
<blockquote>
<p><strong>第1步</strong>：在<code>Windows 10</code>系统中运行Outlook软件程序。由于各位读者使用的<code>Windows 10</code>系统版本不一</p>
<p>定相同，因此本书决定采用<code>Outlook 2010</code>版本为对象进行实验。如果您想要与这里的实验环境尽量保</p>
<p>持一致，可在软件资源库页面（<a target="_blank" rel="noopener" href="https://www.linuxprobe.com/tools%EF%BC%89%E4%B8%8B%E8%BD%BD%E5%B9%B6%E5%AE%89%E8%A3%85%60Outlook">https://www.linuxprobe.com/tools）下载并安装`Outlook</a> 2010&#96;软件。</p>
<p>在初次运行该软件时会出现一个“<code>Microsoft Outlook 2010</code>启动”页面，引导大家完成该软件的配置过</p>
<p>程，如图16-5所示。</p>
</blockquote>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824102941406.png" alt="图16-5 Outlook 2010启动向导"></p>
<blockquote>
<p><strong>第2步</strong>：<strong>配置电子邮件账户</strong>。在图16-6所示的“账户配置”页面中单击“是”单选按钮，然后单击“下一步”按</p>
<p>钮。</p>
</blockquote>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824103006840.png" alt="图16-6 配置电子邮件账户"></p>
<blockquote>
<p><strong>第3步</strong>：<strong>填写电子邮件账户信息</strong>，在图16-7所示的页面中，在“您的姓名”文本框中输入您的名字（可以为</p>
<p>自定义的任意名字），在“电子邮件地址”文本框中输入服务器系统内的账户名和发件域，在“密码”文本框</p>
<p>中输入该账户在服务器内的登录密码。填写完毕之后，单击“下一步”按钮。</p>
</blockquote>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824103048772.png" alt="图16-7 填写电子邮件账户信息"></p>
<blockquote>
<p> <strong>第4步</strong>：进<strong>行电子邮件服务登录验证</strong>。由于当前没有可用的<code>SSL</code>加密服务，因此在<code>Dovecot</code>服务程序的</p>
<p>主配置文件中写入了一条参数，让用户可以使用明文登录到电子邮件服务。<code>Outlook</code>软件默认会通过</p>
<p><code>SSL</code>加密协议尝试登录电子邮件服务，所以在进行图16-8所示的“搜索<a href="mailto:&#x6c;&#x69;&#117;&#99;&#104;&#117;&#x61;&#x6e;&#64;&#108;&#105;&#x6e;&#x75;&#120;&#112;&#x72;&#x6f;&#x62;&#101;&#x2e;&#x63;&#x6f;&#x6d;">&#x6c;&#x69;&#117;&#99;&#104;&#117;&#x61;&#x6e;&#64;&#108;&#105;&#x6e;&#x75;&#120;&#112;&#x72;&#x6f;&#x62;&#101;&#x2e;&#x63;&#x6f;&#x6d;</a>服务器</p>
<p>设置”大约30～60秒后，系统会出现登录失败的报错信息。此时只需再次单击“下一步”按钮，即可让</p>
<p><code>Outloo</code>k软件通过非加密的方式验证登录，如图16-9所示。最后验证成功的界面如图16-10所示，点</p>
<p>击“完成”按钮，一切搞定！</p>
</blockquote>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824103228788.png" alt="图16-8 进行电子邮件服务验证登录"></p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824103241253.png" alt="图16-9 使用非加密的方式进行电子邮件服务验证登录"></p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824103257766.png" alt="图16-10 使用非加密方式配置账户成功"></p>
<blockquote>
<p><strong>第5步</strong>：<strong>向其他信箱发送邮件</strong>。在成功登录<code>Outlook</code>软件后即可尝试编写并发送新邮件了。只需在软件界</p>
<p>面的空白处单击鼠标右键，在弹出的菜单中单击“新建电子邮件”选项（见图16-11），然后在邮件界面中</p>
<p>填写收件人的信箱地址以及完整的邮件内容后单击“发送”按钮，如图16-12所示。</p>
</blockquote>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824103336383.png" alt="图16-11 向其他信箱发送邮件"></p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824103353358.png" alt="图16-12 填写收件人信箱地址并编写完整的邮件内容"></p>
<blockquote>
<p>当使用<code>Outlook</code>软件成功发送邮件后，便可以在电子邮件服务器上查看到新邮件提醒了，在<code>RHEL 8</code>系统</p>
<p>中查看邮件的命令是<code>mailx</code>，需要自行安装（输出信息省略）。要想查看邮件的完整内容，只需输入收</p>
<p>件人姓名前面的编号即可。</p>
</blockquote>
<pre><code class="bash">[root@linuxprobe ~]# dnf install mailx
[root@linuxprobe ~]# mailx
Heirloom Mail version 12.5 7/5/10.  Type ? for help.
&quot;/var/spool/mail/root&quot;: 1 message 1 new
&gt;N  1 liuchuan              Tue Mar 30 01:35  97/3257  &quot;Hello~&quot;
&amp; 1
Message  1:
From liuchuan@linuxprobe.com  Tue Mar 30 01:35:29 2021
Return-Path: &lt;liuchuan@linuxprobe.com&gt;
X-Original-To: root@linuxprobe.com
Delivered-To: root@linuxprobe.com
From: &quot;liuchuan&quot; &lt;liuchuan@linuxprobe.com&gt;
To: &lt;root@linuxprobe.com&gt;
Subject: Hello~
Date: Mon, 29 Mar 2021 19:49:30 +0800
Content-Type: multipart/alternative;
    boundary=&quot;----=_NextPart_000_0001_01D724D4.A28BB310&quot;
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AdckkVaUrscA9j2EQ3evqG++j6aSSA==
Content-Language: zh-cn
Status: R

Content-Type: text/plain;
    charset=&quot;gb2312&quot;

当您收到这封邮件时，证明我的邮局系统实验已经成功！

&amp; quit
Held 1 message in /var/spool/mail/root
[root@linuxprobe ~]#
</code></pre>
<h3 id="16-3、设置用户别名邮箱"><a href="#16-3、设置用户别名邮箱" class="headerlink" title="16.3、设置用户别名邮箱"></a>16.3、设置用户别名邮箱</h3><p>用户别名功能是一项简单实用的邮件账户伪装技术，可以用来设置多个虚拟信箱的账户以接收发送的邮件，从</p>
<p>而保证自身的邮件地址不被泄露；还可以用来接收自己的多个信箱中的邮件。刚才我们已经顺利地向root账户</p>
<p>发送了邮件，下面再向bin账户发送一封邮件，如图16-13所示。</p>
<p>在邮件发送后登录到服务器，然后尝试以bin账户的身份登录。由于<code>bin</code>账户在<code>Linux</code>系统中是系统账户，默</p>
<p>认的<code>Shell</code>终端是&#x2F;sbin&#x2F;nologin，因此在以<code>bin</code>账户登录时，系统会提示当前账户不可用。但是，在电子邮</p>
<p>件服务器上使用<code>mail</code>命令后，却看到这封原本要发送给<code>bin</code>账户的邮件已经被存放到<code>root</code>账户的信箱中。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824103701215.png" alt="图16-13 向服务器上的bin账户发送邮件"></p>
<pre><code class="bash">[root@linuxprobe ~]# su - bin
This account is currently not available.
[root@linuxprobe ~]# mailx
Heirloom Mail version 12.5 7/5/10.  Type ? for help.
&quot;/var/spool/mail/root&quot;: 2 messages 1 new
    1 liuchuan              Tue Mar 30 01:35  98/3268  &quot;Hello~&quot;
&gt;N  2 liuchuan              Tue Mar 30 03:53  97/3251  &quot;你好，用户bin。&quot;
&amp; 2
Message  2:
From liuchuan@linuxprobe.com  Tue Mar 30 03:53:37 2021
Return-Path: &lt;liuchuan@linuxprobe.com&gt;
X-Original-To: bin@linuxprobe.com
Delivered-To: bin@linuxprobe.com
From: &quot;liuchuan&quot; &lt;liuchuan@linuxprobe.com&gt;
To: &lt;bin@linuxprobe.com&gt;
Subject: 你好，用户bin。
Date: Mon, 29 Mar 2021 22:07:39 +0800
Content-Type: multipart/alternative;
    boundary=&quot;----=_NextPart_000_000E_01D724E7.EEF35A10&quot;
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AdckpJ6n2QIfRYAZTB20gA9VTep2dg==
Content-Language: zh-cn
Status: R

Content-Type: text/plain;
    charset=&quot;gb2312&quot;

这是一封发给用户bin的邮件。

&amp; quit
Held 2 messages in /var/spool/mail/root
[root@linuxprobe ~]#
</code></pre>
<p>其实，这就是使用用户别名技术来实现的。在<code>aliases</code>邮件别名服务的配置文件中可以看到，里面定义了大</p>
<p>量的用户别名，这些用户别名大多数是<code>Linux</code>系统本地的系统账户，而在冒号（:）间隔符后面的<code>root</code>账户则</p>
<p>是用来接收这些账户邮件的人。用户别名可以是<code>Linux</code>系统内的本地用户，也可以是完全虚构的用户名字。</p>
<pre><code class="bash">[root@linuxprobe ~]# cat /etc/aliases
#
#  Aliases in this file will NOT be expanded in the header from
#  Mail, but WILL be visible over networks or from /bin/mail.
#
#	&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;	The program &quot;newaliases&quot; must be run after
#	&gt;&gt; NOTE &gt;&gt;	this file is updated for any changes to
#	&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;	show through to sendmail.
#

# Basic system aliases -- these MUST be present.
mailer-daemon:	postmaster
postmaster:	root

# General redirections for pseudo accounts.
bin:		root
daemon:		root
adm:		root
lp:		root
sync:		root
shutdown:	root
halt:		root
mail:		root
news:		root
uucp:		root
operator:	root
………………省略部分输出信息………………
</code></pre>
<p>现在大家能猜出是怎么一回事了吧。原来aliases邮件别名服务的配置文件专门用来定义用户别名与邮件接收</p>
<p>人的映射。除了使用本地系统中系统账户的名称外，我们还可以自行定义一些别名来接收邮件。例如，创建一</p>
<p>个名为<code>dream</code>的账户，而真正接收该账户邮件的应该是<code>root</code>账户。</p>
<pre><code class="bash">[root@linuxprobe ~]# cat /etc/aliases
#
#  Aliases in this file will NOT be expanded in the header from
#  Mail, but WILL be visible over networks or from /bin/mail.
#
#       &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;      The program &quot;newaliases&quot; must be run after
#       &gt;&gt; NOTE &gt;&gt;      this file is updated for any changes to
#       &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;      show through to sendmail.
#

# Basic system aliases -- these MUST be present.
mailer-daemon:  postmaster
postmaster:     root

# General redirections for pseudo accounts.
dream:          root
bin:            root
daemon:         root
adm:            root
lp:             root
sync:           root
shutdown:       root
halt:           root
mail:           root
news:           root
uucp:           root
operator:       root
………………省略部分输出信息………………
</code></pre>
<p>保存并退出aliases邮件别名服务的配置文件后，需要再执行一下<code>newaliases</code>命令，其目的是让新的用户别名</p>
<p>配置文件立即生效。然后再次尝试发送邮件，如图16-14所示。</p>
<pre><code class="bash">[root@linuxprobe ~]# newaliases
</code></pre>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824103942211.png" alt="图16-14 向服务器上的dream用户发送邮件"></p>
<p>这时，使用<code>root</code>账户在服务器上执行<code>mail</code>命令后，就能看到这封原本要发送给<code>dream</code>账户的邮件了。最</p>
<p>后，再啰唆一句，用户别名技术不仅应用广泛，而且配置也很简单。所以这里要提醒大家的是，今后千万不</p>
<p>要看到有些网站上提供了很多客服信箱就轻易相信别人，没准发往这些客服信箱的邮件会被同一个人收到。</p>
<pre><code class="bash">[root@linuxprobe ~]# mailx
Heirloom Mail version 12.5 7/5/10.  Type ? for help.
&quot;/var/spool/mail/root&quot;: 3 messages 1 new
    1 liuchuan              Tue Mar 30 01:35  98/3268  &quot;Hello~&quot;
    2 liuchuan              Tue Mar 30 03:53  98/3262  &quot;你好，用户bin。&quot;
&gt;N  3 liuchuan              Tue Mar 30 04:12  98/3317  &quot;这是一封发送给dream用户的邮件&quot;
&amp; 3
Message  3:
From liuchuan@linuxprobe.com  Tue Mar 30 04:12:19 2021
Return-Path: &lt;liuchuan@linuxprobe.com&gt;
X-Original-To: dream@linuxprobe.com
Delivered-To: dream@linuxprobe.com
From: &quot;liuchuan&quot; &lt;liuchuan@linuxprobe.com&gt;
To: &lt;dream@linuxprobe.com&gt;
Subject: 这是一封发送给dream用户的邮件
Date: Mon, 29 Mar 2021 22:26:21 +0800
Content-Type: multipart/alternative;
    boundary=&quot;----=_NextPart_000_0009_01D724EA.8B9A4750&quot;
X-Mailer: Microsoft Outlook 14.0
Thread-Index: Adckpw3r2QT7QwGITceHTJdfioQeQQ==
Content-Language: zh-cn
Status: R

Content-Type: text/plain;
    charset=&quot;gb2312&quot;

顺利的话会被root用户接收到。

&amp; quit
Held 3 messages in /var/spool/mail/root
</code></pre>
<h3 id="16-4、邮件客户端"><a href="#16-4、邮件客户端" class="headerlink" title="16.4、邮件客户端"></a>16.4、邮件客户端</h3><p>在<code>Linux</code>系统下可选的邮件客户端有数十种，例如<code>Thunderbird</code>、<code>Evolution</code>、<code>Gear</code>、<code>Elementary </code></p>
<p><code>Mail</code>、<code>KMail</code>、<code>Mailspring</code>、<code>Sylpheed</code>、<code>Claws Mail</code>等。<code>Thunderbird</code>是由<code>Mozilla</code>基金会</p>
<p>（<code>Firefox</code>浏览器的生产厂商）发布的一款电子邮件客户端，操作简单，支持跨平台，拥有各种插件和丰</p>
<p>富的功能，而且兼具<code>Firefox</code>浏览器的各种优势，用户可以轻松上手。</p>
<blockquote>
<p>安装<code>Thunderbird</code></p>
</blockquote>
<pre><code class="bahs">[root@linuxprobe ~]# yum install -y thunderbird
</code></pre>
<p>这款图形化的客户端程序有两种打开方式。一种是通过在终端中输入<code>thunderbird</code>命令后按回车键；</p>
<p>另外一种方式是在<code>RHEL8</code>桌面左上角的<code>Activities</code>程序菜单中单击<code>Thunderbird</code>客户端的图标将其</p>
<p>打开，如图16-15所示。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824104357254.png" alt="图16-15 在程序菜单中点击邮件客户端图标"></p>
<p>在初次进入<code>Thunderbird</code>客户端界面时，会要求用户填写邮件账户的名称、地址和密码，如图16-16所示。账</p>
<p>户不一定要与系统中的账户名称相同，可以理解成是邮件发送人的昵称，密码则是系统中账户的密码，然后单</p>
<p>击<code>Continue</code>按钮。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824104449398.png" alt="图16-16 配置客户端的账号、地址和密码"></p>
<p>接下来单击<code>Manual config</code>按钮，进一步配置连接信息，如图16-17所示。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824104528970.png" alt="图16-17 进入到手动配置模式"></p>
<p>由于当前没有设置<code>SSL</code>邮局加密，因此在如图16-18所示的手动配置模式中，需要将<code>SSL</code>选项更改为<code>None</code>，</p>
<p>并将<code>Authentication</code>设置为<code>Normal password</code>。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824104604439.png" alt="图16-18 手动配置连接信息"></p>
<p>出于安全方面的考虑，<code>Thunderbird</code>客户端会提示警告信息。选中<code>understand the risks</code>复选框，然后单</p>
<p>击<code>Done</code>按钮即可，如图16-19所示。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824104639074.png" alt="图16-19 安全警告信息"></p>
<p>接下来便顺利来到了<code>Thunderbird</code>客户端的使用界面，如图16-20所示。</p>
<p><img src="/../image/linux%EF%BC%88%E4%BA%8C%EF%BC%89/image-20220824104704393.png" alt="图16-20 Thunderbird邮件客户端使用界面"></p>

            </div>
            <hr/>
    
            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力!</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.bmp" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.bmp" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
    
            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>
    
            
            
            
            <div class="reprint1">
                <p>
                    <span class="reprint1-tip">
                        <i class="fa fa-exclamation-circle"></i>&nbsp;&nbsp;转载请注明:
                    </span>
                    <a href="https://hcs-21.github.io" class="b-link-green">郝春帅的博客</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="/2022/08/22/linux%EF%BC%88%E4%BA%8C%EF%BC%89/" class="b-link-green">linux的使用教程（二）</a>
                </p>
            </div>
    
        </div>
    </div>
    
    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: 'Iv1.fc0d9004c04bd10f',
        clientSecret: 'ae1026f1a6a57e97dbd91e20bb433d5f87c2f220',
        repo: 'hcs-21.github.io',
        owner: 'hcs-21',
        admin: ["hcs-21"],
        id: '2022/08/22/linux（二）/',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    
    
    
    
    
    
    
    
    
    
    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/08/24/linux%EF%BC%88%E4%B8%89%EF%BC%89/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/13.jpg" class="responsive-img" alt="linux的使用教程（三）">
                        
                        <span class="card-title">linux的使用教程（三）</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            linux的使用教程
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2022-08-24
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E7%B3%BB%E7%BB%9F/" class="post-category" target="_blank">
                                    系统
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/linux/" target="_blank">
                        <span class="chip bg-color">linux</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/08/12/person-teacher/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/17.jpg" class="responsive-img" alt="person_teacher的使用教程">
                        
                        <span class="card-title">person_teacher的使用教程</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            person_teacher的使用教程
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2022-08-12
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/" class="post-category" target="_blank">
                                    工具使用教程
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E9%9D%A2%E8%AF%95test/" target="_blank">
                        <span class="chip bg-color">面试test</span>
                    </a>
                    
                    <a href="/tags/%E7%AC%94%E8%AE%B0/" target="_blank">
                        <span class="chip bg-color">笔记</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }
    
        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());
    
        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }
    
        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 郝春帅的博客<br />'
            + '作者: 郝帅<br />'
            + '链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';
    
        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


        <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            Copyright&copy;  郝帅. 


            <br>
            <span id="sitetime"></span><span class="my-face">ღゝ◡╹)ノ♡</span>
            <br>
    
            
    
            
                    
                        <span id="busuanzi_container_site_pv" style='display:none'></span>
                        总访问量: <span id="busuanzi_value_site_pv" class="white-color"></span>
                    
        
                    
                        <span id="busuanzi_container_site_uv" style='display:none'></span>
                        人次&nbsp; | &nbsp;访客人数: <span id="busuanzi_value_site_uv" class="white-color"></span> 人
                    
    
            
			


            
            <br>
    
        </div>
    
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/hcs-21.github.io" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>


 
    <a href="https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=haocs21@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>






    <a href="http://wpa.qq.com/msgrd?v=3&uin=993999150&site=qq&menu=yes" class="tooltipped" target="_blank" data-tooltip="访问我的QQ空间" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>





    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>
    
    </div>
</footer>

<div class="progress-bar"></div>
<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();

        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
    
        var t1 = Date.UTC(2022, 06, 24, 00, 00, 00); //北京时间2019-8-1 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes *
            minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已勉强运行 " + diffYears + " 年 " + diffDays + " 天 " + diffHours +
            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒" ;
    } /*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>






        <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
        <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


        <script src="https://cdn.bootcss.com/materialize/1.0.0/js/materialize.min.js"></script>
        <script src="https://cdn.bootcss.com/masonry/4.2.2/masonry.pkgd.min.js"></script>
        <script src="https://cdn.bootcss.com/aos/3.0.0-beta.6/aos.js"></script>
        <script src="https://cdn.bootcss.com/scrollprogress/3.0.2/scrollProgress.min.js"></script>
        <script src="https://cdn.bootcss.com/lightgallery/1.6.12/js/lightgallery-all.min.js"></script>
        <script src="/js/matery.js"></script>

        <!-- Global site tag (gtag.js) - Google Analytics -->



        
            <script src="/libs/others/clicklove.js"></script>
        

        
            <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        

        <!-- 洪卫 shw2018 add 2019.08.28 -->
        <script type="text/javascript">
            var OriginTitile = document.title,
                st;
            document.addEventListener("visibilitychange", function () {
                document.hidden ? (document.title = "看不见我🙈~看不见我🙈~", clearTimeout(st)) : (document.title =
                    "(๑•̀ㅂ•́) ✧被发现了～", st = setTimeout(function () {
                        document.title = OriginTitile
                    }, 3e3))
            })
        </script>

        <!-- 鼠标点击烟花爆炸效果  洪卫 shw2018 add 2019.09.09 -->
        

        <!-- 背景雪花飘落特效洪卫 shw2018 add 2019.09.10 -->
        
            <script type="text/javascript">
            //只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>');
            }
            </script>
        

        <!-- 鼠标点击文字特效 洪卫 shw2018 add 2019.09.10-->
        
            <script src="/js/wenzi.js" type="text/javascript"></script>
        

        <!-- 背景雪花飘落特效 洪卫 shw2018 add 2019.09.10 -->
        
            <script type="text/javascript">
                var windowWidth = $(window).width();
                if (windowWidth > 768) {
                    document.write('<script type="text/javascript" src="/js/xuehuapiaoluo.js"><\/script>');
                }
            </script>
        

        <!-- 在线聊天工具  洪卫 shw2018 add 2019.09.11 -->
        
            <script src="//code.tidio.co/xxxxxxxxxxxxxxxxxxxxxxxxxxx.js"></script>
            <!--  在线聊天位置自定义  洪卫 shw2018 add 2019.09.13  -->
            <script> 
                $(document).ready(function () {

                    setInterval(change_Tidio, 50);  
                    function change_Tidio() { 

                        var tidio=$("#tidio-chat iframe");
                        if(tidio.css("display")=="block"&& $(window).width()>977 ){
                            document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"80px":"20px";   
                            document.getElementById("tidio-chat-iframe").style.right="-15px";   
                            document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                            document.getElementById("tidio-chat-iframe").style.zIndex="997";
                        } 
                        else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                            document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;   
                            document.getElementById("tidio-chat-iframe").style.right="-15px"; 
                            document.getElementById("tidio-chat-iframe").style.zIndex="997";
                        }
                        else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                            document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;   
                            document.getElementById("tidio-chat-iframe").style.zIndex="997";
                        }

                        if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                            document.getElementById("tidio-chat-iframe").style.zIndex="998";
                        }
                    } 
                }); 
            </script>
        

        <!-- 背景 canvas-nest  洪卫 shw 2018  add 2019.09.15-->
        
            <script type="text/javascript">
            var windowWidth = $(window).width();
            if (windowWidth > 992) {
                document.write('<script type="text/javascript" color="0,0,255" pointColor="0,0,255" opacity= "0.8" zIndex="--1" count="150"src="/libs/background/canvas-nest.js"><\/script>');
            }
            </script>
        

        <!-- 背景静止彩带  洪卫 shw 2018  add 2019.09.15-->
        

        <!-- 背景动态彩带 洪卫 shw 2018  add 2019.09.15-->
        
            <script type="text/javascript">
            var windowWidth = $(window).width();
            if (windowWidth > 992) {
                document.write('<script type="text/javascript" src="/libs/background/ribbon-dynamic.js"><\/script>');
            }
            </script>
        

    </body>
</html>
<!DOCTYPE HTML>
<html lang="zh-CN">
    <!-- hcs-21 郝帅  modify 2022.06.24-->



<head>
    <meta charset="utf-8">
    <meta name="keywords" content="linux的使用教程（一）, BigData">
    <meta name="baidu-site-verification" content="fmlEuI34ir" />
    <meta name="google-site-verification" content="KeoTn_OFy4ndJwXNmm2gMeQfPhd7alqE9vQDwI32KCY" />
    <meta name="description" content="
阅读须知本篇文章进仅供参考
阿里云主机密码   
阿里云 售后服务人员  孙仕鑫   95187


​	47.99.59.135 / Root123!@#
 ​	47.99.44.244 / Root123!@#

一、基础命令

修改">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>linux的使用教程（一） | 郝春帅的博客</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/aos/3.0.0-beta.6/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/lightgallery/1.6.12/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <style type="text/css">
        
    </style>
    
    <script src="https://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?46e79e71af0709a5b9106bf20cecc493";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    
    
    
        <script>
            (function(){
                var bp = document.createElement('script');
                var curProtocol = window.location.protocol.split(':')[0];
                if (curProtocol === 'https') {
                    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
                }
                else {
                    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                }
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(bp, s);
            })();
        </script>
    

<meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="郝春帅的博客" type="application/atom+xml">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

    <body>

        <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">郝春帅的博客</span>
                </a>
            </div>
            


<!-- <a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/AV" class="waves-effect waves-light">
            
            <i class="fa fa-music"></i>
            
            <span>视听</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/galleries" class="waves-effect waves-light">
            
            <i class="fa fa-photo"></i>
            
            <span>相册</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于我</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul> -->

<!-- 支持二级菜单特性 洪卫 shw2018 modify 2019.09.17  -->
<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right nav-menu">
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/" class="waves-effect waves-light">
              
                <i class="fa fa-home"></i>
              
              <span>首页</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/tags" class="waves-effect waves-light">
              
                <i class="fa fa-tags"></i>
              
              <span>标签</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/categories" class="waves-effect waves-light">
              
                <i class="fa fa-bookmark"></i>
              
              <span>分类</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/archives" class="waves-effect waves-light">
              
                <i class="fa fa-archive"></i>
              
              <span>归档</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/AV" class="waves-effect waves-light">
              
                <i class="fa fa-music"></i>
              
              <span>视听</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/galleries" class="waves-effect waves-light">
              
                <i class="fa fa-photo"></i>
              
              <span>相册</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/about" class="waves-effect waves-light">
              
                <i class="fa fa-user-circle-o"></i>
              
              <span>关于我</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/friends" class="waves-effect waves-light">
              
                <i class="fa fa-address-book"></i>
              
              <span>友情链接</span>
            </a>

            
      </li>
    

    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>

</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">郝春帅的博客</div>
        <div class="logo-desc">
            
            什么也不会的小白
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/AV" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-music"></i>
                
                视听
            </a>
        </li>
        
        <li>
            <a href="/galleries" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-photo"></i>
                
                相册
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于我
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/hcs-21/hcs-21.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>

   
   
<!-- 支持二级菜单特性 洪卫 shw2018 modify 2019.09.17  -->
<!-- <ul class="menu-list mobile-menu-list">
    
        <li class="m-nav-item">
                
                    <a href="/" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-home"></i>
                        
                        首页
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/tags" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-tags"></i>
                        
                        标签
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/categories" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-bookmark"></i>
                        
                        分类
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/archives" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-archive"></i>
                        
                        归档
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/AV" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-music"></i>
                        
                        视听
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/galleries" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-photo"></i>
                        
                        相册
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/about" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-user-circle-o"></i>
                        
                        关于我
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/friends" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-address-book"></i>
                        
                        友情链接
                    </a>
              
            </li>
        

        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/hcs-21/hcs-21.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul> -->

</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/hcs-21/hcs-21.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

        
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/22.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        linux的使用教程（一）
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- shw2018 洪卫  modify 2019.08.15-->
<!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/linux/" target="_blank">
                                <span class="chip bg-color">linux</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E7%B3%BB%E7%BB%9F/" class="post-category" target="_blank">
                                系统
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-07-28
                </div>
    
                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>作者:&nbsp;&nbsp;
                    
                        郝帅
                    
                </div>
    
                
                
                        <span id="busuanzi_container_site_pv" style='display:none'></span>
                        <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv" ></span>
    
                
    
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <blockquote>
<h2 id="阅读须知"><a href="#阅读须知" class="headerlink" title="阅读须知"></a>阅读须知</h2><p>本篇文章进仅供参考</p>
<p>阿里云主机密码   </p>
<p>阿里云 售后服务人员  孙仕鑫   95187</p>
</blockquote>
<blockquote>
<p>​	<code>47.99.59.135</code> / <code>Root123!@#</code></p>
<p> ​	<code>47.99.44.244</code> / <code>Root123!@#</code></p>
</blockquote>
<h2 id="一、基础命令"><a href="#一、基础命令" class="headerlink" title="一、基础命令"></a>一、基础命令</h2><hr>
<blockquote>
<p>修改主机名字，无需重启，重启也不影响</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">vi</span> /etc/hosts

<span class="token comment" spellcheck="true">#添加映射</span>
IP NAME
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-BASH'"><code class="language-BASH'">vi /etc/hostname

修改名字
name
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>hostname name
</code></pre>
<blockquote>
<p><code>yum</code> 软件 命令</p>
</blockquote>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>yum repolist all</code></td>
<td>列出所有仓库</td>
</tr>
<tr>
<td><code>yum list all</code></td>
<td>列出仓库中所有软件包</td>
</tr>
<tr>
<td><code>yum info 软件包名称</code></td>
<td>查看软件包信息</td>
</tr>
<tr>
<td><code>yum install 软件包名称</code></td>
<td>安装软件包</td>
</tr>
<tr>
<td><code>yum reinstall 软件包名称</code></td>
<td>重新安装软件包</td>
</tr>
<tr>
<td><code>yum update 软件包名称</code></td>
<td>升级软件包</td>
</tr>
<tr>
<td><code>yum remove 软件包名称</code></td>
<td>移除软件包</td>
</tr>
<tr>
<td><code>yum clean all</code></td>
<td>清除所有仓库缓存</td>
</tr>
<tr>
<td><code>yum check-update</code></td>
<td>检查可更新的软件包</td>
</tr>
<tr>
<td><code>yum grouplist</code></td>
<td>查看系统中已经安装的软件包组</td>
</tr>
<tr>
<td><code>yum groupinstall 软件包组</code></td>
<td>安装指定的软件包组</td>
</tr>
<tr>
<td><code>yum groupremove 软件包组</code></td>
<td>移除指定的软件包组</td>
</tr>
<tr>
<td><code>yum groupinfo 软件包组</code></td>
<td>查询指定的软件包组信息</td>
</tr>
</tbody></table>
<blockquote>
<p>日期命令</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>%S</code></td>
<td>秒（00～59）</td>
</tr>
<tr>
<td><code>%M</code></td>
<td>分钟（00～59）</td>
</tr>
<tr>
<td><code>%H</code></td>
<td>小时（00～23）</td>
</tr>
<tr>
<td><code>%I</code></td>
<td>小时（00～12）</td>
</tr>
<tr>
<td><code>%m</code></td>
<td>月份（1~12）</td>
</tr>
<tr>
<td><code>%p</code></td>
<td>显示出AM或PM</td>
</tr>
<tr>
<td><code>%a</code></td>
<td>缩写的工作日名称（例如：Sun）</td>
</tr>
<tr>
<td><code>%A</code></td>
<td>完整的工作日名称（例如：Sunday）</td>
</tr>
<tr>
<td><code>%b</code></td>
<td>缩写的月份名称（例如：Jan）</td>
</tr>
<tr>
<td><code>%B</code></td>
<td>完整的月份名称（例如：January）</td>
</tr>
<tr>
<td><code>%q</code></td>
<td>季度（1~4）</td>
</tr>
<tr>
<td><code>%y</code></td>
<td>简写年份（例如：20）</td>
</tr>
<tr>
<td><code>%Y</code></td>
<td>完整年份（例如：2020）</td>
</tr>
<tr>
<td><code>%d</code></td>
<td>本月中的第几天</td>
</tr>
<tr>
<td><code>%j</code></td>
<td>今年中的第几天</td>
</tr>
<tr>
<td><code>%n</code></td>
<td>换行符（相当于按下回车键）</td>
</tr>
<tr>
<td><code>%t</code></td>
<td>跳格（相当于按下Tab键）</td>
</tr>
</tbody></table>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#查看时间</span>
<span class="token function">date</span>

<span class="token comment" spellcheck="true">##按照`年-月-日 小时:分钟:秒`查看时间</span>
<span class="token function">date</span> <span class="token string">"+%Y-%m-%d %H:%M:%S"</span>

<span class="token comment" spellcheck="true">#将系统的当前时间设置为2020年11月1日8点30分</span>
<span class="token function">date</span> -s <span class="token string">"20201101 8:30:00"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>时区设置</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>status</code></td>
<td>显示状态信息</td>
</tr>
<tr>
<td><code>list-timezones</code></td>
<td>列出已知时区</td>
</tr>
<tr>
<td><code>set-time</code></td>
<td>设置系统时间</td>
</tr>
<tr>
<td><code>set-timezone</code></td>
<td>设置时区</td>
</tr>
</tbody></table>
<blockquote>
<p><code>top</code> 命令</p>
<ul>
<li><p>第1行：系统时间、运行时间、登录终端数、系统负载（3个数值分别为1分钟、5分钟、15分钟内的平均值，数值越小意味着负载越低）。</p>
</li>
<li><p>第2行：进程总数、运行中的进程数、睡眠中的进程数、停止的进程数、僵死的进程数。</p>
</li>
<li><p>第3行：用户占用资源百分比、系统内核占用资源百分比、改变过优先级的进程资源百分比、空闲的</p>
<p>资源百分比等。其中数据均为CPU数据并以百分比格式显示，例如“99.9 id”意味着有99.9%的CPU处</p>
<p>理器资源处于空闲。</p>
</li>
<li><p>第4行：物理内存总量、内存空闲量、内存使用量、作为内核缓存的内存量。</p>
</li>
<li><p>第5行：虚拟内存总量、虚拟内存空闲量、虚拟内存使用量、已被提前加载的内存量。</p>
</li>
</ul>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220815145714200.png"></p>
<blockquote>
<p>查看系统内核版本与系统架构等信息</p>
<p><strong>内核名称</strong>、<strong>主机名</strong>、<strong>内核发行版本</strong>、节点名、压制时间、硬件名称、硬件平台、处理器类型以及操作系统名称等信息</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">uname</span> -a

Linux hcs32 3.10.0-957.21.3.el7.x86_64 <span class="token comment" spellcheck="true">#1 SMP Tue Jun 18 16:35:19 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>查看系统的负载信息</p>
<p>显示<strong>当前系统时间</strong>、<strong>系统已运行时间</strong>、<strong>启用终端数量</strong>以及<strong>平均负载值等信息</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">uptime</span>

15:03:40 up  5:13,  2 users,  load average: 0.05, 0.04, 0.05
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>显示当前系统中内存的使用量信息<code>free</code></p>
</blockquote>
<table>
<thead>
<tr>
<th></th>
<th>内存总量</th>
<th>已用量</th>
<th>空闲量</th>
<th>进程共享的内存量</th>
<th>磁盘缓存的内存量</th>
<th>缓存的内存量</th>
<th>可用量</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>total</td>
<td>used</td>
<td>free</td>
<td>shared</td>
<td>buffers</td>
<td>buff/cache</td>
<td>available</td>
</tr>
<tr>
<td><code>Mem</code>:</td>
<td><code>1.9Gi</code></td>
<td><code>1.4Gi</code></td>
<td><code>99Mi</code></td>
<td><code>20Mi</code></td>
<td><code>450Mi</code></td>
<td><code>348Mi</code></td>
<td></td>
</tr>
<tr>
<td><code>Swap</code>:</td>
<td><code>2.0Gi</code></td>
<td><code>80Mi</code></td>
<td><code>1.9Gi</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p>查看当前登入主机的用户终端信息</p>
</blockquote>
<pre class="line-numbers language-bsh"><code class="language-bsh">[hdp@hcs32 ~]$ who
root     pts/0        2022-08-15 09:52 (175.167.148.235)
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>用于按照指定条件来查找文件所对应的位置<code>find</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-name</code></td>
<td>匹配名称</td>
</tr>
<tr>
<td><code>-perm</code></td>
<td>匹配权限（mode为完全匹配，-mode为包含即可）</td>
</tr>
<tr>
<td><code>-user</code></td>
<td>匹配所有者</td>
</tr>
<tr>
<td><code>-group</code></td>
<td>匹配所有组</td>
</tr>
<tr>
<td><code>-mtime -n +n</code></td>
<td>匹配修改内容的时间（-n指n天以内，+n指n天以前）</td>
</tr>
<tr>
<td><code>-atime -n +n</code></td>
<td>匹配访问文件的时间（-n指n天以内，+n指n天以前）</td>
</tr>
<tr>
<td><code>-ctime -n +n</code></td>
<td>匹配修改文件权限的时间（-n指n天以内，+n指n天以前）</td>
</tr>
<tr>
<td><code>-nouser</code></td>
<td>匹配无所有者的文件</td>
</tr>
<tr>
<td><code>-nogroup</code></td>
<td>匹配无所有组的文件</td>
</tr>
<tr>
<td><code>-newer f1 !f2</code></td>
<td>匹配比文件<code>f1</code>新但比<code>f2</code>旧的文件</td>
</tr>
<tr>
<td><code>-type b/d/c/p/l/f</code></td>
<td>匹配文件类型（后面的字幕字母依次表示块设备、目录、字符设备、管道、链接文件、文本文件）</td>
</tr>
<tr>
<td><code>-size</code></td>
<td>匹配文件的大小（+<code>50KB</code>为查找超过50KB的文件，而-<code>50KB</code>为查找小于50KB的文件）</td>
</tr>
<tr>
<td><code>-prune</code></td>
<td>忽略某个目录</td>
</tr>
<tr>
<td><code>-exec …… {}\;</code></td>
<td>后面可跟用于进一步处理搜索结果的命令（下文会有演示）</td>
</tr>
</tbody></table>
<blockquote>
<p><code>which</code>命令用于按照指定名称快速搜索二进制程序（命令）所对应的位置</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># which locate</span>
/usr/bin/locate
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p><code>stat</code>命令用于查看文件的具体存储细节和时间等信息</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>hdp@hcs32 etc<span class="token punctuation">]</span>$ <span class="token function">stat</span> <span class="token function">passwd</span>
  File: ‘passwd’
  Size: 993       	Blocks: 8          IO Block: 4096   regular <span class="token function">file</span>
Device: fd01h/64769d	Inode: 397804      Links: 1
Access: <span class="token punctuation">(</span>0644/-rw-r--r--<span class="token punctuation">)</span>  Uid: <span class="token punctuation">(</span>    0/    root<span class="token punctuation">)</span>   Gid: <span class="token punctuation">(</span>    0/    root<span class="token punctuation">)</span>
Access: 2022-08-15 10:24:44.680044460 +0800
Modify: 2022-08-15 10:24:44.621043752 +0800
Change: 2022-08-15 10:24:44.625043800 +0800
 Birth: -
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>grep</code>命令用于按行提取文本内容，语法格式为“<code>grep</code> [参数] 文件名称”。</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-b</code></td>
<td>将可执行文件(binary)当作文本文件（text）来搜索</td>
</tr>
<tr>
<td><code>-c</code></td>
<td>仅显示找到的行数</td>
</tr>
<tr>
<td><code>-i</code></td>
<td>忽略大小写</td>
</tr>
<tr>
<td><code>-n</code></td>
<td>显示行号</td>
</tr>
<tr>
<td><code>-v</code></td>
<td>反向选择——仅列出没有“关键词”的行</td>
</tr>
</tbody></table>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>hdp@hcs32 etc<span class="token punctuation">]</span>$ <span class="token function">grep</span> /sbin/nologin /etc/passwd
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
operator:x:11:0:operator:/root:/sbin/nologin
games:x:12:100:games:/usr/games:/sbin/nologin
ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
nobody:x:99:99:Nobody:/:/sbin/nologin
systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin
dbus:x:81:81:System message bus:/:/sbin/nologin
polkitd:x:999:998:User <span class="token keyword">for</span> polkitd:/:/sbin/nologin
sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
postfix:x:89:89::/var/spool/postfix:/sbin/nologin
chrony:x:998:996::/var/lib/chrony:/sbin/nologin
ntp:x:38:38::/etc/ntp:/sbin/nologin
tcpdump:x:72:72::/:/sbin/nologin
nscd:x:28:28:NSCD Daemon:/:/sbin/nologin
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>cut</code>命令用于按“列”提取文本内容</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>hdp@hcs32 etc<span class="token punctuation">]</span>$ <span class="token function">head</span> -n 2 /etc/passwd 
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
<span class="token punctuation">[</span>hdp@hcs32 etc<span class="token punctuation">]</span>$ <span class="token function">cut</span> -d <span class="token keyword">:</span> -f 1 /etc/passwd
root
bin
daemon
adm
lp
<span class="token function">sync</span>
<span class="token function">shutdown</span>
halt
mail
operator
games
<span class="token function">ftp</span>
nobody
systemd-network
dbus
polkitd
sshd
postfix
chrony
ntp
tcpdump
nscd
hdp
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>sort</code>命令用于对文本内容进行再排序，语法格式为“<code>sort</code> [参数] 文件名称”</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-f</code></td>
<td>忽略大小写</td>
</tr>
<tr>
<td><code>-b</code></td>
<td>忽略缩进与空格</td>
</tr>
<tr>
<td><code>-n</code></td>
<td>以数值型排序</td>
</tr>
<tr>
<td><code>-r</code></td>
<td>反向排序</td>
</tr>
<tr>
<td><code>-u</code></td>
<td>去除重复行</td>
</tr>
<tr>
<td><code>-t</code></td>
<td>指定间隔符</td>
</tr>
<tr>
<td><code>-k</code></td>
<td>设置字段范围</td>
</tr>
</tbody></table>
<blockquote>
<p><code>touch</code>命令用于创建空白文件或设置文件的时间，语法格式为“<code>touch</code> [参数] 文件名称”。</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-a</code></td>
<td>仅修改“读取时间”（<code>atime</code>）</td>
</tr>
<tr>
<td><code>-m</code></td>
<td>仅修改“修改时间”（<code>mtime</code>）</td>
</tr>
<tr>
<td><code>-d</code></td>
<td>同时修改atime与mtime</td>
</tr>
</tbody></table>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># touch -d "2020-05-04 15:44" anaconda-ks.cfg </span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -l anaconda-ks.cfg </span>
-rw-------. 1 root root 1260 May  4 15:44 anaconda-ks.cfg
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>mkdir</code>命令用于创建空白的目录，英文全称为“make directory”，语法格式为“<code>mkdir</code>[参数] 目录名称”。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir linuxprobe</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd linuxprobe</span>
<span class="token punctuation">[</span>root@linuxprobe linuxprobe<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir -p a/b/c/d/e</span>
<span class="token punctuation">[</span>root@linuxprobe linuxprobe<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd a</span>
<span class="token punctuation">[</span>root@linuxprobe a<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd b</span>
<span class="token punctuation">[</span>root@linuxprobe b<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>cp</code>命令用于复制文件或目录，英文全称为“copy”，语法格式为“<code>cp</code> [参数] 源文件名称 目标文件名称”。</p>
<ul>
<li>如果目标文件是目录，则会把源文件复制到该目录中；</li>
<li>如果目标文件也是普通文件，则会询问是否要覆盖它；</li>
<li>如果目标文件不存在，则执行正常的复制操作。</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-p</code></td>
<td>保留原始文件的属性</td>
</tr>
<tr>
<td><code>-d</code></td>
<td>若对象为“链接文件”，则保留该“链接文件”的属性</td>
</tr>
<tr>
<td><code>-r</code></td>
<td>递归持续复制（用于目录</td>
</tr>
<tr>
<td><code>-i</code></td>
<td>若目标文件存在则询问是否覆盖</td>
</tr>
<tr>
<td><code>-a</code></td>
<td>相当于-<code>pdr</code>（p、d、r为上述参数）</td>
</tr>
</tbody></table>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># touch install.log</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cp install.log x.log</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
install.log x.log
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>mv</code>命令用于剪切或重命名文件，英文全称为“move”，语法格式为“<code>mv </code>[参数] 源文件名称 目标文件名称”。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mv x.log linux.log</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
install.log linux.log
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>rm</code>命令用于删除文件或目录，英文全称为“remove”，语法格式为“<code>rm</code> [参数] 文件  名称”。</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-f</code></td>
<td>强制执行</td>
</tr>
<tr>
<td><code>-i</code></td>
<td>删除前询问</td>
</tr>
<tr>
<td><code>-r</code></td>
<td>删除目录</td>
</tr>
<tr>
<td><code>-v</code></td>
<td>显示过程</td>
</tr>
</tbody></table>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rm install.log</span>
rm: remove regular empty <span class="token function">file</span> ‘install.log’? y
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rm -f linux.log</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong><code>dd</code>命令用于按照指定大小和个数的数据块来复制文件或转换文件，语法格式为“<code>dd if=参数值of=参数值</code></strong></p>
<p><strong><code>count=参数值bs=参数值</code>”。</strong></p>
<p><code>dd</code>命令是一个比较重要而且比较有特色的命令，它能够让用户按照指定大小和个数的数据块来复制文</p>
<p>件的内容。当然，如果愿意的话，还可以在复制过程中转换其中的数据。Linux系统中有一个名</p>
<p>为<code>/dev/zero</code>的设备文件，每次在课堂上解释它时都充满哲学理论的色彩。因为这个文件不会占用系统</p>
<p>存储空间，但却可以提供无穷无尽的数据，因此常常使用它作为dd命令的输入文件，来生成一个指定大</p>
<p>小的文件。</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>if</code></td>
<td>输入的文件名称</td>
</tr>
<tr>
<td><code>of</code></td>
<td>输出的文件名称</td>
</tr>
<tr>
<td><code>bs</code></td>
<td>设置每个“块”的大小</td>
</tr>
<tr>
<td><code>count</code></td>
<td>设置要复制“块”的个数</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>例如</strong>，用<code>dd</code>命令从<code>/dev/zero</code>设备文件中取出一个大小为<code>560MB</code>的数据块，然后保存成名为<code>560_file</code>的文件。在理解了这个命令后，以后就能随意创建任意大小的文件了：</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dd if=/dev/zero of=560_file count=1 bs=560M</span>
1+0 records <span class="token keyword">in</span>
1+0 records out
587202560 bytes <span class="token punctuation">(</span>587 MB, 560 MiB<span class="token punctuation">)</span> copied, 1.28667 s, 456 MB/s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>dd</code>命令的功能也<strong>绝不仅限于复制文件这么简单</strong>。如果想<strong>把光驱设备中的光盘制作成<code>iso</code>格式的镜像文</strong></p>
<p><strong>件</strong>，在Windows系统中需要借助于第三方软件才能做到，但在Linux系统中可以直接使用<code>dd</code>命令来</p>
<p>压制出光盘镜像文件，将它变成一个可立即使用的<code>iso</code>镜像：</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dd if=/dev/cdrom of=RHEL-server-8.0-x86_64-LinuxProbe.Com.iso</span>
13873152+0 records <span class="token keyword">in</span>
13873152+0 records out
7103053824 bytes <span class="token punctuation">(</span>7.1 GB, 6.6 GiB<span class="token punctuation">)</span> copied, 27.8812 s, 255 MB/s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>file</code>命令用于查看文件的类型，语法格式为“<code>file</code>文件名称”。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># file anaconda-ks.cfg </span>
anaconda-ks.cfg: ASCII text
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># file /dev/sda</span>
/dev/sda: block special
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>tar</code>命令用于对文件进行打包压缩或解压，语法格式为“<code>tar</code>参数 文件名称”。</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-c</code></td>
<td>创建压缩文件</td>
</tr>
<tr>
<td><code>-x</code></td>
<td>解开压缩文件</td>
</tr>
<tr>
<td><code>-t</code></td>
<td>查看压缩包内有哪些文件</td>
</tr>
<tr>
<td><code>-z</code></td>
<td>用<code>Gzip</code>压缩或解压</td>
</tr>
<tr>
<td><code>-j</code></td>
<td>用<code>bzip2</code>压缩或解压</td>
</tr>
<tr>
<td><code>-v</code></td>
<td>显示压缩或解压的过程</td>
</tr>
<tr>
<td><code>-f</code></td>
<td>目标文件名</td>
</tr>
<tr>
<td><code>-p</code></td>
<td>保留原始的权限与属性</td>
</tr>
<tr>
<td><code>-P</code></td>
<td>使用绝对路径来压缩</td>
</tr>
<tr>
<td><code>-C</code></td>
<td>指定解压到的目录</td>
</tr>
</tbody></table>
<h2 id="二、管道符、重定向与环境变量"><a href="#二、管道符、重定向与环境变量" class="headerlink" title="二、管道符、重定向与环境变量"></a>二、管道符、重定向与环境变量</h2><hr>
<blockquote>
<p><strong>标准输入重定向（<code>STDIN</code>，文件描述符为0）</strong>：默认从键盘输入，也可从其他文件或命令中输入。</p>
<p><strong>标准输出重定向（<code>STDOUT</code>，文件描述符为1）</strong>：默认输出到屏幕。</p>
<p><strong>错误输出重定向（<code>STDERR</code>，文件描述符为2）</strong>：默认输出到屏幕</p>
</blockquote>
<h3 id="2-1、输入输出重"><a href="#2-1、输入输出重" class="headerlink" title="2.1、输入输出重"></a>2.1、输入输出重</h3><blockquote>
<p>输入重定向中用到的符号及其作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>符号</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>命令 <code>&lt;</code> 文件</td>
<td>将文件作为命令的标准输入</td>
</tr>
<tr>
<td>命令 <code>&lt;&lt; </code>分界符</td>
<td>从标准输入中读入，直到遇见分界符才停止</td>
</tr>
<tr>
<td>命令 <code>&lt;</code> 文件1 <code>&gt;</code> 文件2</td>
<td>将<strong>文件1</strong>作为命令的标准输入并将标准输出到文件2</td>
</tr>
</tbody></table>
<blockquote>
<p>输出重定向中用到的符号及其作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>符号</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>命令 <code>&gt;</code> 文件</td>
<td>将标准输出重定向到一个文件中（<strong>清空原有文件的数据</strong>）</td>
</tr>
<tr>
<td>命令 <code>2&gt;</code> 文件</td>
<td>将错误输出重定向到一个文件中（清空原有文件的数据）</td>
</tr>
<tr>
<td>命令 <code>&gt;&gt;</code> 文件</td>
<td>将标准输出重定向到一个文件中（<strong>追加到原有内容的后面</strong>）</td>
</tr>
<tr>
<td>命令 <code>2&gt;&gt;</code> 文件</td>
<td>将错误输出重定向到一个文件中（追加到原有内容的后面）</td>
</tr>
<tr>
<td>命令 <code>&gt;&gt;</code> 文件 2&gt;&amp;1 或 命令 &amp;&gt;&gt; 文件</td>
<td>将标准输出与错误输出共同写入到文件中（追加到原有内容的后面）</td>
</tr>
</tbody></table>
<h3 id="2-2、管道命令符"><a href="#2-2、管道命令符" class="headerlink" title="2.2、管道命令符"></a>2.2、管道命令符</h3><blockquote>
<p><strong>把前一个命令原本要输出到屏幕的信息当作后一个命令的标准输入</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -l /etc/ | more</span>
total 1344
-rw-r--r--. 1 root root 16 Jul 21 05:08 adjtime
-rw-r--r--. 1 root root 1518 Sep 10 2018 aliases
drwxr-xr-x. 3 root root 65 Jul 21 05:06 alsa
drwxr-xr-x. 2 root root 4096 Jul 21 05:08 alternatives
-rw-r--r--. 1 root root 541 Oct 2 2018 anacrontab
-rw-r--r--. 1 root root 55 Feb 1 2019 asound.conf
-rw-r--r--. 1 root root 1 Aug 12 2018 at.deny
drwxr-x---. 4 root root 100 Jul 21 05:16 audit
drwxr-xr-x. 3 root root 228 Jul 21 05:08 authselect
drwxr-xr-x. 4 root root 71 Jul 21 05:06 avahi
drwxr-xr-x. 2 root root 204 Jul 21 05:06 bash_completion.d
-rw-r--r--. 1 root root 3001 Sep 10 2018 bashrc
--More--
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="2-3、命令行的通配符"><a href="#2-3、命令行的通配符" class="headerlink" title="2.3、命令行的通配符"></a>2.3、命令行的通配符</h3><table>
<thead>
<tr>
<th>通配符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>*</code></td>
<td>任意字符</td>
</tr>
<tr>
<td><code>?</code></td>
<td>单个任意字符</td>
</tr>
<tr>
<td><code>[a-z]</code></td>
<td>单个小写字母</td>
</tr>
<tr>
<td><code>[A-Z]</code></td>
<td>单个大写字母</td>
</tr>
<tr>
<td><code>[a-Z]</code></td>
<td>单个字母</td>
</tr>
<tr>
<td><code>[0-9]</code></td>
<td>单个数字</td>
</tr>
<tr>
<td><code>[[:alpha:]]</code></td>
<td>任意字母</td>
</tr>
<tr>
<td><code>[[:upper:]]</code></td>
<td>任意大写字母</td>
</tr>
<tr>
<td><code>[[:lower:]]</code></td>
<td>任意小写字母</td>
</tr>
<tr>
<td><code>[[:digit:]]</code></td>
<td>所有数字</td>
</tr>
<tr>
<td><code>[[:alnum:]]</code></td>
<td>任意字母加数字</td>
</tr>
<tr>
<td><code>[[:punct:]]</code></td>
<td>标点符号</td>
</tr>
</tbody></table>
<blockquote>
<p><code>/dev</code>目录中且以<code>sda</code>开头的文件：</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -l /dev/sda*</span>
brw-rw----. 1 root disk 8, 0 May 4 15:55 /dev/sda
brw-rw----. 1 root disk 8, 1 May 4 15:55 /dev/sda1
brw-rw----. 1 root disk 8, 2 May 4 15:55 /dev/sda2
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>查看文件名以<code>sda</code>开头，但是后面还紧跟其他某一个字符的文件的相关信息</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -l /dev/sda?</span>
brw-rw----. 1 root disk 8, 1 May 4 15:55 /dev/sda1
brw-rw----. 1 root disk 8, 2 May 4 15:55 /dev/sda2
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>使用[0-9]来匹配0～9之间的单个数字，也可以用[135]这样的方式仅匹配这3个指定数字中的一个；若没有匹配到数字1或2或3，则不会显示出来</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -l /dev/sda[0-9]</span>
brw-rw----. 1 root disk 8, 1 May 4 15:55 /dev/sda1
brw-rw----. 1 root disk 8, 2 May 4 15:55 /dev/sda2
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -l /dev/sda[135]</span>
brw-rw----. 1 root disk 8, 1 May 4 15:55 /dev/sda1
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>搜索<code>/etc/</code>目录中所有以<code>.conf</code>结尾的配置文件有哪些</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -l /etc/*.conf</span>
-rw-r--r--. 1 root root 55 Feb 1 2019 /etc/asound.conf
-rw-r--r--. 1 root root 25696 Dec 12 2018 /etc/brltty.conf
-rw-r--r--. 1 root root 1083 Apr 4 2018 /etc/chrony.conf
-rw-r--r--. 1 root root 1174 Aug 12 2018 /etc/dleyna-server-service.conf
-rw-r--r--. 1 root dnsmasq 26843 Aug 12 2018 /etc/dnsmasq.conf
-rw-r--r--. 1 root root 117 Jan 16 2019 /etc/dracut.conf
-rw-r--r--. 1 root root 20 Aug 12 2018 /etc/fprintd.conf
-rw-r--r--. 1 root root 38 Nov 16 2018 /etc/fuse.conf
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>一口气创建出好多个文件。不过在创建多个文件时，需要使用大括号，并且字段之间用逗号间隔</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># touch {AA,BB,CC}.conf</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -l *.conf</span>
-rw-r--r--. 1 root root 0 Sep 22 01:54 AA.conf
-rw-r--r--. 1 root root 0 Sep 22 01:54 BB.conf
-rw-r--r--. 1 root root 0 Sep 22 01:54 CC.conf
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>使用通配符还可以输出一些指定的信息</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo file{1,2,3,4,5}</span>
file1 file2 file3 file4 file5
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="2-4、常用的转义字符"><a href="#2-4、常用的转义字符" class="headerlink" title="2.4、常用的转义字符"></a>2.4、常用的转义字符</h3><blockquote>
<ul>
<li><strong>反斜杠（\）</strong>：使反斜杠后面的一个变量变为单纯的字符。</li>
<li><strong>单引号（’ ‘）</strong>：转义其中所有的变量为单纯的字符串。</li>
<li><strong>双引号（” “）</strong>：保留其中的变量属性，不进行转义处理。</li>
<li><strong>反引号（` `）</strong>：把其中的命令执行后返回结果。</li>
</ul>
</blockquote>
<blockquote>
<p>定义一个名为<code>PRICE</code>的变量并赋值为5，然后输出以双引号括起来的字符串与变量信息</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># PRICE=5</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "Price is $PRICE"</span>
Price is 5
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>输出“Price is $5”</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "Price is $$PRICE" </span>
Price is 3767PRICE
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>某个命令的输出值</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo `uname -a`</span>
Linux linuxprobe.com 4.18.0-80.el8.x86_64 <span class="token comment" spellcheck="true">#1 SMP Wed Mar 13 12:02:46 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="2-5、重要的环境变量"><a href="#2-5、重要的环境变量" class="headerlink" title="2.5、重要的环境变量"></a>2.5、重要的环境变量</h3><blockquote>
<p><code>Linux</code>系统中最重要的10个环境变量</p>
</blockquote>
<table>
<thead>
<tr>
<th>变量名称</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>HOME</code></td>
<td>用户的主目录（即家目录）</td>
</tr>
<tr>
<td><code>SHELL</code></td>
<td>用户在使用的Shell解释器名称</td>
</tr>
<tr>
<td><code>HISTSIZE</code></td>
<td>输出的历史命令记录条数</td>
</tr>
<tr>
<td><code>HISTFILESIZE</code></td>
<td>保存的历史命令记录条数</td>
</tr>
<tr>
<td><code>MAIL</code></td>
<td>邮件保存路径</td>
</tr>
<tr>
<td><code>LANG</code></td>
<td>系统语言、语系名称</td>
</tr>
<tr>
<td><code>RANDOM</code></td>
<td>生成一个随机数字</td>
</tr>
<tr>
<td><code>PS1</code></td>
<td>Bash解释器的提示符</td>
</tr>
<tr>
<td><code>PATH</code></td>
<td>定义解释器搜索用户执行命令的路径</td>
</tr>
<tr>
<td><code>EDITOR</code></td>
<td>用户默认的文本编辑器</td>
</tr>
</tbody></table>
<h2 id="三、VIM编辑器"><a href="#三、VIM编辑器" class="headerlink" title="三、VIM编辑器"></a>三、<code>VIM</code>编辑器</h2><hr>
<blockquote>
<ul>
<li><strong>命令模式</strong>：控制光标移动，可对文本进行复制、粘贴、删除和查找等工作。</li>
<li><strong>输入模式</strong>：正常的文本录入。</li>
<li><strong>末行模式</strong>：保存或退出文档，以及设置编辑环境。</li>
</ul>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220816104736582.png"></p>
<blockquote>
<p>命令模式中最常用的一些命令</p>
</blockquote>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>dd</code></td>
<td>删除（剪切）光标所在整行</td>
</tr>
<tr>
<td><code>5dd</code></td>
<td>删除（剪切）从光标处开始的5行</td>
</tr>
<tr>
<td><code>yy</code></td>
<td>复制光标所在整行</td>
</tr>
<tr>
<td><code>5yy</code></td>
<td>复制从光标处开始的5行</td>
</tr>
<tr>
<td><code>n</code></td>
<td>显示搜索命令定位到的下一个字符串</td>
</tr>
<tr>
<td><code>N</code></td>
<td>显示搜索命令定位到的上一个字符串</td>
</tr>
<tr>
<td><code>u</code></td>
<td>撤销上一步的操作</td>
</tr>
<tr>
<td><code>p</code></td>
<td>将之前删除（<code>dd</code>）或复制（<code>yy</code>）过的数据粘贴到光标后面</td>
</tr>
</tbody></table>
<blockquote>
<p>末行模式中最常用的一些命令</p>
</blockquote>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>:w</code></td>
<td>保存</td>
</tr>
<tr>
<td><code>:q</code></td>
<td>退出</td>
</tr>
<tr>
<td><code>:q!</code></td>
<td>强制退出（放弃对文档的修改内容）</td>
</tr>
<tr>
<td><code>:wq!</code></td>
<td>强制保存退出</td>
</tr>
<tr>
<td><code>:set nu</code></td>
<td>显示行号</td>
</tr>
<tr>
<td><code>:set nonu</code></td>
<td>不显示行号</td>
</tr>
<tr>
<td><code>:命令</code></td>
<td>执行该命令</td>
</tr>
<tr>
<td><code>:整数</code></td>
<td>跳转到该行</td>
</tr>
<tr>
<td><code>:s/one/two</code></td>
<td>将当前光标所在行的第一个one替换成two</td>
</tr>
<tr>
<td><code>:s/one/two/g</code></td>
<td>将当前光标所在行的所有one替换成two</td>
</tr>
<tr>
<td><code>:%s/one/two/g</code></td>
<td>将全文中的所有one替换成two</td>
</tr>
<tr>
<td><code>?字符串</code></td>
<td>在文本中从下至上搜索该字符串</td>
</tr>
<tr>
<td><code>/字符串</code></td>
<td>在文本中从上至下搜索该字符串</td>
</tr>
</tbody></table>
<h2 id="四、SHELL脚本"><a href="#四、SHELL脚本" class="headerlink" title="四、SHELL脚本"></a>四、<code>SHELL</code>脚本</h2><hr>
<h3 id="4-1、基础语法"><a href="#4-1、基础语法" class="headerlink" title="4.1、基础语法"></a>4.1、基础语法</h3><blockquote>
<p> 文件测试所用的参数</p>
</blockquote>
<table>
<thead>
<tr>
<th>操作符</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-d</code></td>
<td>测试文件是否为目录类型</td>
</tr>
<tr>
<td><code>-e</code></td>
<td>测试文件是否存在</td>
</tr>
<tr>
<td><code>-f</code></td>
<td>判断是否为一般文件</td>
</tr>
<tr>
<td><code>-r</code></td>
<td>测试当前用户是否有权限读取</td>
</tr>
<tr>
<td><code>-w</code></td>
<td>测试当前用户是否有权限写入</td>
</tr>
<tr>
<td><code>-x</code></td>
<td>测试当前用户是否有权限执行</td>
</tr>
</tbody></table>
<blockquote>
<ul>
<li><code>&amp;&amp;</code>是逻辑“与”，只有当前面的语句执行成功的时候才会执行后面的语句。</li>
<li><code>||</code>是逻辑“或”，只有当前面的语句执行失败的时候才会执行后面的语句。</li>
<li><code>!</code>是逻辑“非”，代表对逻辑测试结果取反值；之前若为正确则变成错误，若为错误则变成正确。</li>
</ul>
</blockquote>
<blockquote>
<p> 可用的整数比较运算符</p>
</blockquote>
<table>
<thead>
<tr>
<th>操作符</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-eq</code></td>
<td>是否等于</td>
</tr>
<tr>
<td><code>-ne</code></td>
<td>是否不等于</td>
</tr>
<tr>
<td><code>-gt</code></td>
<td>是否大于</td>
</tr>
<tr>
<td><code>-lt</code></td>
<td>是否小于</td>
</tr>
<tr>
<td><code>-le</code></td>
<td>是否等于或小于</td>
</tr>
<tr>
<td><code>-ge</code></td>
<td>是否大于或等于</td>
</tr>
</tbody></table>
<blockquote>
<p>常见的字符串比较运算符</p>
</blockquote>
<table>
<thead>
<tr>
<th>操作符</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>=</code></td>
<td>比较字符串内容是否相同</td>
</tr>
<tr>
<td><code>!=</code></td>
<td>比较字符串内容是否不同</td>
</tr>
<tr>
<td><code>-z</code></td>
<td>判断字符串内容是否为空</td>
</tr>
</tbody></table>
<h3 id="4-2、流程控制语句"><a href="#4-2、流程控制语句" class="headerlink" title="4.2、流程控制语句"></a>4.2、流程控制语句</h3><h4 id="4-2-1、if-else"><a href="#4-2-1、if-else" class="headerlink" title="4.2.1、if...else..."></a>4.2.1、<code>if...else...</code></h4><blockquote>
<p>用单分支的if条件语句来判断<code>/media/cdrom</code>目录是否存在，若不存在就创建这个目录，反之则结束条件</p>
<p>判断和整个Shell脚本的执行</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220816143656596.png"></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim mkcdrom.sh</span>
<span class="token comment" spellcheck="true">#!/bin/bash</span>
DIR<span class="token operator">=</span><span class="token string">"/media/cdrom"</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token variable">$DIR</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>    
        <span class="token function">mkdir</span> -p <span class="token variable">$DIR</span>
<span class="token keyword">fi</span> 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>用双分支的if条件语句来验证某台主机是否在线，然后根据返回值的结果，要么显示主机在线信息，要么</p>
<p>显示主机不在线信息。这里的脚本主要使用<code>ping</code>命令来测试与对方主机的网络连通性，而<code>Linux</code>系统中</p>
<p>的<code>ping</code>命令不像<code>Windows</code>一样尝试4次就结束，因此为了避免用户等待时间过长，需要通过<code>-c</code>参数</p>
<p>来规定尝试的次数，并使用<code>-i</code>参数定义每个数据包的发送间隔，以及使用<code>-W</code>参数定义等待超时时间。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim chkhost.sh</span>
<span class="token comment" spellcheck="true">#!/bin/bash</span>
<span class="token function">ping</span> -c 3 -i 0.2 -W 3 <span class="token variable">$1</span> <span class="token operator">&amp;</span><span class="token operator">></span> /dev/null
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -eq 0 <span class="token punctuation">]</span>
<span class="token keyword">then</span>
        <span class="token keyword">echo</span> <span class="token string">"Host <span class="token variable">$1</span> is On-line."</span>
<span class="token keyword">else</span>
        <span class="token keyword">echo</span> <span class="token string">"Host <span class="token variable">$1</span> is Off-line."</span>
<span class="token keyword">fi</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>下面的脚本示例中，只有当用户输入的分数大于等于85分且小于等于100分时，才输出<code>Excellent</code>字</p>
<p>样；若分数不满足该条件（即匹配不成功），则继续判断分数是否大于等于70分且小于等于84分，如果</p>
<p>是，则输出<code>Pass</code>字样；若两次都落空（即两次的匹配操作都失败了），则输出Fail字样</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim chkscore.sh</span>
<span class="token comment" spellcheck="true">#!/bin/bash</span>
<span class="token function">read</span> -p <span class="token string">"Enter your score（0-100）："</span> GRADE
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$GRADE</span> -ge 85 <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> <span class="token variable">$GRADE</span> -le 100 <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token keyword">echo</span> <span class="token string">"<span class="token variable">$GRADE</span> is Excellent"</span>
<span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token variable">$GRADE</span> -ge 70 <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> <span class="token variable">$GRADE</span> -le 84 <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token keyword">echo</span> <span class="token string">"<span class="token variable">$GRADE</span> is Pass"</span>
<span class="token keyword">else</span>
        <span class="token keyword">echo</span> <span class="token string">"<span class="token variable">$GRADE</span> is Fail"</span> 
<span class="token keyword">fi</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># bash chkscore.sh</span>
Enter your score（0-100）：88
88 is Excellent
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># bash chkscore.sh </span>
Enter your score（0-100）：80
80 is Pass
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="4-2-2、for条件循环语句"><a href="#4-2-2、for条件循环语句" class="headerlink" title="4.2.2、for条件循环语句"></a>4.2.2、<code>for</code>条件循环语句</h4><blockquote>
<p>使用<code>for</code>循环语句从列表文件中读取多个用户名，然后为其逐一创建用户账户并设置密码。首先创建</p>
<p>用户名称的列表文件<code>users.txt</code>，每个用户名称单独一行。读者可以自行决定具体的用户名称和个数</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220816143644968.png"></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim addusers.sh</span>
<span class="token comment" spellcheck="true">#!/bin/bash</span>
<span class="token function">read</span> -p <span class="token string">"Enter The Users Password : "</span> PASSWD
<span class="token keyword">for</span> UNAME <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> users.txt<span class="token variable">`</span></span>
<span class="token keyword">do</span>
        <span class="token function">id</span> <span class="token variable">$UNAME</span> <span class="token operator">&amp;</span><span class="token operator">></span> /dev/null
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -eq 0 <span class="token punctuation">]</span>
        <span class="token keyword">then</span>
                <span class="token keyword">echo</span> <span class="token string">"<span class="token variable">$UNAME</span> , Already exists"</span>
        <span class="token keyword">else</span>
                <span class="token function">useradd</span> <span class="token variable">$UNAME</span>
                <span class="token keyword">echo</span> <span class="token string">"<span class="token variable">$PASSWD</span>"</span> <span class="token operator">|</span> <span class="token function">passwd</span> --stdin <span class="token variable">$UNAME</span> <span class="token operator">&amp;</span><span class="token operator">></span> /dev/null
                <span class="token keyword">echo</span> <span class="token string">"<span class="token variable">$UNAME</span> , Create success"</span>
        <span class="token keyword">fi</span>
<span class="token keyword">done</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="4-2-3、While条件循环语句"><a href="#4-2-3、While条件循环语句" class="headerlink" title="4.2.3、While条件循环语句"></a>4.2.3、<code>While</code>条件循环语句</h4><blockquote>
<p>结合使用多分支的if条件测试语句与<code>while</code>条件循环语句，编写一个用来猜测数值大小的脚本<code>Guess.sh</code></p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220816143628131.png"></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim Guess.sh</span>
<span class="token comment" spellcheck="true">#!/bin/bash</span>
PRICE<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">expr</span> $RANDOM % 1000<span class="token variable">)</span></span>
TIMES<span class="token operator">=</span>0
<span class="token keyword">echo</span> <span class="token string">"商品实际价格为0-999之间，猜猜看是多少？"</span>
<span class="token keyword">while</span> <span class="token boolean">true</span>
<span class="token keyword">do</span>
        <span class="token function">read</span> -p <span class="token string">"请输入您猜测的价格数目："</span> INT
        <span class="token keyword">let</span> TIMES++
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$INT</span> -eq <span class="token variable">$PRICE</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
                <span class="token keyword">echo</span> <span class="token string">"恭喜您答对了，实际价格是 <span class="token variable">$PRICE</span>"</span>
                <span class="token keyword">echo</span> <span class="token string">"您总共猜测了 <span class="token variable">$TIMES</span> 次"</span>
                <span class="token keyword">exit</span>
        <span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token variable">$INT</span> -gt <span class="token variable">$PRICE</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
                <span class="token keyword">echo</span> <span class="token string">"太高了！"</span>
        <span class="token keyword">else</span>
                <span class="token keyword">echo</span> <span class="token string">"太低了！"</span>
        <span class="token keyword">fi</span>
<span class="token keyword">done</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="4-2-4、case条件测试语句"><a href="#4-2-4、case条件测试语句" class="headerlink" title="4.2.4、case条件测试语句"></a>4.2.4、<code>case</code>条件测试语句</h4><blockquote>
<p>编写脚本<code>Checkkeys.sh</code>，提示用户输入一个字符并将其赋值给变量<code>KEY</code>，然后根据变量<code>KEY</code>的值向用</p>
<p>户显示其值是字母、数字还是其他字符</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220816143615216.png"></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim Checkkeys.sh</span>
<span class="token comment" spellcheck="true">#!/bin/bash</span>
<span class="token function">read</span> -p <span class="token string">"请输入一个字符，并按Enter键确认："</span> KEY
<span class="token keyword">case</span> <span class="token string">"<span class="token variable">$KEY</span>"</span> <span class="token keyword">in</span>
        <span class="token punctuation">[</span>a-z<span class="token punctuation">]</span><span class="token operator">|</span><span class="token punctuation">[</span>A-Z<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">echo</span> <span class="token string">"您输入的是 字母。"</span>
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>0-9<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">echo</span> <span class="token string">"您输入的是 数字。"</span>
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
        *<span class="token punctuation">)</span>
                <span class="token keyword">echo</span> <span class="token string">"您输入的是 空格、功能键或其他控制字符。"</span>
esac
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># bash Checkkeys.sh</span>
请输入一个字符，并按Enter键确认：6
您输入的是 数字。
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># bash Checkkeys.sh</span>
请输入一个字符，并按Enter键确认：p
您输入的是 字母。
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># bash Checkkeys.sh</span>
请输入一个字符，并按Enter键确认：^<span class="token punctuation">[</span><span class="token punctuation">[</span>15~
您输入的是 空格、功能键或其他控制字符。
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="五、计划任务服务程序"><a href="#五、计划任务服务程序" class="headerlink" title="五、计划任务服务程序"></a>五、<strong>计划任务服务程序</strong></h2><blockquote>
<p>一次性计划任务只执行一次，一般用于临时的工作需求。可以用at命令实现这种功能，只需要写成“<code>at时</code></p>
<p><code>间</code>”的形式就行。如果想要查看已设置好但还未执行的一次性计划任务，可以使用<code>at -l</code>命令；要想将</p>
<p>其删除，可以使用<code>atrm任务序号</code></p>
</blockquote>
<blockquote>
<p>at命令的参数及其作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-f</code></td>
<td>指定包含命令的任务文件</td>
</tr>
<tr>
<td><code>-q</code></td>
<td>指定新任务名称</td>
</tr>
<tr>
<td><code>-l</code></td>
<td>显示待执行任务列表</td>
</tr>
<tr>
<td><code>-d</code></td>
<td>删除指定待执行任务</td>
</tr>
<tr>
<td><code>-m</code></td>
<td>任务执行后给用户发邮件</td>
</tr>
</tbody></table>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># at 23:30</span>
warning: commands will be executed using /bin/sh
at<span class="token operator">></span> systemctl restart httpd
at<span class="token operator">></span> 此处请同时按下<span class="token operator">&lt;</span>Ctrl<span class="token operator">></span>+<span class="token operator">&lt;</span>d<span class="token operator">></span>键来结束编写计划任务
job 1 at Wed Oct 14 23:30:00 2020
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># at -l</span>
1 Wed Oct 14 23:30:00 2020 a root
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>使用<code>crond</code>设置任务的参数字段说明</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220816144304370.png"></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># crontab -e</span>
no <span class="token function">crontab</span> <span class="token keyword">for</span> root - using an empty one
crontab: installing new <span class="token function">crontab</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># crontab -l</span>
25 3 * * 1,3,5 /usr/bin/tar -czvf backup.tar.gz /home/wwwroot
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="六、用户身份与能力"><a href="#六、用户身份与能力" class="headerlink" title="六、用户身份与能力"></a>六、用户身份与能力</h2><hr>
<blockquote>
<p><code>id</code>命令用于显示用户的详细信息，语法格式为“<code>id</code>用户名”。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># id linuxprobe</span>
uid<span class="token operator">=</span>1000<span class="token punctuation">(</span>linuxprobe<span class="token punctuation">)</span> gid<span class="token operator">=</span>1000<span class="token punctuation">(</span>linuxprobe<span class="token punctuation">)</span> groups<span class="token operator">=</span>1000<span class="token punctuation">(</span>linuxprobe<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p><code>useradd</code>命令用于创建新的用户账户，语法格式为“<code>useradd </code>[参数] 用户名”。</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-d</code></td>
<td>指定用户的家目录（默认为<code>/home/username</code>）</td>
</tr>
<tr>
<td><code>-e</code></td>
<td>账户的到期时间，格式为<code>YYYY-MM-DD</code>.</td>
</tr>
<tr>
<td><code>-u</code></td>
<td>指定该用户的默认<code>UID</code></td>
</tr>
<tr>
<td><code>-g</code></td>
<td>指定一个初始的用户基本组（必须已存在）</td>
</tr>
<tr>
<td><code>-G</code></td>
<td>指定一个或多个扩展用户组</td>
</tr>
<tr>
<td><code>-N</code></td>
<td>不创建与用户同名的基本用户组</td>
</tr>
<tr>
<td><code>-s</code></td>
<td>指定该用户的默认Shell解释器</td>
</tr>
</tbody></table>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># useradd linuxcool</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># id linuxcool</span>
uid<span class="token operator">=</span>1001<span class="token punctuation">(</span>linuxcool<span class="token punctuation">)</span> gid<span class="token operator">=</span>1001<span class="token punctuation">(</span>linuxcool<span class="token punctuation">)</span> groups<span class="token operator">=</span>1001<span class="token punctuation">(</span>linuxcool<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>groupadd</code>命令用于创建新的用户组，语法格式为“<code>groupadd</code> [参数] 群组名”。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">groupadd</span> ronny
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p><code>usermod</code>命令用于修改用户的属性，英文全称为“<code>user modify</code>”，语法格式为“<code>usermod</code> [参数] 用户名”。</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-c</code></td>
<td>填写用户账户的备注信息</td>
</tr>
<tr>
<td><code>-d -m</code></td>
<td>参数<code>-m</code>与参数<code>-d</code>连用，可重新指定用户的家目录并自动把旧的数据转移过去</td>
</tr>
<tr>
<td><code>-e</code></td>
<td>账户的到期时间，格式为<code>YYYY-MM-DD</code></td>
</tr>
<tr>
<td><code>-g</code></td>
<td>变更所属用户组</td>
</tr>
<tr>
<td><code>-G</code></td>
<td>变更扩展用户组</td>
</tr>
<tr>
<td><code>-L</code></td>
<td>锁定用户禁止其登录系统</td>
</tr>
<tr>
<td><code>-U</code></td>
<td>解锁用户，允许其登录系统</td>
</tr>
<tr>
<td><code>-s</code></td>
<td>变更默认终端</td>
</tr>
<tr>
<td><code>-u</code></td>
<td>修改用户的<code>UID</code></td>
</tr>
</tbody></table>
<blockquote>
<p><code>passwd</code>命令用于修改用户的密码、过期时间等信息，英文全称为“<code>password</code>”，语法格式为“<code>passwd </code>[参数] 用户名”</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-l</code></td>
<td>锁定用户，禁止其登录</td>
</tr>
<tr>
<td><code>-u</code></td>
<td>解除锁定，允许用户登录</td>
</tr>
<tr>
<td><code>--stdin</code></td>
<td>允许通过标准输入修改用户密码，如`echo “NewPassWord”</td>
</tr>
<tr>
<td><code>-d</code></td>
<td>使该用户可用空密码登录系统</td>
</tr>
<tr>
<td><code>-e</code></td>
<td>强制用户在下次登录时修改密码</td>
</tr>
<tr>
<td><code>-S</code></td>
<td>显示用户的密码是否被锁定，以及密码所采用的加密算法名称</td>
</tr>
</tbody></table>
<blockquote>
<p><code>userdel</code>命令用于删除已有的用户账户，英文全称为“<code>user delete</code>”，语法格式为“<code>userdel</code> [参数] 用户名”。</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-f</code></td>
<td>强制删除用户</td>
</tr>
<tr>
<td><code>-r</code></td>
<td>同时删除用户及用户家目录</td>
</tr>
</tbody></table>
<h3 id="6-1、文件权限与归属"><a href="#6-1、文件权限与归属" class="headerlink" title="6.1、文件权限与归属"></a>6.1、文件权限与归属</h3><blockquote>
<p> 读写执行权限对于文件与目录可执行命令的区别</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220816172532310.png"></p>
<blockquote>
<p>文件权限的字符与数字表示</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220816172548042.png"></p>
<blockquote>
<p><strong>常见的文件类型</strong>包括普通文件（-）、目录文件（d）、链接文件（l）、管道文件（p）、块设备文件</p>
<p>（b）以及字符设备文件（c）。</p>
<p>通过分析可知，该文件的类型为<strong>普通文件</strong>，所有者权限为<strong>可读</strong>、<strong>可写</strong>（<code>rw-</code>），所属组权限为<strong>可读</strong>（<code>r-</code></p>
<p><code>-</code>），除此以外的其他人也只有<strong>可读权限</strong>（<code>r--</code>），文件的<strong>磁盘占用</strong>大小是34298字节，最近一次的<strong>修改</strong></p>
<p><strong>时间</strong>为4月2日的<code>0:23</code>，<strong>文件的名称</strong>为<code>install.log</code></p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220816172746994.png"></p>
<h3 id="6-2、文件的特殊权限"><a href="#6-2、文件的特殊权限" class="headerlink" title="6.2、文件的特殊权限"></a>6.2、文件的特殊权限</h3><h4 id="6-2-1、SUID"><a href="#6-2-1、SUID" class="headerlink" title="6.2.1、SUID"></a>6.2.1、<code>SUID</code></h4><blockquote>
<p><code>SUID</code>是一种对二进制程序进行设置的特殊权限，能够让二进制程序的执行者<strong>临时</strong>拥有<strong>所有者的权限</strong>（<strong>仅</strong></p>
<p><strong>对拥有执行权限的二进制程序有效</strong>）</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -l /etc/shadow</span>
----------. 1 root root 1312 Jul 21 05:08 /etc/shadow
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -l /bin/passwd </span>
-rwsr-xr-x. 1 root root 34512 Aug 13 2018 /bin/passwd
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>查看<code>passwd</code>命令属性时发现所有者的权限由<code>rwx</code>变成了<code>rws</code>，其中x改变成s就意味着该文件被赋予了</p>
<p><code>SUID</code>权限。另外如果原本的权限是<code>rw-</code>呢？如果原先权限位上没有x执行权限，那么被赋予特殊权限后</p>
<p>将变成大写的<code>S</code>。</p>
</blockquote>
<h4 id="6-2-2、SGID"><a href="#6-2-2、SGID" class="headerlink" title="6.2.2、SGID"></a>6.2.2、<code>SGID</code></h4><blockquote>
<p><code>SGID</code>特殊权限有两种应用场景：当对二进制程序进行设置时，能够让执行者<strong>临时获取文件所属组的权</strong></p>
<p><strong>限</strong>；当对目录进行设置时，则是让目录内新创建的文件<strong>自动继承该目录原有用户组的名称</strong>。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /tmp</span>
<span class="token punctuation">[</span>root@linuxprobe tmp<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir testdir</span>
<span class="token punctuation">[</span>root@linuxprobe tmp<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -ald testdir</span>
drwxr-xr-x. 2 root root 6 Oct 27 23:44 testdir
<span class="token punctuation">[</span>root@linuxprobe tmp<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># chmod -R 777 testdir</span>
<span class="token punctuation">[</span>root@linuxprobe tmp<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># chmod -R g+s testdir</span>
<span class="token punctuation">[</span>root@linuxprobe tmp<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -ald testdir</span>
drwxrwsrwx. 2 root root 6 Oct 27 23:44 testdir
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="6-2-3、SBIT"><a href="#6-2-3、SBIT" class="headerlink" title="6.2.3、SBIT"></a>6.2.3、<code>SBIT</code></h4><blockquote>
<p><code>SBIT</code>特殊权限位可确保用户只能删除自己的文件，而不能删除其他用户的文件</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -ald /tmp</span>
drwxrwxrwt. 17 root root 4096 Oct 28 00:29 /tmp
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="6-2-4、总结"><a href="#6-2-4、总结" class="headerlink" title="6.2.4、总结"></a>6.2.4、总结</h4><table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>u+s</code></td>
<td>设置<code>SUID</code>权限</td>
</tr>
<tr>
<td><code>u-s</code></td>
<td>取消<code>SUID</code>权限</td>
</tr>
<tr>
<td><code>g+s</code></td>
<td>设置<code>SGID</code>权限</td>
</tr>
<tr>
<td><code>g-s</code></td>
<td>取消<code>SGID</code>权限</td>
</tr>
<tr>
<td><code>o+t</code></td>
<td>设置<code>SBIT</code>权限</td>
</tr>
<tr>
<td><code>o-t</code></td>
<td>取消<code>SBIT</code>权限</td>
</tr>
</tbody></table>
<blockquote>
<p><code>SUID</code>、<code>SGID</code>与<code>SBIT</code>也有对应的数字表示法，分别为4、2、1。也就是说777还不是最大权限，最大权</p>
<p>限应该是7777，其中第1个数字代表的是特殊权限位。既然知道了数字表示法是由“特殊权限+一般权</p>
<p>限”构成的，现在就以上面<code>linux</code>目录的权限为例，为大家梳理一下计算方法。</p>
<p>在<code>rwxr-xr-t</code>权限中，最后一位是t，这说明该文件的一般权限为<code>rwxr-xr-x</code>，并带有<code>SBIT</code>特殊权限。</p>
<p>对于可读（r）、可写（w）、可执行（x）权限的数字计算方法大家应该很熟悉了—<code>rwxr-xr-x</code>即755，</p>
<p>而<code>SBIT</code>特殊权限位是1，则合并后的结果为1755。</p>
<p>再增加点难度，如果权限是“<code>rwsrwSr--</code>”呢？首先不要慌，大写S表示原先没有执行权限，因此一般权限</p>
<p>为<code>rwxrw-r--</code>，将其转换为数字表示法后结果是764。带有的<code>SUID</code>和<code>SGID</code>特殊权限的数字法表示是4</p>
<p>和2，心算得出结果是6，合并后的结果为6764</p>
</blockquote>
<h3 id="6-3、文件的隐藏属性"><a href="#6-3、文件的隐藏属性" class="headerlink" title="6.3、文件的隐藏属性"></a>6.3、文件的隐藏属性</h3><blockquote>
<p><code>Linux</code>系统中的文件除了具备一般权限和特殊权限之外，还有一种隐藏权限，即被隐藏起来的权限，</p>
<p>默认情况下不能直接被用户发觉。</p>
<p><strong>既然叫隐藏权限，那么使用常规的ls命令肯定不能看到它的真面目。隐藏权限的专用设置命令是</strong></p>
<p><strong><code>chattr</code>，专用查看命令是<code>lsattr</code>。</strong></p>
</blockquote>
<h4 id="6-3-1、chattr命令"><a href="#6-3-1、chattr命令" class="headerlink" title="6.3.1、chattr命令"></a>6.3.1、<code>chattr</code>命令</h4><blockquote>
<p><code>chattr</code>命令用于设置文件的隐藏权限，英文全称为<code>change attributes</code>，语法格式为“<code>chattr</code> [参数] </p>
<p>文件名称”。</p>
</blockquote>
<blockquote>
<p>如果想要把某个隐藏功能添加到文件上，则需要在命令后面追加“+参数”，如果想要把某个隐藏功能移出</p>
<p>文件，则需要追加“-参数”</p>
</blockquote>
<blockquote>
<p><code>chattr</code>命令中的参数及其作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>i</code></td>
<td>无法对文件进行修改；若对目录设置了该参数，则仅能修改其中的子文件内容而不能新建或删除文件</td>
</tr>
<tr>
<td><code>a</code></td>
<td>仅允许补充（追加）内容，无法覆盖/删除内容（<code>Append Only</code>）</td>
</tr>
<tr>
<td><code>S</code></td>
<td>文件内容在变更后立即同步到硬盘（<code>sync</code>）</td>
</tr>
<tr>
<td><code>s</code></td>
<td>彻底从硬盘中删除，不可恢复（用0填充原文件所在硬盘区域）</td>
</tr>
<tr>
<td><code>A</code></td>
<td>不再修改这个文件或目录的最后访问时间（<code>atime</code>）</td>
</tr>
<tr>
<td><code>b</code></td>
<td>不再修改文件或目录的存取时间</td>
</tr>
<tr>
<td><code>D</code></td>
<td>检查压缩文件中的错误</td>
</tr>
<tr>
<td><code>d</code></td>
<td>使用<code>dump</code>命令备份时忽略本文件/目录</td>
</tr>
<tr>
<td><code>c</code></td>
<td>默认将文件或目录进行压缩</td>
</tr>
<tr>
<td><code>u</code></td>
<td>当删除该文件后依然保留其在硬盘中的数据，方便日后恢复</td>
</tr>
<tr>
<td><code>t</code></td>
<td>让文件系统支持尾部合并（<code>tail-merging</code>）</td>
</tr>
<tr>
<td><code>x</code></td>
<td>可以直接访问压缩文件中的内容</td>
</tr>
</tbody></table>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "for Test" > linuxprobe</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rm linuxprobe</span>
rm: remove regular <span class="token function">file</span> ‘linuxprobe’? y

<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "for Test" > linuxprobe</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># chattr +a linuxprobe</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rm linuxprobe</span>
rm: remove regular <span class="token function">file</span> ‘linuxprobe’? y
rm: cannot remove ‘linuxprobe’: Operation not permitted
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="6-3-2、lsattr命令"><a href="#6-3-2、lsattr命令" class="headerlink" title="6.3.2、lsattr命令"></a>6.3.2、<code>lsattr</code>命令</h4><blockquote>
<p><code>lsattr</code>命令用于查看文件的隐藏权限，英文全称为“<code>list attributes</code>”，语法格式为“<code>lsattr </code>[参数] 文件名称”</p>
</blockquote>
<blockquote>
<p>文件的隐藏权限必须使用<code>lsattr</code>命令来查看，平时使用的<code>ls</code>之类的命令则看不出端倪</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -al linuxprobe</span>
-rw-r--r--. 1 root root 9 Feb 12 11:42 linuxprobe
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>一旦使用<code>lsattr</code>命令后，文件上被赋予的隐藏权限马上就会原形毕露</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># lsattr linuxprobe</span>
-----a---------- linuxprobe
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>此时按照显示的隐藏权限的类型（字母），使用<code>chattr</code>命令将其去掉</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># chattr -a linuxprobe</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># lsattr linuxprobe </span>
---------------- linuxprobe
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rm linuxprobe </span>
rm: remove regular <span class="token function">file</span> ‘linuxprobe’? y
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="6-4、文件访问控制列表"><a href="#6-4、文件访问控制列表" class="headerlink" title="6.4、文件访问控制列表"></a>6.4、文件访问控制列表</h3><blockquote>
<p>前文讲解的一般权限、特殊权限、隐藏权限其实有一个共性—权限是针对某一类用户设置的，能够对很</p>
<p>多人同时生效。如果希望对某个指定的用户进行单独的权限控制，就需要用到文件的访问控制列表</p>
<p>（<code>ACL</code>）了。通俗来讲，基于普通文件或目录设置<code>ACL</code>其实就是针对指定的用户或用户组设置文件或目</p>
<p>录的操作权限，更加精准地派发权限。另外，如果针对某个目录设置了<code>ACL</code>，则目录中的文件会继承其</p>
<p><code>ACL</code>权限；若针对文件设置了<code>ACL</code>，则文件不再继承其所在目录的<code>ACL</code>权限</p>
</blockquote>
<blockquote>
<p>在没有针对普通用户为<code>root</code>管理员的家目录设置<code>ACL</code>之前，其执行结果如下所示：</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># su - linuxprobe</span>
<span class="token punctuation">[</span>linuxprobe@linuxprobe ~<span class="token punctuation">]</span>$ <span class="token function">cd</span> /root
-bash: cd: /root: Permission denied
<span class="token punctuation">[</span>linuxprobe@linuxprobe root<span class="token punctuation">]</span>$ <span class="token keyword">exit</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="6-4-1、setfacl命令"><a href="#6-4-1、setfacl命令" class="headerlink" title="6.4.1、setfacl命令"></a>6.4.1、<code>setfacl</code>命令</h4><blockquote>
<p><code>setfacl</code>命令用于管理文件的<code>ACL</code>权限规则，英文全称为“<code>set files ACL</code>”，语法格式为“<code>setfacl </code>[参数] 文件名称”</p>
</blockquote>
<blockquote>
<p><code>ACL</code>权限提供的是在所有者、所属组、其他人的读/写/执行权限之外的特殊权限控制。使用<code>setfacl</code>命</p>
<p>令可以针对单一用户或用户组、单一文件或目录来进行读/写/执行权限的控制。其中，针对目录文件需要</p>
<p>使用<code>-R</code>递归参数；针对普通文件则使用<code>-m</code>参数；如果想要删除某个文件的<code>ACL</code>，则可以使用<code>-b</code>参数。</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-m</code></td>
<td>修改权限</td>
</tr>
<tr>
<td><code>-M</code></td>
<td>从文件中读取权限</td>
</tr>
<tr>
<td><code>-x</code></td>
<td>删除某个权限</td>
</tr>
<tr>
<td><code>-b</code></td>
<td>删除全部权限</td>
</tr>
<tr>
<td><code>-R</code></td>
<td>递归子目录</td>
</tr>
</tbody></table>
<blockquote>
<p>为普通用户单独设置一下权限</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># setfacl -Rm u:linuxprobe:rwx /root</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>换到这位普通用户的身份下，现在能正常进入了</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># su - linuxprobe</span>
<span class="token punctuation">[</span>linuxprobe@linuxprobe ~<span class="token punctuation">]</span>$ <span class="token function">cd</span> /root
<span class="token punctuation">[</span>linuxprobe@linuxprobe root<span class="token punctuation">]</span>$ <span class="token function">ls</span>
anaconda-ks.cfg  Documents  initial-setup-ks.cfg  Pictures  Templates
Desktop          Downloads  Music                 Public    Videos
<span class="token punctuation">[</span>linuxprobe@linuxprobe root<span class="token punctuation">]</span>$ <span class="token keyword">exit</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>常用的ls命令是看不到<code>ACL</code>信息的，但是却可以看到文件权限的最后一个点（**.<strong>）变成了加号（</strong>+**），这就</p>
<p>意味着该文件已经设置了<code>ACL</code></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -ld /root</span>
dr-xrwx---+ 14 root root 4096 May 4 2020 /root
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="6-4-2、getfacl命令"><a href="#6-4-2、getfacl命令" class="headerlink" title="6.4.2、getfacl命令"></a>6.4.2、<code>getfacl</code>命令</h4><blockquote>
<p><code>getfacl</code>命令用于查看文件的<code>ACL</code>权限规则，英文全称为“<code>get files ACL</code>”，语法格式为“<code>getfacl</code> [参数] 文件名称”。</p>
</blockquote>
<blockquote>
<p>使用<code>getfacl</code>命令显示在root管理员家目录上设置的所有<code>ACL</code>信息</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># getfacl /root</span>
ggetfacl: Removing leading <span class="token string">'/'</span> from absolute path names
<span class="token comment" spellcheck="true"># file: root</span>
<span class="token comment" spellcheck="true"># owner: root</span>
<span class="token comment" spellcheck="true"># group: root</span>
user::r-x
user:linuxprobe:rwx
group::r-x
mask::rwx
other::---
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>ACL</code>权限还可以针对某个用户组进行设置。例如，允许某个组的用户都可以读写<code>/etc/fstab</code>文件</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># setfacl -m g:linuxprobe:rw /etc/fstab</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># getfacl /etc/fstab </span>
getfacl: Removing leading <span class="token string">'/'</span> from absolute path names
<span class="token comment" spellcheck="true"># file: etc/fstab</span>
<span class="token comment" spellcheck="true"># owner: root</span>
<span class="token comment" spellcheck="true"># group: root</span>
user::rw-
group::r--
group:linuxprobe:rw-
mask::rw-
other::r--
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>要清空所有<code>ACL</code>权限，请用<code>-b</code>参数；要删除某一条指定的权限，就用<code>-x</code>参数</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># setfacl -x g:linuxprobe /etc/fstab</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># getfacl /etc/fstab </span>
getfacl: Removing leading <span class="token string">'/'</span> from absolute path names
<span class="token comment" spellcheck="true"># file: etc/fstab</span>
<span class="token comment" spellcheck="true"># owner: root</span>
<span class="token comment" spellcheck="true"># group: root</span>
user::rw-
group::r--
mask::r--
other::r--
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong><code>ACL</code>权限的设置都是立即且永久生效的，不需要再编辑什么配置文件，这一点特别方便。但是，这也带来了一个安全隐患。如果我们不小心设置错了权限，就会覆盖掉文件原始的权限信息，并且永远都找不回来了。</strong></p>
</blockquote>
<blockquote>
<p>在备份<code>/home</code>目录上的<code>ACL</code>权限时，可使用<code>-R</code>递归参数，这样不仅能够把目录本身的权限进行备份，还</p>
<p>能将里面的文件权限也自动备份</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /</span>
<span class="token punctuation">[</span>root@linuxprobe /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># getfacl -R home > backup.acl</span>
<span class="token punctuation">[</span>root@linuxprobe /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -l </span>
-rw-r--r--. 1 root root 834 Jul 18 14:14 backup.acl
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>ACL</code>权限的恢复也很简单，使用的是<code>--restore</code>参数。由于在备份时已经指定是对<code>/home</code>目录进行操</p>
<p>作，所以不需要写对应的目录名称，它能够自动找到要恢复的对象</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># setfacl --restore backup.acl</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="6-5、su命令与sudo服务"><a href="#6-5、su命令与sudo服务" class="headerlink" title="6.5、su命令与sudo服务"></a>6.5、<code>su</code>命令与<code>sudo</code>服务</h3><blockquote>
<p><code>su</code>命令可以解决切换用户身份的需求，使得当前用户在不退出登录的情况下，顺畅地切换到其他用户，</p>
<p>比如从<code>root</code>管理员切换至普通用户</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># su - linuxprobe</span>
<span class="token punctuation">[</span>linuxprobe@linuxprobe ~<span class="token punctuation">]</span>$ <span class="token function">id</span>
uid<span class="token operator">=</span>1000<span class="token punctuation">(</span>linuxprobe<span class="token punctuation">)</span> gid<span class="token operator">=</span>1000<span class="token punctuation">(</span>linuxprobe<span class="token punctuation">)</span> groups<span class="token operator">=</span>1000<span class="token punctuation">(</span>linuxprobe<span class="token punctuation">)</span> context<span class="token operator">=</span>unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>上面的<code>su</code>命令与用户名之间有一个减号（-），这意味着完全切换到新的用户，即把环境变量信息也变更</p>
<p>为新用户的相应信息，而不是保留原始的信息。强烈建议在切换用户身份时添加这个减号（-）</p>
</blockquote>
<blockquote>
<p><code>sudo</code>命令用于给普通用户提供额外的权限，语法格式为“<code>sudo</code> [参数] 用户名”。</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-h</code></td>
<td>列出帮助信息</td>
</tr>
<tr>
<td><code>-l</code></td>
<td>列出当前用户可执行的命令</td>
</tr>
<tr>
<td><code>-u</code>用户名或<code>UID</code>值</td>
<td>以指定的用户身份执行命令</td>
</tr>
<tr>
<td><code>-k</code></td>
<td>清空密码的有效时间，下次执行<code>sudo</code>时需要再次进行密码验证</td>
</tr>
<tr>
<td><code>-b</code></td>
<td>在后台执行指定的命令</td>
</tr>
<tr>
<td><code>-p</code></td>
<td>更改询问密码的提示语</td>
</tr>
</tbody></table>
<blockquote>
<p><code>visudo</code>命令用于编辑、配置用户<code>sudo</code>的权限文件，语法格式为“<code>visudo </code>[参数]”。</p>
<p>使用<code>visudo</code>命令配置权限文件时，其操作方法与<code>Vim</code>编辑器中用到的方法完全一致，因此在编写完成后</p>
<p>记得在末行模式下保存并退出。在配置权限文件时，按照下面的格式在第101行（大约）填写上指定的信</p>
<p>息</p>
</blockquote>
<blockquote>
<p><strong>谁可以使用 允许使用的主机 = （以谁的身份） 可执行命令的列表</strong></p>
<p><strong>谁可以使用：</strong>稍后要为哪位用户进行命令授权。</p>
<p><strong>允许使用的主机：</strong>可以填写ALL表示不限制来源的主机，亦可填写如192.168.10.0/24这样的网段限制来</p>
<p>源地址，使得只有从允许网段登录时才能使用<code>sudo</code>命令。</p>
<p><strong>以谁的身份：</strong>可以填写ALL表示系统最高权限，也可以是另外一位用户的名字。</p>
<p><strong>可执行命令的列表：</strong>可以填写ALL表示不限制命令，亦可填写如<code>/usr/bin/cat</code>这样的文件名称来限制命</p>
<p>令列表，多个命令文件之间用逗号（,）间隔。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># visudo</span>
 99 <span class="token comment" spellcheck="true">## Allow root to run any commands anywhere</span>
100 root ALL<span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> ALL
101 linuxprobe ALL<span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> ALL
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>单个命令赋予<code>root</code>权限(<code>cat</code>,<code>reboot</code>)</p>
<p>查询命令的绝对路径</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>linuxprobe@linuxprobe ~<span class="token punctuation">]</span>$ <span class="token keyword">exit</span> 
<span class="token function">logout</span> 
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># whereis cat </span>
cat: /usr/bin/cat /usr/share/man/man1/cat.1.gz /usr/share/man/man1p/cat.1p.gz
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># whereis reboot</span>
reboot: /usr/sbin/reboot /usr/share/man/man2/reboot.2.gz /usr/share/man/man8/reboot.8.gz
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>赋予权限</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># visudo</span>
 99 <span class="token comment" spellcheck="true">## Allow root to run any commands anywhere</span>
100 root ALL<span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> ALL
101 linuxprobe ALL<span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> /usr/bin/cat,/usr/sbin/reboot
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>用户下次再执行<code>sudo</code>命令时就<strong>不用密码验证</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># visudo</span>
 99 <span class="token comment" spellcheck="true">## Allow root to run any commands anywhere</span>
100 root ALL<span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> ALL
101 linuxprobe ALL<span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD:/usr/bin/cat,/usr/sbin/reboot
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="七、存储结构与管理硬盘"><a href="#七、存储结构与管理硬盘" class="headerlink" title="七、存储结构与管理硬盘"></a>七、存储结构与管理硬盘</h2><hr>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220817101100075.png" alt="Linux系统中的文件存储结构"></p>
<h3 id="7-1、一切从“-”开始"><a href="#7-1、一切从“-”开始" class="headerlink" title="7.1、一切从“/”开始"></a>7.1、一切从“<code>/</code>”开始</h3><blockquote>
<p><code>Linux</code>系统中常见的目录名称以及相应内容</p>
</blockquote>
<table>
<thead>
<tr>
<th>目录名称</th>
<th>应放置文件的内容</th>
</tr>
</thead>
<tbody><tr>
<td><code>/boot</code></td>
<td>开机所需文件—<strong>内核</strong>、<strong>开机菜单</strong>以及<strong>所需配置文件</strong>等</td>
</tr>
<tr>
<td><code>/dev</code></td>
<td>以文件形式存放任何<strong>设备与接口</strong></td>
</tr>
<tr>
<td><code>/etc</code></td>
<td>配置文件</td>
</tr>
<tr>
<td><code>/home</code></td>
<td>用户主目录</td>
</tr>
<tr>
<td><code>/bin</code></td>
<td>存放单用户模式下还可以操作的<a target="_blank" rel="noopener" href="https://www.linuxcool.com/">命令</a></td>
</tr>
<tr>
<td><code>/lib</code></td>
<td>开机时用到的函数库，以及<code>/bin</code>与<code>/sbin</code>下面的命令要调用的函数</td>
</tr>
<tr>
<td><code>/sbin</code></td>
<td>开机过程中需要的命令</td>
</tr>
<tr>
<td><code>/media</code></td>
<td>用于挂载设备文件的目录</td>
</tr>
<tr>
<td><code>/opt</code></td>
<td>放置第三方的软件</td>
</tr>
<tr>
<td><code>/root</code></td>
<td>系统管理员的家目录</td>
</tr>
<tr>
<td><code>/srv</code></td>
<td>一些网络服务的数据文件目录</td>
</tr>
<tr>
<td><code>/tmp</code></td>
<td>任何人均可使用的“共享”临时目录</td>
</tr>
<tr>
<td><code>/proc</code></td>
<td><strong>虚拟文件系统</strong>，例如<strong>系统内核</strong>、<strong>进程</strong>、<strong>外部设备及网络状态</strong>等</td>
</tr>
<tr>
<td><code>/usr/local</code></td>
<td>用户自行安装的软件</td>
</tr>
<tr>
<td><code>/usr/sbin</code></td>
<td>Linux系统开机时不会使用到的软件/命令/脚本</td>
</tr>
<tr>
<td><code>/usr/share</code></td>
<td>帮助与说明文件，也可放置共享文件</td>
</tr>
<tr>
<td><code>/var</code></td>
<td>主要存放经常变化的文件，如日志</td>
</tr>
<tr>
<td><code>/lost+found</code></td>
<td>当文件系统发生错误时，将一些丢失的文件片段存放在这里</td>
</tr>
</tbody></table>
<h3 id="7-2、物理设备的命名规则"><a href="#7-2、物理设备的命名规则" class="headerlink" title="7.2、物理设备的命名规则"></a>7.2、物理设备的命名规则</h3><blockquote>
<p>常见的硬件设备及其文件名称</p>
</blockquote>
<table>
<thead>
<tr>
<th>硬件设备</th>
<th>文件名称</th>
</tr>
</thead>
<tbody><tr>
<td><code>IDE设备</code></td>
<td><code>/dev/hd[a-d]</code></td>
</tr>
<tr>
<td><code>SCSI</code>/<code>SATA</code>/<code>U盘</code></td>
<td><code>/dev/sd[a-z]</code></td>
</tr>
<tr>
<td><code>virtio设备</code></td>
<td><code>/dev/vd[a-z]</code></td>
</tr>
<tr>
<td>软驱</td>
<td><code>/dev/fd[0-1]</code></td>
</tr>
<tr>
<td>打印机</td>
<td><code>/dev/lp[0-15]</code></td>
</tr>
<tr>
<td>光驱</td>
<td><code>/dev/cdrom</code></td>
</tr>
<tr>
<td>鼠标</td>
<td><code>/dev/mouse</code></td>
</tr>
<tr>
<td>磁带机</td>
<td><code>/dev/st0</code>或<code>/dev/ht0</code></td>
</tr>
</tbody></table>
<blockquote>
<p>由于现在的<code>IDE设备</code>已经很少见了，所以一般的硬盘设备都是以“<code>/dev/sd</code>”开头。而一台主机上可以有多</p>
<p>块硬盘，因此系统采用<code>a～z</code>来代表26块不同的硬盘（默认从a开始分配），而且硬盘的分区编号也很有</p>
<p>讲究:</p>
<ul>
<li><strong>主分区</strong>或扩展分区的编号从1开始，到4结束；</li>
<li><strong>逻辑分区</strong>从编号5开始</li>
</ul>
</blockquote>
<blockquote>
<p>分析<code>/dev/sda5</code></p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220817110431706.png"></p>
<blockquote>
<p>硬盘设备是由大量的<strong>扇区</strong>组成的，每个扇区的容量为512字节。其中第一个扇区最重要，它里面保存着</p>
<p><strong>主引导记录</strong>与<strong>分区</strong>表信息。就第一个扇区来讲，主引导记录需要占用446字节，<strong>分区表</strong>占用64字节，<strong>结束</strong></p>
<p><strong>符</strong>占用2字节；其中<strong>分区表中每记录一个分区信息就需要16字节</strong>，这样一来最多只有4个分区信息可以写</p>
<p>到第一个扇区中，这4个分区就是4个主分区。第一个扇区中的数据信息如图</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220817112045158.png"></p>
<blockquote>
<p>现在，问题来了—每块硬盘最多只能创建出4个分区？这明显不合情理也不够用。</p>
<p>于是为了解决分区个数不够的问题，<strong>可以将第一个扇区的分区表中16字节（原本要写入主分区信息）</strong></p>
<p><strong>的空间（称之为扩展分区）拿出来指向另外一个分区</strong>。也就是说，扩展分区其实并不是一个真正的</p>
<p>分区，而更像是一个占用16字节分区表空间的指针—一个指向另外一个分区的指针。这样一来，用户一</p>
<p>般会选择使用3个主分区加1个扩展分区的方法，然后在扩展分区中创建出数个逻辑分区，从而来满足多</p>
<p>分区（大于4个）的需求。当然，就目前来讲大家只要明白为什么主分区不能超过4个就足够了。主分</p>
<p>区、扩展分区、逻辑分区可以像图6-4那样来规划。</p>
</blockquote>
<h3 id="7-3、文件系统与数据资料"><a href="#7-3、文件系统与数据资料" class="headerlink" title="7.3、文件系统与数据资料"></a>7.3、文件系统与数据资料</h3><blockquote>
<p><code>Linux</code>系统支持数十种文件系统，而最常见的文件系统如下:</p>
<ul>
<li><p><code>Ext2</code>：最早可追溯到1993年，是<code>Linux</code>系统的<strong>第一个商业级文件系统</strong>，它基本<strong>沿袭了UNIX文件系</strong></p>
<p><strong>统的设计标准</strong>。但由于<strong>不包含日志读写功能，数据丢失的可能性很大</strong>，因此大家能不用就不用，或者</p>
<p>顶多建议用于SD存储卡或U盘。</p>
</li>
<li><p><code>Ext3</code>：是一款<strong>日志文件系统</strong>，它会<strong>把整个硬盘的每个写入动作的细节都预先记录下来</strong>，然后再进行</p>
<p>实际操作，以便在发生异常宕机后能回溯追踪到被中断的部分。<code>Ext3</code>能够在系统异常宕机时避免文</p>
<p>件系统资料丢失，并能自动修复数据的不一致与错误。然而，当硬盘容量较大时，所需的修复时间也</p>
<p>会很长，而且也不能100%地保证资料不会丢失。</p>
</li>
<li><p><code>Ext4</code>：<code>Ext3</code>的改进版本，作为<code>RHEL 6</code>系统中<strong>默认的文件管理系统</strong>，它支持的存储容量高达</p>
<p><code>1EB</code>（<code>1EB</code>=<code>1,073,741,824GB</code>），且能够有无限多的子目录。另外，<code>Ext4</code>文件系统能够批量分配</p>
<p><code>block</code>（块），从而极大地提高了读写效率。<strong>现在很多主流服务器也会使用<code>Ext4</code>文件系统。</strong></p>
</li>
<li><p><code>XFS</code>：是一种高性能的日志文件系统，而且是<code>RHEL 7/8</code>中默认的文件管理系统。<strong>它的优势在发生意</strong></p>
<p><strong>外宕机后尤其明显，即可以快速地恢复可能被破坏的文件，而且强大的日志功能只需花费极低的</strong></p>
<p><strong>计算和存储性能</strong>。它支持的最大存储容量为<code>18EB</code>，这几乎满足了所有需求。</p>
</li>
</ul>
</blockquote>
<blockquote>
<p><strong>在拿到一块新的硬盘存储设备后，先需要分区，然后再格式化文件系统，最后才能挂载并正常使用。硬</strong></p>
<p><strong>盘的分区操作取决于您的需求和硬盘大小；也可以选择不进行分区，但是必须对硬盘进行格式化处理</strong></p>
</blockquote>
<h3 id="7-4、挂载硬件设备"><a href="#7-4、挂载硬件设备" class="headerlink" title="7.4、挂载硬件设备"></a>7.4、挂载硬件设备</h3><p><code>mount</code>命令用于挂载文件系统，格式为“<code>mount</code>文件系统 挂载目录“。</p>
<blockquote>
<p> <code>mount</code>命令中的参数以及作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-a</code></td>
<td>挂载所有在<code>/etc/fstab</code>中定义的文件系统</td>
</tr>
<tr>
<td><code>-t</code></td>
<td>指定文件系统的类型</td>
</tr>
</tbody></table>
<blockquote>
<p>设备<code>/dev/sdb2</code>挂载到<code>/backup</code>目录，只需要在<code>mount</code>命令中填写设备与挂载目录参数就行，系统会自</p>
<p>动判断要挂载文件的类型，命令如下</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mount /dev/sdb2 /backup</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>如果在工作中要挂载一块网络存储设备，该设备的名字可能会变来变去，这样再写为<code>sdb</code>就不太合适</p>
<p>了。这时推荐用<code>UUID</code>（<code>Universally Unique Identifier</code>，通用唯一识别码）进行挂载操作。<code>UUID</code></p>
<p>是一串用于标识每块独立硬盘的字符串，具有唯一性及稳定性，特别适合用来挂载网络设备。那么，怎</p>
<p>么才能得知独立硬盘的<code>UUID</code>呢？答案是使用<code>blkid</code>命令</p>
</blockquote>
<blockquote>
<p><code>blkid</code>命令用于显示设备的属性信息，英文全称为“<code>block id</code>”，语法格式为“<code>blkid</code> [设备名]”。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># blkid</span>
/dev/sdb1: UUID<span class="token operator">=</span><span class="token string">"2db66eb4-d9c1-4522-8fab-ac074cd3ea0b"</span> TYPE<span class="token operator">=</span><span class="token string">"xfs"</span> PARTUUID<span class="token operator">=</span><span class="token string">"eb23857a-01"</span>
/dev/sdb2: UUID<span class="token operator">=</span><span class="token string">"478fRb-1pOc-oPXv-fJOS-tTvH-KyBz-VaKwZG"</span> TYPE<span class="token operator">=</span><span class="token string">"ext4"</span> PARTUUID<span class="token operator">=</span><span class="token string">"eb23857a-02"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>有了设备的<code>UUID</code>值之后，就可以用它挂载网络设备了</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mount UUID=478fRb-1pOc-oPXv-fJOS-tTvH-KyBz-VaKwZG /backup</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>按照上面的方法执行<code>mount</code>命令后就能立即使用文件系统了，但系统在重启后挂载就会失效，也就是说</p>
<p>需要每次开机后都手动挂载一下。这肯定不是我们想要的效果，如果想让硬件设备和目录永久地进行自</p>
<p>动关联，就必须<strong>把挂载信息按照指定的填写格式“设备文件 挂载目录 格式类型 权限选项 是否备份 是否</strong></p>
<p><strong>自检”写入到<code>/etc/fstab</code>文件中</strong></p>
</blockquote>
<blockquote>
<p>用于挂载信息的指定填写格式中，各字段所表示的意义</p>
</blockquote>
<table>
<thead>
<tr>
<th>字段</th>
<th>意义</th>
</tr>
</thead>
<tbody><tr>
<td>设备文件</td>
<td>一般为设备的路径+设备名称，也可以写唯一识别码（<code>UUID</code>，<code>Universally Unique Identifier</code>）</td>
</tr>
<tr>
<td>挂载目录</td>
<td>指定要挂载到的目录，需在挂载前创建好</td>
</tr>
<tr>
<td>格式类型</td>
<td>指定文件系统的格式，比如<code>Ext3</code>、<code>Ext4</code>、<code>XFS</code>、<code>SWAP</code>、<code>iso9660</code>（此为光盘设备）等</td>
</tr>
<tr>
<td>权限选项</td>
<td>若设置为<code>defaults</code>，则默认权限为：<code>rw</code>, <code>suid,</code> <code>dev</code>, <code>exec</code>, <code>auto</code>, <code>nouser</code>, <code>async</code></td>
</tr>
<tr>
<td>是否备份</td>
<td>若为1则开机后使用<code>dump</code>进行磁盘备份，为0则不备份</td>
</tr>
<tr>
<td>是否自检</td>
<td>若为1则开机后自动进行磁盘自检，为0则不自检</td>
</tr>
</tbody></table>
<blockquote>
<p>如果想将文件系统为<code>Ext4</code>的硬件设备<code>/dev/sdb2</code>在开机后自动挂载到<code>/backup</code>目录上，并保持默认权</p>
<p>限且无须开机自检，就需要在<code>/etc/fstab</code>文件中写入下面的信息，这样在系统重启后也会成功挂载。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/fstab</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># /etc/fstab</span>
<span class="token comment" spellcheck="true"># Created by anaconda on Tue Jul 21 05:03:40 2020</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Accessible filesystems, by reference, are maintained under '/dev/disk/'.</span>
<span class="token comment" spellcheck="true"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># After editing this file, run 'systemctl daemon-reload' to update systemd</span>
<span class="token comment" spellcheck="true"># units generated from this file.</span>
<span class="token comment" spellcheck="true">#</span>
/dev/mapper/rhel-root                     /        xfs     defaults    0 0
UUID<span class="token operator">=</span>812b1f7c-8b5b-43da-8c06-b9999e0fe48b /boot    xfs     defaults    0 0
/dev/mapper/rhel-swap                     swap     swap    defaults    0 0
/dev/sdb2                                 /backup  ext4    defaults    0 0
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>写入到<code>/etc/fstab</code>文件中的设备信息并不会立即生效，需要使用<code>mount -a</code>参数进行自动挂载</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mount -a</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p><code>umount</code>命令用于卸载设备或文件系统，英文全称为“<code>un mount</code>”，语法格式为“<code>umount </code>[设备文件/挂载目录]”</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># umount /dev/sdb2</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p><code>lsblk</code>命令用于查看已挂载的磁盘的空间使用情况，英文全称为“<code>list block id</code>”</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># lsblk </span>
NAME          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda             8:0    0   20G  0 disk 
├─sda1          8:1    0    1G  0 part /boot
└─sda2          8:2    0   19G  0 part 
  ├─rhel-root 253:0    0   17G  0 lvm  /
  └─rhel-swap 253:1    0    2G  0 lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
sr0            11:0    1  6.6G  0 rom  /media/cdrom
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="7-5、添加硬盘设备（虚拟机操作）"><a href="#7-5、添加硬盘设备（虚拟机操作）" class="headerlink" title="7.5、添加硬盘设备（虚拟机操作）"></a>7.5、添加硬盘设备（虚拟机操作）</h3><h4 id="7-5-1、添加硬盘设备"><a href="#7-5-1、添加硬盘设备" class="headerlink" title="7.5.1、添加硬盘设备"></a>7.5.1、添加硬盘设备</h4><blockquote>
<p>首先把虚拟机系统关机，稍等几分钟会自动返回到虚拟机管理主界面，然后单击“编辑虚拟机设置”选项，</p>
<p>在弹出的界面中单击“添加”按钮，新增一块硬件设备</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220817140207275.png"></p>
<blockquote>
<p>选择想要添加的硬件类型为“硬盘”，然后单击“下一步”按钮就可以了，如图所示。这确实没有什么需要</p>
<p>进一步解释的</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220817140233922.png"></p>
<blockquote>
<p>选择虚拟硬盘的类型为<code>SATA</code>，并单击“下一步”按钮，如图所示。这样虚拟机中的设备名称过一会儿后应</p>
<p>该为<code>/dev/sdb</code>。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220817140304449.png"></p>
<blockquote>
<p>选中“创建新虚拟磁盘”单选按钮（而不是其他选项），再次单击“下一步”按钮，如图所示</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220817140327958.png"></p>
<blockquote>
<p>将“最大磁盘大小”设置为默认的<code>20GB</code>。这个数值是限制这台虚拟机所使用的最大硬盘空间，而不是立即</p>
<p>将其填满，因此默认<code>20GB</code>就很合适了。单击“下一步”按钮，如图所示</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220817140415148.png"></p>
<blockquote>
<p>设置磁盘文件的文件名和保存位置（这里采用默认设置即可，无须修改），直接单击“完成”按钮，如图所</p>
<p>示。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220817140440306.png"></p>
<blockquote>
<p>将新硬盘添加好后就可以看到设备信息了。这里不需要做任何修改，直接单击“确定”按钮后就可以启虚拟</p>
<p>机了，如图所示</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220817140509238.png"></p>
<blockquote>
<p>在虚拟机中模拟添加了硬盘设备后就应该能看到抽象后的硬盘设备文件了。按照前文讲解的<code>udev</code>服务命</p>
<p>名规则，第二个被识别的<code>SATA</code>设备应该会被保存为<code>/dev/sdb</code>，这个就是硬盘设备文件了。但在开始使</p>
<p>用该硬盘之前还需要进行分区操作，例如从中取出一个<code>2GB</code>的分区设备以供后面的操作使用</p>
</blockquote>
<h4 id="7-5-2、硬盘设备分区"><a href="#7-5-2、硬盘设备分区" class="headerlink" title="7.5.2、硬盘设备分区"></a>7.5.2、硬盘设备分区</h4><blockquote>
<p><code>fdisk</code>命令用于新建、修改及删除磁盘的分区表信息，英文全称为“<code>format disk</code>”，语法格式为“<code>fdisk</code></p>
<p>磁盘名称”。</p>
<p>在<code>Linux</code>系统中，管理硬盘设备最常用的方法就当属<code>fdisk</code>命令了。它提供了集<strong>添加、删除、转换</strong>分区</p>
<p>等功能于一身的“一站式分区服务”。不过与前面的直接写到命令后面的参数不同，这条命令的参数是<strong>交互</strong></p>
<p><strong>式的一问一答的形式</strong>，因此在管理硬盘设备时特别方便，可以根据需求动态调整。</p>
</blockquote>
<blockquote>
<p> <code>fdisk</code>命令中的参数以及作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>m</code></td>
<td>查看全部可用的参数</td>
</tr>
<tr>
<td><code>n</code></td>
<td>添加新的分区</td>
</tr>
<tr>
<td><code>d</code></td>
<td>删除某个分区信息</td>
</tr>
<tr>
<td><code>l</code></td>
<td>列出所有可用的分区类型</td>
</tr>
<tr>
<td><code>t</code></td>
<td>改变某个分区的类型</td>
</tr>
<tr>
<td><code>p</code></td>
<td>查看分区表信息</td>
</tr>
<tr>
<td><code>w</code></td>
<td>保存并退出</td>
</tr>
<tr>
<td><code>q</code></td>
<td>不保存直接退出</td>
</tr>
</tbody></table>
<blockquote>
<p>首先使用<code>fdisk</code>命令来尝试管理<code>/dev/sdb</code>硬盘设备。在看到提示信息后输入参数<code>p</code>来查看硬盘设备内已</p>
<p>有的分区信息，其中包括了<strong>硬盘的容量大小、扇区个数等信息</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># fdisk /dev/sdb</span>

Welcome to <span class="token function">fdisk</span> <span class="token punctuation">(</span>util-linux 2.32.1<span class="token punctuation">)</span>.
Changes will remain <span class="token keyword">in</span> memory only, <span class="token keyword">until</span> you decide to <span class="token function">write</span> them.
Be careful before using the <span class="token function">write</span> command.

Device does not contain a recognized partition table.
Created a new DOS disklabel with disk identifier 0x88b2c2b0.

Command <span class="token punctuation">(</span>m <span class="token keyword">for</span> help<span class="token punctuation">)</span>: p
Disk /dev/sdb: 20 GiB, 21474836480 bytes, 41943040 sectors
Units: sectors of 1 * 512 <span class="token operator">=</span> 512 bytes
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512 bytes / 512 bytes
I/O size <span class="token punctuation">(</span>minimum/optimal<span class="token punctuation">)</span>: 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x88b2c2b0
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>输入参数<code>n</code>尝试添加新的分区。系统会要求用户是选择继续输入参数<code>p</code>来创建<strong>主分区</strong>，还是输入参数<code>e</code>来</p>
<p>创建<strong>扩展分区</strong>。这里输入参数p来创建一个主分区</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">Command <span class="token punctuation">(</span>m <span class="token keyword">for</span> help<span class="token punctuation">)</span>: n
Partition <span class="token function">type</span>
   p   primary <span class="token punctuation">(</span>0 primary, 0 extended, 4 free<span class="token punctuation">)</span>
   e   extended <span class="token punctuation">(</span>container <span class="token keyword">for</span> logical partitions<span class="token punctuation">)</span>
Select <span class="token punctuation">(</span>default p<span class="token punctuation">)</span>: p
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>在<strong>确认创建一个主分区后</strong>，系统要求用户先输入<strong>主分区的编号</strong>。在前文得知，主分区的编号范围是</p>
<p>1～4，因此这里输入默认的1就可以了。</p>
<p>接下来系统会提示定<strong>义起始的扇区位置</strong>，这不需要改动，敲击回车键保留默认设置即可，系统会自动计</p>
<p>算出最靠前的空闲扇区的位置。最后，系统会要求定义分区的结束扇区位置，这其实就是要去定义整个</p>
<p>分区的大小是多少。我们不用去计算扇区的个数，只需要输入<code>+2G</code>即可创建出一个容量为<code>2GB</code>的硬盘分</p>
<p>区</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">Partition number <span class="token punctuation">(</span>1-4, default 1<span class="token punctuation">)</span>: 1
First sector <span class="token punctuation">(</span>2048-41943039, default 2048<span class="token punctuation">)</span>: 此处敲击回车即可
Last sector, +sectors or +size<span class="token punctuation">{</span>K,M,G,T,P<span class="token punctuation">}</span> <span class="token punctuation">(</span>2048-41943039, default 41943039<span class="token punctuation">)</span>: +2G

Created a new partition 1 of <span class="token function">type</span> <span class="token string">'Linux'</span> and of size 2 GiB.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>再次使用参数<code>p</code>来查看硬盘设备中的分区信息。果然就能看到一个名称为<code>/dev/sdb1</code>、起始扇区位置为</p>
<p>2048、结束扇区位置为4196351的主分区了。这时千万不要直接关闭窗口，而应该敲击参数<code>w</code>后按回车</p>
<p>键，这样分区信息才是真正地写入成功啦</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">Command <span class="token punctuation">(</span>m <span class="token keyword">for</span> help<span class="token punctuation">)</span>: p
Disk /dev/sdb: 20 GiB, 21474836480 bytes, 41943040 sectors
Units: sectors of 1 * 512 <span class="token operator">=</span> 512 bytes
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512 bytes / 512 bytes
I/O size <span class="token punctuation">(</span>minimum/optimal<span class="token punctuation">)</span>: 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x88b2c2b0

Device     Boot Start     End Sectors Size Id Type
/dev/sdb1        2048 4196351 4194304   2G 83 Linux

Command <span class="token punctuation">(</span>m <span class="token keyword">for</span> help<span class="token punctuation">)</span>: w
The partition table has been altered.
Calling ioctl<span class="token punctuation">(</span><span class="token punctuation">)</span> to re-read partition table.
Syncing disks.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>分区信息中第<code>6</code>个字段的<code>Id</code>值是一个编码，用于标识该分区的作用，可帮助用户快速了解该分区的作</p>
<p>用，一般没必要修改。使用<code>l</code>参数查看一下磁盘编码都有哪些，然后在<code>7.6</code>节进行<code>SWAP</code>操作时再修改吧</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">Command <span class="token punctuation">(</span>m <span class="token keyword">for</span> help<span class="token punctuation">)</span>: l  

 0  Empty           24  NEC DOS         81  Minix / old Lin bf  Solaris        
 1  FAT12           27  Hidden NTFS Win 82  Linux swap / So c1  DRDOS/sec <span class="token punctuation">(</span>FAT-
 2  XENIX root      39  Plan 9          83  Linux           c4  DRDOS/sec <span class="token punctuation">(</span>FAT-
 3  XENIX usr       3c  PartitionMagic  84  OS/2 hidden or  c6  DRDOS/sec <span class="token punctuation">(</span>FAT-
 4  FAT16 <span class="token operator">&lt;</span>32M      40  Venix 80286     85  Linux extended  c7  Syrinx         
 5  Extended        41  PPC PReP Boot   86  NTFS volume <span class="token keyword">set</span> da  Non-FS data    
 6  FAT16           42  SFS             87  NTFS volume <span class="token keyword">set</span> db  CP/M / CTOS / <span class="token keyword">.</span>
 7  HPFS/NTFS/exFAT 4d  QNX4.x          88  Linux plaintext de  Dell Utility   
 8  AIX             4e  QNX4.x 2nd part 8e  Linux LVM       <span class="token function">df</span>  BootIt         
 9  AIX bootable    4f  QNX4.x 3rd part 93  Amoeba          e1  DOS access     
 a  OS/2 Boot Manag 50  OnTrack DM      94  Amoeba BBT      e3  DOS R/O        
 b  W95 FAT32       51  OnTrack DM6 Aux 9f  BSD/OS          e4  SpeedStor      
 c  W95 FAT32 <span class="token punctuation">(</span>LBA<span class="token punctuation">)</span> 52  CP/M            a0  IBM Thinkpad hi ea  Rufus alignment
 e  W95 FAT16 <span class="token punctuation">(</span>LBA<span class="token punctuation">)</span> 53  OnTrack DM6 Aux a5  FreeBSD         eb  BeOS fs        
 f  W95 Ext'd <span class="token punctuation">(</span>LBA<span class="token punctuation">)</span> 54  OnTrackDM6      a6  OpenBSD         ee  GPT            
10  OPUS            55  EZ-Drive        a7  NeXTSTEP        ef  EFI <span class="token punctuation">(</span>FAT-12/16/
11  Hidden FAT12    56  Golden Bow      a8  Darwin UFS      f0  Linux/PA-RISC b
12  Compaq diagnost 5c  Priam Edisk     a9  NetBSD          f1  SpeedStor      
14  Hidden FAT16 <span class="token operator">&lt;</span>3 61  SpeedStor       ab  Darwin boot     f4  SpeedStor      
16  Hidden FAT16    63  GNU HURD or Sys af  HFS / HFS+      f2  DOS secondary  
17  Hidden HPFS/NTF 64  Novell Netware  b7  BSDI fs         fb  VMware VMFS    
18  AST SmartSleep  65  Novell Netware  b8  BSDI swap       fc  VMware VMKCORE 
1b  Hidden W95 FAT3 70  DiskSecure Mult bb  Boot Wizard hid fd  Linux raid auto
1c  Hidden W95 FAT3 75  PC/IX           <span class="token function">bc</span>  Acronis FAT32 L fe  LANstep        
1e  Hidden W95 FAT1 80  Old Minix       be  Solaris boot    ff  BBT  
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>在上述步骤执行完毕之后，Linux系统会自动把这个硬盘主分区抽象成<code>/dev/sdb1</code>设备文件。可以使用</p>
<p><code>file</code>命令<strong>查看该文件的属性</strong>，有些时候系统并没有自动把分区信息同步给<code>Linux</code>内核，而且这种情况似</p>
<p>乎还比较常见（但不能算作严重的<code>bug</code>）。可以输入<code>partprobe</code>命令手动将分区信息同步到内核，而且</p>
<p>一般推荐连续两次执行该命令，效果会更好。如果使用这个命令都无法解决问题，那么就重启计算机</p>
<p>吧，这个“杀手锏”百试百灵，一定会有用的</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe <span class="token punctuation">]</span><span class="token comment" spellcheck="true"># file /dev/sdb1</span>
/dev/sdb1: cannot <span class="token function">open</span> `/dev/sdb1' <span class="token punctuation">(</span>No such <span class="token function">file</span> or directory<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@linuxprobe <span class="token punctuation">]</span><span class="token comment" spellcheck="true"># partprobe</span>
<span class="token punctuation">[</span>root@linuxprobe <span class="token punctuation">]</span><span class="token comment" spellcheck="true"># partprobe</span>
<span class="token punctuation">[</span>root@linuxprobe <span class="token punctuation">]</span><span class="token comment" spellcheck="true"># file /dev/sdb1</span>
/dev/sdb1: block special
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>如果硬件存储设备没有进行格式化，则Linux系统无法得知怎么在其上写入数据。因此，在对存储设备进</p>
<p>行分区后还需要进行格式化操作。在Linux系统中用于格式化操作的命令是<code>mkfs</code>。这条命令很有意思，</p>
<p>因为在<code>Shell终端中</code>输入<code>mkfs</code>名后再敲击两下用于补齐命令的Tab键，会有如下所示的效果</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkfs</span>
mkfs         mkfs.ext2    mkfs.ext4    mkfs.minix   mkfs.vfat    
mkfs.cramfs  mkfs.ext3    mkfs.fat     mkfs.msdos   mkfs.xfs 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>这个<code>mkfs</code>命令很贴心地把常用的文件系统名称用后缀的方式保存成了多个命令文件，用起来也非常简单</p>
<p>——-&gt;<code>mkfs</code>.文件类型名称。例如要将分区为<code>XFS</code>的文件系统进行格式化，</p>
<p>则命令应为<code>mkfs.xfs /dev/sdb1</code></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">oot@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkfs.xfs /dev/sdb1</span>
meta-data<span class="token operator">=</span>/dev/sdb1              isize<span class="token operator">=</span>512    agcount<span class="token operator">=</span>4, agsize<span class="token operator">=</span>131072 blks
         <span class="token operator">=</span>                       sectsz<span class="token operator">=</span>512   attr<span class="token operator">=</span>2, projid32bit<span class="token operator">=</span>1
         <span class="token operator">=</span>                       crc<span class="token operator">=</span>1        finobt<span class="token operator">=</span>1, sparse<span class="token operator">=</span>1, rmapbt<span class="token operator">=</span>0
         <span class="token operator">=</span>                       reflink<span class="token operator">=</span>1
data     <span class="token operator">=</span>                       bsize<span class="token operator">=</span>4096   blocks<span class="token operator">=</span>524288, imaxpct<span class="token operator">=</span>25
         <span class="token operator">=</span>                       sunit<span class="token operator">=</span>0      swidth<span class="token operator">=</span>0 blks
naming   <span class="token operator">=</span>version 2              bsize<span class="token operator">=</span>4096   ascii-ci<span class="token operator">=</span>0, ftype<span class="token operator">=</span>1
log      <span class="token operator">=</span>internal log           bsize<span class="token operator">=</span>4096   blocks<span class="token operator">=</span>2560, version<span class="token operator">=</span>2
         <span class="token operator">=</span>                       sectsz<span class="token operator">=</span>512   sunit<span class="token operator">=</span>0 blks, lazy-count<span class="token operator">=</span>1
realtime <span class="token operator">=</span>none                   extsz<span class="token operator">=</span>4096   blocks<span class="token operator">=</span>0, rtextents<span class="token operator">=</span>0
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>然后使用<code>mount</code>命令将存储设备与挂载点进行关联；最后使用<code>df -h</code>命令来查看挂载状态和硬盘使用量</p>
<p>信息。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir /newFS</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mount /dev/sdb1 /newFS</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># df -h</span>
Filesystem             Size  Used Avail Use% Mounted on
devtmpfs               969M     0  969M   0% /dev
tmpfs                  984M     0  984M   0% /dev/shm
tmpfs                  984M  9.6M  974M   1% /run
tmpfs                  984M     0  984M   0% /sys/fs/cgroup
/dev/mapper/rhel-root   17G  3.9G   14G  23% /
/dev/sr0               6.7G  6.7G     0 100% /media/cdrom
/dev/sda1             1014M  152M  863M  15% /boot
tmpfs                  197M   16K  197M   1% /run/user/42
tmpfs                  197M  3.5M  194M   2% /run/user/0
/dev/sdb1              2.0G   47M  2.0G   3% /newFS
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="7-6、添加交换分区"><a href="#7-6、添加交换分区" class="headerlink" title="7.6、添加交换分区"></a>7.6、添加交换分区</h3><blockquote>
<p>交换（<code>SWAP</code>）分区是一种通过在硬盘中预先划分一定的空间，然后把内存中暂时不常用的数据临时存放</p>
<p>到硬盘中，以便腾出物理内存空间让更活跃的程序服务来使用的技术，其设计目的是为了解决真实物理</p>
<p>内存不足的问题。通俗来讲就是让硬盘帮内存分担压力。但由于交换分区毕竟是通过硬盘设备读写数据</p>
<p>的，速度肯定要比物理内存慢，所以只有当真实的物理内存耗尽后才会调用交换分区的资源。</p>
</blockquote>
<blockquote>
<p>在对<code>/dev/sdb</code>存储设备进行分区操作前，有必要先说一下交换分区的划分建议：<strong>在生产环境中，交换分</strong></p>
<p><strong>区的大小一般为真实物理内存的1.5～2倍</strong>。为了让大家更明显地感受交换分区空间的变化，这里取出一</p>
<p>个大小为<code>5GB</code>的主分区作为交换分区资源</p>
</blockquote>
<blockquote>
<p> 创建分区</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># fdisk /dev/sdb</span>
Welcome to <span class="token function">fdisk</span> <span class="token punctuation">(</span>util-linux 2.32.1<span class="token punctuation">)</span>.
Changes will remain <span class="token keyword">in</span> memory only, <span class="token keyword">until</span> you decide to <span class="token function">write</span> them.
Be careful before using the <span class="token function">write</span> command.

Command <span class="token punctuation">(</span>m <span class="token keyword">for</span> help<span class="token punctuation">)</span>: n
Partition <span class="token function">type</span>
   p   primary <span class="token punctuation">(</span>1 primary, 0 extended, 3 free<span class="token punctuation">)</span>
   e   extended <span class="token punctuation">(</span>container <span class="token keyword">for</span> logical partitions<span class="token punctuation">)</span>
Select <span class="token punctuation">(</span>default p<span class="token punctuation">)</span>: p
Partition number <span class="token punctuation">(</span>2-4, default 2<span class="token punctuation">)</span>: 敲击回车即可
First sector <span class="token punctuation">(</span>4196352-41943039, default 4196352<span class="token punctuation">)</span>: 敲击回车即可
Last sector, +sectors or +size<span class="token punctuation">{</span>K,M,G,T,P<span class="token punctuation">}</span> <span class="token punctuation">(</span>4196352-41943039, default 41943039<span class="token punctuation">)</span>: +5G

Created a new partition 2 of <span class="token function">type</span> <span class="token string">'Linux'</span> and of size 5 GiB.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>在上面的操作结束后，我们就得到了一个容量为<code>5GB</code>的新分区。然后尝试修改硬盘的标识码，这里将其</p>
<p>改成82（<code>Linux swap</code>）以方便以后知道它的作用</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">Command <span class="token punctuation">(</span>m <span class="token keyword">for</span> help<span class="token punctuation">)</span>: t
Partition number <span class="token punctuation">(</span>1,2, default 2<span class="token punctuation">)</span>: 2
Hex code <span class="token punctuation">(</span>type L to list all codes<span class="token punctuation">)</span>: 82

Changed <span class="token function">type</span> of partition <span class="token string">'Linux'</span> to <span class="token string">'Linux swap / Solaris'</span><span class="token keyword">.</span>

Command <span class="token punctuation">(</span>m <span class="token keyword">for</span> help<span class="token punctuation">)</span>: p 
Disk /dev/sdb: 20 GiB, 21474836480 bytes, 41943040 sectors
Units: sectors of 1 * 512 <span class="token operator">=</span> 512 bytes
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: 512 bytes / 512 bytes
I/O size <span class="token punctuation">(</span>minimum/optimal<span class="token punctuation">)</span>: 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x88b2c2b0

Device     Boot   Start      End  Sectors Size Id Type
/dev/sdb1          2048  4196351  4194304   2G 83 Linux
/dev/sdb2       4196352 14682111 10485760   5G 82 Linux swap / Solaris
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>敲击<code>w</code>参数退出分区表编辑工具</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">Command <span class="token punctuation">(</span>m <span class="token keyword">for</span> help<span class="token punctuation">)</span>: w
The partition table has been altered.
Calling ioctl<span class="token punctuation">(</span><span class="token punctuation">)</span> to re-read partition table.
Syncing disks.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>mkswap</code>命令用于对新设备进行交换分区格式化，英文全称为“<code>make swap</code>”，语法格式为“<code>mkswap</code>设备名</p>
<p>称”</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkswap /dev/sdb2</span>
Setting up swapspace version 1, size <span class="token operator">=</span> 5 GiB <span class="token punctuation">(</span>5368705024 bytes<span class="token punctuation">)</span>
no label, UUID<span class="token operator">=</span>45a4047c-49bf-4c88-9b99-f6ac93908485
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>swapon</code>命令用于激活新的交换分区设备，英文全称为“<code>swap on</code>”，语法格式为“<code>swapon</code>设备名称”</p>
<p>使用<code>swapon</code>命令把准备好的<code>SWAP</code>硬盘设备正式挂载到系统中。可以使用<code>free -m</code>命令查看交换分区的</p>
<p>大小变化</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># free -m</span>
              total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:           1966        1391         105          12         469         384
Swap:          2047           9        2038
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># swapon /dev/sdb2</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># free -m</span>
              total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:           1966        1395         101          12         469         380
Swap:          7167           9        7158
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>为了能够让新的交换分区设备在重启后依然生效，需要按照下面的格式将相关信息写入配置文件中，并</p>
<p>记得保存</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/fstab</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># /etc/fstab</span>
<span class="token comment" spellcheck="true"># Created by anaconda on Tue Jul 21 05:03:40 2020</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Accessible filesystems, by reference, are maintained under '/dev/disk/'.</span>
<span class="token comment" spellcheck="true"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># After editing this file, run 'systemctl daemon-reload' to update systemd</span>
<span class="token comment" spellcheck="true"># units generated from this file.</span>
<span class="token comment" spellcheck="true">#</span>
/dev/mapper/rhel-root                        /               xfs        defaults    1 1
UUID<span class="token operator">=</span>812b1f7c-8b5b-43da-8c06-b9999e0fe48b    /boot           xfs        defaults    1 2
/dev/mapper/rhel-swap                        swap            swap       defaults    0 0
/dev/cdrom                                   /media/cdrom    iso9660    defaults    0 0 
/dev/sdb1                                    /newFS          xfs        defaults    0 0 
/dev/sdb2                                    swap            swap       defaults    0 0 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="7-7、磁盘容量配额"><a href="#7-7、磁盘容量配额" class="headerlink" title="7.7、磁盘容量配额"></a>7.7、磁盘容量配额</h3><blockquote>
<p><code>root</code>管理员需要<strong>使用磁盘容量配额服务来限制某位用户或某个用户组针对特定文件夹可以使用的最大硬</strong></p>
<p><strong>盘空间或最大文件个数</strong>，一旦达到这个最大值就不再允许继续使用。可以使用<code>quota</code>技术进行磁盘容量</p>
<p>配额管理，从而限制用户的硬盘可用容量或所能创建的最大文件个数。<code>quota</code>技术还有<strong>软限制</strong>和<strong>硬限制</strong></p>
<p>的功能。</p>
<ul>
<li><strong>软限制</strong>：当达到软限制时会提示用户，但仍允许用户在限定的额度内<strong>继续使用</strong>。</li>
<li><strong>硬限制</strong>：当达到硬限制时会提示用户，且强制终止用户的操作。</li>
</ul>
</blockquote>
<blockquote>
<p><code>RHEL 8</code>系统中已经安装了<code>quota</code>磁盘容量配额服务程序包，但存储设备却默认没有开启对<code>quota</code>技术的</p>
<p>支持，此时需要手动编辑配置文件并重启一次系统，让系统中的启动目录（<code>/boot</code>）能够支持<code>quota</code>磁</p>
<p>盘配额技术</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/fstab</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># /etc/fstab</span>
<span class="token comment" spellcheck="true"># Created by anaconda on Tue Jul 21 05:03:40 2020</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Accessible filesystems, by reference, are maintained under '/dev/disk/'.</span>
<span class="token comment" spellcheck="true"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># After editing this file, run 'systemctl daemon-reload' to update systemd</span>
<span class="token comment" spellcheck="true"># units generated from this file.</span>
<span class="token comment" spellcheck="true">#</span>
/dev/mapper/rhel-root                        /             xfs        defaults         1 1
UUID<span class="token operator">=</span>812b1f7c-8b5b-43da-8c06-b9999e0fe48b    /boot         xfs        defaults,uquota  1 2
/dev/mapper/rhel-swap                        swap          swap       defaults         0 0
/dev/cdrom                                   /media/cdrom  iso9660    defaults         0 0 
/dev/sdb1                                    /newFS        xfs        defaults         0 0 
/dev/sdb2                                    swap          swap       defaults         0 0 
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># reboot</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>在重启系统后使用<code>mount</code>命令查看，即可发现<code>/boot</code>目录已经支持<code>quota</code>磁盘配额技术了</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mount | grep boot</span>
/dev/sda1 on /boot <span class="token function">type</span> xfs <span class="token punctuation">(</span>rw,relatime,seclabel,attr2,inode64,usrquota<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>接下来创建一个用于检查<code>quota</code>磁盘容量配额效果的用户<code>tom</code>，并针对<code>/boot</code>目录增加其他人的写权</p>
<p>限，保证用户能够正常写入数据</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># useradd tom</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># chmod -R o+w /boot</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p><code>xfs_quota</code>命令用于<strong>管理设备的磁盘容量配额</strong>，语法格式为“<code>xfs_quota</code> [参数] 配额 文件系统”。</p>
</blockquote>
<blockquote>
<p>这是一个专门针对<code>XFS</code>文件系统来管理<code>quota</code>磁盘容量配额服务而设计的命令。其中，<code>-c</code>参数用于以参</p>
<p>数的形式设置要执行的命令；<code>-x</code>参数是专家模式，让运维人员能够对<code>quota</code>服务进行更多复杂的配置。</p>
<p>接下来使用<code>xfs_quota</code>命令来设置用户<code>tom</code>对<code>/boot</code>目录的<code>quota</code>磁盘容量配额。具体的限额控制包</p>
<p>括：<strong>硬盘使用量</strong>的软限制和硬限制分别为<code>3MB</code>和<code>6MB</code>；<strong>创建文件数量</strong>的软限制和硬限制分别为3个和6</p>
<p>个。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># xfs_quota -x -c 'limit bsoft=3m bhard=6m isoft=3 ihard=6 tom' /boot</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># xfs_quota -x -c report /boot</span>
User <span class="token function">quota</span> on /boot <span class="token punctuation">(</span>/dev/sda1<span class="token punctuation">)</span>
                               Blocks                     
User ID          Used       Soft       Hard    Warn/Grace     
---------- -------------------------------------------------- 
root           114964          0          0     00 <span class="token punctuation">[</span>--------<span class="token punctuation">]</span>
tom                 0       3072       6144     00 <span class="token punctuation">[</span>--------<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>bsoft</code>和<code>bhard</code>则是代表文件所占用的block大小，也就是文件占用的最大容量的总统计</p>
</blockquote>
<blockquote>
<p>当配置好上述各种软硬限制后，尝试切换到一个普通用户，然后分别尝试创建一个体积为<code>5MB</code>和<code>8MB</code>的</p>
<p>文件。可以发现，在创建<code>8MB</code>的文件时受到了系统限制</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># su - tom</span>
<span class="token punctuation">[</span>tom@linuxprobe ~<span class="token punctuation">]</span>$ <span class="token function">cd</span> /boot
<span class="token punctuation">[</span>tom@linuxprobe boot<span class="token punctuation">]</span>$ <span class="token function">dd</span> if<span class="token operator">=</span>/dev/zero of<span class="token operator">=</span>/boot/tom bs<span class="token operator">=</span>5M count<span class="token operator">=</span>1
1+0 records <span class="token keyword">in</span>
1+0 records out
5242880 bytes <span class="token punctuation">(</span>5.2 MB, 5.0 MiB<span class="token punctuation">)</span> copied, 0.00298178 s, 1.8 GB/s
<span class="token punctuation">[</span>tom@linuxprobe boot<span class="token punctuation">]</span>$ <span class="token function">dd</span> if<span class="token operator">=</span>/dev/zero of<span class="token operator">=</span>/boot/tom bs<span class="token operator">=</span>8M count<span class="token operator">=</span>1
dd: error writing <span class="token string">'/boot/tom'</span><span class="token keyword">:</span> Disk <span class="token function">quota</span> exceeded
1+0 records <span class="token keyword">in</span>
0+0 records out
4194304 bytes <span class="token punctuation">(</span>4.2 MB, 4.0 MiB<span class="token punctuation">)</span> copied, 0.00398607 s, 1.1 GB/s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>edquota</code>命令用于管理系统的磁盘配额，英文全称为“<code>edit quota</code>”，语法格式为“<code>edquota</code> [参数] 用户</p>
<p>名”</p>
<p>在为用户设置了<code>quota</code>磁盘容量配额限制后，可以使用<code>edquota</code>命令按需修改限额的数值。其中，<code>-u</code>参</p>
<p>数表示要针对哪个用户进行设置；<code>-g</code>参数表示要针对哪个用户组进行设置，如表所示。</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-u</code></td>
<td>对某个用户进行设置</td>
</tr>
<tr>
<td><code>-g</code></td>
<td>对某个用户组进行设置</td>
</tr>
<tr>
<td><code>-p</code></td>
<td>复制原有的规则到新的用户/组</td>
</tr>
<tr>
<td><code>-t</code></td>
<td>限制宽限期限</td>
</tr>
</tbody></table>
<blockquote>
<p> <code>edquota</code>命令会调用<code>Vi</code>或<code>Vim</code>编辑器来让<code>root</code>管理员修改要限制的具体细节，记得用<code>wq</code>保存退出。</p>
<p>下面把用户<code>tom</code>的硬盘使用量的硬限额从<code>5MB</code>提升到<code>8MB</code></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>tom@linuxprobe ~<span class="token punctuation">]</span>$ <span class="token keyword">exit</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># edquota -u tom</span>
Disk quotas <span class="token keyword">for</span> user tom <span class="token punctuation">(</span>uid 1001<span class="token punctuation">)</span>:
  Filesystem                   blocks       soft       hard     inodes     soft     hard
  /dev/sda1                      4096       3072       8192          1        3        6
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># su - tom</span>
<span class="token punctuation">[</span>tom@linuxprobe ~<span class="token punctuation">]</span>$ <span class="token function">cd</span> /boot
<span class="token punctuation">[</span>tom@linuxprobe boot<span class="token punctuation">]</span>$ <span class="token function">dd</span> if<span class="token operator">=</span>/dev/zero of<span class="token operator">=</span>/boot/tom bs<span class="token operator">=</span>8M count<span class="token operator">=</span>1
1+0 records <span class="token keyword">in</span>
1+0 records out
8388608 bytes <span class="token punctuation">(</span>8.4 MB, 8.0 MiB<span class="token punctuation">)</span> copied, 0.0185476 s, 452 MB/s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="7-8、VDO虚拟数据优化"><a href="#7-8、VDO虚拟数据优化" class="headerlink" title="7.8、VDO虚拟数据优化"></a>7.8、<code>VDO</code>虚拟数据优化</h3><blockquote>
<p><code>VDO</code>（<code>Virtual Data Optimize</code>，虚拟数据优化）是一种通过压缩或删除存储设备上的数据来优化存储</p>
<p>空间的技术。<code>VDO</code>技术的关键就是<strong>对硬盘内原有的数据进行删重操作</strong>，它有点类似于我们平时使用的网</p>
<p>盘服务，在第一次正常上传文件时速度特别慢，在第二次上传相同的文件时仅作为一个数据指针，几乎</p>
<p>可以达到“秒传”的效果，无须再多占用一份空间，也不用再漫长等待。除了删重操作，**<code>VDO</code>技术还可以对**</p>
<p><strong>日志和数据库进行自动压缩</strong>，进一步减少存储浪费的情况。<code>VDO</code>针对各种类型文件的压缩效果如表所</p>
<p>示。</p>
</blockquote>
<blockquote>
<p>对各种类型文件压缩效果汇总表</p>
</blockquote>
<table>
<thead>
<tr>
<th>文件名</th>
<th>描述</th>
<th>类型</th>
<th>原始大小（KB）</th>
<th>实际占用空间（KB）</th>
</tr>
</thead>
<tbody><tr>
<td><code>dickens</code></td>
<td>狄更斯文集</td>
<td>英文原文</td>
<td>9953</td>
<td>9948</td>
</tr>
<tr>
<td><code>mozilla</code></td>
<td><code>Mozilla</code>的<code>1.0</code>可执行文件</td>
<td>执行程序</td>
<td>50020</td>
<td>33228</td>
</tr>
<tr>
<td><code>mr</code></td>
<td>医用<code>resonanse</code>图像</td>
<td>图片</td>
<td>9736</td>
<td>9272</td>
</tr>
<tr>
<td><code>nci</code></td>
<td>结构化的化学数据库</td>
<td>数据库</td>
<td>32767</td>
<td>10168</td>
</tr>
<tr>
<td><code>ooffice</code></td>
<td><code>Open Office.org 1.01 DLL</code></td>
<td>可执行程序</td>
<td>6008</td>
<td>5640</td>
</tr>
<tr>
<td><code>osdb</code></td>
<td>基准测试用的<code>MySQL</code>格式示例数据库</td>
<td>数据库</td>
<td>9849</td>
<td>9824</td>
</tr>
<tr>
<td><code>reymont</code></td>
<td>瓦迪斯瓦夫·雷蒙特的书</td>
<td><code>PDF</code></td>
<td>6471</td>
<td>6312</td>
</tr>
<tr>
<td><code>samba</code></td>
<td><code>samba</code>源代码</td>
<td><code>src</code>源码</td>
<td>21100</td>
<td>11768</td>
</tr>
<tr>
<td><code>sao</code></td>
<td>星空数据</td>
<td>天文格式的<code>bin</code>文件</td>
<td>7081</td>
<td>7036</td>
</tr>
<tr>
<td><code>webster</code></td>
<td>辞海</td>
<td><code>HTML</code></td>
<td>40487</td>
<td>40144</td>
</tr>
<tr>
<td><code>xml</code></td>
<td><code>XML</code>文件</td>
<td><code>HTML</code></td>
<td>5220</td>
<td>2180</td>
</tr>
<tr>
<td><code>x-ray</code></td>
<td>透视医学图片</td>
<td>医院数据</td>
<td>8275</td>
<td>8260</td>
</tr>
</tbody></table>
<blockquote>
<p><code>VDO</code>技术支持本地存储和远程存储，可以作为本地文件系统、<code>iSCSI</code>或<code>Ceph</code>存储下的附加存储层使用。</p>
<p>红帽公司在<code>VDO介</code>绍页面中提到，在部署虚拟机或容器时，建议采<strong>用逻辑存储与物理存储为10∶1的比例</strong></p>
<p><strong>进行配置</strong>，即<code>1TB</code>物理存储对应<code>10TB</code>逻辑存储；而部署对象存储时 （例如使用<code>Ceph</code>）则<strong>采用逻辑存</strong></p>
<p><strong>储与物理存储为3∶1的比例进行配置</strong>，即使用<code>1TB</code>物理存储对应<code>3TB</code>逻辑存储</p>
</blockquote>
<blockquote>
<p>有两种特殊情况需要提前讲一下:</p>
<ol>
<li><p>其一，公司服务器上已有的<code>dm-crypt</code>之类的技术是可以与<code>VDO</code>技术兼容的，但记得要先对卷进行加</p>
<p>密再使用<code>VDO</code>。因为加密会使重复的数据变得有所不同，因此删重操作无法实现。要始终记得把加</p>
<p>密层放到<code>VDO</code>之下，如图所示</p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220817164700045.png"></p>
</li>
<li><p><code>VDO</code>技术不可叠加使用，<code>1TB</code>的物理存储提升成<code>10TB</code>的逻辑存储没问题，但是再用<code>10TB</code>翻成</p>
<p><code>100TB</code>就不行了。左脚踩右脚，真的没法飞起来</p>
</li>
</ol>
</blockquote>
<blockquote>
<p>添加一块容量为<code>20GB</code>的新<code>SATA</code>硬盘进来，开机后就能看到这块名称为<code>/dev/sdc</code>的新硬盘了</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -l /dev/sdc</span>
brw-rw----. 1 root disk 8, 32 Jan 6 22:26 /dev/sdc
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p><code>RHEL/CentOS 8</code>系统中<strong>默认已经启用了<code>VDO</code>技术</strong>。<code>VDO</code>技术现在是红帽公司自己的技术，兼容性自然没</p>
<p>得说。如果您所用的系统没有安装<code>VDO</code>的话也不要着急，用<code>dnf</code>命令即可完成安装</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dnf install kmod-kvdo vdo</span>
Updating Subscription Management repositories.
Unable to <span class="token function">read</span> consumer identity
This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.
Last metadata expiration check: 0:01:56 ago on Wed 06 Jan 2021 10:37:19 PM CST.
Package kmod-kvdo-6.2.0.293-50.el8.x86_64 is already installed.
Package vdo-6.2.0.293-10.el8.x86_64 is already installed.
Dependencies resolved.
Nothing to do.
Complete<span class="token operator">!</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>首先，创建一个全新的<code>VDO</code>卷。</p>
<p>新添加进来的物理设备就是使用<code>vdo</code>命令来管理的，其中<code>name</code>参数代表新的设备卷的名称；</p>
<p><code>device</code>参数代表由哪块磁盘进行制作；</p>
<p><code>vdoLogicalSize</code>参数代表制作后的设备大小。</p>
<p>依据红帽公司推荐的原则，<code>20GB</code>硬盘将翻成<code>200GB</code>的逻辑存储</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vdo create --name=storage --device=/dev/sdc --vdoLogicalSize=200G</span>
Creating VDO storage
Starting VDO storage
Starting compression on VDO storage
VDO instance 0 volume is ready at /dev/mapper/storage
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p> 在创建成功后，使用<code>status</code>参数查看新建卷的概述信息：</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vdo status --name=storage</span>
VDO status:
  Date: <span class="token string">'2021-01-06 22:51:33+08:00'</span>
  Node: linuxprobe.com
Kernel module:
  Loaded: <span class="token boolean">true</span>
  Name: kvdo
  Version information:
    kvdo version: 6.2.0.293
Configuration:
  File: /etc/vdoconf.yml
  Last modified: <span class="token string">'2021-01-06 22:49:33'</span>
VDOs:
  storage:
    Acknowledgement threads: 1
    Activate: enabled
    Bio rotation interval: 64
    Bio submission threads: 4
    Block map cache size: 128M
    Block map period: 16380
    Block size: 4096
    CPU-work threads: 2
    Compression: enabled
    Configured <span class="token function">write</span> policy: auto
    Deduplication: enabled
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>有上可见，在输出信息中包含了<code>VDO</code>卷创建的时间、主机名、版本、是否压缩（<code>Compression</code>）及是否</p>
<p>删重（<code>Deduplication</code>）等关键信息</p>
</blockquote>
<blockquote>
<p>接下来，对新建卷进行格式化操作并挂载使用</p>
<p>新建的<code>VDO</code>卷设备会被乖乖地存放在<code>/dev/mapper</code>目录下，并以设备名称命名，对它操作就行。另外，</p>
<p>挂载前可以用<code>udevadm settle</code>命令对设备进行<strong>一次刷新操作</strong>，避免刚才的配置没有生效</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkfs.xfs /dev/mapper/storage </span>
meta-data<span class="token operator">=</span>/dev/mapper/storage    isize<span class="token operator">=</span>512    agcount<span class="token operator">=</span>4, agsize<span class="token operator">=</span>13107200 blks
         <span class="token operator">=</span>                       sectsz<span class="token operator">=</span>4096  attr<span class="token operator">=</span>2, projid32bit<span class="token operator">=</span>1
         <span class="token operator">=</span>                       crc<span class="token operator">=</span>1        finobt<span class="token operator">=</span>1, sparse<span class="token operator">=</span>1, rmapbt<span class="token operator">=</span>0
         <span class="token operator">=</span>                       reflink<span class="token operator">=</span>1
data     <span class="token operator">=</span>                       bsize<span class="token operator">=</span>4096   blocks<span class="token operator">=</span>52428800, imaxpct<span class="token operator">=</span>25
         <span class="token operator">=</span>                       sunit<span class="token operator">=</span>0      swidth<span class="token operator">=</span>0 blks
naming   <span class="token operator">=</span>version 2              bsize<span class="token operator">=</span>4096   ascii-ci<span class="token operator">=</span>0, ftype<span class="token operator">=</span>1
log      <span class="token operator">=</span>internal log           bsize<span class="token operator">=</span>4096   blocks<span class="token operator">=</span>25600, version<span class="token operator">=</span>2
         <span class="token operator">=</span>                       sectsz<span class="token operator">=</span>4096  sunit<span class="token operator">=</span>1 blks, lazy-count<span class="token operator">=</span>1
realtime <span class="token operator">=</span>none                   extsz<span class="token operator">=</span>4096   blocks<span class="token operator">=</span>0, rtextents<span class="token operator">=</span>0
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># udevadm settle</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir /storage</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mount /dev/mapper/storage /storage</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p> 如果想查看设备的实际使用情况，使用<code>vdostats</code>命令即可。<code>human-readable</code>参数的作用是将存储容</p>
<p>量自动进位，以人们更易读的方式输出（比如，显示<code>20G</code>而不是<code>20971520K</code>）</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vdostats --human-readable</span>
Device                    Size      Used Available Use% Space saving%
/dev/mapper/storage      20.0G      4.0G     16.0G  20%           99%
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>这里显示的<code>Size</code>是实际物理存储的空间大小（即<code>20.0</code>GB是硬盘的大小），如果想看逻辑存储空间，可</p>
<p>以使用<code>df</code>命令进行查看</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># df -h</span>
Filesystem             Size  Used Avail Use% Mounted on
devtmpfs               969M     0  969M   0% /dev
tmpfs                  984M     0  984M   0% /dev/shm
tmpfs                  984M  9.6M  974M   1% /run
tmpfs                  984M     0  984M   0% /sys/fs/cgroup
/dev/mapper/rhel-root   17G  3.9G   14G  23% /
/dev/sr0               6.7G  6.7G     0 100% /media/cdrom
/dev/sda1             1014M  152M  863M  15% /boot
tmpfs                  197M   16K  197M   1% /run/user/42
tmpfs                  197M  3.5M  194M   2% /run/user/0
/dev/sdb1              2.0G   47M  2.0G   3% /newFS
/dev/mapper/storage    200G  2.4G  198G   2% /storage
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>随便复制一个大文件过来，看看占用了多少容量，以及空间节省率（<code>Space saving</code>）是多少</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -lh /media/cdrom/images/install.img </span>
-r--r--r--. 1 root root 448M Apr 4 2019 /media/cdrom/images/install.img
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cp /media/cdrom/images/install.img /storage/</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -lh /storage/install.img </span>
-r--r--r--. 1 root root 448M Jan  6 23:06 /storage/install.img
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vdostats --human-readable</span>
Device                    Size      Used Available Use% Space saving%
/dev/mapper/storage      20.0G      4.4G     15.6G  22%           18%
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>效果不明显，再复制一份相同的文件过来，看看这次占用了多少空间</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cp /media/cdrom/images/install.img /storage/rhel.img</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vdostats --human-readable</span>
Device                    Size      Used Available Use% Space saving%
/dev/mapper/storage      20.0G      4.5G     15.5G  22%           55%
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>最后，将设备设置成永久挂载生效，一直提供服务</p>
<p><code>VDO</code>设备卷在创建后会一直存在，但需要手动编辑<code>/etc/fstab</code>文件后才能在下一次重启后自动挂载</p>
<p>生效，为我们所用。对于这种逻辑存储设备，其实不太建议使用<code>/dev/mapper/storage</code>作为设备名进</p>
<p>行挂载。不如试试前面所说的<code>UUID</code>吧</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># blkid /dev/mapper/storage </span>
/dev/mapper/storage: UUID<span class="token operator">=</span><span class="token string">"cd4e9f12-e16a-415c-ae76-8de069076713"</span> TYPE<span class="token operator">=</span><span class="token string">"xfs"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>打开<code>/etc/fstab</code>文件，把对应的字段填写完整。建议再加上<code>_netdev</code>参数，<strong>表示等系统及网络都启动</strong></p>
<p><strong>后再挂载<code>VDO</code>设备卷</strong>，以保证万无一失</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/fstab</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># /etc/fstab</span>
<span class="token comment" spellcheck="true"># Created by anaconda on Tue Jul 21 05:03:40 2020</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Accessible filesystems, by reference, are maintained under '/dev/disk/'.</span>
<span class="token comment" spellcheck="true"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># After editing this file, run 'systemctl daemon-reload' to update systemd</span>
<span class="token comment" spellcheck="true"># units generated from this file.</span>
<span class="token comment" spellcheck="true">#</span>
/dev/mapper/rhel-root                        /             xfs        defaults           1 1
UUID<span class="token operator">=</span>812b1f7c-8b5b-43da-8c06-b9999e0fe48b    /boot         xfs        defaults,uquota    1 2
/dev/mapper/rhel-swap                        swap          swap       defaults           0 0
/dev/cdrom                                   /media/cdrom  iso9660    defaults           0 0 
/dev/sdb1                                    /newFS        xfs        defaults           0 0 
/dev/sdb2                                    swap          swap       defaults           0 0 
UUID<span class="token operator">=</span>cd4e9f12-e16a-415c-ae76-8de069076713    /storage      xfs        defaults,_netdev   0 0 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="7-9、软硬方式链接"><a href="#7-9、软硬方式链接" class="headerlink" title="7.9、软硬方式链接"></a>7.9、软硬方式链接</h3><blockquote>
<p><strong>软链接（<code>soft link</code>）：</strong>也叫符号链接（<code>symbolic link</code>），仅仅包含所链接文件的名称和路径，很像</p>
<p>一个记录地址的标签。当原始文件被删除或移动后，新的链接文件也会随之失效，不能被访问。可以针</p>
<p>对文件、目录设置软链接，<strong>跨文件系统进行链接也不是问题</strong>。从这一点来看，它与<code>Windows</code>系统的“快捷</p>
<p>方式”具有一样的性质。用户访问软链接的效果如图所示。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220817170750832.png"></p>
<blockquote>
<p><strong>硬链接（<code>hard link</code>）：</strong>可以将它理解为一个“指向原始文件<code>block</code>的指针”，系统会创建出一个与原来</p>
<p>一模一样的<code>inode</code>信息块。所以，硬链接文件与原始文件其实是一模一样的，只是名字不同。每添加一</p>
<p>个硬链接，该文件的<code>inode</code>个数就会增加1；而且只有当该文件的<code>inode</code>个数为0时，才算彻底将它删</p>
<p>除。换言之，由于硬链接实际上是指向原文件<code>block</code>的指针，因此即便原始文件被删除，依然可以通过</p>
<p>硬链接文件来访问。需要注意的是，由于技术的局限性，<strong>不能跨分区对目录文件进行硬链接</strong>。用户访问</p>
<p>硬链接的效果如图所示。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220817170948795.png"></p>
<h3 id="7-9-1、创建连接"><a href="#7-9-1、创建连接" class="headerlink" title="7.9.1、创建连接"></a>7.9.1、创建连接</h3><blockquote>
<p><code>ln</code>命令用于创建文件的软硬链接，英文全称为“link”，语法格式为“<code>ln</code> [参数]原始文件名 链接文件</p>
<p>名”。</p>
</blockquote>
<blockquote>
<p> <code>ln</code>命令中可用的参数以及作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-s</code></td>
<td>创建“符号链接”（如果不带-s参数，则默认创建硬链接）</td>
</tr>
<tr>
<td><code>-f</code></td>
<td>强制创建文件或目录的链接</td>
</tr>
<tr>
<td><code>-i</code></td>
<td>覆盖前先询问</td>
</tr>
<tr>
<td><code>-v</code></td>
<td>显示创建链接的过程</td>
</tr>
</tbody></table>
<blockquote>
<p>为了更好地理解软链接、硬链接的不同性质，我们先创建出一个文件，为其创建一个软链接</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "Welcome to linuxprobe.com" > old.txt</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ln -s old.txt new.txt</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cat old.txt </span>
Welcome to linuxprobe.com
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cat new.txt </span>
Welcome to linuxprobe.com
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -l old.txt </span>
-rw-r--r-- 1 root root 26 Jan 11 00:08 old.txt
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>原始文件名为<code>old</code>，新的软链接文件名为<code>new</code>。删掉原始文件后，软链接文件立刻就无法读取了</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rm -f old.txt </span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cat new.txt </span>
cat: readit.txt: No such <span class="token function">file</span> or directory
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>接下来针对原始文件old创建一个硬链接，即相当于针对原始文件的硬盘存储位置创建了一个指针。这样</p>
<p>一来，新创建的这个硬链接就不再依赖于原始文件的名称等信息，也不会因为原始文件的删除而导致无</p>
<p>法读取了。同时可以看到创建硬链接后，<strong>原始文件的硬盘链接数量增加到了2</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "Welcome to linuxprobe.com" > old.txt</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ln old.txt new.txt</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cat old.txt </span>
Welcome to linuxprobe.com
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cat new.txt </span>
Welcome to linuxprobe.com
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -l old.txt </span>
-rw-r--r-- 2 root root 26 Jan 11 00:13 old.txt
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>删除<code>old</code>文件</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rm -f old.txt </span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cat new.txt </span>
Welcome to linuxprobe.com
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="八、使用RAID与LVM磁盘阵列技术"><a href="#八、使用RAID与LVM磁盘阵列技术" class="headerlink" title="八、使用RAID与LVM磁盘阵列技术"></a>八、使用<code>RAID</code>与<code>LVM</code>磁盘阵列技术</h2><hr>
<h3 id="8-1、-RAID磁盘冗余阵列"><a href="#8-1、-RAID磁盘冗余阵列" class="headerlink" title="8.1、 RAID磁盘冗余阵列"></a>8.1、 <code>RAID</code>磁盘冗余阵列</h3><blockquote>
<p><code>RAID</code>技术通过把多个硬盘设备组合成一个容量更大、安全性更好的磁盘阵列，并把数据切割成多个区段</p>
<p>后分别存放在各个不同的物理硬盘设备上，然后利用分散读写技术来提升磁盘阵列整体的性能，同时把</p>
<p>多个重要数据的副本同步到不同的物理硬盘设备上，从而起到了非常好的数据冗余备份效果</p>
</blockquote>
<blockquote>
<p>RAID 0、1、5、10方案技术对比</p>
</blockquote>
<table>
<thead>
<tr>
<th>RAID级别</th>
<th>最少硬盘</th>
<th>可用容量</th>
<th>读写性能</th>
<th>安全性</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>2</td>
<td>n</td>
<td>n</td>
<td>低</td>
<td>追求最大容量和速度，任何一块盘损坏，数据全部异常。</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>n/2</td>
<td>n</td>
<td>高</td>
<td>追求最大安全性，只要阵列组中有一块硬盘可用，数据不受影响。</td>
</tr>
<tr>
<td>5</td>
<td>3</td>
<td>n-1</td>
<td>n-1</td>
<td>中</td>
<td>在控制成本的前提下，追求硬盘的最大容量、速度及安全性，允许有一块硬盘异常，数据不受影响。</td>
</tr>
<tr>
<td>10</td>
<td>4</td>
<td>n/2</td>
<td>n/2</td>
<td>高</td>
<td>综合<code>RAID1</code>和<code>RAID0</code>的优点，追求硬盘的速度和安全性，允许有一半硬盘异常（不可同组），数据不受影响</td>
</tr>
</tbody></table>
<p><strong>1、<code>RAID0</code></strong></p>
<blockquote>
<p><code>RAID 0</code>技术把多块物理硬盘设备（<strong>至少两块</strong>）通过硬件或软件的方式串联在一起，组成一个大的卷组，</p>
<p>并<strong>将数据依次写入各个物理硬盘中</strong>。这样一来，在最理想的状态下，硬盘设备的读写性能会提升数倍，</p>
<p>但是<strong>若任意一块硬盘发生故障，将导致整个系统的数据都受到破坏</strong>。通俗来说，<code>RAID 0</code>技术能够有效地</p>
<p>提升硬盘数据的吞吐速度，但是不具备数据备份和错误修复能力。如图所示，数据被分别写入到不同的</p>
<p>硬盘设备中，即硬盘A和硬盘B设备会分别保存数据资料，最终实现提升读取、写入速度的效果</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220818091807945.png"></p>
<p><strong>2、<code>RAID1</code></strong></p>
<blockquote>
<p><code>RAID 1</code>技术示意图中可以看到，它是把两块以上的硬盘设备进行绑定，在写入数据时，是将数据同时写</p>
<p>入到多块硬盘设备上（可以将其视为数据的镜像或备份）。当其中某一块硬盘发生故障后，一般会立即</p>
<p>自动以热交换的方式来恢复数据的正常使用</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220818092039062.png"></p>
<p><strong>3、<code>RAID5</code></strong></p>
<blockquote>
<p><code>RAID5</code>技术是把硬盘设备的数据奇偶校验信息保存到其他硬盘设备中。<code>RAID 5</code>磁盘阵列中数据的奇偶校</p>
<p>验信息并不是单独保存到某一块硬盘设备中，而是存储到除自身以外的其他每一块硬盘设备上。这样的</p>
<p>好处是，<strong>其中任何一设备损坏后不至于出现致命缺陷</strong>。图中<code>Parity</code>部分存放的就是数据的奇偶校验信</p>
<p>息。换句话说，就是<code>RAID 5</code>技术实际上没有备份硬盘中的真实数据信息，而是当硬盘设备出现问题后通</p>
<p>过奇偶校验信息来尝试重建损坏的数据。<code>RAID</code>这样的技术特性“妥协”地兼顾了硬盘设备的读写速度、数</p>
<p>据安全性与存储成本问题</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220818092443444.png"></p>
<blockquote>
<p><code>RAID 5</code>最少由3块硬盘组成，使用的是硬盘切割（<code>Disk Striping</code>）技术。相较于<code>RAID 1</code>级别，好处</p>
<p>就在于保存的是奇偶校验信息而不是一模一样的文件内容，所以当重复写入某个文件时，<code>RAID 5</code>级别的</p>
<p>磁盘阵列组只需要对应一个奇偶校验信息就可以，效率更高，存储成本也会随之降低</p>
</blockquote>
<p><strong>3、<code>RAID 10</code></strong></p>
<blockquote>
<p><strong><code>RAID 10</code>技术是<code>AID 1</code>+<code>RAID 0</code>技术的一个“组合体”</strong>。如图所示，<code>RAID 10</code>技术需要至少4块硬盘来组</p>
<p>建，其中先分别两两制作成<code>RAID 1</code>磁盘阵列，以保证数据的安全性；然后再对两个<code>RAID 1</code>磁盘阵列实</p>
<p>施<code>RAID 0</code>技术，进一步提高硬盘设备的读写速度。这样从理论上来讲，只要坏的不是同一阵列中的所有</p>
<p>硬盘，那么最多可以损坏50%的硬盘设备而不丢失数据。由于<code>RAID 10</code>技术继承了<code>RAID 0</code>的高读写速度</p>
<p>和RAID 1的数据安全性，在不考虑成本的情况下<code>RAID 10</code>的性能也超过了<code>RAID 5</code>，因此当前成为广泛</p>
<p>使用的一种存储技术</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220818092809490.png"></p>
<h4 id="8-1-1、部署磁盘阵列"><a href="#8-1-1、部署磁盘阵列" class="headerlink" title="8.1.1、部署磁盘阵列"></a>8.1.1、部署磁盘阵列</h4><blockquote>
<p>首先，需要在虚拟机中添加<code>4</code>块硬盘设备来制作一个<code>RAID 10</code>磁盘阵列，如图所示。这里不再详述添加</p>
<p>硬盘的步骤，大家自己操作就行。记得硬盘要用<code>SCSI</code>或<code>SATA</code>接口的类型，大小默认<code>20GB</code>就可以。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220818093016607.png"></p>
<blockquote>
<p><code>mdadm</code>用于<strong>创建、调整、监控和管理<code>RAID</code>设备</strong>，英文全称为“<code>multiple devices admin</code>”，语法格式</p>
<p>为“<code>mdadm</code>参数 硬盘名称”</p>
</blockquote>
<blockquote>
<p> <code>mdadm</code>命令的常用参数和作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-a</code></td>
<td>检测设备名称</td>
</tr>
<tr>
<td><code>-n</code></td>
<td>指定设备数量</td>
</tr>
<tr>
<td><code>-l</code></td>
<td>指定RAID级别</td>
</tr>
<tr>
<td><code>-C</code></td>
<td>创建</td>
</tr>
<tr>
<td><code>-v</code></td>
<td>显示过程</td>
</tr>
<tr>
<td><code>-f</code></td>
<td>模拟设备损坏</td>
</tr>
<tr>
<td><code>-r</code></td>
<td>移除设备</td>
</tr>
<tr>
<td><code>-Q</code></td>
<td>查看摘要信息</td>
</tr>
<tr>
<td><code>-D</code></td>
<td>查看详细信息</td>
</tr>
<tr>
<td><code>-S</code></td>
<td>停止RAID磁盘阵列</td>
</tr>
</tbody></table>
<blockquote>
<p><code>-C</code>参数代表创建一个<code>RAID</code>阵列卡；<code>-v</code>参数显示创建的过程，同时在后面追加一个设备名</p>
<p>称<code>/dev/md0</code>，这样<code>/dev/md0</code>就是创建后的<code>RAID</code>磁盘阵列的名称；<code>-n 4</code>参数代表使用4块硬盘来部署</p>
<p>这<code>个RAID</code>磁盘阵列；而<code>-l 10</code>参数则代表<code>RAID 10</code>方案；最后再加上4块硬盘设备的名称就搞定了</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm -Cv /dev/md0 -n 4 -l 10 /dev/sdb /dev/sdc /dev/sdd /dev/sde</span>
mdadm: layout defaults to n2
mdadm: layout defaults to n2
mdadm: chunk size defaults to 512K
mdadm: size <span class="token keyword">set</span> to 20954112K
mdadm: Defaulting to version 1.2 metadata
mdadm: array /dev/md0 started.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>初始化过程大约需要1分钟左右，期间可以用<code>-D</code>参数进行查看。也可以用<code>-Q</code>参数查看简要信息：</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm -Q /dev/md0</span>
/dev/md0: 39.97GiB raid10 4 devices, 0 spares. Use mdadm --detail <span class="token keyword">for</span> <span class="token function">more</span> detail.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p> 等两三分钟后，把制作好的<code>RAID</code>磁盘阵列格式化为<code>Ext4</code>格式</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkfs.ext4 /dev/md0</span>
mke2fs 1.44.3 <span class="token punctuation">(</span>10-July-2018<span class="token punctuation">)</span>
Creating filesystem with 10477056 4k blocks and 2621440 inodes
Filesystem UUID: d1c68318-a919-4211-b4dc-c4437bcfe9da
Superblock backups stored on blocks: 
    32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
    4096000, 7962624

Allocating group tables: <span class="token keyword">done</span>                            
Writing inode tables: <span class="token keyword">done</span>                            
Creating journal <span class="token punctuation">(</span>65536 blocks<span class="token punctuation">)</span>: <span class="token keyword">done</span>
Writing superblocks and filesystem accounting information: <span class="token keyword">done</span>   
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>随后，创建挂载点，将硬盘设备进行挂载操作</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir /RAID</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mount /dev/md0 /RAID</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># df -h</span>
Filesystem             Size  Used Avail Use% Mounted on
devtmpfs               969M     0  969M   0% /dev
tmpfs                  984M     0  984M   0% /dev/shm
tmpfs                  984M  9.6M  975M   1% /run
tmpfs                  984M     0  984M   0% /sys/fs/cgroup
/dev/mapper/rhel-root   17G  3.9G   14G  23% /
/dev/sr0               6.7G  6.7G     0 100% /media/cdrom
/dev/sda1             1014M  152M  863M  15% /boot
tmpfs                  197M   16K  197M   1% /run/user/42
tmpfs                  197M  3.5M  194M   2% /run/user/0
/dev/md0                40G   49M   38G   1% /RAID
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>再来查看<code>/dev/md0</code>磁盘阵列设备的详细信息，确认<code>RAID</code>级别（<code>Raid Level</code>）、</p>
<p>阵列大小（<code>Array Size</code>）和总硬盘数（<code>Total Devices</code>）都是否正确</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm -D /dev/md0</span>
/dev/md0:
           Version <span class="token keyword">:</span> 1.2
     Creation Time <span class="token keyword">:</span> Wed Jan 13 08:24:58 2021
        Raid Level <span class="token keyword">:</span> raid10
        Array Size <span class="token keyword">:</span> 41908224 <span class="token punctuation">(</span>39.97 GiB 42.91 GB<span class="token punctuation">)</span>
     Used Dev Size <span class="token keyword">:</span> 20954112 <span class="token punctuation">(</span>19.98 GiB 21.46 GB<span class="token punctuation">)</span>
      Raid Devices <span class="token keyword">:</span> 4
     Total Devices <span class="token keyword">:</span> 4
       Persistence <span class="token keyword">:</span> Superblock is persistent

       Update Time <span class="token keyword">:</span> Thu Jan 14 04:49:57 2021
             State <span class="token keyword">:</span> clean 
    Active Devices <span class="token keyword">:</span> 4
   Working Devices <span class="token keyword">:</span> 4
    Failed Devices <span class="token keyword">:</span> 0
     Spare Devices <span class="token keyword">:</span> 0

            Layout <span class="token keyword">:</span> near<span class="token operator">=</span>2
        Chunk Size <span class="token keyword">:</span> 512K

Consistency Policy <span class="token keyword">:</span> resync

              Name <span class="token keyword">:</span> localhost.localdomain:0  <span class="token punctuation">(</span>local to host linuxprobe.com<span class="token punctuation">)</span>
              UUID <span class="token keyword">:</span> 289f501b:3f5f70f9:79189d77:f51ca11a
            Events <span class="token keyword">:</span> 17

    Number   Major   Minor   RaidDevice State
       0       8       16        0      active <span class="token function">sync</span> set-A   /dev/sdb
       1       8       32        1      active <span class="token function">sync</span> set-B   /dev/sdc
       2       8       48        2      active <span class="token function">sync</span> set-A   /dev/sdd
       3       8       64        3      active <span class="token function">sync</span> set-B   /dev/sde
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>将信息添加到<code>/etc/fstab</code>文件中，这样可以确保在每次重启后<code>RAID</code>磁盘阵列都是有效的</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "/dev/md0 /RAID ext4 defaults 0 0" >> /etc/fstab</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cat /etc/fstab</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># /etc/fstab</span>
<span class="token comment" spellcheck="true"># Created by anaconda on Tue Jul 21 05:03:40 2020</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Accessible filesystems, by reference, are maintained under '/dev/disk/'.</span>
<span class="token comment" spellcheck="true"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># After editing this file, run 'systemctl daemon-reload' to update systemd</span>
<span class="token comment" spellcheck="true"># units generated from this file.</span>
<span class="token comment" spellcheck="true">#</span>
/dev/mapper/rhel-root                       /                 xfs         defaults      0 0
UUID<span class="token operator">=</span>2db66eb4-d9c1-4522-8fab-ac074cd3ea0b   /boot             xfs         defaults      0 0
/dev/mapper/rhel-swap                       swap              swap        defaults      0 0
/dev/cdrom                                  /media/cdrom      iso9660     defaults      0 0 
/dev/md0                                    /RAID             ext4        defaults      0 0
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="8-1-2、损坏磁盘阵列及修复"><a href="#8-1-2、损坏磁盘阵列及修复" class="headerlink" title="8.1.2、损坏磁盘阵列及修复"></a>8.1.2、损坏磁盘阵列及修复</h4><blockquote>
<p>在确认有一块物理硬盘设备出现损坏而不能再继续正常使用后，应该使用<code>mdadm</code>命令将其移除，然后查</p>
<p>看<code>RAID</code>磁盘阵列的状态，可以发现状态已经改变</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm /dev/md0 -f /dev/sdb</span>
mdadm: <span class="token keyword">set</span> /dev/sdb faulty <span class="token keyword">in</span> /dev/md0
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm -D /dev/md0</span>
/dev/md0:
           Version <span class="token keyword">:</span> 1.2
     Creation Time <span class="token keyword">:</span> Thu Jan 14 05:12:20 2021
        Raid Level <span class="token keyword">:</span> raid10
        Array Size <span class="token keyword">:</span> 41908224 <span class="token punctuation">(</span>39.97 GiB 42.91 GB<span class="token punctuation">)</span>
     Used Dev Size <span class="token keyword">:</span> 20954112 <span class="token punctuation">(</span>19.98 GiB 21.46 GB<span class="token punctuation">)</span>
      Raid Devices <span class="token keyword">:</span> 4
     Total Devices <span class="token keyword">:</span> 4
       Persistence <span class="token keyword">:</span> Superblock is persistent

       Update Time <span class="token keyword">:</span> Thu Jan 14 05:33:06 2021
             State <span class="token keyword">:</span> clean, degraded 
    Active Devices <span class="token keyword">:</span> 3
   Working Devices <span class="token keyword">:</span> 3
    Failed Devices <span class="token keyword">:</span> 1
     Spare Devices <span class="token keyword">:</span> 0

            Layout <span class="token keyword">:</span> near<span class="token operator">=</span>2
        Chunk Size <span class="token keyword">:</span> 512K

Consistency Policy <span class="token keyword">:</span> resync

              Name <span class="token keyword">:</span> localhost.localdomain:0  <span class="token punctuation">(</span>local to host localhost.localdomain<span class="token punctuation">)</span>
              UUID <span class="token keyword">:</span> 81ee0668:7627c733:0b170c41:cd12f376
            Events <span class="token keyword">:</span> 19

    Number   Major   Minor   RaidDevice State
       -       0        0        0      removed
       1       8       32        1      active <span class="token function">sync</span> set-B   /dev/sdc
       2       8       48        2      active <span class="token function">sync</span> set-A   /dev/sdd
       3       8       64        3      active <span class="token function">sync</span> set-B   /dev/sde

       0       8       16        -      faulty   /dev/sdb
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>刚刚使用的<code>-f</code>参数是让硬盘模拟损坏的效果。为了能够彻底地将故障盘移除，还要再执行一步操作</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm /dev/md0 -r /dev/sdb</span>
mdadm: hot removed /dev/sdb from /dev/md0
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>在<code>RAID 10</code>级别的磁盘阵列中，当<code>RAID 1</code>磁盘阵列中存在一个故障盘时并不影响<code>RAID 10</code>磁盘阵列的</p>
<p>使用。当购买了新的硬盘设备后再使用<code>mdadm</code>命令予以替换即可，在此期间可以在<code>/RAID</code>目录中正常地</p>
<p>创建或删除文件。由于我们是在虚拟机中模拟硬盘，所以先重启系统，然后再把新的硬盘添加到<code>RAID</code>磁</p>
<p>盘阵列中</p>
</blockquote>
<blockquote>
<p>更换硬盘后再次使用-a参数进行添加操作，系统默认会自动开始数据的同步工作。使用<code>-D</code>参数即可看</p>
<p>到整个过程和进度（用百分比表示）</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm /dev/md0 -a /dev/sdb</span>
mdadm: added /dev/sdb
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm -D /dev/md0</span>
/dev/md0:
           Version <span class="token keyword">:</span> 1.2
     Creation Time <span class="token keyword">:</span> Thu Jan 14 05:12:20 2021
        Raid Level <span class="token keyword">:</span> raid10
        Array Size <span class="token keyword">:</span> 41908224 <span class="token punctuation">(</span>39.97 GiB 42.91 GB<span class="token punctuation">)</span>
     Used Dev Size <span class="token keyword">:</span> 20954112 <span class="token punctuation">(</span>19.98 GiB 21.46 GB<span class="token punctuation">)</span>
      Raid Devices <span class="token keyword">:</span> 4
     Total Devices <span class="token keyword">:</span> 4
       Persistence <span class="token keyword">:</span> Superblock is persistent

       Update Time <span class="token keyword">:</span> Thu Jan 14 05:37:32 2021
             State <span class="token keyword">:</span> clean, degraded, recovering 
    Active Devices <span class="token keyword">:</span> 3
   Working Devices <span class="token keyword">:</span> 4
    Failed Devices <span class="token keyword">:</span> 0
     Spare Devices <span class="token keyword">:</span> 1

            Layout <span class="token keyword">:</span> near<span class="token operator">=</span>2
        Chunk Size <span class="token keyword">:</span> 512K

Consistency Policy <span class="token keyword">:</span> resync

    Rebuild Status <span class="token keyword">:</span> 77% complete

              Name <span class="token keyword">:</span> localhost.localdomain:0  <span class="token punctuation">(</span>local to host localhost.localdomain<span class="token punctuation">)</span>
              UUID <span class="token keyword">:</span> 81ee0668:7627c733:0b170c41:cd12f376
            Events <span class="token keyword">:</span> 34

    Number   Major   Minor   RaidDevice State
       4       8       16        0      spare rebuilding    /dev/sdb
       1       8       32        1      active <span class="token function">sync</span> set-B   /dev/sdc
       2       8       48        2      active <span class="token function">sync</span> set-A   /dev/sdd
       3       8       64        3      active <span class="token function">sync</span> set-B   /dev/sde
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="8-1-3、磁盘阵列-备份盘"><a href="#8-1-3、磁盘阵列-备份盘" class="headerlink" title="8.1.3、磁盘阵列+备份盘"></a>8.1.3、磁盘阵列+备份盘</h4><blockquote>
<p><code>RAID 10</code>磁盘阵列中最多允许50%的硬盘设备发生故障，但是存在这样一种极端情况，即同一<code>RAID 1</code>磁</p>
<p>盘阵列中的硬盘设备若全部损坏，也会导致数据丢失。换句话说，在<code>RAID 10</code>磁盘阵列中，如果<code>RAID 1</code></p>
<p>中的某一块硬盘出现了故障，而我们正在前往修复的路上，恰巧该<code>RAID 1</code>磁盘阵列中的另一块硬盘设备</p>
<p>也出现故障，那么数据就被彻底丢失了</p>
</blockquote>
<blockquote>
<p>其实，完全可以使用<code>RAID</code>备份盘技术来预防这类事故。该技术的核心理念就是准备一块足够大的硬盘，</p>
<p>这块硬盘平时处于闲置状态，一旦<code>RAID</code>磁盘阵列中有硬盘出现故障后则会马上自动顶替上去</p>
</blockquote>
<blockquote>
<p>将虚拟机还原到初始状态。部署<code>RAID 5</code>，部署·RAID 5·磁盘阵列时，至少需要用到3块硬盘，还需要再加</p>
<p>一块备份硬盘（也叫热备盘），所以总计需要在虚拟机中模拟4块硬盘设备，如图所示。		</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220818095324120.png"></p>
<blockquote>
<p>现在创建一个<code>RAID 5</code>磁盘阵列+备份盘。在下面的命令中，参数<code>-n 3</code>代表创建这个<code>RAID 5</code>磁盘阵列</p>
<p>所需的硬盘数，参数<code>-l 5</code>代表<code>RAID</code>的级别，而参数<code>-x 1</code>则代表有一块备份盘。当查看<code>/dev/md0</code></p>
<p>（即<code>RAID 5</code>磁盘阵列的名称）磁盘阵列的时候，就能看到有一块备份盘在等待中了</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm -Cv /dev/md0 -n 3 -l 5 -x 1 /dev/sdb /dev/sdc /dev/sdd /dev/sde</span>
mdadm: layout defaults to left-symmetric
mdadm: layout defaults to left-symmetric
mdadm: chunk size defaults to 512K
mdadm: size <span class="token keyword">set</span> to 20954112K
mdadm: Defaulting to version 1.2 metadata
mdadm: array /dev/md0 started.
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm -D /dev/md0</span>
/dev/md0:
           Version <span class="token keyword">:</span> 1.2
     Creation Time <span class="token keyword">:</span> Thu Jan 14 06:12:32 2021
        Raid Level <span class="token keyword">:</span> raid5
        Array Size <span class="token keyword">:</span> 41908224 <span class="token punctuation">(</span>39.97 GiB 42.91 GB<span class="token punctuation">)</span>
     Used Dev Size <span class="token keyword">:</span> 20954112 <span class="token punctuation">(</span>19.98 GiB 21.46 GB<span class="token punctuation">)</span>
      Raid Devices <span class="token keyword">:</span> 3
     Total Devices <span class="token keyword">:</span> 4
       Persistence <span class="token keyword">:</span> Superblock is persistent

       Update Time <span class="token keyword">:</span> Thu Jan 14 06:14:16 2021
             State <span class="token keyword">:</span> clean 
    Active Devices <span class="token keyword">:</span> 3
   Working Devices <span class="token keyword">:</span> 4
    Failed Devices <span class="token keyword">:</span> 0
     Spare Devices <span class="token keyword">:</span> 1

            Layout <span class="token keyword">:</span> left-symmetric
        Chunk Size <span class="token keyword">:</span> 512K

Consistency Policy <span class="token keyword">:</span> resync

              Name <span class="token keyword">:</span> localhost.localdomain:0  <span class="token punctuation">(</span>local to host localhost.localdomain<span class="token punctuation">)</span>
              UUID <span class="token keyword">:</span> cf0c34b6:3b08edfb:85dfa14f:e2bffc1e
            Events <span class="token keyword">:</span> 18

    Number   Major   Minor   RaidDevice State
       0       8       16        0      active <span class="token function">sync</span>   /dev/sdb
       1       8       32        1      active <span class="token function">sync</span>   /dev/sdc
       4       8       48        2      active <span class="token function">sync</span>   /dev/sdd

       3       8       64        -      spare   /dev/sde
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>现在将部署好的<code>RAID 5</code>磁盘阵列格式化为<code>Ext4</code>文件格式，然后挂载到目录上，之后就能够使用了</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkfs.ext4 /dev/md0</span>
mke2fs 1.44.3 <span class="token punctuation">(</span>10-July-2018<span class="token punctuation">)</span>
Creating filesystem with 10477056 4k blocks and 2621440 inodes
Filesystem UUID: ff016386-1126-4799-8a5b-d716242276ec
Superblock backups stored on blocks: 
    32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
    4096000, 7962624

Allocating group tables: <span class="token keyword">done</span>                            
Writing inode tables: <span class="token keyword">done</span>                            
Creating journal <span class="token punctuation">(</span>65536 blocks<span class="token punctuation">)</span>: <span class="token keyword">done</span>
Writing superblocks and filesystem accounting information: <span class="token keyword">done</span>   
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir /RAID</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "/dev/md0 /RAID ext4 defaults 0 0" >> /etc/fstab</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>由3块硬盘组成的<code>RAID 5</code>磁盘阵列，其对应的可用空间是<code>n-1</code>，也就是<code>40GB</code>。<strong>热备盘的空间不计算进</strong></p>
<p><strong>来，平时完全就是在“睡觉”</strong>，只有在意外出现时才会开始工作</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mount -a</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># df -h</span>
Filesystem             Size  Used Avail Use% Mounted on
devtmpfs               969M     0  969M   0% /dev
tmpfs                  984M     0  984M   0% /dev/shm
tmpfs                  984M  9.6M  974M   1% /run
tmpfs                  984M     0  984M   0% /sys/fs/cgroup
/dev/mapper/rhel-root   17G  3.9G   14G  23% /
/dev/sr0               6.7G  6.7G     0 100% /media/cdrom
/dev/sda1             1014M  152M  863M  15% /boot
tmpfs                  197M   16K  197M   1% /run/user/42
tmpfs                  197M  3.5M  194M   2% /run/user/0
/dev/md0                40G   49M   38G   1% /RAID
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>我们再次把硬盘设备<code>/dev/sdb</code>移出磁盘阵列，然后迅速查看<code>/dev/md0</code>磁盘阵列的状态，就会发现备份</p>
<p>盘已经被自动顶替上去并开始了数据同步。<code>RAID</code>中的这种备份盘技术非常实用，可以在保证<code>RAID</code>磁盘</p>
<p>阵列数据安全性的基础上进一步提高数据可靠性</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm /dev/md0 -f /dev/sdb</span>
mdadm: <span class="token keyword">set</span> /dev/sdb faulty <span class="token keyword">in</span> /dev/md0
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm -D /dev/md0</span>
/dev/md0:
           Version <span class="token keyword">:</span> 1.2
     Creation Time <span class="token keyword">:</span> Thu Jan 14 06:12:32 2021
        Raid Level <span class="token keyword">:</span> raid5
        Array Size <span class="token keyword">:</span> 41908224 <span class="token punctuation">(</span>39.97 GiB 42.91 GB<span class="token punctuation">)</span>
     Used Dev Size <span class="token keyword">:</span> 20954112 <span class="token punctuation">(</span>19.98 GiB 21.46 GB<span class="token punctuation">)</span>
      Raid Devices <span class="token keyword">:</span> 3
     Total Devices <span class="token keyword">:</span> 4
       Persistence <span class="token keyword">:</span> Superblock is persistent

       Update Time <span class="token keyword">:</span> Thu Jan 14 06:24:38 2021
             State <span class="token keyword">:</span> clean 
    Active Devices <span class="token keyword">:</span> 3
   Working Devices <span class="token keyword">:</span> 3
    Failed Devices <span class="token keyword">:</span> 1
     Spare Devices <span class="token keyword">:</span> 0

            Layout <span class="token keyword">:</span> left-symmetric
        Chunk Size <span class="token keyword">:</span> 512K

Consistency Policy <span class="token keyword">:</span> resync

              Name <span class="token keyword">:</span> localhost.localdomain:0  <span class="token punctuation">(</span>local to host localhost.localdomain<span class="token punctuation">)</span>
              UUID <span class="token keyword">:</span> cf0c34b6:3b08edfb:85dfa14f:e2bffc1e
            Events <span class="token keyword">:</span> 37

    Number   Major   Minor   RaidDevice State
       3       8       64        0      active <span class="token function">sync</span>   /dev/sde
       1       8       32        1      active <span class="token function">sync</span>   /dev/sdc
       4       8       48        2      active <span class="token function">sync</span>   /dev/sdd

       0       8       16        -      faulty   /dev/sdb
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>如果后面想再添加一块热备盘进来，使用<code>-a</code>参数就可以了</p>
</blockquote>
<h4 id="8-1-4、删除磁盘阵列"><a href="#8-1-4、删除磁盘阵列" class="headerlink" title="8.1.4、删除磁盘阵列"></a>8.1.4、删除磁盘阵列</h4><blockquote>
<p>首先，需要<strong>将所有的磁盘都设置成停用状态</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># umount /RAID</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm /dev/md0 -f /dev/sdc</span>
mdadm: <span class="token keyword">set</span> /dev/sdc faulty <span class="token keyword">in</span> /dev/md0
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm /dev/md0 -f /dev/sdd</span>
mdadm: <span class="token keyword">set</span> /dev/sdd faulty <span class="token keyword">in</span> /dev/md0
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm /dev/md0 -f /dev/sde</span>
mdadm: <span class="token keyword">set</span> /dev/sde faulty <span class="token keyword">in</span> /dev/md0
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>然后再逐一移除出去</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm /dev/md0 -r /dev/sdb</span>
mdadm: hot removed /dev/sdb from /dev/md0
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm /dev/md0 -r /dev/sdc</span>
mdadm: hot removed /dev/sdc from /dev/md0
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm /dev/md0 -r /dev/sdd</span>
mdadm: hot removed /dev/sdd from /dev/md0
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm /dev/md0 -r /dev/sde</span>
mdadm: hot removed /dev/sde from /dev/md0
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>将所有的硬盘都移除后，再来查看磁盘阵列组的状态</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm -D /dev/md0</span>
/dev/md0:
           Version <span class="token keyword">:</span> 1.2
     Creation Time <span class="token keyword">:</span> Fri Jan 15 08:53:41 2021
        Raid Level <span class="token keyword">:</span> raid5
        Array Size <span class="token keyword">:</span> 41908224 <span class="token punctuation">(</span>39.97 GiB 42.91 GB<span class="token punctuation">)</span>
     Used Dev Size <span class="token keyword">:</span> 20954112 <span class="token punctuation">(</span>19.98 GiB 21.46 GB<span class="token punctuation">)</span>
      Raid Devices <span class="token keyword">:</span> 3
     Total Devices <span class="token keyword">:</span> 0
       Persistence <span class="token keyword">:</span> Superblock is persistent

       Update Time <span class="token keyword">:</span> Fri Jan 15 09:00:57 2021
             State <span class="token keyword">:</span> clean, FAILED 
    Active Devices <span class="token keyword">:</span> 0
    Failed Devices <span class="token keyword">:</span> 0
     Spare Devices <span class="token keyword">:</span> 0

            Layout <span class="token keyword">:</span> left-symmetric
        Chunk Size <span class="token keyword">:</span> 512K

Consistency Policy <span class="token keyword">:</span> resync

    Number   Major   Minor   RaidDevice State
       -       0        0        0      removed
       -       0        0        1      removed
       -       0        0        2      removed
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>下面继续停用整个<code>RAID</code>磁盘阵列，咱们的工作就彻底完成了</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mdadm --stop /dev/md0</span>
mdadm: stopped /dev/md0
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls /dev/md0</span>
ls: cannot access <span class="token string">'/dev/md0'</span><span class="token keyword">:</span> No such <span class="token function">file</span> or directory
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="8-2、LVM逻辑卷管理器"><a href="#8-2、LVM逻辑卷管理器" class="headerlink" title="8.2、LVM逻辑卷管理器"></a>8.2、<code>LVM</code>逻辑卷管理器</h3><blockquote>
<p><code>LVM</code>是<code>Linux</code>系统用于对硬盘分区进行管理的一种机制，理论性较强，其创建初衷是为了解决硬盘设备</p>
<p>在创建分区后不易修改分区大小的缺陷。尽管对传统的硬盘分区进行强制扩容或缩容从理论上来讲是可</p>
<p>行的，但是却可能造成数据的丢失。而<code>LVM</code>技术是在硬盘分区和文件系统之间添加了一个逻辑层，它提</p>
<p>供了一个抽象的卷组，可以把多块硬盘进行卷组合并。这样一来，用户不必关心物理硬盘设备的底层架</p>
<p>构和布局，就可以实现对硬盘分区的动态调整。<code>LVM</code>的技术架构如图所示</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220818105359123.png"></p>
<blockquote>
<p>我们来看一个吃货的例子。比如小明家里想吃馒头，但是面粉不够了，于是妈妈从隔壁老王家、老李</p>
<p>家、老张家分别借来一些面粉，准备蒸馒头吃。首先需要把这些面粉（物理卷[<code>Physical Volume</code>，</p>
<p><code>PV</code>]）揉成一个大面团（卷组[<code>Volume Group</code>]，<code>VG</code>），然后再把这个大面团分割成一个个小馒头（逻辑</p>
<p>卷[<code>Logical Volume</code>，<code>LV]</code>），而且每个小馒头的重量必须是每勺面粉（基本单元[<code>Physical </code></p>
<p><code>Extent</code>，<code>PE]</code>）的倍数</p>
</blockquote>
<blockquote>
<p>物理卷处于<code>LVM</code>中的最底层，可以将其理解为物理硬盘、硬盘分区或者<code>RAID</code>磁盘阵列。卷组建立在物理</p>
<p>卷之上，一个卷组能够包含多个物理卷，而且在卷组创建之后也可以继续向其中添加新的物理卷。逻辑</p>
<p>卷是用卷组中空闲的资源建立的，并且逻辑卷在建立后可以动态地扩展或缩小空间。这就是<code>LVM</code>的核心</p>
<p>理念</p>
</blockquote>
<h4 id="8-2-1、部署逻辑卷"><a href="#8-2-1、部署逻辑卷" class="headerlink" title="8.2.1、部署逻辑卷"></a>8.2.1、部署逻辑卷</h4><blockquote>
<p>常用的<code>LVM</code>部署命令</p>
</blockquote>
<table>
<thead>
<tr>
<th>功能/命令</th>
<th>物理卷管理</th>
<th>卷组管理</th>
<th>逻辑卷管理</th>
</tr>
</thead>
<tbody><tr>
<td>扫描</td>
<td><code>pvscan</code></td>
<td><code>vgscan</code></td>
<td><code>lvscan</code></td>
</tr>
<tr>
<td>建立</td>
<td><code>pvcreate</code></td>
<td><code>vgcreate</code></td>
<td><code>lvcreate</code></td>
</tr>
<tr>
<td>显示</td>
<td><code>pvdisplay</code></td>
<td><code>vgdisplay</code></td>
<td><code>lvdisplay</code></td>
</tr>
<tr>
<td>删除</td>
<td><code>pvremove</code></td>
<td><code>vgremove</code></td>
<td><code>lvremove</code></td>
</tr>
<tr>
<td>扩展</td>
<td></td>
<td><code>vgextend</code></td>
<td><code>lvextend</code></td>
</tr>
<tr>
<td>缩小</td>
<td></td>
<td><code>vgreduce</code></td>
<td><code>lvreduce</code></td>
</tr>
</tbody></table>
<blockquote>
<p>将虚拟机还<strong>原到初始状态</strong>，并重新添加两块新硬盘设备，如图所示。然后开机。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220818110003544.png"></p>
<blockquote>
<p>在虚拟机中添加两块新硬盘设备的目的，<strong>是为了更好地演示<code>LVM</code>理念中用户无须关心底层物理硬盘</strong></p>
<p><strong>设备的特性</strong>。我们先对这两块新硬盘进行创建物理卷的操作，可以将该操作简单理解成让硬盘设备支持</p>
<p><code>LVM</code>技术，或者理解成是把硬盘设备加入到<code>LVM</code>技术可用的硬件资源池中，然后对这两块硬盘进行卷组</p>
<p>合并，卷组的名称允许由用户自定义。接下来，根据需求把合并后的卷组切割出一个约为<code>150MB</code>的逻辑</p>
<p>卷设备，最后把这个逻辑卷设备格式化成<code>Ext4</code>文件系统后挂载使用。下文将对每一个步骤做一些简单的</p>
<p>描述</p>
</blockquote>
<blockquote>
<p><strong>第1步</strong>：让新添加的两块硬盘设备支持<code>LVM</code>技术。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># pvcreate /dev/sdb /dev/sdc</span>
  Physical volume <span class="token string">"/dev/sdb"</span> successfully created.
  Physical volume <span class="token string">"/dev/sdc"</span> successfully created.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第2步</strong>：把两块硬盘设备加入到<code>storage</code>卷组中，然后查看卷组的状态。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vgcreate storage /dev/sdb /dev/sdc</span>
 Volume group <span class="token string">"storage"</span> successfully created
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vgdisplay</span>
  --- Volume group ---
  VG Name               storage
  System ID             
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  1
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                0
  Open LV               0
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               39.99 GiB
  PE Size               4.00 MiB
  Total PE              10238
  Alloc PE / Size       0 / 0   
  Free  PE / Size       10238 / 39.99 GiB
  VG UUID               HPwsm4-lOvI-8O0Q-TG54-BkyI-ONYE-owlGLd
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第3步</strong>：再切割出一个约为<code>150MB</code>的逻辑卷设备。</p>
<p>这里需要<strong>注意切割单位的问题</strong>。在对逻辑卷进行切割时有两种计量单位。第一种是以<strong>容量为单位</strong>，所使</p>
<p>用的参数为<code>-L</code>。例如，使用<code>-L 150M</code>生成一个大小为<code>150MB</code>的逻辑卷。另外一种是以<strong>基本单元的个数为</strong></p>
<p><strong>单位</strong>，所使用的参数为<code>-l</code>。每个基本单元的大小默认为<code>4MB</code>。例如，使用<code>-l 37</code>可以生成一个大小为</p>
<p><code>37×4MB=148MB</code>的逻辑卷</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># lvcreate -n vo -l 37 storage</span>
 Logical volume <span class="token string">"vo"</span> created.
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># lvdisplay </span>
  --- Logical volume ---
  LV Path                /dev/storage/vo
  LV Name                vo
  VG Name                storage
  LV UUID                AsDGJj-G6Uo-HG4q-auD6-lmyn-aLY0-o36HEj
  LV Write Access        read/write
  LV Creation host, <span class="token function">time</span> localhost.localdomain, 2021-01-15 00:47:35 +0800
  LV Status              available
  <span class="token comment" spellcheck="true"># open                 0</span>
  LV Size                148.00 MiB
  Current LE             37
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span class="token keyword">set</span> to     8192
  Block device           253:2
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第4步</strong>：把生成好的逻辑卷进行格式化，然后挂载使用。</p>
<p><code>Linux</code>系统会把<code>LVM</code>中的逻辑卷设备存放在<code>/dev</code>设备目录中（实际上就是个快捷方式），同时会以卷组</p>
<p>的名称来建立一个目录，其中保存了逻辑卷的设备映射文件（即<code>/dev/卷组名称/逻辑卷名称</code>）</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkfs.ext4 /dev/storage/vo </span>
mke2fs 1.44.3 <span class="token punctuation">(</span>10-July-2018<span class="token punctuation">)</span>
Creating filesystem with 151552 1k blocks and 38000 inodes
Filesystem UUID: 429cbc28-4463-4a1b-b601-02a7cf81a1b2
Superblock backups stored on blocks: 
    8193, 24577, 40961, 57345, 73729

Allocating group tables: <span class="token keyword">done</span>                            
Writing inode tables: <span class="token keyword">done</span>                            
Creating journal <span class="token punctuation">(</span>4096 blocks<span class="token punctuation">)</span>: <span class="token keyword">done</span>
Writing superblocks and filesystem accounting information: <span class="token keyword">done</span> 
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir /linuxprobe</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mount /dev/storage/vo /linuxprobe</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>对了，如果使用了逻辑卷管理器，则不建议用<code>XFS</code>文件系统，因为<code>XFS</code>文件系统自身就可以使用</p>
<p><code>xfs_growfs</code>命令进行磁盘扩容。这虽然不比<code>LVM</code>灵活，但起码也够用。在实测阶段我们发现，在有一些</p>
<p>服务器上，<code>XFS</code>与<code>LVM</code>的兼容性并不好</p>
</blockquote>
<blockquote>
<p><strong>第5步</strong>：查看挂载状态，并写入配置文件，使其永久生效</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># df -h</span>
Filesystem              Size  Used Avail Use% Mounted on
devtmpfs                969M     0  969M   0% /dev
tmpfs                   984M     0  984M   0% /dev/shm
tmpfs                   984M  9.6M  974M   1% /run
tmpfs                   984M     0  984M   0% /sys/fs/cgroup
/dev/mapper/rhel-root    17G  3.9G   14G  23% /
/dev/sr0                6.7G  6.7G     0 100% /media/cdrom
/dev/sda1              1014M  152M  863M  15% /boot
tmpfs                   197M   16K  197M   1% /run/user/42
tmpfs                   197M  3.4M  194M   2% /run/user/0
/dev/mapper/storage-vo  140M  1.6M  128M   2% /linuxprobe
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "/dev/storage/vo /linuxprobe ext4 defaults 0 0" >> /etc/fstab</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cat /etc/fstab</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># /etc/fstab</span>
<span class="token comment" spellcheck="true"># Created by anaconda on Tue Jul 21 05:03:40 2020</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Accessible filesystems, by reference, are maintained under '/dev/disk/'.</span>
<span class="token comment" spellcheck="true"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># After editing this file, run 'systemctl daemon-reload' to update systemd</span>
<span class="token comment" spellcheck="true"># units generated from this file.</span>
<span class="token comment" spellcheck="true">#</span>
/dev/mapper/rhel-root                       /                       xfs      defaults        0 0
UUID<span class="token operator">=</span>2db66eb4-d9c1-4522-8fab-ac074cd3ea0b   /boot                   xfs      defaults        0 0
/dev/mapper/rhel-swap                       swap                    swap     defaults        0 0
/dev/cdrom                                  /media/cdrom            iso9660  defaults        0 0 
/dev/storage/vo                             /linuxprobe             ext4     defaults        0 0
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="8-2-2、扩容逻辑卷"><a href="#8-2-2、扩容逻辑卷" class="headerlink" title="8.2.2、扩容逻辑卷"></a>8.2.2、扩容逻辑卷</h4><blockquote>
<p>在前面的实验中，卷组是由两块硬盘设备共同组成的。用户在使用存储设备时感知不到设备底层的架构</p>
<p>和布局，更不用关心底层是由多少块硬盘组成的，只要卷组中有足够的资源，就可以一直为逻辑卷扩</p>
<p>容。<strong>扩容前请一定要记得卸载设备和挂载点的关联</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># umount /linuxprobe</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p><strong>第1步</strong>：把上一个实验中的逻辑卷<code>vo</code>扩展至<code>290MB</code>。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># lvextend -L 290M /dev/storage/vo</span>
Rounding size to boundary between physical extents: 292.00 MiB.
Size of logical volume storage/vo changed from 148 MiB <span class="token punctuation">(</span>37 extents<span class="token punctuation">)</span> to 292 MiB <span class="token punctuation">(</span>73 extents<span class="token punctuation">)</span>.
Logical volume storage/vo successfully resized.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第2步</strong>：检查硬盘的完整性，确认目录结构、内容和文件内容没有丢失。一般情况下没有报错，均为正常情况</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># e2fsck -f /dev/storage/vo</span>
e2fsck 1.44.3 <span class="token punctuation">(</span>10-July-2018<span class="token punctuation">)</span>
Pass 1: Checking inodes, blocks, and sizes
Pass 2: Checking directory structure
Pass 3: Checking directory connectivity
Pass 4: Checking reference counts
Pass 5: Checking group summary information
/dev/storage/vo: 11/38000 files <span class="token punctuation">(</span>0.0% non-contiguous<span class="token punctuation">)</span>, 10453/151552 blocks
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第3步</strong>：重置设备在系统中的容量。刚刚是对<code>LV</code>（逻辑卷）设备进行了扩容操作，但系统内核还没有同</p>
<p>步到这部分新修改的信息，需要手动进行同步</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># resize2fs /dev/storage/vo</span>
resize2fs 1.44.3 <span class="token punctuation">(</span>10-July-2018<span class="token punctuation">)</span>
Resizing the filesystem on /dev/storage/vo to 299008 <span class="token punctuation">(</span>1k<span class="token punctuation">)</span> blocks.
The filesystem on /dev/storage/vo is now 299008 <span class="token punctuation">(</span>1k<span class="token punctuation">)</span> blocks long.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第4步</strong>：重新挂载硬盘设备并查看挂载状态</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mount -a</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># df -h</span>
Filesystem              Size  Used Avail Use% Mounted on
devtmpfs                969M     0  969M   0% /dev
tmpfs                   984M     0  984M   0% /dev/shm
tmpfs                   984M  9.6M  974M   1% /run
tmpfs                   984M     0  984M   0% /sys/fs/cgroup
/dev/mapper/rhel-root    17G  3.9G   14G  23% /
/dev/sr0                6.7G  6.7G     0 100% /media/cdrom
/dev/sda1              1014M  152M  863M  15% /boot
tmpfs                   197M   16K  197M   1% /run/user/42
tmpfs                   197M  3.4M  194M   2% /run/user/0
/dev/mapper/storage-vo  279M  2.1M  259M   1% /linuxprobe
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="8-2-3、缩小逻辑卷"><a href="#8-2-3、缩小逻辑卷" class="headerlink" title="8.2.3、缩小逻辑卷"></a>8.2.3、缩小逻辑卷</h4><blockquote>
<p>相较于扩容逻辑卷，在对逻辑卷进行缩容操作时，数据丢失的风险更大。所以在生产环境中执行相应操</p>
<p>作时，一定要提前备份好数据。另外，<code>Linux</code>系统规定，在对<code>LVM</code>逻辑卷进行缩容操作之前，要先检查</p>
<p>文件系统的完整性（当然这也是为了保证数据的安全）。在执行缩容操作前记得先把文件系统卸载掉。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># umount /linuxprobe</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p><strong>第1步</strong>：检查文件系统的完整性。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># e2fsck -f /dev/storage/vo</span>
e2fsck 1.44.3 <span class="token punctuation">(</span>10-July-2018<span class="token punctuation">)</span>
Pass 1: Checking inodes, blocks, and sizes
Pass 2: Checking directory structure
Pass 3: Checking directory connectivity
Pass 4: Checking reference counts
Pass 5: Checking group summary information
/dev/storage/vo: 11/74000 files <span class="token punctuation">(</span>0.0% non-contiguous<span class="token punctuation">)</span>, 15507/299008 blocks
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第2步</strong>：通知系统内核将逻辑卷<code>vo</code>的容量减小到<code>120MB</code>。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># resize2fs /dev/storage/vo 120M</span>
resize2fs 1.44.3 <span class="token punctuation">(</span>10-July-2018<span class="token punctuation">)</span>
Resizing the filesystem on /dev/storage/vo to 122880 <span class="token punctuation">(</span>1k<span class="token punctuation">)</span> blocks.
The filesystem on /dev/storage/vo is now 122880 <span class="token punctuation">(</span>1k<span class="token punctuation">)</span> blocks long.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第3步</strong>：将<code>LV</code>逻辑卷的容量修改为<code>120M</code>。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># lvreduce -L 120M /dev/storage/vo</span>
  WARNING: Reducing active logical volume to 120.00 MiB.
  THIS MAY DESTROY YOUR DATA <span class="token punctuation">(</span>filesystem etc.<span class="token punctuation">)</span>
Do you really want to reduce storage/vo? <span class="token punctuation">[</span>y/n<span class="token punctuation">]</span>: y
  Size of logical volume storage/vo changed from 292 MiB <span class="token punctuation">(</span>73 extents<span class="token punctuation">)</span> to 120 MiB <span class="token punctuation">(</span>30 extents<span class="token punctuation">)</span>.
  Logical volume storage/vo successfully resized.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>缩容操作和扩容不同的是，先通知系统内核自己想缩小逻辑卷，如果在执行<code>resize2fs</code>命令后系统没有</p>
<p>报错，再正式操作。</p>
</blockquote>
<blockquote>
<p><strong>第4步</strong>：重新挂载文件系统并查看系统状态</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mount -a</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># df -h</span>
Filesystem              Size  Used Avail Use% Mounted on
devtmpfs                969M     0  969M   0% /dev
tmpfs                   984M     0  984M   0% /dev/shm
tmpfs                   984M  9.6M  974M   1% /run
tmpfs                   984M     0  984M   0% /sys/fs/cgroup
/dev/mapper/rhel-root    17G  3.9G   14G  23% /
/dev/sr0                6.7G  6.7G     0 100% /media/cdrom
/dev/sda1              1014M  152M  863M  15% /boot
tmpfs                   197M   16K  197M   1% /run/user/42
tmpfs                   197M  3.4M  194M   2% /run/user/0
/dev/mapper/storage-vo  113M  1.6M  103M   2% /linuxprobe
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="8-2-4、逻辑卷快照"><a href="#8-2-4、逻辑卷快照" class="headerlink" title="8.2.4、逻辑卷快照"></a>8.2.4、逻辑卷快照</h4><blockquote>
<p><code>LVM</code>还具备有“<strong>快照卷</strong>”功能，该功能<strong>类似于虚拟机软件的还原时间点功能</strong>。例如，对某一个逻辑卷设备做</p>
<p>一次快照，如果日后发现数据被改错了，就可以利用之前做好的快照卷进行覆盖还原。<code>LVM</code>的快照卷功</p>
<p>能有两个特点:</p>
<ul>
<li>快照卷的容量必须等同于逻辑卷的容量；</li>
<li>快照卷仅一次有效，一旦执行还原操作后则会被立即自动删除</li>
</ul>
</blockquote>
<blockquote>
<p>在正式操作前，先看看<code>VG</code>（卷组）中的容量是否够用</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vgdisplay</span>
  --- Volume group ---
  VG Name               storage
  System ID             
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  4
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                1
  Open LV               1
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               39.99 GiB
  PE Size               4.00 MiB
  Total PE              10238
  Alloc PE / Size       30 / 120.00 MiB
  Free  PE / Size       10208 / <span class="token operator">&lt;</span>39.88 GiB
  VG UUID               k3ZnaP-wGPr-TQJ5-PCtA-0RgO-jvsi-9elZ5M
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>通过卷组的输出信息可以清晰看到，卷组中已经使用了<code>120MB</code>的容量，空闲容量还有<code>39.88GB</code>。</p>
<p><strong>接下来用重定向往逻辑卷设备所挂载的目录中写入一个文件</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "Welcome to Linuxprobe.com" > /linuxprobe/readme.txt</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -l /linuxprobe</span>
total 14
drwx------. 2 root root 12288 Jan 15 01:11 lost+found
-rw-r--r--. 1 root root    26 Jan 15 07:01 readme.txt
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第1步</strong>：使用<code>-s</code>参数生成一个快照卷，使用<code>-L</code>参数指定切割的大小，需要与要做快照的设备容量保持一</p>
<p>致。另外，还需要在命令后面写上是针对哪个逻辑卷执行的快照操作，稍后数据也会还原到这个相应的</p>
<p>设备上。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># lvcreate -L 120M -s -n SNAP /dev/storage/vo</span>
 Logical volume <span class="token string">"SNAP"</span> created
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># lvdisplay</span>
  --- Logical volume ---
  LV Path                /dev/storage/SNAP
  LV Name                SNAP
  VG Name                storage
  LV UUID                qd7l6w-3Iv1-6E3X-RGkC-t5xl-170r-rDZSEf
  LV Write Access        read/write
  LV Creation host, <span class="token function">time</span> localhost.localdomain, 2021-01-15 07:02:44 +0800
  LV snapshot status     active destination <span class="token keyword">for</span> vo
  LV Status              available
  <span class="token comment" spellcheck="true"># open                 0</span>
  LV Size                120.00 MiB
  Current LE             30
  COW-table size         120.00 MiB
  COW-table LE           30
  Allocated to snapshot  0.01%
  Snapshot chunk size    4.00 KiB
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span class="token keyword">set</span> to     8192
  Block device           253:5
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第2步</strong>：在逻辑卷所挂载的目录中创建一个<code>100MB</code>的垃圾文件，然后再查看快照卷的状态。可以发现存储</p>
<p>空间的占用量上升了。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dd if=/dev/zero of=/linuxprobe/files count=1 bs=100M</span>
1+0 records <span class="token keyword">in</span>
1+0 records out
104857600 bytes <span class="token punctuation">(</span>105 MB, 100 MiB<span class="token punctuation">)</span> copied, 0.312057 s, 336 MB/s
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># lvdisplay</span>
  --- Logical volume ---
  LV Path                /dev/storage/SNAP
  LV Name                SNAP
  VG Name                storage
  LV UUID                qd7l6w-3Iv1-6E3X-RGkC-t5xl-170r-rDZSEf
  LV Write Access        read/write
  LV Creation host, <span class="token function">time</span> localhost.localdomain, 2021-01-15 07:02:44 +0800
  LV snapshot status     active destination <span class="token keyword">for</span> vo
  LV Status              available
  <span class="token comment" spellcheck="true"># open                 0</span>
  LV Size                120.00 MiB
  Current LE             30
  COW-table size         120.00 MiB
  COW-table LE           30
  Allocated to snapshot  83.71%
  Snapshot chunk size    4.00 KiB
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span class="token keyword">set</span> to     8192
  Block device           253:5
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第3步</strong>：为了校验快照卷的效果，需要对逻辑卷进行快照还原操作。在此之前记得先卸载掉逻辑卷设备与</p>
<p>目录的挂载</p>
</blockquote>
<blockquote>
<p><code>lvconvert</code>命令用于管理逻辑卷的快照，语法格式为“<code>lvconvert</code> [参数]快照卷名称”。</p>
<p>使用<code>lvconvert</code>命令能自动回复逻辑卷的快照,在早期的<code>RHEL/[CentOS 5]</code>版本中要写全格式：</p>
<p>“<code>--mergesnapshot</code>”，而从<code>RHEL 6</code>到<code>RHEL 8</code>，已经允许用户只输入<code>--merge</code>参数进行操作了，</p>
<p>系统会自动分辨设备的类型</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># umount /linuxprobe</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># lvconvert --merge /dev/storage/SNAP</span>
  Merging of volume storage/SNAP started.
  storage/vo: Merged: 36.41%
  storage/vo: Merged: 100.00%
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第4步</strong>：快照卷会被自动删除掉，并且刚刚在逻辑卷设备被执行快照操作后再创建出来的<code>100MB</code>的垃圾文</p>
<p>件也被清除了。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mount -a</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /linuxprobe/</span>
<span class="token punctuation">[</span>root@linuxprobe linuxprobe<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
lost+found readme.txt
<span class="token punctuation">[</span>root@linuxprobe linuxprobe<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cat readme.txt </span>
Welcome to Linuxprobe.com
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="8-2-5、删除逻辑卷"><a href="#8-2-5、删除逻辑卷" class="headerlink" title="8.2.5、删除逻辑卷"></a>8.2.5、删除逻辑卷</h4><blockquote>
<p>生产环境中想要重新部署<code>LVM</code>或者不再需要使用<code>LVM</code>时，则需要执行<code>LVM</code>的删除操作。为此，需要提前</p>
<p>备份好重要的数据信息，<strong>然后依次删除逻辑卷、卷组、物理卷设备，这个顺序不可颠倒</strong>。</p>
</blockquote>
<blockquote>
<p><strong>第1步</strong>：取消逻辑卷与目录的挂载关联，删除配置文件中永久生效的设备参数</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># umount /linuxprobe</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/fstab</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># /etc/fstab</span>
<span class="token comment" spellcheck="true"># Created by anaconda on Tue Jul 21 05:03:40 2020</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Accessible filesystems, by reference, are maintained under '/dev/disk/'.</span>
<span class="token comment" spellcheck="true"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># After editing this file, run 'systemctl daemon-reload' to update systemd</span>
<span class="token comment" spellcheck="true"># units generated from this file.</span>
<span class="token comment" spellcheck="true">#</span>
/dev/mapper/rhel-root                       /                       xfs      defaults        0 0
UUID<span class="token operator">=</span>2db66eb4-d9c1-4522-8fab-ac074cd3ea0b   /boot                   xfs      defaults        0 0
/dev/mapper/rhel-swap                       swap                    swap     defaults        0 0
/dev/cdrom                                  /media/cdrom            iso9660  defaults        0 0 
/dev/storage/vo                             /linuxprobe             ext4     defaults        0 0
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第2步</strong>：删除逻辑卷设备，需要输入y来确认操作。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># lvremove /dev/storage/vo </span>
Do you really want to remove active logical volume storage/vo? <span class="token punctuation">[</span>y/n<span class="token punctuation">]</span>: y
  Logical volume <span class="token string">"vo"</span> successfully removed
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第3步</strong>：删除卷组，此处只写卷组名称即可，不需要设备的绝对路径。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vgremove storage</span>
  Volume group <span class="token string">"storage"</span> successfully removed
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第4步</strong>：删除物理卷设备。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># pvremove /dev/sdb /dev/sdc</span>
  Labels on physical volume <span class="token string">"/dev/sdb"</span> successfully wiped.
  Labels on physical volume <span class="token string">"/dev/sdc"</span> successfully wiped.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>在上述操作执行完毕之后，再执行<code>lvdisplay</code>、<code>vgdisplay</code>、<code>pvdisplay</code>命令来查看<code>LVM</code>的信息时就不</p>
<p>会再看到相关信息了（前提是上述步骤的操作是正确的）</p>
</blockquote>
<h2 id="九、使用Iptables与Firewalld防火墙"><a href="#九、使用Iptables与Firewalld防火墙" class="headerlink" title="九、使用Iptables与Firewalld防火墙"></a>九、使用<code>Iptables</code>与<code>Firewalld</code>防火墙</h2><hr>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220818134308464.png" alt="防火墙作为公网与内网之间的保护屏障"></p>
<h3 id="9-1、Iptables"><a href="#9-1、Iptables" class="headerlink" title="9.1、Iptables"></a>9.1、<code>Iptables</code></h3><blockquote>
<p>在早期的<code>Linux</code>系统中，默认使用的是<code>iptables</code>防火墙管理服务来配置防火墙。尽管新型的</p>
<p><code>firewalld</code>防火墙管理服务已经被投入使用多年，但是大量的企业在生产环境中依然出于</p>
<p>各种原因而继续使用<code>iptables</code></p>
</blockquote>
<h4 id="9-1-1、策略与规则链"><a href="#9-1-1、策略与规则链" class="headerlink" title="9.1.1、策略与规则链"></a>9.1.1、策略与规则链</h4><blockquote>
<p>防火墙会按照从上到下的顺序来读取配置的策略规则，在找到匹配项后就立即结束匹配工作并去执行匹</p>
<p>配项中定义的行为（即放行或阻止）。如果在读取完所有的策略规则之后没有匹配项，就去执行默认的</p>
<p>策略。一般而言，防火墙策略规则的设置有两种：“通”（即放行）和“堵”（即阻止）。当防火墙的默认策</p>
<p>略为拒绝时（堵），就要设置允许规则（通），否则谁都进不来；如果防火墙的默认策略为允许，就要</p>
<p>设置拒绝规则，否则谁都能进来，防火墙也就失去了防范的作用</p>
</blockquote>
<blockquote>
<p><code>iptables</code>服务把<strong>用于处理或过滤流量的策略条目</strong>称之为规则，多条规则可以组成一个规则链，而规则</p>
<p>链则依据数据包处理位置的不同进行分类，具体如下：</p>
<ul>
<li>在进行路由选择前处理数据包（<code>PREROUTING</code>）</li>
<li>处理流入的数据包（<code>INPUT</code>）</li>
<li>处理流出的数据包（<code>OUTPUT</code>）</li>
<li>处理转发的数据包（<code>FORWARD</code>）</li>
<li>在进行路由选择后处理数据包（<code>POSTROUTING</code>）</li>
</ul>
</blockquote>
<blockquote>
<p><code>iptables</code>服务的术语中分别是:</p>
<ul>
<li><code>ACCEPT</code>（允许流量通过）</li>
<li><code>REJECT</code>（拒绝流量通过）</li>
<li><code>LOG</code>（记录日志信息）</li>
<li><code>DROP</code>（拒绝流量通过）</li>
</ul>
</blockquote>
<blockquote>
<p>当把<code>Linux</code>系统中的防火墙策略设置为<code>REJECT</code>动作后，流量发送方会看到端口不可达的响应</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ping -c 4 192.168.10.10</span>
PING 192.168.10.10 <span class="token punctuation">(</span>192.168.10.10<span class="token punctuation">)</span> 56<span class="token punctuation">(</span>84<span class="token punctuation">)</span> bytes of data.
From 192.168.10.10 icmp_seq<span class="token operator">=</span>1 Destination Port Unreachable
From 192.168.10.10 icmp_seq<span class="token operator">=</span>2 Destination Port Unreachable
From 192.168.10.10 icmp_seq<span class="token operator">=</span>3 Destination Port Unreachable
From 192.168.10.10 icmp_seq<span class="token operator">=</span>4 Destination Port Unreachable
--- 192.168.10.10 <span class="token function">ping</span> statistics ---
4 packets transmitted, 0 received, +4 errors, 100% packet loss, <span class="token function">time</span> 3002ms
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>而把<code>Linux</code>系统中的防火墙策略修改成<code>DROP</code>动作后，流量发送方会看到响应超时的提醒。但是流量发送</p>
<p>方无法判断流量是被拒绝，还是接收方主机当前不在线</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ping -c 4 192.168.10.10</span>
PING 192.168.10.10 <span class="token punctuation">(</span>192.168.10.10<span class="token punctuation">)</span> 56<span class="token punctuation">(</span>84<span class="token punctuation">)</span> bytes of data.

--- 192.168.10.10 <span class="token function">ping</span> statistics ---
4 packets transmitted, 0 received, 100% packet loss, <span class="token function">time</span> 3000ms
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="9-1-2、基本的命令参数"><a href="#9-1-2、基本的命令参数" class="headerlink" title="9.1.2、基本的命令参数"></a>9.1.2、基本的命令参数</h4><blockquote>
<p>根据<code>OSI</code>七层模型的定义，<code>iptables</code>属于数据链路层的服务，所以可以根据流量的<strong>源地址</strong>、<strong>目的地址</strong>、</p>
<p><strong>传输协议</strong>、<strong>服务类型</strong>等信息进行匹配；一旦匹配成功，<code>iptables</code>就会根据策略规则所预设的动作来处理</p>
<p>这些流量。另外，再次提醒一下，防火墙策略规则的匹配顺序是从上到下的，因此要把较为严格、优先</p>
<p>级较高的策略规则放到前面，以免发生错误</p>
</blockquote>
<blockquote>
<p><code>iptables</code>中常用的参数以及作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-P</code></td>
<td>设置默认策略</td>
</tr>
<tr>
<td><code>-F</code></td>
<td>清空规则链</td>
</tr>
<tr>
<td><code>-L</code></td>
<td>查看规则链</td>
</tr>
<tr>
<td><code>-A</code></td>
<td>在规则链的末尾加入新规则</td>
</tr>
<tr>
<td><code>-I num</code></td>
<td>在规则链的头部加入新规则</td>
</tr>
<tr>
<td><code>-D num</code></td>
<td>删除某一条规则</td>
</tr>
<tr>
<td><code>-s</code></td>
<td>匹配来源地址<code>IP/MASK</code>，加叹号“!”表示除这个<code>IP</code>外</td>
</tr>
<tr>
<td><code>-d</code></td>
<td>匹配目标地址</td>
</tr>
<tr>
<td><code>-i</code> 网卡名称</td>
<td>匹配从这块网卡流入的数据</td>
</tr>
<tr>
<td><code>-o </code>网卡名称</td>
<td>匹配从这块网卡流出的数据</td>
</tr>
<tr>
<td><code>-p</code></td>
<td>匹配协议，如<code>TCP</code>、<code>UDP</code>、<code>ICMP</code></td>
</tr>
<tr>
<td><code>--dport num</code></td>
<td>匹配目标端口号</td>
</tr>
<tr>
<td><code>--sport num</code></td>
<td>匹配来源端口号</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>第一步．在<code>iptables</code>命令后添加-L参数查看已有的防火墙规则链。</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># iptables -L</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination         
ACCEPT     udp  --  anywhere             anywhere             udp dpt:domain
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:domain
ACCEPT     udp  --  anywhere             anywhere             udp dpt:bootps
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:bootps

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination         
ACCEPT     all  --  anywhere             192.168.122.0/24     ctstate RELATED,ESTABLISHED
ACCEPT     all  --  192.168.122.0/24     anywhere            
ACCEPT     all  --  anywhere             anywhere            
REJECT     all  --  anywhere             anywhere             reject-with icmp-port-unreachable
REJECT     all  --  anywhere             anywhere             reject-with icmp-port-unreachable

Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination         
ACCEPT     udp  --  anywhere             anywhere             udp dpt:bootpc
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第二部. 在<code>iptables</code>命令后添加-F参数清空已有的防火墙规则链。</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># iptables -F</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># iptables -L</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination         

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination         

Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第三步. 把<code>INPUT</code>规则链的默认策略设置为拒绝</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># iptables -P INPUT DROP</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># iptables -L</span>
Chain INPUT <span class="token punctuation">(</span>policy DROP<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination         

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination         

Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>把<code>INPUT</code>链设置为默认拒绝后，就要往里面写入允许策略了，否则所有流入的数据包都会被默认拒绝</p>
<p>掉。<strong>规则链的默认策略拒绝动作只能是<code>DROP</code>，而不能是<code>REJECT</code></strong></p>
</blockquote>
<blockquote>
<p><strong>第四步. 向<code>INPUT</code>链中添加允许<code>ICMP</code>流量进入的策略规则</strong></p>
</blockquote>
<blockquote>
<p>向防火墙的<code>INPUT</code>规则链中添加一条允许<code>ICMP</code>流量进入的策略规则就默认允许了这种<code>ping</code>命令检测行</p>
<p>为</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># iptables -I INPUT -p icmp -j ACCEPT</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ping -c 4 192.168.10.10</span>
PING 192.168.10.10 <span class="token punctuation">(</span>192.168.10.10<span class="token punctuation">)</span> 56<span class="token punctuation">(</span>84<span class="token punctuation">)</span> bytes of data.
64 bytes from 192.168.10.10: icmp_seq<span class="token operator">=</span>1 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.154 ms
64 bytes from 192.168.10.10: icmp_seq<span class="token operator">=</span>2 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.041 ms
64 bytes from 192.168.10.10: icmp_seq<span class="token operator">=</span>3 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.038 ms
64 bytes from 192.168.10.10: icmp_seq<span class="token operator">=</span>4 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.046 ms

--- 192.168.10.10 <span class="token function">ping</span> statistics ---
4 packets transmitted, 4 received, 0% packet loss, <span class="token function">time</span> 104ms
rtt min/avg/max/mdev <span class="token operator">=</span> 0.038/0.069/0.154/0.049 ms
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第五步. 删除<code>INPUT</code>规则链中刚刚加入的那条策略（允许<code>ICMP</code>流量），并把默认策略设置为允许</strong> </p>
<p>使用<code>-F</code>参数会清空已有的所有防火墙策略；</p>
<p>使用<code>-D</code>参数可以删除某一条指定的策略，因此更加安全和准确</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># iptables -D INPUT 1</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># iptables -P INPUT ACCEPT</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># iptables -L</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination         

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination         

Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第六步. 将<code>INPUT</code>规则链设置为只允许指定网段的主机访问本机的22端口，拒绝来自其他所有主机</strong></p>
<p><strong>的流量</strong></p>
</blockquote>
<blockquote>
<p>对某台主机进行匹配，可直接写出它的<code>IP</code>地址；</p>
<p>如需对网段进行匹配，则需要写为子网掩码的形式（比如192.168.10.0/24）</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># iptables -I INPUT -s 192.168.10.0/24 -p tcp --dport 22 -j ACCEPT</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># iptables -A INPUT -p tcp --dport 22 -j REJECT</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># iptables -L</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target prot opt <span class="token function">source</span> destination
 ACCEPT tcp -- 192.168.10.0/24 anywhere tcp dpt:ssh 
 REJECT tcp -- anywhere anywhere tcp dpt:ssh reject-with icmp-port-unreachable
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>在设置完上述<code>INPUT</code>规则链之后，使用<code>IP</code>地址在192.168.10.0/24网段内的主机访问服务器（即前面提</p>
<p>到的设置了<code>INPUT</code>规则链的主机）的22端口，效果如下</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@Client A ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ssh 192.168.10.10</span>
The authenticity of host <span class="token string">'192.168.10.10 (192.168.10.10)'</span> can<span class="token string">'t be established.
ECDSA key fingerprint is SHA256:5d52kZi1la/FJK4v4jibLBZhLqzGqbJAskZiME6ZXpQ.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '</span>192.168.10.10<span class="token string">' (ECDSA) to the list of known hosts.
root@192.168.10.10'</span>s password: 此处输入服务器密码
Activate the web console with: systemctl <span class="token function">enable</span> --now cockpit.socket

Last login: Wed Jan 20 16:30:28 2021 from 192.168.10.1
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>然后，再使用<code>IP</code>地址在192.168.20.0/24网段内的主机访问服务器的22端口（虽网段不同，但已确认可</p>
<p>以相互通信），效果如下</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@Client B ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ssh 192.168.10.10</span>
Connecting to 192.168.10.10:22<span class="token punctuation">..</span>.
Could not connect to <span class="token string">'192.168.10.10'</span> <span class="token punctuation">(</span>port 22<span class="token punctuation">)</span>: Connection failed.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p> 由上可以看到，提示连接请求被拒绝了（<code>Connection failed</code>）</p>
</blockquote>
<blockquote>
<p><strong>第八步. 向<code>INPUT</code>规则链中添加拒绝192.168.10.5主机访问本机80端口（<code>Web</code>服务）的策略规则</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># iptables -I INPUT -p tcp -s 192.168.10.5 --dport 80 -j REJECT</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># iptables -L</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target prot opt <span class="token function">source</span> destination 
 REJECT tcp -- 192.168.10.5 anywhere tcp dpt:http reject-with icmp-port-unreachable
 REJECT udp -- anywhere anywhere udp dpt:italk reject-with icmp-port-unreachable
 REJECT tcp -- anywhere anywhere tcp dpt:italk reject-with icmp-port-unreachable
 ACCEPT tcp -- 192.168.10.0/24 anywhere tcp dpt:ssh
 REJECT tcp -- anywhere anywhere tcp dpt:ssh reject-with icmp-port-unreachable
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第九步. 向<code>INPUT</code>规则链中添加拒绝所有主机访问本机1000～1024端口的策略规则</strong></p>
</blockquote>
<blockquote>
<p>前面在添加防火墙策略时，使用的是<code>-I</code>参数，它默认会把规则添加到最上面的位置，因此优先级是最高</p>
<p>的。如果工作中需要添加一条最后“兜底”的规则，那就用<code>-A</code>参数吧</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># iptables -A INPUT -p tcp --dport 1000:1024 -j REJECT</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># iptables -A INPUT -p udp --dport 1000:1024 -j REJECT</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># iptables -L</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target prot opt <span class="token function">source</span> destination 
 REJECT tcp -- 192.168.10.5 anywhere tcp dpt:http reject-with icmp-port-unreachable
 REJECT udp -- anywhere anywhere udp dpt:italk reject-with icmp-port-unreachable
 REJECT tcp -- anywhere anywhere tcp dpt:italk reject-with icmp-port-unreachable
 ACCEPT tcp -- 192.168.10.0/24 anywhere tcp dpt:ssh
 REJECT tcp -- anywhere anywhere tcp dpt:ssh reject-with icmp-port-unreachable
 REJECT tcp -- anywhere anywhere tcp dpts:cadlock2:1024 reject-with icmp-port-unreachable
 REJECT udp -- anywhere anywhere udp dpts:cadlock2:1024 reject-with icmp-port-unreachable
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>请特别注意，使用<code>iptables</code>命令配置的防火墙规则默认会在系统<strong>下一次重启时失效</strong>，如果想让配置的防</p>
<p>火墙策略永久生效，还要执行保存命令</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># iptables-save </span>
<span class="token comment" spellcheck="true"># Generated by xtables-save v1.8.2 on Wed Jan 20 16:56:27 2021</span>
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>对了，如果公司服务器是<code>5/6/7</code>版本的话，对应的保存命令应该是</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># service iptables save</span>
iptables: Saving firewall rules to /etc/sysconfig/iptables: <span class="token punctuation">[</span> OK <span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="9-2、Firewalld"><a href="#9-2、Firewalld" class="headerlink" title="9.2、Firewalld"></a>9.2、<code>Firewalld</code></h3><blockquote>
<p> <code>firewalld</code>中常用的区域名称及策略规则</p>
</blockquote>
<table>
<thead>
<tr>
<th>区域</th>
<th>默认规则策略</th>
</tr>
</thead>
<tbody><tr>
<td><code>trusted</code></td>
<td>允许所有的数据包</td>
</tr>
<tr>
<td><code>home</code></td>
<td>拒绝流入的流量，除非与流出的流量相关；而如果流量与<code>ssh</code>、<code>mdns</code>、<code>ipp-client</code>、<code>amba-client</code>与<code>dhcpv6-client</code>服务相关，则允许流量</td>
</tr>
<tr>
<td><code>internal</code></td>
<td>等同于home区域</td>
</tr>
<tr>
<td><code>work</code></td>
<td>拒绝流入的流量，除非与流出的流量相关；而如果流量与<code>ssh</code>、<code>ipp-client</code>与<code>dhcpv6-client</code>服务相关，则允许流量</td>
</tr>
<tr>
<td><code>public</code></td>
<td>拒绝流入的流量，除非与流出的流量相关；而如果流量与<code>ssh</code>、<code>dhcpv6-client</code>服务相关，则允许流量</td>
</tr>
<tr>
<td><code>external</code></td>
<td>拒绝流入的流量，除非与流出的流量相关；而如果流量与<code>ssh</code>服务相关，则允许流量</td>
</tr>
<tr>
<td><code>dmz</code></td>
<td>拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh服务相关，则允许流量</td>
</tr>
<tr>
<td><code>block</code></td>
<td>拒绝流入的流量，除非与流出的流量相关</td>
</tr>
<tr>
<td><code>drop</code></td>
<td>拒绝流入的流量，除非与流出的流量相关</td>
</tr>
</tbody></table>
<h4 id="9-2-1、终端管理工具"><a href="#9-2-1、终端管理工具" class="headerlink" title="9.2.1、终端管理工具"></a>9.2.1、终端管理工具</h4><blockquote>
<p> <code>firewall-cmd</code>命令中使用的参数以及作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>--get-default-zone</code></td>
<td>查询默认的区域名称</td>
</tr>
<tr>
<td><code>--set-default-zone=&lt;区域名称&gt;</code></td>
<td>设置默认的区域，使其永久生效</td>
</tr>
<tr>
<td><code>--get-zones</code></td>
<td>显示可用的区域</td>
</tr>
<tr>
<td><code>--get-services</code></td>
<td>显示预先定义的服务</td>
</tr>
<tr>
<td><code>--get-active-zones</code></td>
<td>显示当前正在使用的区域与网卡名称</td>
</tr>
<tr>
<td><code>--add-source=</code></td>
<td>将源自此<code>IP</code>或子网的流量导向指定的区域</td>
</tr>
<tr>
<td><code>--remove-source=</code></td>
<td>不再将源自此<code>IP</code>或子网的流量导向某个指定区域</td>
</tr>
<tr>
<td><code>--add-interface=&lt;网卡名称&gt;</code></td>
<td>将源自该网卡的所有流量都导向某个指定区域</td>
</tr>
<tr>
<td><code>--change-interface=&lt;网卡名称&gt;</code></td>
<td>将某个网卡与区域进行关联</td>
</tr>
<tr>
<td><code>--list-all</code></td>
<td>显示当前区域的网卡配置参数、资源、端口以及服务等信息</td>
</tr>
<tr>
<td>–list-all-zones</td>
<td>显示所有区域的网卡配置参数、资源、端口以及服务等信息</td>
</tr>
<tr>
<td><code>--add-service=&lt;服务名&gt;</code></td>
<td>设置默认区域允许该服务的流量</td>
</tr>
<tr>
<td><code>--add-port=&lt;端口号/协议&gt;</code></td>
<td>设置默认区域允许该端口的流量</td>
</tr>
<tr>
<td><code>-remove-service=&lt;服务名&gt;</code></td>
<td>设置默认区域不再允许该服务的流量</td>
</tr>
<tr>
<td><code>--remove-port=&lt;端口号/协议&gt;</code></td>
<td>设置默认区域不再允许该端口的流量</td>
</tr>
<tr>
<td><code>--reload</code></td>
<td>让“永久生效”的配置规则立即生效，并覆盖当前的配置规则</td>
</tr>
<tr>
<td><code>--panic-on</code></td>
<td>开启应急状况模式</td>
</tr>
<tr>
<td><code>--panic-off</code></td>
<td>关闭应急状况模式</td>
</tr>
</tbody></table>
<blockquote>
<p> 与<code>Linux</code>系统中其他的防火墙策略配置工具一样，使用<code>firewalld</code>配置的防火墙策略默认为运行时</p>
<p>（<code>Runtime</code>）模式，又称为当前生效模式，而且会随着系统的重启而失效。如果想让配置策略一直存</p>
<p>在，就需要使用永久（<code>Permanent</code>）模式了，方法就是在用<code>firewall-cmd</code>命令正常设置防火墙策略时</p>
<p>添加<code>--permanent</code>参数，这样配置的防火墙策略就可以永久生效了。但是，永久生效模式有一个“不近人</p>
<p>情”的特点，就是使用它设置的策略只有在系统重启之后才能自动生效。如果想让配置的策略立即生效，</p>
<p>需要手动执行<code>firewall-cmd --reload</code>命令</p>
</blockquote>
<blockquote>
<p><strong>第一步. 查看<code>firewalld</code>服务当前所使用的区域</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --get-default-zone</span>
public
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p> <strong>第二部. 查询指定网卡在<code>firewalld</code>服务中绑定的区域</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --get-zone-of-interface=ens160</span>
public
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第三步.  把网卡默认区域修改为<code>external</code>，并在系统重启后生效</strong></p>
</blockquote>
<pre><code>[root@linuxprobe ~]# firewall-cmd --permanent --zone=external --change-interface=ens160
The interface is under control of NetworkManager, setting zone to 'external'.
success
[root@linuxprobe ~]# firewall-cmd --permanent --get-zone-of-interface=ens160
external
</code></pre>
<blockquote>
<p><strong>第四步. 把<code>firewalld</code>服务的默认区域设置为<code>public</code></strong></p>
</blockquote>
<blockquote>
<p>默认区域也叫<strong>全局配置</strong>，指的是对所有网卡都生效的配置，优先级较低。在下面的代码中可以看到，当</p>
<p>前默认区域为<code>public</code>，而<code>ens160</code>网卡的区域为<code>external</code>。此时便是以网卡的区域名称为准</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --set-default-zone=public</span>
Warning: ZONE_ALREADY_SET: public
success
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --get-default-zone </span>
public
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --get-zone-of-interface=ens160</span>
externa
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第四步. 启动和关闭<code>firewalld</code>防火墙服务的应急状况模式</strong></p>
</blockquote>
<blockquote>
<p>使用<code>--panic-on</code>参数会立即<strong>切断一切网络连接</strong>，而使用<code>--panic-off</code>则会恢复网络连接。切记，紧急</p>
<p>模式会切断一切网络连接，因此在远程管理服务器时，在按下回车键前一定要三思</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --panic-on</span>
success
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --panic-off</span>
success
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第六步. 查询<code>SSH</code>和<code>HTTPS</code>协议的流量是否允许放行</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --zone=public --query-service=ssh</span>
<span class="token function">yes</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --zone=public --query-service=https</span>
no
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第七步. 把<code>HTTPS</code>协议的流量设置为永久允许放行，并立即生效</strong></p>
</blockquote>
<blockquote>
<p>默认情况下进行的修改都属于<code>Runtime模式</code>，即<strong>当前生效而重启后失效</strong>，因此在工作和考试中尽量避免</p>
<p>使用。而在使用<code>--permanent</code>参数时，则是当前不会立即看到效果，而在重启或重新加载后方可生效。</p>
<p>于是，在添加了允许放行<code>HTTPS</code>流量的策略后，查询当前模式策略，发现依然是不允许放行<code>HTTPS</code>协议</p>
<p>的流量</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --permanent --zone=public --add-service=https</span>
success
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --zone=public --query-service=https</span>
no
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>不想重启服务器的话，就用<code>--reload</code>参数吧</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --reload</span>
success
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --zone=public --query-service=https</span>
<span class="token function">yes</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第八步. 把<code>HTTP</code>协议的流量设置为永久拒绝，并立即生效</strong></p>
</blockquote>
<blockquote>
<p>由于在默认情况下<code>HTTP</code>协议的流量就没有被允许，所以会有“<code>Warning: NOT_ENABLED: http</code>”这样的提</p>
<p>示信息，因此对实际操作没有影响</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --permanent --zone=public --remove-service=http</span>
Warning: NOT_ENABLED: http
success
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --reload </span>
success
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第九步. 访问8080和8081端口的流量策略设置为允许，但仅限当前生效</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --zone=public --add-port=8080-8081/tcp</span>
success
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --zone=public --list-ports</span>
8080-8081/tcp
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p> <strong>第十步. 把原本访问本机888端口的流量转发到22端口，要且求当前和长期均有效</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --permanent --zone=public --add-forward-port=port=888:proto=tcp:toport=22:toaddr=192.168.10.10</span>
success
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --reload</span>
success
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第十一步 富规则的设置</strong></p>
</blockquote>
<blockquote>
<p>富规则也叫复规则，表示更细致、更详细的防火墙策略配置，它可以针对<strong>系统服务、端口号、源地址和</strong></p>
<p><strong>目标地址</strong>等诸多信息进行更有针对性的策略配置。<strong>它的优先级在所有的防火墙策略中也是最高的</strong>。</p>
<p>比如，我们可以在<code>firewalld</code>服务中配置一条富规则，使其拒绝<code>192.168.10.0/24</code>网段的所有用户访问</p>
<p>本机的ssh服务（22端口）</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --permanent --zone=public --add-rich-rule="rule family="ipv4" source address="192.168.10.0/24" service name="ssh" reject"</span>
success
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --reload</span>
success
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>在客户端使用<code>ssh</code>命令尝试访问<code>192.168.10.10</code>主机的ssh服务（22端口）</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@client A ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ssh 192.168.10.10</span>
Connecting to 192.168.10.10:22<span class="token punctuation">..</span>.
Could not connect to <span class="token string">'192.168.10.10'</span> <span class="token punctuation">(</span>port 22<span class="token punctuation">)</span>: Connection failed.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="9-2-2、图形管理工具"><a href="#9-2-2、图形管理工具" class="headerlink" title="9.2.2、图形管理工具"></a>9.2.2、图形管理工具</h4><blockquote>
<p><code>firewall-config</code>是<code>firewalld</code>防火墙配置管理工具的<code>GUI</code>（图形用户界面）版本，几乎可以实现所有</p>
<p>以命令行来执行的操作。在默认情况下系统并没有提供f<code>irewall-config</code>命令，我们需要自行用<code>dnf</code>命</p>
<p>令进行安装，所以需要先配置软件仓库</p>
</blockquote>
<blockquote>
<p><strong>第一步. 安装<code>firewall-config</code></strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">yum <span class="token function">install</span> firewall-config
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>安装成功后，<code>firewall-config</code>工具的界面如图所示，其功能具体如下:</p>
<ul>
<li><strong>1：</strong>选择运行时（<code>Runtime</code>）或永久（<code>Permanent</code>）模式的配置。</li>
<li><strong>2</strong>：可选的策略集合区域列表。</li>
<li><strong>3</strong>：常用的系统服务列表。</li>
<li><strong>4：</strong>主机地址的黑白名单。</li>
<li><strong>5</strong>：当前正在使用的区域。</li>
<li><strong>6</strong>：管理当前被选中区域中的服务。</li>
<li><strong>7</strong>：管理当前被选中区域中的端口。</li>
<li><strong>8：</strong>设置允许被访问的协议。</li>
<li><strong>9：</strong>设置允许被访问的端口。</li>
<li><strong>10</strong>：开启或关闭<code>SNAT</code>（源网络地址转换）技术。</li>
<li><strong>11</strong>：设置端口转发策略。</li>
<li><strong>12</strong>：控制请求<code>icmp</code>服务的流量。</li>
<li><strong>13</strong>：管理防火墙的富规则。</li>
<li><strong>14</strong>：被选中区域的服务，若勾选了相应服务前面的复选框，则表示允许与之相关的流量。</li>
<li><strong>15</strong>：<code>firewall-config</code>工具的运行状态。</li>
</ul>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220818175746469.png"></p>
<blockquote>
<p>在使用<code>firewall-config</code>工具配置完防火墙策略之后，无须进行二次确认，因为只要有修改内容，它就</p>
<p>自动进行保存</p>
</blockquote>
<blockquote>
<p>将当前区域中请求<code>http</code>服务的流量设置为允许放行，但仅限当前生效</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819091016196.png"></p>
<blockquote>
<p>尝试添加一条防火墙策略规则，使其放行访问8080～8088端口（<code>TCP</code>协议）的流量，并将其设置为永久</p>
<p>生效，以达到系统重启后防火墙策略依然生效的目的。在按照下图所示的界面配置完毕之后，还需要在</p>
<p><code>Options</code>菜单中单击<code>Reload Firewalld</code>命令，让配置的防火墙策略立即生效（见图）。这与在命令行</p>
<p>中使用<code>--reload</code>参数的效果一样</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819091239526.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819091319319.png"></p>
<blockquote>
<p><code>SNAT</code>是一种为了解决<code>IP</code>地址匮乏而设计的技术，它可以使得多个内网中的用户通过同一个外网<code>IP</code>接入</p>
<p><code>Internet</code>。该技术的应用非常广泛，甚至可以说我们每天都在使用，只不过没有察觉到罢了。比如，</p>
<p>当通过家中的网关设备（无线路由器）访问本书配套站点<a target="_blank" rel="noopener" href="https://www.linuxprobe.com/">www.linuxprobe.com</a>时，就用到了<code>SNAT</code>技术</p>
</blockquote>
<blockquote>
<p>在网络中不使用<code>SNAT</code>技术（见图“不使用<code>SNAT</code>”）和使用<code>SNAT</code>技术（见图使用<code>SNAT</code>）时的情况。</p>
<p>在图”不使用<code>SNAT</code>”所示的局域网中有多台<code>PC</code>，如果网关服务器没有应用<code>SNAT</code>技术，则互联网中的网站</p>
<p>服务器在收到<code>PC</code>的请求数据包，并回送响应数据包时，将无法在网络中找到这个私有网络的<code>IP</code>地址</p>
<p>，所以PC也就收不到响应数据包了。在图”使用<code>SNAT</code>””所示的局域网中，由于网关服务器应用了<code>SNAT</code>技</p>
<p>术，所以互联网中的网站服务器会将响应数据包发给网关服务器，再由后者转发给局域网中的PC</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819091718381.png" alt="不使用`SNAT`"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819091852766.png" alt="使用`SNAT`"></p>
<blockquote>
<p>按照下图进行配置，并选中<code>Masquerade zone</code>复选框，就自动<strong>开启了<code>SNAT</code>技术</strong></p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819091953838.png"></p>
<hr>
<blockquote>
<p>将本机888端口的流量转发到22端口，且要求当前和长期均有效，具体如图所示</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819092052351.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819092107401.png"></p>
<hr>
<blockquote>
<p>让192.168.10.20主机访问本机的1234端口号，如图所示。其中<code>Element</code>选项能够根据<strong>服务名称</strong>、<strong>端口</strong></p>
<p>号、<strong>协议</strong>等信息进行匹配；<code>Source</code>与<code>Destination</code>选项后的<code>inverted</code>复选框代表<strong>反选功能</strong>，将其选中</p>
<p>则代表对已填写信息进行反选，即选中填写信息以外的主机地址；<code>Log</code>复选框在选中后，日志不仅会被</p>
<p>记录到日志文件中，而且还可以在设置日志的级别（<code>Level</code>）后，再将日志记录到日志文件中，以方便</p>
<p>后续的筛查</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819092312603.png"></p>
<hr>
<blockquote>
<p>如果生产环境中的服务器<strong>有多块网卡在同时提供服务</strong>（这种情况很常见），则对<strong>内网</strong>和对<strong>外网</strong>提供服务</p>
<p>的网卡要选择的<strong>防火墙策略区域也是不一样的</strong>。也就是说，可以把<strong>网卡与防火墙策略区域进行绑定</strong>（见</p>
<p>图），这样就可以使用不同的防火墙区域策略，对源自不同网卡的流量进行有针对性的监控，效果会更</p>
<p>好</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819092431941.png" alt="把网卡与防火墙策略区域进行绑定"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819092449094.png" alt="网卡与策略区域绑定完成"></p>
<h3 id="9-3、服务的访问控制列表"><a href="#9-3、服务的访问控制列表" class="headerlink" title="9.3、服务的访问控制列表"></a>9.3、服务的访问控制列表</h3><blockquote>
<p> <code>TCP Wrapper</code>是<code>RHEL 6/7</code>系统中默认启用的一款流量监控程序，它能够根据来访主机的地址与本机的</p>
<p>目标服务程序做出允许或拒绝的操作。<strong>在<code>RHEL 8</code>版本中，它已经被<code>firewalld</code>正式替代</strong>。换句话说，</p>
<p><code>Linux</code>系统中其实有两个层面的防火墙，第一种是前面讲到的基于<code>TCP/IP</code>协议的流量过滤工具，而</p>
<p><code>TCP Wrapper</code>服务则是能允许或禁止<code>Linux</code>系统提供服务的防火墙，从而在更高层面保护了<code>Linux</code></p>
<p>系统的安全运行</p>
</blockquote>
<blockquote>
<p><code>TCP Wrapper</code>服务的防火墙策略由两个控制列表文件所控制，用户可以编辑允许控制列表文件来放行对</p>
<p>服务的请求流量，也可以编辑拒绝控制列表文件来阻止对服务的请求流量。控制列表文件修改后会立即</p>
<p>生效，系统将会先<strong>检查允许控制列表文件</strong>（<code>/etc/hosts.allow</code>），如果匹配到相应的允许策略则放行</p>
<p>流量；如果没有匹配，则会<strong>进一步匹配拒绝控制列表文件</strong>（<code>/etc/hosts.deny</code>），若找到匹配项则</p>
<p>拒绝该流量。如果这两个文件都没有匹配到，则默认放行流量</p>
</blockquote>
<blockquote>
<p> <code>TCP Wrappers</code>服务的控制列表文件中常用的参数</p>
</blockquote>
<table>
<thead>
<tr>
<th>客户端类型</th>
<th>示例</th>
<th>满足示例的客户端列表</th>
</tr>
</thead>
<tbody><tr>
<td>单一主机</td>
<td><code>192.168.10.10</code></td>
<td><code>IP</code>地址为<code>192.168.10.10</code>的主机</td>
</tr>
<tr>
<td>指定网段</td>
<td><code>192.168.10.</code></td>
<td><code>IP</code>段为<code>192.168.10.0/24</code>的主机</td>
</tr>
<tr>
<td>指定网段</td>
<td><code>192.168.10.0</code>/<code>255.255.255.0</code></td>
<td><code>IP</code>段为<code>192.168.10.0/24</code>的主机</td>
</tr>
<tr>
<td>指定DNS后缀</td>
<td><code>.linuxprobe.com</code></td>
<td>所有<code>DNS</code>后缀为<code>.linuxprobe.com</code>的主机</td>
</tr>
<tr>
<td>指定主机名称</td>
<td><code>www.linuxprobe.com</code></td>
<td>主机名称为<code>www.linuxprobe.com</code>的主机</td>
</tr>
<tr>
<td>指定所有客户端</td>
<td>ALL</td>
<td>所有主机全部包括在内</td>
</tr>
</tbody></table>
<blockquote>
<p>在配置<code>TCP Wrapper</code>服务时需要遵循两个原则 ： </p>
<ul>
<li>编写拒绝策略规则时，填写的是<strong>服务名称，而非协议名称</strong>；</li>
<li>建议<strong>先编写拒绝策略规则，再编写允许策略规则</strong>，以便直观地看到相应的效果。</li>
</ul>
</blockquote>
<hr>
<blockquote>
<p>下面编写拒绝策略规则文件，禁止访问本机<code>sshd</code>服务的所有流量（无须修改<code>/etc/hosts.deny</code>文件</p>
<p>中原有的注释信息）</p>
</blockquote>
<pre><code>[root@linuxprobe ~]# vim /etc/hosts.deny
#
# hosts.deny This file contains access rules which are used to
# deny connections to network services that either use
# the tcp_wrappers library or that have been
# started through a tcp_wrappers-enabled xinetd.
#
# The rules in this file can also be set up in
# /etc/hosts.allow with a 'deny' option instead.
#
# See 'man 5 hosts_options' and 'man 5 hosts_access'
# for information on rule syntax.
# See 'man tcpd' for information on tcp_wrappers
sshd:*
[root@linuxprobe ~]# ssh 192.168.10.10
ssh_exchange_identification: read: Connection reset by peer
</code></pre>
<hr>
<blockquote>
<p>接下来，在允许策略规则文件中添加一条规则，使其放行源自192.168.10.0/24网段，且访问本机<code>sshd</code></p>
<p>服务的所有流量。可以看到，服务器立刻就放行了访问<code>sshd</code>服务的流量，效果非常直观</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/hosts.allow</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># hosts.allow This file contains access rules which are used to</span>
<span class="token comment" spellcheck="true"># allow or deny connections to network services that</span>
<span class="token comment" spellcheck="true"># either use the tcp_wrappers library or that have been</span>
<span class="token comment" spellcheck="true"># started through a tcp_wrappers-enabled xinetd.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># See 'man 5 hosts_options' and 'man 5 hosts_access'</span>
<span class="token comment" spellcheck="true"># for information on rule syntax.</span>
<span class="token comment" spellcheck="true"># See 'man tcpd' for information on tcp_wrappers</span>
sshd:192.168.10.

<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ssh 192.168.10.10</span>
The authenticity of host <span class="token string">'192.168.10.10 (192.168.10.10)'</span> can<span class="token string">'t be established.
ECDSA key fingerprint is 70:3b:5d:37:96:7b:2e:a5:28:0d:7e:dc:47:6a:fe:5c.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '</span>192.168.10.10<span class="token string">' (ECDSA) to the list of known hosts.
root@192.168.10.10'</span>s password: 
Last login: Wed May 4 07:56:29 2021
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="9-4、驾驶舱管理工具"><a href="#9-4、驾驶舱管理工具" class="headerlink" title="9.4、驾驶舱管理工具"></a>9.4、驾驶舱管理工具</h3><blockquote>
<p><code>Cockpit</code>是一个基于<code>Web</code>的图形化服务管理工具，对用户相当友好，即便是新手也可以轻松上手。而且</p>
<p>它天然具备很好的跨平台性，因此被广泛应用于服务器、容器、虚拟机等多种管理场景。最后，红帽公</p>
<p>司对<code>Cockpit</code>也十分看重，直接将它默认安装到了<code>RHEL 8</code>系统中，由此衍生的<code>CentOS</code>和<code>Fedora</code>也都</p>
<p>标配有<code>Cockpit</code></p>
</blockquote>
<blockquote>
<p><code>Cockpit</code>在默认情况下就已经被安装到系统中。下面执行<code>dnf</code>命令对此进行确认</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dnf install cockpit</span>
Updating Subscription Management repositories.
Unable to <span class="token function">read</span> consumer identity
This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.
AppStream                                       3.1 MB/s <span class="token operator">|</span> 3.2 kB     00:00    
BaseOS                                          2.7 MB/s <span class="token operator">|</span> 2.7 kB     00:00    
Package cockpit-185-2.el8.x86_64 is already installed.
Dependencies resolved.
Nothing to do.
Complete<span class="token operator">!</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<blockquote>
<p><code>Cockpit</code>服务程序在<code>RHEL 8</code>版本中没有自动运行，下面将它开启并加入到开机启动项中</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl start cockpit</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl enable cockpit.socket</span>
Created symlink /etc/systemd/system/sockets.target.wants/cockpit.socket → /usr/lib/systemd/system/cockpit.socket.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>输入“本机地址:9090”即可访问</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819100354401.png"></p>
<blockquote>
<p>进入到<code>Cockpit</code>网页界面后可谓是别有洞天，总共分为十三个功能模块，</p>
<p>即：系统状态、日志信息、硬盘存储、网卡网络、账户安全、服务程序、软件仓库、报告分析、</p>
<p>内核排错、<code>SElinux</code>、更新软件、订阅服务、终端界面</p>
</blockquote>
<hr>
<blockquote>
<p><code>System</code></p>
</blockquote>
<blockquote>
<p>进入<code>Cockpit</code>界面后默认显示的便是<code>System</code>（系统）界面，在该界面中能够看到系<strong>统架构</strong>、</p>
<p><strong>版本</strong>、<strong>主机名</strong>与<strong>时间</strong>等信息，还能够动态地展现出<strong>CPU</strong>、<strong>硬盘</strong>、<strong>内存</strong>和<strong>网络</strong>的复杂情况，这有</p>
<p>点类似于<code>Web</code>版的“<code>Winodws</code>系统任务管理器”</p>
</blockquote>
<hr>
<blockquote>
<p><code>Logs</code></p>
</blockquote>
<blockquote>
<p>这个模块能够<strong>提供系统的全部日志</strong>，但是“为什么图中的内容这么有限呢”？原因出在图中的两个选项中：</p>
<p><strong>时间</strong>和<strong>日志级别</strong>。通过这两个选项可以让用户更快地找到所需信息，而不是像<code>/var/log/message</code>文件</p>
<p>那样一股脑儿地都抛给用户</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819100705266.png"></p>
<hr>
<blockquote>
<p><code>Storage</code></p>
</blockquote>
<blockquote>
<p>这个模块显示了硬盘的<code>I/O</code>读写负载情况，也可以让用户通过该界面，用鼠标创建出</p>
<p><code>RAID</code>、<code>LVM</code>、<code>VDO</code>和<code>iSCSI</code>等存储设备</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819100828009.png"></p>
<hr>
<blockquote>
<p><code>Networking</code></p>
</blockquote>
<blockquote>
<p>动态看网卡的输出和接收值肯定是这个模块的标配功能了。</p>
<p>我们不仅可以在这里进行网卡的绑定（<code>Bonding</code>）和聚合（<code>Team</code>），还可以创建桥接网卡及添加</p>
<p><code>VLAN</code>。图的最下方会单独列出与网卡相关的日志信息。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819100927420.png"></p>
<hr>
<blockquote>
<p><code>Accounts</code></p>
</blockquote>
<blockquote>
<p> 我们在这里可以对用户进行重命名，设置用户的权限，还可以锁定、修改密码以及创建SSH密钥信息</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819101023345.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819101034720.png"></p>
<hr>
<blockquote>
<p><code>Services</code></p>
</blockquote>
<blockquote>
<p> 在<code>Services</code>功能模块的界面中，可以查看系统中已有的服务列表和运行状态。</p>
<p>单击某一服务，进入该服务的管理界面后（见图），可以对具体的服务进行<strong>开启</strong>、<strong>关闭</strong>操作。</p>
<p>在<code>Services</code>功能模块中设置了服务并将其加入到开机启动项后，在系统重启后也依然会为用户提供服</p>
<p>务。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819101204960.png" alt="服务程序界面"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819101221620.png" alt="服务管理界面"></p>
<hr>
<blockquote>
<p><code>Applications</code></p>
</blockquote>
<blockquote>
<p> 后期采用<code>Cockpit</code>或红帽订阅服务安装的软件都会显示在这个功能模块中</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819101307795.png" alt="软件仓库界面"></p>
<hr>
<blockquote>
<p><code>Diagnostic Report</code></p>
</blockquote>
<blockquote>
<p> <code>Diagnostic Report</code>模块的功能是帮助用户收集及分析系统的信息，找到系统出现问题的原因。</p>
<p>单击<code>Create Report</code>按钮后大约两分钟左右，会出现如图所示的界面。好吧，摊牌了，这个功能其实很</p>
<p>鸡肋，就是将<code>sosreport</code>命令做成了一个网页按钮</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819101431173.png" alt="报告分析界面"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819101447941.png" alt="告生成完毕"></p>
<hr>
<blockquote>
<p><code>Kernel Dump</code></p>
</blockquote>
<blockquote>
<p><code>Kernel Dump</code>（<code>Kdump</code>）是一个在<strong>系统崩溃、死锁或死机时用来收集内核参数的一个服务</strong>。举例来说，</p>
<p>如果有一天系统崩溃了，这时<code>Kdump</code>服务就会开始工作，将系统的运行状态和内核数据收集到一个名为</p>
<p><code>dump core</code>的文件中，以便后续让运维人员分析并找出问题所在。由于我们在安装系统时没有启动该服</p>
<p>务，所以可以等到后续使用时再开启该功能界面</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819101556129.png" alt="内核排错界面"></p>
<hr>
<blockquote>
<p><code>SElinux</code></p>
</blockquote>
<blockquote>
<p>图所示为<code>SELinux</code>服务的控制按钮和警告信息界面。第11章将详细介绍<code>SELinux</code>安全子系统，这里</p>
<p>暂时略过</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819101651622.png" alt=" SElinux管理界面"></p>
<hr>
<blockquote>
<p><code>Software Updates</code></p>
</blockquote>
<blockquote>
<p><code>Software Updates</code>功能模块的界面如图所示。这里提到的<code>Software Updates</code>并不是我们用来更新其</p>
<p>他<strong>常规软件</strong>的一个界面，而是用来对红帽客户订阅的服务进行更新的界面。用户只有在购<strong>买了红帽第三</strong></p>
<p><strong>方服务后</strong>才能使用这里面的功能。在购买了红帽订阅服务后，用户便可以在这里下载到相应服务程序的</p>
<p>最新版本和稳定版本</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819101829456.png" alt="更新软件界面"></p>
<hr>
<blockquote>
<p><code>Subscriptions</code></p>
</blockquote>
<blockquote>
<p><code>subscriptions</code>功能模块的界面如图所示。里依然是一则红帽公司的“小广告”—如果想成为尊贵的红帽</p>
<p>服务用户，要付费购买订阅服务。个人用户无须购买。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819101922336.png" alt="订阅服务界面"></p>
<hr>
<blockquote>
<p><code>Terminal</code></p>
</blockquote>
<blockquote>
<p><code>Terminal</code>功能模块的界面如图所示。<code>Cockpit</code>服务提供了<code>Shell</code>终端的在线控制平台，可方便用户通</p>
<p>过网页上的终端功能管理服务器。这个功能深受运维人员喜爱</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819102011142.png"></p>
<h2 id="十、使用ssh服务管理远程主机"><a href="#十、使用ssh服务管理远程主机" class="headerlink" title="十、使用ssh服务管理远程主机"></a>十、使用ssh服务管理远程主机</h2><hr>
<h3 id="10-1、配置网卡服务"><a href="#10-1、配置网卡服务" class="headerlink" title="10.1、配置网卡服务"></a>10.1、配置网卡服务</h3><h4 id="10-1-1、配置网卡参数"><a href="#10-1-1、配置网卡参数" class="headerlink" title="10.1.1、配置网卡参数"></a>10.1.1、配置网卡参数</h4><blockquote>
<p>使用<code>nmtui</code>命令来配置网络</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819105026043.png" alt="1 执行nmtui命令运行网络配置工具"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819105055980.png" alt="2 选中配置网卡按钮并按下回车键"></p>
<blockquote>
<p>在<code>RHEL 5</code>、<code>RHEL 6</code>系统及其他大多数早期的<code>Linux</code>系统中，网卡的名称一直都是<code>eth0</code>、<code>eth1</code>、</p>
<p><code>eth2</code>、……；在<code>RHEL 7</code>中则变成了类似于<code>eno16777736</code>这样的名字；而在<code>RHEL 8</code>系统中网卡的最新名</p>
<p>称是类似于<code>ens160</code>、<code>ens192</code>这样的，不过除了网卡的名称发生变化之外，其他一切几乎照旧</p>
</blockquote>
<blockquote>
<p> 在服务器主机的网络配置信息中填写<code>IP</code>地址192.168.10.10/24。24表示子网掩码中的前24位为网络</p>
<p>号，后8位是主机号（与写成255.255.255.0的效果一样）。网关、<code>DNS</code>等信息暂可不必填写，等用到时</p>
<p>再补充</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819105250920.png" alt="3 选中要配置的网卡名称，然后按下编辑按钮"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819105304964.png" alt="4 把网卡IPv4的配置方式改成手动模式"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819105336597.png" alt="5 按下显示详细信息按钮"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819105358242.png" alt="6 填写IP地址和子网掩码"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819105411498.png" alt="7 单击OK按钮保存配置"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819105427087.png" alt="8 单击Back按钮结束配置工作"></p>
<blockquote>
<p>只需使用<code>Vim</code>编辑器将网卡配置文件中的<code>ONBOOT</code>参数修改成<code>yes</code>，这样在系统重启后网卡就被激活了</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/sysconfig/network-scripts/ifcfg-ens160</span>
TYPE<span class="token operator">=</span>Ethernet
PROXY_METHOD<span class="token operator">=</span>none
BROWSER_ONLY<span class="token operator">=</span>no
BOOTPROTO<span class="token operator">=</span>none
DEFROUTE<span class="token operator">=</span>yes
IPV4_FAILURE_FATAL<span class="token operator">=</span>no
IPV6INIT<span class="token operator">=</span>yes
IPV6_AUTOCONF<span class="token operator">=</span>yes
IPV6_DEFROUTE<span class="token operator">=</span>yes
IPV6_FAILURE_FATAL<span class="token operator">=</span>no
IPV6_ADDR_GEN_MODE<span class="token operator">=</span>stable-privacy
NAME<span class="token operator">=</span>ens160
UUID<span class="token operator">=</span>97486c86-6d1e-4e99-9aa2-68d3172098b2
DEVICE<span class="token operator">=</span>ens160
ONBOOT<span class="token operator">=</span>yes
HWADDR<span class="token operator">=</span>00:0C:29:7D:27:BF
IPADDR<span class="token operator">=</span>192.168.10.10
PREFIX<span class="token operator">=</span>24
IPV6_PRIVACY<span class="token operator">=</span>no
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>要想让服务程序获取到最新的配置文件，需要手动重启相应的服务，之后就可以看到网络畅通了</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection reload ens160</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection up ens160</span>
Connection successfully activated <span class="token punctuation">(</span>D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/6<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ping 192.168.10.10</span>
PING 192.168.10.10 <span class="token punctuation">(</span>192.168.10.10<span class="token punctuation">)</span> 56<span class="token punctuation">(</span>84<span class="token punctuation">)</span> bytes of data.
64 bytes from 192.168.10.10: icmp_seq<span class="token operator">=</span>1 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.122 ms
64 bytes from 192.168.10.10: icmp_seq<span class="token operator">=</span>2 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.048 ms
64 bytes from 192.168.10.10: icmp_seq<span class="token operator">=</span>3 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.106 ms
64 bytes from 192.168.10.10: icmp_seq<span class="token operator">=</span>4 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.043 ms

--- 192.168.10.10 <span class="token function">ping</span> statistics ---
4 packets transmitted, 4 received, 0% packet loss, <span class="token function">time</span> 61ms
rtt min/avg/max/mdev <span class="token operator">=</span> 0.043/0.079/0.122/0.036 ms
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="10-1-2、创建网络会话"><a href="#10-1-2、创建网络会话" class="headerlink" title="10.1.2、创建网络会话"></a>10.1.2、创建网络会话</h4><blockquote>
<p><code>RHEL</code>和<code>CentOS</code>系统默认使用<code>NetworkManager</code>来提供网络服务，这是一种动态管理网络配置的守护进程，能够让网络设备保持连接状态。可以使用<code>nmcli</code>命令来管理<code>NetworkManager</code>服务程序。<code>nmcli</code>是一款基于命令行的网络配置工具，功能丰富，参数众多。它可以轻松地查看网络信息或网络状态</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection show</span>
NAME    UUID                                  TYPE      DEVICE 
ens160  97486c86-6d1e-4e99-9aa2-68d3172098b2  ethernet  ens160 
virbr0  e5fca1ee-7020-4c21-a65b-259d0f993b44  bridge    virbr0
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection show ens160 </span>
connection.id:                          ens160
connection.uuid:                        97486c86-6d1e-4e99-9aa2-68d3172098b2
connection.stable-id:                   --
connection.type:                        802-3-ethernet
connection.interface-name:              ens160
connection.autoconnect:                 <span class="token function">yes</span>
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>外，<code>RHEL 8</code>系统支持网络会话功能，允许用户在多个配置文件中快速切换（非常类似于<code>firewalld</code>防</p>
<p>火墙服务中的区域技术）。如果我们在公司网络中使用笔记本电脑时需要手动指定网络的<code>IP</code>地址，而回</p>
<p>到家中则是使用<code>DHCP</code>自动分配<code>IP</code>地址，这就需要麻烦地频繁修改<code>IP</code>地址，但是使用了网络会话功能后</p>
<p>一切就简单多了—只需在不同的使用环境中激活相应的网络会话，就可以实现网络配置信息的自动切换</p>
<p>了</p>
</blockquote>
<blockquote>
<p>使用<code>nmcli</code>命令并按照“<code>connection add con-name type ifname</code>”的格式来创建网络会话。假设将公</p>
<p>司网络中的网络会话称之为<code>company</code>，将家庭网络中的网络会话称之为<code>house</code>，现在依次创建各自的网</p>
<p>络会话</p>
</blockquote>
<hr>
<blockquote>
<p>使用<code>con-name</code>参数指定公司所使用的网络会话名称<code>company</code>，然后依次用<code>ifname</code>参数指定本机的网卡</p>
<p>名称（千万要以实际环境为准，不要照抄书上的<code>ens160</code>），用<code>autoconnect no</code>参数将网络会话设置为</p>
<p>默认不被自动激活，以及用<code>ip4</code>及<code>gw4</code>参数手动指定网络的<code>IP</code>地址</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection add con-name company ifname ens160 autoconnect no type ethernet ip4 192.168.10.10/24 gw4 192.168.10.1</span>
Connection <span class="token string">'company'</span> <span class="token punctuation">(</span>6ac8f3ad-0846-42f4-819a-e1ae84f4da86<span class="token punctuation">)</span> successfully added.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>使用<code>con-name</code>参数指定家庭所使用的网络会话名称<code>house</code>。因为要从外部<code>DHCP</code>服务器自动获得<code>IP</code>地</p>
<p>址，所以这里不需要进行手动指定</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection add con-name house type ethernet ifname ens160</span>
Connection <span class="token string">'house'</span> <span class="token punctuation">(</span>d848242a-4bdf-4446-9079-6e12ab5d1f15<span class="token punctuation">)</span> successfully added.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>在成功创建网络会话后，可以使用<code>nmcli</code>命令查看创建的所有网络会话</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection show</span>
NAME     UUID                                  TYPE      DEVICE 
ens160   97486c86-6d1e-4e99-9aa2-68d3172098b2  ethernet  ens160 
virbr0   e5fca1ee-7020-4c21-a65b-259d0f993b44  bridge    virbr0 
company  6ac8f3ad-0846-42f4-819a-e1ae84f4da86  ethernet  --     
house    d848242a-4bdf-4446-9079-6e12ab5d1f15  ethernet  --  
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>使用<code>nmcli</code>命令配置过的网络会话是永久生效的，这样当我们上班后，顺手启动<code>company</code>网络会话，网</p>
<p>卡信息就自动配置好了</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection up company </span>
Connection successfully activated <span class="token punctuation">(</span>D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/6<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ifconfig</span>
ens160: flags<span class="token operator">=</span>4163<span class="token operator">&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">></span>  mtu 1500
        inet 192.168.10.88  netmask 255.255.255.0  broadcast 192.168.10.255
        inet6 fe80::320e:a005:dfa1:431c  prefixlen 64  scopeid 0x20
        ether 00:0c:29:7d:27:bf  txqueuelen 1000  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets 66  bytes 5469 <span class="token punctuation">(</span>5.3 KiB<span class="token punctuation">)</span>
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 99  bytes 11255 <span class="token punctuation">(</span>10.9 KiB<span class="token punctuation">)</span>
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>如果大家使用的是虚拟机，请把虚拟机系统的网卡（网络适配器）切换成桥接模式，如图9所示。然后重</p>
<p>启虚拟机系统即可。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819110342395.png" alt="9 设置虚拟机网卡的模式"></p>
<blockquote>
<p>启动house家庭会话</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection up house</span>
Connection successfully activated <span class="token punctuation">(</span>D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/4<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ifconfig</span>
ens160: flags<span class="token operator">=</span>4163<span class="token operator">&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">></span>  mtu 1500
        inet 192.168.0.107  netmask 255.255.255.0  broadcast 192.168.0.255
        inet6 fe80::f209:dc47:4004:3868  prefixlen 64  scopeid 0x20
        ether 00:0c:29:7d:27:bf  txqueuelen 1000  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets 22  bytes 6924 <span class="token punctuation">(</span>6.7 KiB<span class="token punctuation">)</span>
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 82  bytes 10582 <span class="token punctuation">(</span>10.3 KiB<span class="token punctuation">)</span>
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>后续不需要网络会话时，直接用<code>delete</code>命令就能删除，特别简单</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection delete house</span>
Connection <span class="token string">'house'</span> <span class="token punctuation">(</span>d848242a-4bdf-4446-9079-6e12ab5d1f15<span class="token punctuation">)</span> successfully deleted.
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection delete company </span>
Connection <span class="token string">'company'</span> <span class="token punctuation">(</span>6ac8f3ad-0846-42f4-819a-e1ae84f4da86<span class="token punctuation">)</span> successfully deleted.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="10-1-3、绑定两块网卡"><a href="#10-1-3、绑定两块网卡" class="headerlink" title="10.1.3、绑定两块网卡"></a>10.1.3、绑定两块网卡</h4><blockquote>
<p>在虚拟机系统中再添加一块网卡设备，请确保两块网卡都处在同一种网络连接模式中，如图10和图11所</p>
<p>示。<strong>处于相同模式的网卡设备才可以进行网卡绑定</strong>，否则这两块网卡无法互相传送数据</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819110636479.png" alt="10 在虚拟机中再添加一块网卡设备"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819110652672.png" alt="11 确保两块网卡处在同一个网络连接中（即网卡模式相同"></p>
<blockquote>
<p>网卡绑定的理论知识类似于前面学习的<code>RAID</code>硬盘组，我们需要对参与绑定的网卡设备逐个进行“初始设</p>
<p>置”。需要注意的是，如图12所示，左侧的<code>ens160</code>及<code>ens192</code>这些原本独立的网卡设备此时需要被配置成</p>
<p>为一块“从属”网卡，服务于右侧的<code>bond0</code>“主”网卡，不应该再有自己的<code>IP</code>地址等信息。在进行了初始设</p>
<p>置之后，它们就可以支持网卡绑定</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819110824705.png" alt="12 网卡绑定信息示意图"></p>
<blockquote>
<p><strong>第一步、创建出一个bond网卡</strong></p>
</blockquote>
<blockquote>
<p>首先使用如下命令创建一个<code>bond</code>网卡。其中，命令与参数的意思是创建一个类型为<code>bond</code>（绑定）、名</p>
<p>称为<code>bond0</code>、网卡名为<code>bond0</code>的绑定设备，绑定模式为<code>balance-rr</code></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection add type bond con-name bond0 ifname bond0 bond.options "mode=balance-rr"</span>
Connection <span class="token string">'bond0'</span> <span class="token punctuation">(</span>b37b720d-c5fa-43f8-8578-820d19811f32<span class="token punctuation">)</span> successfully added.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>这里使用的是<code>balance-rr</code>网卡绑定模式，其中<code>rr</code>是<code>round-robin</code>的缩写，全称为轮循模式。</p>
<p><code>round-robin</code>的特点是<strong>会根据设备顺序依次传输数据包，提供负载均衡的效果</strong>，让带宽的性能更好一</p>
<p>些；而且一旦某个网卡发生故障，会马上切换到另外一台网卡设备上，保证网络传输不被中断。</p>
<p><code>active-backup</code>是另外一种比较常用的网卡绑定模式，它的特点是平时只有一块网卡正常工作，另一个</p>
<p>网卡随时待命，一旦工作中的网卡发生损坏，待命的网卡会自动顶替上去。可见，这种网卡绑定模式的</p>
<p>冗余能力比较强，因此也称为主备模式</p>
</blockquote>
<blockquote>
<p><strong>第二部、向<code>bond0</code>添加从属网卡</strong></p>
</blockquote>
<blockquote>
<p>刚才创建成功的<code>bond0</code>设备当前仅仅是个名称，里面并没有真正能为用户传输数据的网卡设备，接下</p>
<p>来使用下面的命令把<code>ens160</code>和<code>ens192</code>网卡添加进来。其中，<code>con-name</code>参数后面接的是从属网卡的名</p>
<p>称（可以随时设置）；<code>ifname</code>参数后面接的是两块网卡的名称。大家一定要以真实的网卡名称为准，不</p>
<p>要直接复制这里的名字</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection add type ethernet slave-type bond con-name bond0-port1 ifname ens160 master bond0</span>
Connection <span class="token string">'bond0-port1'</span> <span class="token punctuation">(</span>8a2f77ee-cc92-4c11-9292-d577ccf8753d<span class="token punctuation">)</span> successfully added.
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection add type ethernet slave-type bond con-name bond0-port2 ifname ens192 master bond0</span>
Connection <span class="token string">'bond0-port2'</span> <span class="token punctuation">(</span>b1ca9c47-3051-480a-9623-fbe4bf731a89<span class="token punctuation">)</span> successfully added.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第三步、配置<code>bond0</code>设备的网卡信息</strong></p>
</blockquote>
<blockquote>
<p>用<code>nmcli</code>命令依次配置网络的<code>IP</code>地址及子网掩码、网关、<code>DNS</code>、搜索域和手动配置等参数</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection modify bond0 ipv4.addresses 192.168.10.10/24</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection modify bond0 ipv4.gateway 192.168.10.1</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection modify bond0 ipv4.dns 192.168.10.1</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection modify bond0 ipv4.dns-search linuxprobe.com</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection modify bond0 ipv4.method manual</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第四步、启动</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli connection up bond0</span>
Connection successfully activated <span class="token punctuation">(</span>master waiting <span class="token keyword">for</span> slaves<span class="token punctuation">)</span> <span class="token punctuation">(</span>D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/22<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nmcli device status</span>
DEVICE      TYPE      STATE      CONNECTION  
bond0       bond      connected  bond0       
ens160      ethernet  connected  ens160      
virbr0      bridge    connected  virbr0      
ens192      ethernet  connected  bond0-port2 
lo          loopback  unmanaged  --          
virbr0-nic  tun       unmanaged  --
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>当用户接下来访问主机<code>IP</code>地址192.168.10.10时，主机实际上是由两块网卡在共同提供服务。可以在本</p>
<p>地主机执行<code>ping 192.168.10.10</code>命令检查网络的连通性。为了检验网卡绑定技术的自动备援功能，可</p>
<p>以突然在虚拟机硬件配置中随机移除一块网卡设备，如图13所示</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819111624891.png" alt="13 随机移除掉任意一块网卡"></p>
<blockquote>
<p>可以非常清晰地看到网卡切换的过程（一般只丢失一个数据包），另外一块网卡会继续为用户提供服</p>
<p>务。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ping 192.168.10.10</span>
PING 192.168.10.10 <span class="token punctuation">(</span>192.168.10.10<span class="token punctuation">)</span> 56<span class="token punctuation">(</span>84<span class="token punctuation">)</span> bytes of data.
64 bytes from 192.168.10.10: icmp_seq<span class="token operator">=</span>1 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.109 ms
64 bytes from 192.168.10.10: icmp_seq<span class="token operator">=</span>2 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.102 ms
64 bytes from 192.168.10.10: icmp_seq<span class="token operator">=</span>3 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.066 ms
ping: sendmsg: Network is unreachable
64 bytes from 192.168.10.10: icmp_seq<span class="token operator">=</span>5 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.065 ms
64 bytes from 192.168.10.10: icmp_seq<span class="token operator">=</span>6 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.048 ms
64 bytes from 192.168.10.10: icmp_seq<span class="token operator">=</span>7 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.042 ms
64 bytes from 192.168.10.10: icmp_seq<span class="token operator">=</span>8 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.079 ms
^C
--- 192.168.10.10 <span class="token function">ping</span> statistics ---
8 packets transmitted, 7 received, 12% packet loss, <span class="token function">time</span> 7006ms
rtt min/avg/max/mdev <span class="token operator">=</span> 0.042/0.073/0.109/0.023 ms
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>由于在<code>RHEL 8</code>系统中，网卡绑定切换间隔为1毫秒（也就是1/1000秒），因此发生一个丢包的情况大概</p>
<p>率不会出现。</p>
</blockquote>
<h3 id="10-2、远程控制服务"><a href="#10-2、远程控制服务" class="headerlink" title="10.2、远程控制服务"></a>10.2、远程控制服务</h3><h4 id="10-2-1、配置sshd服务"><a href="#10-2-1、配置sshd服务" class="headerlink" title="10.2.1、配置sshd服务"></a>10.2.1、配置<code>sshd</code>服务</h4><blockquote>
<p><code>sshd</code>是基于<code>SSH</code>协议开发的一款远程管理服务程序，不仅使用起来方便快捷，而且能够提供两种安全验</p>
<p>证的方法：</p>
<ul>
<li><strong>基于密码的验证</strong>—用账户和密码来验证登录；</li>
<li><strong>基于密钥的验证</strong>—需要在本地生成密钥对，然后把密钥对中的公钥上传至服务器，并与服务器中的公钥进行比较；该方式相较来说更安全。</li>
</ul>
</blockquote>
<blockquote>
<p><code>sshd</code>服务的配置信息保存在<code>/etc/ssh/sshd_config</code>文件中。</p>
</blockquote>
<blockquote>
<p><code>sshd</code>服务配置文件中包含的参数以及作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>Port 22</code></td>
<td>默认的<code>sshd</code>服务端口</td>
</tr>
<tr>
<td><code>ListenAddress 0.0.0.0</code></td>
<td>设定<code>sshd</code>服务器监听的<code>IP</code>地址</td>
</tr>
<tr>
<td><code>Protocol 2</code></td>
<td><code>SSH</code>协议的版本号</td>
</tr>
<tr>
<td><code>HostKey /tc/ssh/ssh_host_key</code></td>
<td><code>SSH</code>协议版本为1时，<code>DES</code>私钥存放的位置</td>
</tr>
<tr>
<td><code>HostKey /etc/ssh/ssh_host_rsa_key</code></td>
<td><code>SSH</code>协议版本为2时，<code>RSA</code>私钥存放的位置</td>
</tr>
<tr>
<td><code>HostKey /etc/ssh/ssh_host_dsa_key</code></td>
<td><code>SSH</code>协议版本为2时，<code>DSA</code>私钥存放的位置</td>
</tr>
<tr>
<td><code>PermitRootLogin yes</code></td>
<td>设定是否允许<code>root</code>管理员直接登录</td>
</tr>
<tr>
<td><code>StrictModes yes</code></td>
<td>当远程用户的私钥改变时直接拒绝连接</td>
</tr>
<tr>
<td><code>MaxAuthTries 6</code></td>
<td>最大密码尝试次数</td>
</tr>
<tr>
<td><code>MaxSessions 10</code></td>
<td>最大终端数</td>
</tr>
<tr>
<td><code>PasswordAuthentication yes</code></td>
<td>是否允许密码验证</td>
</tr>
<tr>
<td><code>PermitEmptyPasswords no</code></td>
<td>是否允许空密码登录（很不安全）</td>
</tr>
</tbody></table>
<blockquote>
<p><code>sshd</code>服务实验机器简介</p>
</blockquote>
<table>
<thead>
<tr>
<th>主机地址</th>
<th>操作系统</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.10.10</td>
<td>Linux</td>
<td>服务器</td>
</tr>
<tr>
<td>192.168.10.20</td>
<td>Linux</td>
<td>客户端</td>
</tr>
</tbody></table>
<blockquote>
<p>接下来在客户端使用ssh命令远程连接服务器，其格式为“<code>ssh</code> [参数]主机<code>IP</code>地址”，要退出登录则执行</p>
<p><code>exit</code>命令。第一次访问时需要输入<code>yes</code>来确认对方主机的指纹信息</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@Client ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ssh 192.168.10.10</span>
The authenticity of host <span class="token string">'192.168.10.10 (192.168.10.10)'</span> can<span class="token string">'t be established.
ECDSA key fingerprint is SHA256:5d52kZi1la/FJK4v4jibLBZhLqzGqbJAskZiME6ZXpQ.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '</span>192.168.10.10<span class="token string">' (ECDSA) to the list of known hosts.
root@192.168.10.10'</span>s password: 此处输入服务器管理员密码
Activate the web console with: systemctl <span class="token function">enable</span> --now cockpit.socket

Last login: Fri Jul 24 06:26:58 2020
<span class="token punctuation">[</span>root@Server ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span>
<span class="token punctuation">[</span>root@Server ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># exit</span>
<span class="token function">logout</span>
Connection to 192.168.10.10 closed.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>先使用Vim文本编辑器打开服务器上的<code>sshd</code>服务主配置文件，然后把第46行<code>#PermitRootLogin yes</code></p>
<p>参数前的井号（#）去掉，并把参数值<code>yes</code>改成<code>no</code>，这样就不再允许<code>root</code>管理员远程登录了</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@Server ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/ssh/sshd_config </span>
 ………………省略部分输出信息………………
 43 <span class="token comment" spellcheck="true"># Authentication:</span>
 44 
 45 <span class="token comment" spellcheck="true">#LoginGraceTime 2m</span>
 46 PermitRootLogin no
 47 <span class="token comment" spellcheck="true">#StrictModes yes</span>
 48 <span class="token comment" spellcheck="true">#MaxAuthTries 6</span>
 49 <span class="token comment" spellcheck="true">#MaxSessions 10</span>
 ………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>再次提醒的是，一般的服务程序并不会在配置文件修改之后立即获得最新的参数。如果想让新配置文件</p>
<p>生效，则需要手动重启相应的服务程序。最好也将这个服务程序加入到开机启动项中，这样系统在下一</p>
<p>次启动时，该服务程序便会自动运行，继续为用户提供服务</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@Server ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl restart sshd</span>
<span class="token punctuation">[</span>root@Server ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl enable sshd</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@Client ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ssh 192.168.10.10</span>
root@192.168.10.10's password:此处输入服务器管理员密码
Permission denied, please try again.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<hr>
<blockquote>
<p>如果想使用Windows系统进行访问也没问题。首先确保网络是可以通信的，随后从	<code>Xshell</code>、</p>
<p><code>PuTTY</code>、<code>SecureCRT</code>、<code>SSH Secure Shell Client</code>等工具中选择一个喜欢的登录工具，远程连接一下</p>
<p>试试看，效果如图14～图16所示</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819134059732.png" alt="14 远程登录输入账号名称"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819134119034.png" alt="15 远程登录输入账号密码"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819134135908.png" alt="16 远程登录成功界面"></p>
<h4 id="10-2-2、安全密钥验证"><a href="#10-2-2、安全密钥验证" class="headerlink" title="10.2.2、安全密钥验证"></a>10.2.2、安全密钥验证</h4><blockquote>
<p><strong>第1步</strong>：在客户端主机中生成“密钥对”，记住是客户端</p>
</blockquote>
<pre><code>[root@Client ~]# ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): 按回车键或设置密钥的存储路径
Enter passphrase (empty for no passphrase): 直接按回车键或设置密钥的密码
Enter same passphrase again: 再次按回车键或设置密钥的密码
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:kHa7B8V0nk63evABRrfZhxUpLM5Hx0I6gb7isNG9Hkg root@linuxprobe.com
The key's randomart image is:
+---[RSA 2048]----+
|          o.=.o.+|
|       . + =oB X |
|      + o =oO O o|
|     . o + *.+ ..|
|      .ES . + o  |
|     o.o.=   + . |
|      =.o.o . o  |
|     . . o.  .   |
|        ..       |
+----[SHA256]-----+
</code></pre>
<blockquote>
<p><strong>第2步</strong>：把客户端主机中生成的公钥文件传送至远程服务器</p>
</blockquote>
<pre><code>[root@Client ~]# ssh-copy-id 192.168.10.10
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@192.168.10.10's password: 此处输入服务器管理员密码

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh '192.168.10.10'"
and check to make sure that only the key(s) you wanted were added.
</code></pre>
<blockquote>
<p><strong>第4步</strong>：客户端尝试登录到服务器，此时无须输入密码也可成功登录，特别方便。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@Client ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ssh 192.168.10.10</span>
Activate the web console with: systemctl <span class="token function">enable</span> --now cockpit.socket

Last failed login: Thu Jan 28 13:44:09 CST 2021 from 192.168.10.20 on ssh:notty
There were 2 failed login attempts since the last successful login.
Last login: Thu Jan 28 13:22:34 2021 from 192.168.10.20
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="10-2-3、远程传输命令"><a href="#10-2-3、远程传输命令" class="headerlink" title="10.2.3、远程传输命令"></a>10.2.3、远程传输命令</h4><blockquote>
<p><code>scp</code>（<code>secure copy</code>）是一个基于<code>SSH</code>协议在网络之间进行安全传输的命令，</p>
<p>其格式为“<code>scp</code> [参数]本地文件 远程账户@远程<code>IP</code>地址:远程目录”</p>
</blockquote>
<blockquote>
<p>  <code>scp</code>命令中可用的参数及作用</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-v</code></td>
<td>显示详细的连接进度</td>
</tr>
<tr>
<td><code>-P</code></td>
<td>指定远程主机的<code>sshd</code>端口号</td>
</tr>
<tr>
<td><code>-r</code></td>
<td>用于传送文件夹</td>
</tr>
<tr>
<td><code>-6</code></td>
<td>使用<code>IPv6</code>协议</td>
</tr>
</tbody></table>
<blockquote>
<p>由于<code>scp</code>命令是基于SSH协议进行文件传送的，而10.2.2节又设置好了密钥验证，因此当前在传输文件</p>
<p>时，并不需要账户和密码</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@Client ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "Welcome to LinuxProbe.Com" > readme.txt</span>
<span class="token punctuation">[</span>root@Client ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># scp /root/readme.txt 192.168.10.10:/home</span>
readme.txt                                    100%   26    13.6KB/s   00:00
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>此外，还可以使用<code>scp</code>命令把远程服务器上的文件下载到本地主机，</p>
<p>其命令格式为“<code>scp</code> [参数]远程用户@远程<code>IP</code>地址:远程文件 本地目录”</p>
</blockquote>
<pre class="line-numbers language-bsah"><code class="language-bsah">[root@Client ~]# scp 192.168.10.10:/etc/redhat-release /root
[root@Client ~]# scp 192.168.10.10:/etc/redhat-release /root
redhat-release                                100%   45    23.6KB/s   00:00    
[root@Client ~]# cat redhat-release 
Red Hat Enterprise Linux release 8.0 (Ootpa)
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="10-3、不间断会话服务"><a href="#10-3、不间断会话服务" class="headerlink" title="10.3、不间断会话服务"></a>10.3、不间断会话服务</h3><blockquote>
<p> <code>Terminal Multiplexer</code>（终端复用器，简称为<code>Tmux</code>）是一款能够实现多窗口远程控制的开源服务程</p>
<p>序。简单来说就是为了解决网络异常中断或为了同时控制多个远程终端窗口而设计的程序。用户还可以</p>
<p>使用<code>Tmux</code>服务程序同时在多个远程会话中自由切换，能够实现如下功能：</p>
<ul>
<li><strong>会话恢复</strong>：即便网络中断，也可让会话随时恢复，确保用户不会失去对远程会话的控制。</li>
<li><strong>多窗口</strong>：每个会话都是独立运行的，拥有各自独立的输入输出终端窗口，终端窗口内显示过的信息也将被分开隔离保存，以便下次使用时依然能看到之前的操作记录。</li>
<li><strong>会话共享</strong>：当多个用户同时登录到远程服务器时，便可以使用会话共享功能让用户之间的输入输出信息共享。</li>
</ul>
</blockquote>
<blockquote>
<p>在<code>RHEL 8</code>系统中，默认没有安装<code>Tmux</code>服务程序，因此需要配置软件仓库来安装它。<code>BaseOS</code>和</p>
<p><code>AppStream</code>都要配置，这里直接开始安装<code>Tmux</code></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dnf install tmux</span>
Updating Subscription Management repositories.
Unable to <span class="token function">read</span> consumer identity
This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.
AppStream                                       3.1 MB/s <span class="token operator">|</span> 3.2 kB     00:00    
BaseOS                                          2.7 MB/s <span class="token operator">|</span> 2.7 kB     00:00    
Dependencies resolved.
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
 Package         Arch              Version              Repository         Size
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Installing:
 tmux            x86_64            2.7-1.el8            BaseOS            317 k

Transaction Summary
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Install  1 Package

Total size: 317 k
Installed size: 770 k
Is this ok <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>: y
Downloading Packages:
Running transaction check
Transaction check succeeded.
Running transaction <span class="token function">test</span>
Transaction <span class="token function">test</span> succeeded.
Running transaction
  Preparing        <span class="token keyword">:</span>                                                        1/1 
  Installing       <span class="token keyword">:</span> tmux-2.7-1.el8.x86_64                                  1/1 
  Running scriptlet: tmux-2.7-1.el8.x86_64                                  1/1 
  Verifying        <span class="token keyword">:</span> tmux-2.7-1.el8.x86_64                                  1/1 
Installed products updated.

Installed:
  tmux-2.7-1.el8.x86_64                                                         

Complete<span class="token operator">!</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="10-3-1、管理远程会话"><a href="#10-3-1、管理远程会话" class="headerlink" title="10.3.1、管理远程会话"></a>10.3.1、管理远程会话</h4><blockquote>
<p><code>Tmux</code>服务能做的事情非常多，例如<strong>创建不间断会话、恢复离线工作、将界面切分为不同的窗格、</strong></p>
<p><strong>共享会话等</strong>。下面直接敲击<code>tmux</code>命令进入会话窗口中，如图18所示</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819135016978.png" alt="18 Tumx服务程序会话界面"></p>
<blockquote>
<p>不难发现，会话窗口的底部出现了一个绿色的状态栏，里面分别显示的是<strong>会话编号、名称、主机名及系</strong></p>
<p><strong>统时间</strong>。</p>
<p>退出会话窗口的命令是<code>exit</code>，敲击后即可返回到正常的终端界面，如图19所示</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819135117169.png" alt="19 从会话窗口退回到终端界面"></p>
<blockquote>
<p> 会话窗口的编号是从0开始自动排序（即0、1、2、3、……），会话窗口数量少的时候还没关系，数量多</p>
<p>的时候区分起来就很麻烦了。接下来创建一个指定名称为<code>backup</code>的会话窗口。</p>
<p>当在命令行中敲下下面这条命令的一瞬间，屏幕会快速闪动一下，这时就已经进入<code>Tmux</code>会话中了，在</p>
<p>里面执行的任何操作都会被后台记录下来</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># tmux new -s backup</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>假设我们突然要去忙其他事情，但会话窗口中执行的进程还不能被中断，此时便可以用<code>detach</code>参数将</p>
<p>会话隐藏到后台。虽然看起来与刚才没有不同，但实际上可以看到当前的会话正在工作中</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># tmux detach</span>
<span class="token punctuation">[</span>detached <span class="token punctuation">(</span>from session backup<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p> 如果觉得每次输入<code>detach</code>参数都很麻烦，可以直接如图20所示关闭中断窗口（<strong>这与进行远程连接时突</strong></p>
<p><strong>然断网具有相同的效果</strong>），<code>Tmux</code>服务程序会自动帮我们进行保存。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819135344059.png" alt="20 强行关闭会话窗口"></p>
<blockquote>
<p>这样操作之后，服务和进程都会一直在后台默默运行，不会因为窗口被关闭而造成数据丢失。</p>
<p>不放心的话可以查看一下后台有哪些会话</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># tmux ls</span>
backup: 1 windows <span class="token punctuation">(</span>created Thu Jan 28 15:57:40 2021<span class="token punctuation">)</span> <span class="token punctuation">[</span>80x23<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>回归到<code>backup</code>会话中的方法很简单，直接在<code>tmux</code>命令后面加<code>attach</code>和会话编号或会话名称就可以。</p>
<p>关闭会话窗口之前正在进行的一切工作状态都会被原原本本地呈现出来，丝毫不受影响</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># tmux attach -t backup</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>如果不再需要使用这个<code>Tmux</code>会话了，也不用先在<code>tmux</code>命令后面添加<code>attach</code>，再执行<code>exit</code>命令退</p>
<p>出，而是可以直接使用kill命令杀死这个会话</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># tmux attach -t backup</span>
<span class="token punctuation">[</span>exited<span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># tmux ls</span>
no server running on /tmp/tmux-0/default
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>在日常的生产环境中，其实并不是必须先创建会话，然后再开始工作。可以直接使用<code>tmux</code>命令执行要运</p>
<p>行的指令，这样命令中的一切操作都会被记录下来，当命令执行结束后，后台会话也会自动结束</p>
</blockquote>
<h4 id="10-3-2、管理多窗格"><a href="#10-3-2、管理多窗格" class="headerlink" title="10.3.2、管理多窗格"></a>10.3.2、管理多窗格</h4><blockquote>
<p>先创建一个会话。使用“<code>tmux split-window</code>”命令可以创建上下切割的多窗格终端界面，如图21所示。</p>
<p>使用“<code>tmux split-window -h</code>”命令可以创建左右切割的多窗格终端界面，如图22所示<img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819135657933.png" alt="21 上下切割多窗格"></p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819135709663.png" alt="22 上下切割多窗格"></p>
<blockquote>
<p> 创建多窗格终端界面后，我们同时做几件事情都不会乱了。如果觉得两个窗格还不够，那就再执行几次</p>
<p>上面的命令吧，退出时执行<code>exit</code>命令即可。</p>
<p>可以同时按下“<code>Ctrl + B +方向键</code>”调整窗格的尺寸</p>
</blockquote>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>tmux select-pane -U</code></td>
<td>切换至上方的窗格</td>
</tr>
<tr>
<td><code>tmux select-pane -D</code></td>
<td>切换至下方的窗格</td>
</tr>
<tr>
<td><code>tmux select-pane -L</code></td>
<td>切换至左方的窗格</td>
</tr>
<tr>
<td><code>tmux select-pane -R</code></td>
<td>切换至右方的窗格</td>
</tr>
<tr>
<td><code>tmux swap-pane -U</code></td>
<td>将当前窗格与上方的窗格互换</td>
</tr>
<tr>
<td><code>tmux swap-pane -D</code></td>
<td>将当前窗格与下方的窗格互换</td>
</tr>
</tbody></table>
<blockquote>
<p>如图23所示，原本执行过<code>uptime</code>命令的窗格在下方，只需要在该窗格中执行“<code>tmux swap-pane -U</code>”命</p>
<p>令即可与上方窗格互换位置，效果如图24所示</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819135959016.png" alt="23 切换窗格位置前"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819140015789.png" alt="24 切换窗格位置后"></p>
<blockquote>
<p>在工作中，通过输入命令来切换窗格难免有些麻烦，实际上<code>Tmux</code>服务为用户提供了一系列快捷键来执</p>
<p>行窗格的切换。方法是先同时按下<code>Ctrl+B</code>组合键，然后松手后再迅速按下其他后续按键，而不是一起按</p>
<p>下。</p>
</blockquote>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>%</code></td>
<td>划分左右两个窗格</td>
</tr>
<tr>
<td><code>"</code></td>
<td>划分上下两个窗格</td>
</tr>
<tr>
<td><code>&lt;方向键&gt;</code></td>
<td>切换到上下左右相邻的一个窗格</td>
</tr>
<tr>
<td><code>;</code></td>
<td>切换至上一个窗格</td>
</tr>
<tr>
<td><code>o</code></td>
<td>切换至下一个窗格</td>
</tr>
<tr>
<td><code>{</code></td>
<td>将当前窗格与上一个窗格位置互换</td>
</tr>
<tr>
<td><code>}</code></td>
<td>将当前窗格与下一个窗格位置互换</td>
</tr>
<tr>
<td><code>x</code></td>
<td>关闭窗格</td>
</tr>
<tr>
<td><code>!</code></td>
<td>将当前窗格拆分成独立窗口</td>
</tr>
<tr>
<td><code>q</code></td>
<td>显示窗格编号</td>
</tr>
</tbody></table>
<h4 id="10-3-3、会话共享功能"><a href="#10-3-3、会话共享功能" class="headerlink" title="10.3.3、会话共享功能"></a>10.3.3、会话共享功能</h4><blockquote>
<p><code>Tmux</code>服务不仅可以确保用户在极端情况下也不丢失对系统的远程控制，保证了生产环境中远程工作的</p>
<p>不间断性，而且它还具有<strong>会话共享、分屏切割窗格、会话锁定</strong>等实用的功能。其中，<strong>会话共享功能</strong>是一</p>
<p>件很酷的事情，当多个用户同时控制服务器的时候，它可以<strong>把服务器屏幕内容共享出来</strong>。也就是说，每</p>
<p>个用户都能够看到相同的内容，还能一起同时操作。会话共享功能的技术拓扑如图27所示</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819140400862.png" alt="27 会话共享功能技术拓扑"></p>
<blockquote>
<p>要实现会话共享功能，首先使用<code>ssh</code>服务将客户端A远程连接到服务器，随后使用<code>Tmux</code>服务创建一个新</p>
<p>的会话窗口，名称为<code>share</code></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@client A ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ssh 192.168.10.10</span>
The authenticity of host <span class="token string">'192.168.10.10 (192.168.10.10)'</span> can<span class="token string">'t be established.
ECDSA key fingerprint is SHA256:5d52kZi1la/FJK4v4jibLBZhLqzGqbJAskZiME6ZXpQ.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '</span>192.168.10.10<span class="token string">' (ECDSA) to the list of known hosts.
root@192.168.10.10'</span>s password: 此处输入服务器管理员密码
Activate the web console with: systemctl <span class="token function">enable</span> --now cockpit.socket

Last login: Fri Jul 24 06:26:58 2020
<span class="token punctuation">[</span>root@client A ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># tmux new -s share</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>然后，使用<code>ssh</code>服务将客户端B也远程连接到服务器，并执行获取远程会话的命令。接下来，两台客户端</p>
<p>就能看到相同的内容了。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@client B ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ssh 192.168.10.10</span>
The authenticity of host <span class="token string">'192.168.10.10 (192.168.10.10)'</span> can<span class="token string">'t be established.
ECDSA key fingerprint is SHA256:5d52kZi1la/FJK4v4jibLBZhLqzGqbJAskZiME6ZXpQ.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '</span>192.168.10.10<span class="token string">' (ECDSA) to the list of known hosts.
root@192.168.10.10'</span>s password: 此处输入服务器管理员密码
Activate the web console with: systemctl <span class="token function">enable</span> --now cockpit.socket

Last login: Fri Jul 24 06:26:58 2020
<span class="token punctuation">[</span>root@client B ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># tmux attach-session -t share</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="10-3、检索日志信息"><a href="#10-3、检索日志信息" class="headerlink" title="10.3、检索日志信息"></a>10.3、检索日志信息</h3><blockquote>
<p> 在<code>RHEL 8</code>系统中，<strong>默认的日志服务程序是</strong><code>rsyslog</code>。可以将<code>rsyslog</code>理解成之前的<code>syslogd</code>服务的增</p>
<p>强版本，它更加注重日志的安全性和性能指标。为了便于日后的检索，不同的日志信息会被写入到不同</p>
<p>的文件中。在<code>Linux</code>系统中，常见的日志文件如表所示</p>
</blockquote>
<table>
<thead>
<tr>
<th>文件路径及命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>/var/log/boot.log</code></td>
<td>系统开机自检事件及引导过程等信息</td>
</tr>
<tr>
<td><code>/var/log/lastlog</code></td>
<td>用户登录成功时间、终端名称及<code>IP</code>地址等信息</td>
</tr>
<tr>
<td><code>/var/log/btmp</code></td>
<td>记录登录失败的时间、终端名称及<code>IP</code>地址等信息</td>
</tr>
<tr>
<td><code>/var/log/messages</code></td>
<td>系统及各个服务的运行和报错信息</td>
</tr>
<tr>
<td><code>/var/log/secure</code></td>
<td>系统安全相关的信息</td>
</tr>
<tr>
<td><code>/var/log/wtmp</code></td>
<td>系统启动与关机等相关信息</td>
</tr>
</tbody></table>
<blockquote>
<p>在日常工作中，<code>/var/log/message</code>这个综合性的文件用得最多。在处理<code>Linux</code>系统中出现的各种故障</p>
<p>时，一般是最先发现故障的症状，而找到故障的原因则一定离不开日志信息的帮忙。从理论上讲，日志</p>
<p>文件分为下面3种类型：</p>
<ul>
<li><strong>系统日志</strong>：主要记录<strong>系统的运行情况和内核信息</strong>。</li>
<li><strong>用户日志</strong>：主要记录<strong>用户的访问信息，包含用户名、终端名称、登入及退出时间、来源<code>IP</code>地址和执行过的操作</strong>等。</li>
<li><strong>程序日志</strong>：稍微大一些的服务一般都会保存一份与其同名的日志文件，里面记录着服务运行过程中各种事件的信息；每个服务程序都有自己独立的日志文件，且格式相差较大。</li>
</ul>
</blockquote>
<blockquote>
<p> 上面提到，每个稍微大一些的服务都有自己独立的日志文件，为了让用户在检索信息时不至于特别麻</p>
<p>烦，<code>journalctl</code>命令应运而生。</p>
<p><code>journalctl</code>命令用于检索和管理系统日志信息，英文全称为“<code>journal control</code>”，</p>
<p>语法格式为“<code>journalctl</code>参数”。它可以根据<strong>事件、类型、服务名称等信息</strong>进行信息检索，从而大大提高</p>
<p>了日常排错的效率。<code>journalctl</code>命令的常见参数如表所示。</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-k</code></td>
<td>内核日志</td>
</tr>
<tr>
<td><code>-b</code></td>
<td>启动日志</td>
</tr>
<tr>
<td><code>-u</code></td>
<td>指定服务</td>
</tr>
<tr>
<td><code>-n</code></td>
<td>指定条数</td>
</tr>
<tr>
<td><code>-p</code></td>
<td>指定类型</td>
</tr>
<tr>
<td><code>-f</code></td>
<td>实时刷新（追踪日志）</td>
</tr>
<tr>
<td><code>--since</code></td>
<td>指定时间</td>
</tr>
<tr>
<td><code>--disk-usage</code></td>
<td>占用空间</td>
</tr>
</tbody></table>
<hr>
<blockquote>
<p>查看系统中最后5条日志信息</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># journalctl -n 5 </span>
-- Logs begin at Fri 2020-07-24 05:59:38 CST, end at Sun 2021-01-31 13:39:51 CS<span class="token operator">></span>
Jan 31 13:33:54 localhost.localdomain systemd<span class="token punctuation">[</span>1<span class="token punctuation">]</span>: Started Fingerprint Authentic<span class="token operator">></span>
Jan 31 13:33:55 localhost.localdomain gnome-keyring-daemon<span class="token punctuation">[</span>2533<span class="token punctuation">]</span>: couldn't init<span class="token operator">></span>
Jan 31 13:33:55 localhost.localdomain gdm-password<span class="token punctuation">]</span><span class="token punctuation">[</span>4983<span class="token punctuation">]</span>: gkr-pam: unlocked lo<span class="token operator">></span>
Jan 31 13:33:56 localhost.localdomain NetworkManager<span class="token punctuation">[</span>1203<span class="token punctuation">]</span>:   <span class="token punctuation">[</span>1612071236<span class="token operator">></span>
Jan 31 13:39:51 localhost.localdomain cupsd<span class="token punctuation">[</span>1230<span class="token punctuation">]</span>: REQUEST localhost - - "POST <span class="token operator">></span>
lines 1-6/6 <span class="token punctuation">(</span>END<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<blockquote>
<p>还可以使用<code>-f</code>参数实时刷新日志的最新内容</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># journalctl -f </span>
-- Logs begin at Fri 2020-07-24 05:59:38 CST. --
Jan 31 13:33:54 localhost.localdomain dbus-daemon<span class="token punctuation">[</span>1058<span class="token punctuation">]</span>: <span class="token punctuation">[</span>system<span class="token punctuation">]</span> Activating via systemd: <span class="token function">service</span> name<span class="token operator">=</span><span class="token string">'net.reactivated.Fprint'</span> unit<span class="token operator">=</span><span class="token string">'fprintd.service'</span> requested by <span class="token string">':1.172'</span> <span class="token punctuation">(</span>uid<span class="token operator">=</span>0 pid<span class="token operator">=</span>2600 comm<span class="token operator">=</span><span class="token string">"/usr/bin/gnome-shell "</span> label<span class="token operator">=</span><span class="token string">"unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023"</span><span class="token punctuation">)</span>
Jan 31 13:33:54 localhost.localdomain systemd<span class="token punctuation">[</span>1<span class="token punctuation">]</span>: Starting Fingerprint Authentication Daemon<span class="token punctuation">..</span>.
Jan 31 13:33:54 localhost.localdomain dbus-daemon<span class="token punctuation">[</span>1058<span class="token punctuation">]</span>: <span class="token punctuation">[</span>system<span class="token punctuation">]</span> Successfully activated <span class="token function">service</span> <span class="token string">'net.reactivated.Fprint'</span>
Jan 31 13:33:54 localhost.localdomain systemd<span class="token punctuation">[</span>1<span class="token punctuation">]</span>: Started Fingerprint Authentication Daemon.
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<table>
<thead>
<tr>
<th>日志等级</th>
<th>说明介绍</th>
</tr>
</thead>
<tbody><tr>
<td><code>emerg</code></td>
<td>系统出现严重故障，内核崩溃等情况</td>
</tr>
<tr>
<td><code>alert</code></td>
<td>应立即修复的故障，数据库损坏等情况</td>
</tr>
<tr>
<td><code>crit</code></td>
<td>危险较高的故障，硬盘损坏导致程序运行失败的情况</td>
</tr>
<tr>
<td><code>err</code></td>
<td>一般危险的故障，某个服务启动或运行失败的情况</td>
</tr>
<tr>
<td><code>warning</code></td>
<td>警告信息，某个服务参数或功能错误的情况</td>
</tr>
<tr>
<td><code>notice</code></td>
<td>一般无危险的故障，只是需要处理的情况</td>
</tr>
<tr>
<td><code>info</code></td>
<td>通用性消息，给用户提示一些有用信息</td>
</tr>
<tr>
<td><code>debug</code></td>
<td>调试程序所产生的信息</td>
</tr>
<tr>
<td><code>none</code></td>
<td>没有优先级，不做日志记录</td>
</tr>
</tbody></table>
<hr>
<blockquote>
<p>看系统中较高级别的报错信息，可以在<code>journalctl</code>命令中用-p参数进行指定</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># journalctl -p crit</span>
-- Logs begin at Fri 2020-07-24 05:59:38 CST, end at Sun 2021-01-31 15:06:07 CST. --
Jul 24 05:59:38 localhost.localdomain kernel: Detected CPU family 6 model 158 stepping 13
Jul 24 05:59:38 localhost.localdomain kernel: Warning: Intel Processor - this hardware has not undergone testing by Red Hat and might not be certified. Please consult https://hardware.redhat.com <span class="token keyword">for</span> certified hardware.
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<blockquote>
<p>仅查询今日的日志信息</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># journalctl --since today</span>
-- Logs begin at Fri 2020-07-24 05:59:38 CST, end at Sun 2021-01-31 15:10:01 CST. --
Jan 31 12:48:25 localhost.localdomain systemd<span class="token punctuation">[</span>1<span class="token punctuation">]</span>: Starting update of the root trust anchor <span class="token operator">></span>
Jan 31 12:48:25 localhost.localdomain rsyslogd<span class="token punctuation">[</span>1392<span class="token punctuation">]</span>: imjournal: sd_journal_get_cursor<span class="token punctuation">(</span><span class="token punctuation">)</span> fail<span class="token operator">></span>
Jan 31 12:48:25 localhost.localdomain rsyslogd<span class="token punctuation">[</span>1392<span class="token punctuation">]</span>: imjournal: journal reloaded<span class="token punctuation">..</span>. <span class="token punctuation">[</span>v8.3<span class="token operator">></span>
Jan 31 12:48:25 localhost.localdomain systemd<span class="token punctuation">[</span>1<span class="token punctuation">]</span>: Started update of the root trust anchor for<span class="token operator">></span>
Jan 31 12:48:25 localhost.localdomain sssd<span class="token punctuation">[</span>kcm<span class="token punctuation">]</span><span class="token punctuation">[</span>2764<span class="token punctuation">]</span>: Shutting down
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<blockquote>
<p>仅查询最近1小时的日志信息</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># journalctl --since "-1 hour"</span>
-- Logs begin at Fri 2020-07-24 05:59:38 CST, end at Sun 2021-01-31 15:10:01 CST. --
Jan 31 14:25:36 localhost.localdomain systemd<span class="token punctuation">[</span>1<span class="token punctuation">]</span>: Starting dnf makecache<span class="token punctuation">..</span>.
Jan 31 14:25:36 localhost.localdomain dnf<span class="token punctuation">[</span>5516<span class="token punctuation">]</span>: Updating Subscription Management repositories.
Jan 31 14:25:36 localhost.localdomain dnf<span class="token punctuation">[</span>5516<span class="token punctuation">]</span>: Unable to <span class="token function">read</span> consumer identity
Jan 31 14:25:36 localhost.localdomain dnf<span class="token punctuation">[</span>5516<span class="token punctuation">]</span>: This system is not registered to Red Hat<span class="token operator">></span>
Jan 31 14:25:36 localhost.localdomain dnf<span class="token punctuation">[</span>5516<span class="token punctuation">]</span>: Metadata cache refreshed recently.
Jan 31 14:25:36 localhost.localdomain systemd<span class="token punctuation">[</span>1<span class="token punctuation">]</span>: Started dnf makecache.
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<blockquote>
<p>仅查询12点整到14点整的日志信息</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># journalctl --since "12:00" --until "14:00"</span>
-- Logs begin at Fri 2020-07-24 05:59:38 CST, end at Sun 2021-01-31 15:10:01 CST. --
Jan 31 12:48:25 localhost.localdomain systemd<span class="token punctuation">[</span>1<span class="token punctuation">]</span>: Starting update of the root trust anchor<span class="token operator">></span>
Jan 31 12:48:25 localhost.localdomain rsyslogd<span class="token punctuation">[</span>1392<span class="token punctuation">]</span>: imjournal: sd_journal_get_cursor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span>
Jan 31 12:48:25 localhost.localdomain rsyslogd<span class="token punctuation">[</span>1392<span class="token punctuation">]</span>: imjournal: journal reloaded<span class="token punctuation">..</span>. <span class="token punctuation">[</span>v8.37<span class="token operator">></span>
Jan 31 12:48:25 localhost.localdomain systemd<span class="token punctuation">[</span>1<span class="token punctuation">]</span>: Started update of the root trust anchor<span class="token operator">></span>
Jan 31 12:48:25 localhost.localdomain sssd<span class="token punctuation">[</span>kcm<span class="token punctuation">]</span><span class="token punctuation">[</span>2764<span class="token punctuation">]</span>: Shutting down
Jan 31 12:48:30 localhost.localdomain systemd<span class="token punctuation">[</span>1<span class="token punctuation">]</span>: Starting SSSD Kerberos Cache Manager<span class="token punctuation">..</span>.
Jan 31 12:48:30 localhost.localdomain systemd<span class="token punctuation">[</span>1<span class="token punctuation">]</span>: Started SSSD Kerberos Cache Manager.
Jan 31 12:48:30 localhost.localdomain sssd<span class="token punctuation">[</span>kcm<span class="token punctuation">]</span><span class="token punctuation">[</span>3981<span class="token punctuation">]</span>: Starting up
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<blockquote>
<p>查询从2020年7月1日至2020年8月1日的日志信息</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># journalctl --since "2020-07-01" --until "2020-08-01"</span>
-- Logs begin at Fri 2020-07-24 05:59:38 CST, end at Sun 2021-01-31 15:10:01 CST. --
Jul 24 05:59:38 localhost.localdomain kernel: Linux version 4.18.0-80.el8.x86_64 <span class="token punctuation">(</span>mockbuild<span class="token operator">></span>
Jul 24 05:59:38 localhost.localdomain kernel: Command line: BOOT_IMAGE<span class="token operator">=</span><span class="token punctuation">(</span>hd0,msdos1<span class="token punctuation">)</span>/vmlinuz<span class="token operator">></span>
Jul 24 05:59:38 localhost.localdomain kernel: Disabled fast string operations
Jul 24 05:59:38 localhost.localdomain kernel: x86/fpu: Supporting XSAVE feature 0x001: <span class="token string">'x87>
Jul 24 05:59:38 localhost.localdomain kernel: x86/fpu: Supporting XSAVE feature 0x002: '</span>SSE<span class="token operator">></span>
Jul 24 05:59:38 localhost.localdomain kernel: x86/fpu: Supporting XSAVE feature 0x004: 'AVX<span class="token operator">></span>
Jul 24 05:59:38 localhost.localdomain kernel: x86/fpu: xstate_offset<span class="token punctuation">[</span>2<span class="token punctuation">]</span>:  576, xstate_sizes<span class="token operator">></span>
Jul 24 05:59:38 localhost.localdomain kernel: x86/fpu: Enabled xstate features 0x7, context<span class="token operator">></span>
Jul 24 05:59:38 localhost.localdomain kernel: BIOS-provided physical RAM map:
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<blockquote>
<p>在默认情况下，所有的日志信息都是混在一起的。如果想看具体某项服务的日志信息，可以使用</p>
<p><code>_SYSTEMD_UNIT</code>参数进行查询，服务名称的后面要有“<code>.service</code>”，这是标准服务名称的写法</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># journalctl -u sshd</span>
-- Logs begin at Mon 2020-09-14 15:35:27 CST, end at Sun 2021-01-31 17:26:15 CST. --
Nov 09 13:50:03 iZuf61gqesu0zmrcsma8x4Z sshd<span class="token punctuation">[</span>1218<span class="token punctuation">]</span>: Server listening on 0.0.0.0 port 22.
Nov 09 13:58:45 iZuf61gqesu0zmrcsma8x4Z sshd<span class="token punctuation">[</span>1218<span class="token punctuation">]</span>: Received signal 15<span class="token punctuation">;</span> terminating.
-- Reboot --
Nov 09 13:59:29 iZuf61gqesu0zmrcsma8x4Z sshd<span class="token punctuation">[</span>1127<span class="token punctuation">]</span>: Server listening on 0.0.0.0 port 22.
Nov 09 14:12:12 iZuf61gqesu0zmrcsma8x4Z sshd<span class="token punctuation">[</span>1262<span class="token punctuation">]</span>: Accepted password <span class="token keyword">for</span> root from 111.196
Nov 09 14:12:12 iZuf61gqesu0zmrcsma8x4Z sshd<span class="token punctuation">[</span>1262<span class="token punctuation">]</span>: pam_unix<span class="token punctuation">(</span>sshd:session<span class="token punctuation">)</span>: session opened
Nov 09 14:14:31 iZuf61gqesu0zmrcsma8x4Z sshd<span class="token punctuation">[</span>1127<span class="token punctuation">]</span>: Received signal 15<span class="token punctuation">;</span> terminating.
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="十一、使用Apache服务部署静态网站"><a href="#十一、使用Apache服务部署静态网站" class="headerlink" title="十一、使用Apache服务部署静态网站"></a>十一、使用Apache服务部署静态网站</h2><hr>
<h3 id="11-1、网站服务程序"><a href="#11-1、网站服务程序" class="headerlink" title="11.1、网站服务程序"></a>11.1、网站服务程序</h3><blockquote>
<p>目前能够提供Web网络服务的程序有<code>IIS</code>、<code>Nginx</code>和<code>Apache等。</code>其中，<code>IIS</code>（<code>Internet Information </code></p>
<p><code>Service</code>，互联网信息服务）是<code>Windows</code>系统中默认的<code>Web</code>服务程序，这是一款图形化的网站管理工</p>
<p>具，不仅可以提供<code>Web</code>网站服务，还可以提供<code>FTP</code>、<code>NMTP</code>、<code>SMTP</code>等服务。</p>
</blockquote>
<blockquote>
<p>2004年10月4日，为俄罗斯知名门户站点而开发的<code>Web</code>服务程序<code>Nginx</code>横空出世。<code>Nginx</code>程序作为一款</p>
<p>轻量级的网站服务软件，因其稳定性和丰富的功能而快速占领服务器市场，但<code>Nginx</code>最被认可的还是其</p>
<p>系统资源消耗低且并发能力强的特性，因此得到了国内诸如新浪、网易、腾讯等门户网站的青睐</p>
</blockquote>
<blockquote>
<p> <code>Apache</code>程序是目前拥有很高市场占有率的<code>Web</code>服务程序之一，其跨平台和安全性广泛被认可且拥有快</p>
<p>速、可靠、简单的<code>API</code>扩展</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819154110969.png" alt="Apache软件基金会著名的Logo"></p>
<blockquote>
<p>第一步：动手安装<code>Apache</code>服务程序。注意，在使用<code>dnf</code>进行安装时，跟在命令后面的<code>Apache</code>服务的软</p>
<p>件包名称为<code>httpd</code></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dnf install httpd</span>
Updating Subscription Management repositories.
Unable to <span class="token function">read</span> consumer identity
This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.
AppStream                                       3.1 MB/s <span class="token operator">|</span> 3.2 kB     00:00    
BaseOS                                          2.7 MB/s <span class="token operator">|</span> 2.7 kB     00:00    
Dependencies resolved.
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
 Package            Arch   Version                   Repository           Size
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Installing:
 httpd              x86_64 2.4.37-10.module+el8+2764+7127e69e   AppStream 1.4 M
Installing dependencies:
 apr                x86_64 1.6.3-9.el8                          AppStream 125 k
 apr-util           x86_64 1.6.1-6.el8                          AppStream 105 k
 httpd-filesystem   noarch 2.4.37-10.module+el8+2764+7127e69e   AppStream  34 k
 httpd-tools        x86_64 2.4.37-10.module+el8+2764+7127e69e   AppStream 101 k
 mod_http2          x86_64 1.11.3-1.module+el8+2443+605475b7    AppStream 156 k
 redhat-logos-httpd noarch 80.7-1.el8                           BaseOS     25 k
Installing weak dependencies:
 apr-util-bdb       x86_64 1.6.1-6.el8                          AppStream  25 k
 apr-util-openssl   x86_64 1.6.1-6.el8                          AppStream  27 k
Enabling module streams:
 httpd                     2.4                                                 

Transaction Summary
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Install  9 Packages

Total size: 2.0 M
Installed size: 5.4 M
Is this ok <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>: y
Downloading Packages:
Running transaction check
Transaction check succeeded.
Running transaction <span class="token function">test</span>
Transaction <span class="token function">test</span> succeeded.
………………省略部分输出信息………………                                    
Complete<span class="token operator">!</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>第二部： 启用<code>httpd</code>服务程序并将其加入到开机启动项中，使其能够随系统开机而运行，从而持续为</p>
<p>用户提供Web服务</p>
</blockquote>
<pre><code>[root@linuxprobe ~]# systemctl start httpd
[root@linuxprobe ~]# systemctl enable httpd
Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.
</code></pre>
<h3 id="11-2、配置服务文件参数"><a href="#11-2、配置服务文件参数" class="headerlink" title="11.2、配置服务文件参数"></a>11.2、配置服务文件参数</h3><blockquote>
<p><code>Linux</code>系统中的配置文件</p>
</blockquote>
<table>
<thead>
<tr>
<th>作用</th>
<th>文件名称</th>
</tr>
</thead>
<tbody><tr>
<td>服务目录</td>
<td><code>/etc/httpd</code></td>
</tr>
<tr>
<td>主配置文件</td>
<td><code>/etc/httpd/conf/httpd.conf</code></td>
</tr>
<tr>
<td>网站数据目录</td>
<td><code>/var/www/html</code></td>
</tr>
<tr>
<td>访问日志</td>
<td><code>/var/log/httpd/access_log</code></td>
</tr>
<tr>
<td>错误日志</td>
<td><code>/var/log/httpd/error_log</code></td>
</tr>
</tbody></table>
<blockquote>
<p>在<code>httpd</code>服务程序的主配置文件中，存在3种类型的信息：<strong>注释行信息、全局配置、区域配置</strong>，</p>
<p>如图1所示</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819165458040.png" alt="1 httpd服务主配置文件的参数结构"></p>
<blockquote>
<p>局配置参数就是一种全局性的配置参数，可作用于所有的子站点，既保证了子站点的正常访问，也有效</p>
<p>降低了频繁写入重复参数的工作量。区域配置参数则是单独针对每个独立的子站点进行设置的</p>
</blockquote>
<blockquote>
<p>配置<code>httpd</code>服务程序时最常用的参数以及用途描述</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>ServerRoot</code></td>
<td>服务目录</td>
</tr>
<tr>
<td><code>ServerAdmin</code></td>
<td>管理员邮箱</td>
</tr>
<tr>
<td><code>User</code></td>
<td>运行服务的用户</td>
</tr>
<tr>
<td><code>Group</code></td>
<td>运行服务的用户组</td>
</tr>
<tr>
<td><code>ServerName</code></td>
<td>网站服务器的域名</td>
</tr>
<tr>
<td><code>DocumentRoot</code></td>
<td>网站数据目录</td>
</tr>
<tr>
<td><code>Listen</code></td>
<td>监听的IP地址与端口号</td>
</tr>
<tr>
<td><code>DirectoryIndex</code></td>
<td>默认的索引页页面</td>
</tr>
<tr>
<td><code>ErrorLog</code></td>
<td>错误日志文件</td>
</tr>
<tr>
<td><code>CustomLog</code></td>
<td>访问日志文件</td>
</tr>
<tr>
<td><code>Timeout</code></td>
<td>网页超时时间，默认为300秒</td>
</tr>
</tbody></table>
<blockquote>
<p>从上表中可知，<code>DocumentRoot</code>参数用于定义网站数据的保存路径，其参数的默认值</p>
<p>是<code>/var/www/html</code>（即把网站数据存放到这个目录中）；而当前网站普遍的首页面名称是</p>
<p><code>index.html</code>，因此可以向<code>/var/www/html/index.html</code>文件中写入一段内容，替换掉<code>httpd</code></p>
<p>服务程序的默认首页面。该操作会立即生效</p>
</blockquote>
<blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "Welcome To LinuxProbe.Com" > /var/www/html/index.html </span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firefox</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</blockquote>
<blockquote>
<p>在执行上述操作之后，再在<code>Firefox</code>浏览器中刷新<code>httpd</code>服务程序，可以看到该程序的首页面内容已经</p>
<p>发生了改变，如图2所示</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220819174730311.png" alt="2 首页面内容已经被修改"></p>
<hr>
<blockquote>
<p>保存网站数据的目录修改为<code>/home/wwwroot</code>目录</p>
</blockquote>
<blockquote>
<p><strong>第1步</strong>：建立网站数据的保存目录，并创建首页文件</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir /home/wwwroot</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "The New Web Directory" > /home/wwwroot/index.html</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p> <strong>第2步</strong>：打开<code>httpd</code>服务程序的主配置文件，将约第122行用于定义网站数据保存路径的参数</p>
<p><code>DocumentRoot</code>修改为<code>/home/wwwroot</code>，同时还需要将约第127行与第134行用于定义目录权限的参数</p>
<p><code>Directory</code>后面的路径也修改为<code>/home/wwwroot</code>。配置文件修改完毕后即可保存并退出</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/httpd/conf/httpd.conf </span>
………………省略部分输出信息………………
117 <span class="token comment" spellcheck="true">#</span>
118 <span class="token comment" spellcheck="true"># DocumentRoot: The directory out of which you will serve your</span>
119 <span class="token comment" spellcheck="true"># documents. By default, all requests are taken from this directory, but</span>
120 <span class="token comment" spellcheck="true"># symbolic links and aliases may be used to point to other locations.</span>
121 <span class="token comment" spellcheck="true">#</span>
122 DocumentRoot <span class="token string">"/home/wwwroot"</span>
123 
124 <span class="token comment" spellcheck="true">#</span>
125 <span class="token comment" spellcheck="true"># Relax access to content within /var/www.</span>
126 <span class="token comment" spellcheck="true">#</span>
127 <span class="token operator">&lt;</span>Directory <span class="token string">"/home/wwwroot"</span><span class="token operator">></span>
128     AllowOverride None
129     <span class="token comment" spellcheck="true"># Allow open access:</span>
130     Require all granted
131 <span class="token operator">&lt;</span>/Directory<span class="token operator">></span>
132 
133 <span class="token comment" spellcheck="true"># Further relax access to the default document root:</span>
134 <span class="token operator">&lt;</span>Directory <span class="token string">"/home/wwwroot"</span><span class="token operator">></span>
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第3步</strong>：重新启动<code>httpd</code>服务程序并验证效果，浏览器刷新页面后的内容如图3所示。</p>
<p>奇怪！怎么提示权限不足了？</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl restart httpd</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firefox</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220822085442325.png" alt="4 Web页面提示权限不足"></p>
<h3 id="11-3、SELinux安全子系统"><a href="#11-3、SELinux安全子系统" class="headerlink" title="11.3、SELinux安全子系统"></a>11.3、<code>SELinux</code>安全子系统</h3><blockquote>
<p><code>SELinux</code>（<code>Security-Enhanced Linux</code>）是美国国家安全局在<code>Linux</code>开源社区的帮助下开发的一个强</p>
<p>制访问控制（<code>MAC，Mandatory Access Control</code>）的安<strong>全子系统</strong>。<code>Linux</code>系统使用<code>SELinux</code>技术的</p>
<p>目的是<strong>为了让各个服务进程都受到约束，使其仅获取到本应获取的资源</strong>。能够从多方面监控违法行为：</p>
<ul>
<li>对服务程序的功能进行限制（<code>SELinux</code>域限制可以确保服务程序做不了出格的事情）；</li>
<li>对文件资源的访问进行限制（<code>SELinux</code>安全上下文确保文件资源只能被其所属的服务程序进行访问）</li>
</ul>
</blockquote>
<blockquote>
<p><code>SELinux</code>服务有3种配置模式，具体如下：</p>
<ul>
<li><strong>enforcing</strong>：强制启用安全策略模式，将拦截服务的不合法请求。</li>
<li><strong>permissive</strong>：遇到服务越权访问时，只发出警告而不强制拦截。</li>
<li><strong>disabled</strong>：对于越权的行为不警告也不拦截。</li>
</ul>
</blockquote>
<blockquote>
<p>查看<code>SELinux</code>服务主配置文件中定义的默认状态</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">修改为enforcing。

<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/selinux/config</span>
<span class="token comment" spellcheck="true"># This file controls the state of SELinux on the system.</span>
<span class="token comment" spellcheck="true"># SELINUX= can take one of these three values:</span>
<span class="token comment" spellcheck="true">#     enforcing - SELinux security policy is enforced.</span>
<span class="token comment" spellcheck="true">#     permissive - SELinux prints warnings instead of enforcing.</span>
<span class="token comment" spellcheck="true">#     disabled - No SELinux policy is loaded.</span>
SELINUX<span class="token operator">=</span>enforcing
<span class="token comment" spellcheck="true"># SELINUXTYPE= can take one of these three values:</span>
<span class="token comment" spellcheck="true">#     targeted - Targeted processes are protected,</span>
<span class="token comment" spellcheck="true">#     minimum - Modification of targeted policy. Only selected processes are protected. </span>
<span class="token comment" spellcheck="true">#     mls - Multi Level Security protection.</span>
SELINUXTYPE<span class="token operator">=</span>targeted
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>SELinux</code>服务的主配置文件中，定义的是<code>SELinux</code>的默认运行状态，可以将其理解为系统重启后的状态，因此它不会在更改后立即生效。可以使用<code>getenforce</code>命令获得当前<code>SELinux</code>服务的运行模式</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># getenforce </span>
Enforcing
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>为了确认图5所示的结果是因为<code>SELinux</code>而导致的，可以用<code>setenforce </code>[0|1]命令修改<code>SELinux</code>当前的</p>
<p>运行模式（<strong>0为禁用，1为启用</strong>）。注意，<strong>这种修改只是临时的，在系统重启后就会失效</strong></p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># setenforce 0</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># getenforce</span>
Permissive
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>再次刷新网页，就会看到正常的网页内容了，如图5所示。可见，问题是出在了<code>SELinux</code>服务上</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220822085642886.png" alt="5 页面内容按照预期显示"></p>
<blockquote>
<p><code>httpd</code>服务程序的功能是允许用户访问网站内容，因此<code>SELinux</code>肯定会默认放行用户对网站的请求操</p>
<p>作。但是，我们将网站数据的默认保存目录修改为<code>/home/wwwroot</code>，这就产生问题了</p>
</blockquote>
<blockquote>
<p>现在，把<code>SELinux</code>服务恢复到强制启用安全策略模式，然后分别查看原始网站数据的保存目录与当前网</p>
<p>站数据的保存目录是否拥有不同的<code>SELinux</code>安全上下文值</p>
</blockquote>
<blockquote>
<p> 在<code>ls</code>命令中，<code>-Z</code>参数用于查看文件的安全上下文值，<code>-d</code>参数代表对象是个文件夹</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># setenforce 1</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -Zd /var/www/html</span>
drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 /var/www/html
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls -Zd /home/wwwroot</span>
drwxrwxrwx. root root unconfined_u:object_r:home_root_t:s0 /home/wwwroot
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p> 文件上设置的<code>SELinux</code>安全上下文是由用户段、角色段以及类型段等多个信息项共同组成的：</p>
<ul>
<li>用户段<code>system_u</code>代表系统进程的身份</li>
<li>角色段<code>object_r</code>代表文件目录的角色</li>
<li>类型段<code>httpd_sys_content_t</code>代表网站服务的系统文件</li>
</ul>
</blockquote>
<blockquote>
<p> 针对当前这种情况，我们只需要使用<code>semanage</code>命令，将当前网站目录<code>/home/wwwroot</code>的<code>SELinux</code>安全</p>
<p>上下文修改为跟原始网站目录的一样就行了</p>
<p><code>semanage</code>命令用于管理<code>SELinux</code>的策略，英文全称为“<code>SELinux manage</code>”，</p>
<p>语法格式为“<code>semanage</code> [参数] [文件]”</p>
</blockquote>
<blockquote>
<p><code>SELinux</code>服务极大地提升了<code>Linux</code>系统的安全性，将用户权限牢牢地锁在笼子里。<code>semanage</code>命令不仅</p>
<p>能够像传统的<code>chcon</code>命令那样<strong>设置文件、目录的策略</strong>，还能够<strong>管理网络端口、消息接口</strong>（这些新特性将</p>
<p>在本章后文中涵盖）。使用<code>semanage</code>命令时，经常用到的几个参数及其作用如表所示</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-l</code></td>
<td>查询</td>
</tr>
<tr>
<td><code>-a</code></td>
<td>添加</td>
</tr>
<tr>
<td><code>-m</code></td>
<td>修改</td>
</tr>
<tr>
<td><code>-d</code></td>
<td>删除</td>
</tr>
</tbody></table>
<blockquote>
<p> 向新的网站数据目录中新添加一条<code>SELinux</code>安全上下文，让这个目录以及里面的所有文件能够被</p>
<p><code>httpd</code>服务程序访问到</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash">bash<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/*</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p> 在执行上述设置之后，还无法立即访问网站，还需要使用<code>restorecon</code>命令将设置好的<code>SELinux</code>安全上</p>
<p>下文立即生效。在使用<code>restorecon</code>命令时，可以加上<code>-Rv</code>参数对指定的目录进行递归操作，以及显示</p>
<p><code>SELinux</code>安全上下文的修改过程。最后，再次刷新页面，就可以正常看到网页内容了，结果如图6所示</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># restorecon -Rv /home/wwwroot/</span>
Relabeled /home/wwwroot from unconfined_u:object_r:user_home_dir_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/index.html from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firefox</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220822090837052.png" alt="6 正常看到网页内容"></p>
<h3 id="11-4、个人用户主页功能"><a href="#11-4、个人用户主页功能" class="headerlink" title="11.4、个人用户主页功能"></a>11.4、个人用户主页功能</h3><blockquote>
<p><strong>第1步</strong>：</p>
<p>在<code>httpd</code>服务程序中，默认没有开启个人用户主页功能。为此，我们需要编辑下面的配置文件，然后在</p>
<p>第17行的<code>UserDir disabled</code>参数前面加上井号（#），表示让<code>httpd</code>服务程序开启个人用户主页功</p>
<p>能；同时再把第24行的<code>UserDir public_html</code>参数前面的井号（#）去掉（<code>UserDir</code>参数表示网站数据</p>
<p>在用户家目录中的保存目录名称，即<code>public_html</code>目录）。最后，在修改完毕后记得保存</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/httpd/conf.d/userdir.conf </span>
  1 <span class="token comment" spellcheck="true">#</span>
  2 <span class="token comment" spellcheck="true"># UserDir: The name of the directory that is appended onto a user's home</span>
  3 <span class="token comment" spellcheck="true"># directory if a ~user request is received.</span>
  4 <span class="token comment" spellcheck="true">#</span>
  5 <span class="token comment" spellcheck="true"># The path to the end user account 'public_html' directory must be</span>
  6 <span class="token comment" spellcheck="true"># accessible to the webserver userid.  This usually means that ~userid</span>
  7 <span class="token comment" spellcheck="true"># must have permissions of 711, ~userid/public_html must have permissions</span>
  8 <span class="token comment" spellcheck="true"># of 755, and documents contained therein must be world-readable.</span>
  9 <span class="token comment" spellcheck="true"># Otherwise, the client will only receive a "403 Forbidden" message.</span>
 10 <span class="token comment" spellcheck="true">#</span>
 11 <span class="token operator">&lt;</span>IfModule mod_userdir.c<span class="token operator">></span>
 12     <span class="token comment" spellcheck="true">#</span>
 13     <span class="token comment" spellcheck="true"># UserDir is disabled by default since it can confirm the presence</span>
 14     <span class="token comment" spellcheck="true"># of a username on the system (depending on home directory</span>
 15     <span class="token comment" spellcheck="true"># permissions).</span>
 16     <span class="token comment" spellcheck="true">#</span>
 17     <span class="token comment" spellcheck="true"># UserDir disabled</span>
 18 
 19     <span class="token comment" spellcheck="true">#</span>
 20     <span class="token comment" spellcheck="true"># To enable requests to /~user/ to serve the user's public_html</span>
 21     <span class="token comment" spellcheck="true"># directory, remove the "UserDir disabled" line above, and uncomment</span>
 22     <span class="token comment" spellcheck="true"># the following line instead:</span>
 23     <span class="token comment" spellcheck="true"># </span>
 24       UserDir public_html
 25 <span class="token operator">&lt;</span>/IfModule<span class="token operator">></span>
 26 
 27 <span class="token comment" spellcheck="true">#</span>
 28 <span class="token comment" spellcheck="true"># Control access to UserDir directories.  The following is an example</span>
 29 <span class="token comment" spellcheck="true"># for a site where these directories are restricted to read-only.</span>
 30 <span class="token comment" spellcheck="true">#</span>
 31 <span class="token operator">&lt;</span>Directory <span class="token string">"/home/*/public_html"</span><span class="token operator">></span>
 32     AllowOverride FileInfo AuthConfig Limit Indexes
 33     Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
 34     Require method GET POST OPTIONS
 35 <span class="token operator">&lt;</span>/Directory<span class="token operator">></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p> <strong>第2步</strong>：在用户家目录中建立用于保存网站数据的目录及首页面文件。另外，还需要把家目录的权限修改</p>
<p>为755，保证其他人也有权限读取里面的内容</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># su - linuxprobe</span>
<span class="token punctuation">[</span>linuxprobe@linuxprobe ~<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> public_html
<span class="token punctuation">[</span>linuxprobe@linuxprobe ~<span class="token punctuation">]</span>$ <span class="token keyword">echo</span> <span class="token string">"This is linuxprobe's website"</span> <span class="token operator">></span> public_html/index.html
<span class="token punctuation">[</span>linuxprobe@linuxprobe ~<span class="token punctuation">]</span>$ <span class="token function">chmod</span> -R 755 /home/linuxprobe
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第3步</strong>：重新启动<code>httpd</code>服务程序，在浏览器的地址栏中输入网址，其格式为“网址/～用户名”（其中的波</p>
<p>浪号是必需的，而且网址、波浪号、用户名之间没有空格）。从理论上来讲，现在就可以看到用户的个</p>
<p>人网站了。出乎意料的是，系统显示报错页面，如图6所示。这一定还是<code>SELinux</code>惹的祸</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>linuxprobe@linuxprobe ~<span class="token punctuation">]</span>$ <span class="token keyword">exit</span>
<span class="token function">logout</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl restart httpd</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220822100203807.png" alt="6 禁止访问用户的个人网站"></p>
<blockquote>
<p><strong>第4步</strong>：<code>httpd</code>服务程序在提供个人用户主页功能时，该用户的网站数据目录本身就应该是存放到与这</p>
<p>位用户对应的家目录中的，所以应该不需要修改家目录的<code>SELinux</code>安全上下文。但是，前文还讲到了</p>
<p><code>SELinux</code>域的概念。<code>SELinux</code>域确保服务程序不能执行违规的操作，只能本本分分地为用户提供服务。</p>
<p><code>httpd</code>服务中突然开启的这项个人用户主页功能到底有没有被<code>SELinux</code>域默认允许呢？</p>
<p>接下来使用<code>getsebool</code>命令查询并过滤出所有与HTTP协议相关的安全策略。其中，<code>off</code>为禁止状态，</p>
<p><code>on</code>为允许状态。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># getsebool -a | grep http</span>
httpd_anon_write --<span class="token operator">></span> off
httpd_builtin_scripting --<span class="token operator">></span> on
httpd_can_check_spam --<span class="token operator">></span> off
httpd_can_connect_ftp --<span class="token operator">></span> off
httpd_can_connect_ldap --<span class="token operator">></span> off
httpd_can_connect_mythtv --<span class="token operator">></span> off
httpd_can_connect_zabbix --<span class="token operator">></span> off
httpd_can_network_connect --<span class="token operator">></span> off
httpd_can_network_connect_cobbler --<span class="token operator">></span> off
httpd_can_network_connect_db --<span class="token operator">></span> off
httpd_can_network_memcache --<span class="token operator">></span> off
httpd_can_network_relay --<span class="token operator">></span> off
httpd_can_sendmail --<span class="token operator">></span> off
httpd_dbus_avahi --<span class="token operator">></span> off
httpd_dbus_sssd --<span class="token operator">></span> off
httpd_dontaudit_search_dirs --<span class="token operator">></span> off
httpd_enable_cgi --<span class="token operator">></span> on
httpd_enable_ftp_server --<span class="token operator">></span> off
httpd_enable_homedirs --<span class="token operator">></span> off
httpd_execmem --<span class="token operator">></span> off
httpd_graceful_shutdown --<span class="token operator">></span> off
httpd_manage_ipa --<span class="token operator">></span> off
httpd_mod_auth_ntlm_winbind --<span class="token operator">></span> off
httpd_mod_auth_pam --<span class="token operator">></span> off
httpd_read_user_content --<span class="token operator">></span> off
httpd_run_ipa --<span class="token operator">></span> off
httpd_run_preupgrade --<span class="token operator">></span> off
httpd_run_stickshift --<span class="token operator">></span> off
httpd_serve_cobbler_files --<span class="token operator">></span> off
httpd_setrlimit --<span class="token operator">></span> off
httpd_ssi_exec --<span class="token operator">></span> off
httpd_sys_script_anon_write --<span class="token operator">></span> off
httpd_tmp_exec --<span class="token operator">></span> off
httpd_tty_comm --<span class="token operator">></span> off
httpd_unified --<span class="token operator">></span> off
httpd_use_cifs --<span class="token operator">></span> off
httpd_use_fusefs --<span class="token operator">></span> off
httpd_use_gpg --<span class="token operator">></span> off
httpd_use_nfs --<span class="token operator">></span> off
httpd_use_openstack --<span class="token operator">></span> off
httpd_use_sasl --<span class="token operator">></span> off
httpd_verify_dns --<span class="token operator">></span> off
mysql_connect_http --<span class="token operator">></span> off
named_tcp_bind_http_port --<span class="token operator">></span> off
prosody_bind_http_port --<span class="token operator">></span> off
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>大致确定后就可以用<code>setsebool</code>命令来修改<code>SELinux</code>策略中各条规则的布尔值了。大家一定要记得在</p>
<p><code>setsebool</code>命令后面加上-P参数，让修改后的<code>SELinux</code>策略规则永久生效且立即生效。随后刷新网页</p>
</blockquote>
<pre><code>[root@linuxprobe ~]# setsebool -P httpd_enable_homedirs=on
[root@linuxprobe ~]# firefox
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220822102552667.png" alt="7 正常看到个人用户主页面中的内容"></p>
<blockquote>
<p>网站中添加密码功能</p>
</blockquote>
<blockquote>
<p><strong>第1步</strong>：先使用<code>htpasswd</code>命令生成密码数据库。<code>-c</code>参数表示第一次生成；后面再分别添加密码数据库的</p>
<p>存放文件，以及验证要用到的用户名称（该用户不必是系统中已有的本地账户）</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># htpasswd -c /etc/httpd/passwd linuxprobe</span>
New password:此处输入用于网页验证的密码
Re-type new password:再输入一遍进行确认
Adding password <span class="token keyword">for</span> user linuxprobe
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第2步</strong>：继续编辑个人用户主页功能的配置文件。把第31～37行的参数信息修改成下列内容，其中以井号</p>
<p>（#）开头的内容为添加的注释信息，可将其忽略。随后保存并退出配置文件，重启<code>httpd</code>服务程序即可</p>
<p>生效</p>
</blockquote>
<pre><code>[root@linuxprobe ~]# vim /etc/httpd/conf.d/userdir.conf
………………省略部分输出信息………………
 27 #
 28 # Control access to UserDir directories.  The following is an example
 29 # for a site where these directories are restricted to read-only.
 30 #
 31 &lt;Directory "/home/*/public_html"&gt;
 32     AllowOverride all 
        #刚刚生成出的密码验证文件保存路径
 33     authuserfile "/etc/httpd/passwd" 
        #当用户访问网站时的提示信息
 34     authname "My privately website"
        #验证方式为口令模式
 35     authtype basic
        #访问网站时需要验证的用户名称
 36     require user linuxprobe
 37 &lt;/Directory&gt;
[root@linuxprobe ~]# systemctl restart httpd
</code></pre>
<blockquote>
<p> 此后，当用户再想访问某个用户的个人网站时，就必须输入账户和密码才能正常访问了。另外，验证时</p>
<p>使用的账户和密码是用<code>htpasswd</code>命令生成的专门用于网站登录的账户和密码，而不是系统中的账户和密</p>
<p>码，请不要搞错了。登录界面如图8与图9所示</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220822102914222.png" alt="9 需要输入账户和密码才能访问"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220822102926690.png" alt="9 口令验证成功"></p>
<h3 id="11-5、虚拟网站主机功能"><a href="#11-5、虚拟网站主机功能" class="headerlink" title="11.5、虚拟网站主机功能"></a>11.5、虚拟网站主机功能</h3><blockquote>
<p><code>Apache</code>的虚拟主机功能是服务器基于用户请求的不同<code>IP</code>地址、主机域名或端口号，提供多个网站同时</p>
<p>为外部提供访问服务的技术。如图10所示，用户请求的资源不同，最终获取到的网页内容也各不相同。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220822103134718.png" alt="10 用户请求网站资源"></p>
<h4 id="11-5-1、基于IP地址"><a href="#11-5-1、基于IP地址" class="headerlink" title="11.5.1、基于IP地址"></a>11.5.1、基于<code>IP</code>地址</h4><blockquote>
<p>如果一台服务器有多个<code>IP</code>地址，而且每个<code>IP</code>地址与服务器上部署的每个网站一一对应，这样当用户请</p>
<p>求访问不同的<code>IP</code>地址时，会访问到不同网站的页面资源。而且，每个网站都有一个独立的<code>IP</code>地址，这</p>
<p>对搜索引擎优化也大有裨益。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220822104051891.png" alt="11 使用nmtui命令配置网络参数"></p>
<blockquote>
</blockquote>
<pre><code>[root@linuxprobe ~]# nmcli connection up ens160 
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/6)
</code></pre>
<blockquote>
<p> <strong>第1步</strong>：分别在<code>/home/wwwroot</code>中创建用于保存不同网站数据的3个目录，并向其中分别写入网站的首页</p>
<p>文件。每个首页文件中应有明确区分不同网站内容的信息，方便稍后能更直观地检查效果</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir -p /home/wwwroot/10</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir -p /home/wwwroot/20</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir -p /home/wwwroot/30</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "IP:192.168.10.10" > /home/wwwroot/10/index.html</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "IP:192.168.10.20" > /home/wwwroot/20/index.html</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "IP:192.168.10.30" > /home/wwwroot/30/index.html</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第2步</strong>：从<code>httpd</code>服务的配置文件中大约第132行处开始，分别追加写入3个基于<code>IP</code>地址的虚拟主机网站</p>
<p>参数，然后保存并退出。记得需要重启<code>httpd</code>服务，这些配置才生效。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/httpd/conf/httpd.conf</span>
………………省略部分输出信息………………
132 <span class="token operator">&lt;</span>VirtualHost 192.168.10.10<span class="token operator">></span>
133     DocumentRoot /home/wwwroot/10
134     ServerName www.linuxprobe.com
135     <span class="token operator">&lt;</span>Directory /home/wwwroot/10<span class="token operator">></span>
136     AllowOverride None
137     Require all granted
138     <span class="token operator">&lt;</span>/Directory<span class="token operator">></span>
139 <span class="token operator">&lt;</span>/VirtualHost<span class="token operator">></span>
  
140 <span class="token operator">&lt;</span>VirtualHost 192.168.10.20<span class="token operator">></span>
141     DocumentRoot /home/wwwroot/20
142     ServerName www.linuxcool.com
143     <span class="token operator">&lt;</span>Directory /home/wwwroot/20<span class="token operator">></span>
144     AllowOverride None
145     Require all granted
146     <span class="token operator">&lt;</span>/Directory<span class="token operator">></span>
147 <span class="token operator">&lt;</span>/VirtualHost<span class="token operator">></span>
  
148 <span class="token operator">&lt;</span>VirtualHost 192.168.10.30<span class="token operator">></span>
149     DocumentRoot /home/wwwroot/30
150     ServerName www.linuxdown.com
151     <span class="token operator">&lt;</span>Directory /home/wwwroot/30<span class="token operator">></span>
152     AllowOverride None
153     Require all granted
154     <span class="token operator">&lt;</span>/Directory<span class="token operator">></span>
155 <span class="token operator">&lt;</span>/VirtualHost<span class="token operator">></span>
………………省略部分输出信息………………
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl restart httpd</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第3步</strong>：此时访问网站，则会看到<code>httpd</code>服务程序的默认首页面中显示“权限不足”。大家现在应该立刻就</p>
<p>反应过来—这是<code>SELinux</code>在捣鬼。由于当前的<code>/home/wwwroot</code>目录及里面的网站数据目录的<code>SELinux</code>安</p>
<p>全上下文与网站服务不吻合，因此<code>httpd</code>服务程序无法获取到这些网站数据目录。我们需要手动把新的</p>
<p>网站数据目录的<code>SELinux</code>安全上下文设置正确（见前文的实验），并使用<code>restorecon</code>命令让新设置的</p>
<p><code>SELinux</code>安全上下文立即生效，这样就可以立即看到网站的访问效果了，如图12所示</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/10</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/10/*</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/20</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/20/*</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/30</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/30/*</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># restorecon -Rv /home/wwwroot</span>
Relabeled /home/wwwroot from unconfined_u:object_r:user_home_dir_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/10 from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/10/index.html from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/20 from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/20/index.html from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/30 from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/30/index.html from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firefox</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220822105544516.png" alt="13 基于不同的IP地址访问虚拟主机网站"></p>
<h4 id="11-5-2、基于主机名"><a href="#11-5-2、基于主机名" class="headerlink" title="11.5.2、基于主机名"></a>11.5.2、基于主机名</h4><blockquote>
<p>当服务器无法为每个网站都分配一个独立<code>IP</code>地址的时候，可以尝试让<code>Apache</code>自动识别用户请求的域</p>
<p>名，从而根据不同的域名请求来传输不同的内容。在这种情况下的配置更加简单，只需要保证位于生产</p>
<p>环境中的服务器上有一个可用的<code>IP</code>地址（这里以192.168.10.10为例）就可以了。由于当前还没有介绍</p>
<p>如何配置<code>DNS</code>解析服务，因此需要手动定义<code>IP</code>地址与域名之间的对应关系。<code>/etc/hosts</code>是Linux系统中</p>
<p>用于强制把某个主机域名解析到指定<code>IP</code>地址的配置文件。简单来说，只要这个文件配置正确，即使网络</p>
<p>参数中没有<code>DNS</code>信息也依然能够将域名解析为某个<code>IP</code>地址。</p>
</blockquote>
<blockquote>
<p><strong>第1步</strong>：手动定义<code>IP</code>地址与域名之间对应关系的配置文件，保存并退出后会立即生效。可以通过分别</p>
<p><code>ping</code>这些域名来验证域名是否已经成功解析为<code>IP</code>地址</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/hosts</span>
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.10.10   www.linuxprobe.com www.linuxcool.com www.linuxdown.com
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ping -c 4 www.linuxprobe.com</span>
PING www.linuxprobe.com <span class="token punctuation">(</span>192.168.10.10<span class="token punctuation">)</span> 56<span class="token punctuation">(</span>84<span class="token punctuation">)</span> bytes of data.
64 bytes from www.linuxprobe.com <span class="token punctuation">(</span>192.168.10.10<span class="token punctuation">)</span>: icmp_seq<span class="token operator">=</span>1 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.070 ms
64 bytes from www.linuxprobe.com <span class="token punctuation">(</span>192.168.10.10<span class="token punctuation">)</span>: icmp_seq<span class="token operator">=</span>2 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.077 ms
64 bytes from www.linuxprobe.com <span class="token punctuation">(</span>192.168.10.10<span class="token punctuation">)</span>: icmp_seq<span class="token operator">=</span>3 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.061 ms
64 bytes from www.linuxprobe.com <span class="token punctuation">(</span>192.168.10.10<span class="token punctuation">)</span>: icmp_seq<span class="token operator">=</span>4 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.069 ms
--- www.linuxprobe.com <span class="token function">ping</span> statistics ---
4 packets transmitted, 4 received, 0% packet loss, <span class="token function">time</span> 2999ms
rtt min/avg/max/mdev <span class="token operator">=</span> 0.061/0.069/0.077/0.008 ms
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p> <strong>第2步</strong>：分别在<code>/home/wwwroot</code>中创建用于保存不同网站数据的3个目录，并向其中分别写入网站的首页</p>
<p>文件。每个首页文件中应有明确区分不同网站内容的信息，方便稍后能更直观地检查效果</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir -p /home/wwwroot/linuxprobe</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir -p /home/wwwroot/linuxcool</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir -p /home/wwwroot/linuxdown</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "www.linuxprobe.com" > /home/wwwroot/linuxprobe/index.html</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "www.linuxcool.com" > /home/wwwroot/linuxcool/index.html</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "www.linuxdown.com" > /home/wwwroot/linuxdown/index.html</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第3步</strong>：从<code>httpd</code>服务的配置文件中大约第132行处开始，分别追加写入3个基于主机名的虚拟主机网站</p>
<p>参数，然后保存并退出。记得需要重启<code>httpd</code>服务，这些配置才生效</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/httpd/conf/httpd.conf</span>
………………省略部分输出信息………………
132 <span class="token operator">&lt;</span>VirtualHost 192.168.10.10<span class="token operator">></span>
133     Documentroot /home/wwwroot/linuxprobe
134     ServerName www.linuxprobe.com
135     <span class="token operator">&lt;</span>Directory /home/wwwroot/linuxprobe<span class="token operator">></span>
136     AllowOverride None
137     Require all granted
138     <span class="token operator">&lt;</span>/Directory<span class="token operator">></span>
139 <span class="token operator">&lt;</span>/VirtualHost<span class="token operator">></span>
 
140 <span class="token operator">&lt;</span>VirtualHost 192.168.10.10<span class="token operator">></span>
141     Documentroot /home/wwwroot/linuxcool
142     ServerName www.linuxcool.com
143     <span class="token operator">&lt;</span>Directory /home/wwwroot/linuxcool<span class="token operator">></span>
144     AllowOverride None
145     Require all granted
146     <span class="token operator">&lt;</span>/Directory<span class="token operator">></span>
147 <span class="token operator">&lt;</span>/VirtualHost<span class="token operator">></span>
 
148 <span class="token operator">&lt;</span>VirtualHost 192.168.10.10<span class="token operator">></span>
149     Documentroot /home/wwwroot/linuxdown
150     ServerName www.linuxdown.com
151     <span class="token operator">&lt;</span>Directory /home/wwwroot/linuxdown<span class="token operator">></span>
152     AllowOverride None
153     Require all granted
154     <span class="token operator">&lt;</span>/Directory<span class="token operator">></span>
155 <span class="token operator">&lt;</span>/VirtualHost<span class="token operator">></span>
………………省略部分输出信息………………
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl restart httpd</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第4步</strong>：因为当前的网站数据目录还是在<code>/home/wwwroot</code>目录中，因此还是必须要正确设置网站数据</p>
<p>目录文件的<code>SELinux</code>安全上下文，使其与网站服务功能相吻合。最后记得用<code>restorecon</code>命令让新配置</p>
<p>的<code>SELinux</code>安全上下文立即生效，这样就可以立即访问到虚拟主机网站了，效果如图14所示</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/linuxprobe</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/linuxprobe/*</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/linuxcool</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/linuxcool/*</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/linuxdown</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/linuxdown/*</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># restorecon -Rv /home/wwwroot</span>
Relabeled /home/wwwroot from unconfined_u:object_r:user_home_dir_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/linuxprobe from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/linuxprobe/index.html from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/linuxcool from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/linuxcool/index.html from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/linuxdown from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/linuxdown/index.html from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firefox </span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220822110014348.png" alt="14 基于主机域名访问虚拟主机网站"></p>
<h4 id="11-5-2、基于端口号"><a href="#11-5-2、基于端口号" class="headerlink" title="11.5.2、基于端口号"></a>11.5.2、基于端口号</h4><blockquote>
<p>基于端口号的虚拟主机功能可以让用户通过指定的端口号来访问服务器上的网站资源。在使用<code>Apache</code>配</p>
<p>置虚拟网站主机功能时，基于端口号的配置方式是最复杂的。因此我们不仅要考虑<code>httpd</code>服务程序的配</p>
<p>置因素，还需要考虑到<code>SELinux</code>服务对新开设端口的监控。一般来说，使用80、443、8080等端口号来</p>
<p>提供网站访问服务是比较合理的，如果使用其他端口号则会受到<code>SELinux</code>服务的限制。</p>
</blockquote>
<blockquote>
<p><strong>第1步</strong>：分别在<code>/home/wwwroot</code>中创建用于保存不同网站数据的3个目录，并向其中分别写入网站的</p>
<p>首页文件。每个首页文件中应有明确区分不同网站内容的信息，方便稍后能更直观地检查效果。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir -p /home/wwwroot/6111</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir -p /home/wwwroot/6222</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir -p /home/wwwroot/6333</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "port:6111" > /home/wwwroot/6111/index.html</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "port:6222" > /home/wwwroot/6222/index.html</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "port:6333" > /home/wwwroot/6333/index.html</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第2步</strong>：在<code>httpd</code>服务配置文件的第46行～48行分别添加用于监听6111、6222和6333端口的参数。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/httpd/conf/httpd.conf </span>
………………省略部分输出信息……………… 
 37 <span class="token comment" spellcheck="true"># Listen: Allows you to bind Apache to specific IP addresses and/or</span>
 38 <span class="token comment" spellcheck="true"># ports, instead of the default. See also the </span>
 39 <span class="token comment" spellcheck="true"># directive.</span>
 40 <span class="token comment" spellcheck="true">#</span>
 41 <span class="token comment" spellcheck="true"># Change this to Listen on specific IP addresses as shown below to </span>
 42 <span class="token comment" spellcheck="true"># prevent Apache from glomming onto all bound IP addresses.</span>
 43 <span class="token comment" spellcheck="true">#</span>
 44 <span class="token comment" spellcheck="true">#Listen 12.34.56.78:80</span>
 45 Listen 80
 46 Listen 6111
 47 Listen 6222
 48 Listen 6333
………………省略部分输出信息……………… 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第3步</strong>：从<code>httpd</code>服务的配置文件中大约第134行处开始，分别追加写入3个基于端口号的虚拟主机网</p>
<p>站参数，然后保存并退出。记得需要重启<code>httpd</code>服务，这些配置才生效。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/httpd/conf/httpd.conf</span>
………………省略部分输出信息……………… 
134 <span class="token operator">&lt;</span>VirtualHost 192.168.10.10:6111<span class="token operator">></span>
135     DocumentRoot /home/wwwroot/6111
136     ServerName www.linuxprobe.com
137     <span class="token operator">&lt;</span>Directory /home/wwwroot/6111<span class="token operator">></span>
138     AllowOverride None
139     Require all granted
140     <span class="token operator">&lt;</span>/Directory<span class="token operator">></span> 
141 <span class="token operator">&lt;</span>/VirtualHost<span class="token operator">></span>

142 <span class="token operator">&lt;</span>VirtualHost 192.168.10.10:6222<span class="token operator">></span>
143     DocumentRoot /home/wwwroot/6222
144     ServerName www.linuxcool.com
145     <span class="token operator">&lt;</span>Directory /home/wwwroot/6222<span class="token operator">></span>
146     AllowOverride None
147     Require all granted
148     <span class="token operator">&lt;</span>/Directory<span class="token operator">></span>
149 <span class="token operator">&lt;</span>/VirtualHost<span class="token operator">></span>

150 <span class="token operator">&lt;</span>VirtualHost 192.168.10.10:6333<span class="token operator">></span>
151     DocumentRoot /home/wwwroot/6333
152     ServerName www.linuxdown.com
153     <span class="token operator">&lt;</span>Directory /home/wwwroot/6333<span class="token operator">></span>
154     AllowOverride None
155     Require all granted
156     <span class="token operator">&lt;</span>/Directory<span class="token operator">></span>
157 <span class="token operator">&lt;</span>/VirtualHost<span class="token operator">></span>
………………省略部分输出信息………………
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第4步</strong>：因为我们把网站数据目录存放在<code>/home/wwwroot</code>目录中，因此还是必须要正确设置网站数据目</p>
<p>录文件的<code>SELinux</code>安全上下文，使其与网站服务功能相吻合。最后记得用<code>restorecon</code>命令让新配置的</p>
<p><code>SELinux</code>安全上下文立即生效</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/6111</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/6111/*</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/6222</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/6222/*</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/6333</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/6333/*</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># restorecon -Rv /home/wwwroot/</span>
Relabeled /home/wwwroot from unconfined_u:object_r:user_home_dir_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/6111 from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/6111/index.html from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/6222 from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/6222/index.html from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/6333 from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /home/wwwroot/6333/index.html from unconfined_u:object_r:user_home_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl restart httpd</span>
Job <span class="token keyword">for</span> httpd.service failed because the control process exited with error code.
See <span class="token string">"systemctl status httpd.service"</span> and <span class="token string">"journalctl -xe"</span> <span class="token keyword">for</span> details.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>在妥当配置<code>httpd</code>服务程序和<code>SELinux</code>安全上下文并重启<code>httpd</code>服务后，竟然出现报错信息。这是因为</p>
<p><code>SELinux</code>服务检测到6111、6222和6333端口原本不属于<code>Apache</code>服务应该需要的资源，但现在却以</p>
<p><code>httpd</code>服务程序的名义监听使用了，所以<code>SELinux</code>会拒绝使用<code>Apache</code>服务使用这3个端口。可以使用</p>
<p><code>semanage</code>命令查询并过滤出所有与<code>HTTP</code>协议相关且<code>SELinux</code>服务允许的端口列表</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage port -l | grep http</span>
http_cache_port_t            tcp      8080, 8118, 8123, 10001-10010
http_cache_port_t            udp      3130
http_port_t                  tcp      80, 81, 443, 488, 8008, 8009, 8443, 9000
pegasus_http_port_t          tcp      5988
pegasus_https_port_t         tcp      5989
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>第5步</strong>：<code>SELinux</code>允许的与<code>HTTP</code>协议相关的端口号中默认没有包含6111、6222和6333，因此需要将</p>
<p>这3个端口号手动添加进去。该操作会立即生效，而且在系统重启过后依然有效。设置好后再重启<code>httpd</code></p>
<p>服务程序，然后就可以看到网页内容了，结果如图15所示。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage port -a -t http_port_t -p tcp 6111</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage port -a -t http_port_t -p tcp 6222</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage port -a -t http_port_t -p tcp 6333</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># semanage port -l | grep http</span>
http_cache_port_t            tcp      8080, 8118, 8123, 10001-10010
http_cache_port_t            udp      3130
http_port_t                  tcp      6333, 6222, 6111, 80, 81, 443, 488, 8008, 8009, 8443, 9000
pegasus_http_port_t          tcp      5988
pegasus_https_port_t         tcp      5989
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl restart httpd</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firefox</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220822110625027.png" alt="15 基于端口号访问虚拟主机网站"></p>
<h3 id="11-6、Apache的访问控制"><a href="#11-6、Apache的访问控制" class="headerlink" title="11.6、Apache的访问控制"></a>11.6、<code>Apache</code>的访问控制</h3><blockquote>
<p><code>Apache</code>可以基于源主机名、源<code>IP</code>地址或源主机上的浏览器特征等信息对网站上的资源进行访问控制。</p>
<p>它通过<code>Allow</code>指令允许某个主机访问服务器上的网站资源，通过<code>Deny</code>指令实现禁止访问。在允许或禁止</p>
<p>访问网站资源时，还会用到<code>Order</code>指令，这个指令用来定义<code>Allow</code>或<code>Deny</code>指令<strong>起作用的顺序</strong>，其匹配原</p>
<p>则是按照顺序进行匹配，若匹配成功则执行后面的默认指令。比如“<code>Order Allow, Deny</code>”表示先将源主</p>
<p>机与允许规则进行匹配，若匹配成功则允许访问请求，反之则拒绝访问请求</p>
</blockquote>
<blockquote>
<p><strong>第1步</strong>：先在服务器上的网站数据目录中新建一个子目录，并在这个子目录中创建一个包含<code>Successful</code></p>
<p>单词的首页文件。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir /var/www/html/server</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># echo "Successful" > /var/www/html/server/index.html</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p> <strong>第2步</strong>：打开<code>httpd</code>服务的配置文件，在第161行后面添加下述规则来限制源主机的访问。这段规则的</p>
<p>含义是允许使用<code>Firefox</code>浏览器的主机访问服务器上的首页文件，除此之外的所有请求都将被拒绝。使</p>
<p>用<code>Firefox</code>浏览器的访问效果如图16所示，使用其他浏览器的访问效果如图17所示。</p>
</blockquote>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/httpd/conf/httpd.conf</span>
………………省略部分输出信息………………
161 <span class="token operator">&lt;</span>Directory <span class="token string">"/var/www/html/server"</span><span class="token operator">></span>
162     SetEnvIf User-Agent <span class="token string">"Firefox"</span> ff<span class="token operator">=</span>1
163     Order allow,deny
164     Allow from env<span class="token operator">=</span>ff
165 <span class="token operator">&lt;</span>/Directory<span class="token operator">></span>
………………省略部分输出信息………………
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl restart httpd</span>
<span class="token punctuation">[</span>root@linuxprobe ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firefox</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220822111102325.png" alt="16 火狐浏览器成功访问"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220822111119030.png" alt="17 其它浏览器访问失败"></p>
<blockquote>
<p>除了匹配源主机的浏览器特征之外，还可以通过匹配源主机的<code>IP</code>地址进行访问控制。例如，我们只允许</p>
<p><code>IP</code>地址为<code>192.168.10.20</code>的主机访问网站资源，那么就可以在<code>httpd</code>服务配置文件的第161行后面添加</p>
<p>下述规则。这样在重启<code>httpd</code>服务程序后再用本机（即服务器，其<code>IP</code>地址为192.168.10.10）来访问网</p>
<p>站的首页面时就会提示访问被拒绝了，如图18所示</p>
</blockquote>
<pre><code>[root@linuxprobe ~]# vim /etc/httpd/conf/httpd.conf
………………省略部分输出信息………………
161 &lt;Directory "/var/www/html/server"&gt;
162     Order allow,deny 
163     Allow from 192.168.10.20
164 &lt;/Directory&gt;
………………省略部分输出信息………………
[root@linuxprobe ~]# systemctl restart httpd
[root@linuxprobe ~]# firefox
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/../image/linux/image-20220822111301271.png" alt="18 因IP地址不符合要求而被拒绝访问"></p>

            </div>
            <hr/>
    
            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力!</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.bmp" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.bmp" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
    
            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>
    
            
            
            
            <div class="reprint1">
                <p>
                    <span class="reprint1-tip">
                        <i class="fa fa-exclamation-circle"></i>&nbsp;&nbsp;转载请注明:
                    </span>
                    <a href="https://hcs-21.github.io" class="b-link-green">郝春帅的博客</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="/2022/07/28/linux-yi/" class="b-link-green">linux的使用教程（一）</a>
                </p>
            </div>
    
        </div>
    </div>
    
    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: 'Iv1.fc0d9004c04bd10f',
        clientSecret: 'ae1026f1a6a57e97dbd91e20bb433d5f87c2f220',
        repo: 'hcs-21.github.io',
        owner: 'hcs-21',
        admin: ["hcs-21"],
        id: '2022/07/28/linux-yi/',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    
    
    
    
    
    
    
    
    
    
    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/07/28/kylin/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/2.jpg" class="responsive-img" alt="Apache Kylin的使用教程">
                        
                        <span class="card-title">Apache Kylin的使用教程</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Apache Kylin的使用教程
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2022-07-28
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/" class="post-category" target="_blank">
                                    工具使用教程
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" target="_blank">
                        <span class="chip bg-color">大数据</span>
                    </a>
                    
                    <a href="/tags/Kylin/" target="_blank">
                        <span class="chip bg-color">Kylin</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/07/26/vmware/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/18.jpg" class="responsive-img" alt="VMware 创建虚拟机">
                        
                        <span class="card-title">VMware 创建虚拟机</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            VMware 创建虚拟机教程
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2022-07-26
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/" class="post-category" target="_blank">
                                    工具使用教程
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/VMware/" target="_blank">
                        <span class="chip bg-color">VMware</span>
                    </a>
                    
                    <a href="/tags/CentOs/" target="_blank">
                        <span class="chip bg-color">CentOs</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }
    
        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());
    
        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }
    
        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 郝春帅的博客<br />'
            + '作者: 郝帅<br />'
            + '链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';
    
        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


        <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            Copyright&copy;  郝帅. 


            <br>
            <span id="sitetime"></span><span class="my-face">ღゝ◡╹)ノ♡</span>
            <br>
    
            
    
            
                    
                        <span id="busuanzi_container_site_pv" style='display:none'></span>
                        总访问量: <span id="busuanzi_value_site_pv" class="white-color"></span>
                    
        
                    
                        <span id="busuanzi_container_site_uv" style='display:none'></span>
                        人次&nbsp; | &nbsp;访客人数: <span id="busuanzi_value_site_uv" class="white-color"></span> 人
                    
    
            
			


            
            <br>
    
        </div>
    
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/hcs-21.github.io" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>


 
    <a href="https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=haocs21@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>






    <a href="http://wpa.qq.com/msgrd?v=3&uin=993999150&site=qq&menu=yes" class="tooltipped" target="_blank" data-tooltip="访问我的QQ空间" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>





    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>
    
    </div>
</footer>

<div class="progress-bar"></div>
<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();

        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
    
        var t1 = Date.UTC(2022, 06, 24, 00, 00, 00); //北京时间2019-8-1 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes *
            minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已勉强运行 " + diffYears + " 年 " + diffDays + " 天 " + diffHours +
            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒" ;
    } /*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>






        <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
        <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


        <script src="https://cdn.bootcss.com/materialize/1.0.0/js/materialize.min.js"></script>
        <script src="https://cdn.bootcss.com/masonry/4.2.2/masonry.pkgd.min.js"></script>
        <script src="https://cdn.bootcss.com/aos/3.0.0-beta.6/aos.js"></script>
        <script src="https://cdn.bootcss.com/scrollprogress/3.0.2/scrollProgress.min.js"></script>
        <script src="https://cdn.bootcss.com/lightgallery/1.6.12/js/lightgallery-all.min.js"></script>
        <script src="/js/matery.js"></script>

        <!-- Global site tag (gtag.js) - Google Analytics -->



        
            <script src="/libs/others/clicklove.js"></script>
        

        
            <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        

        <!-- 洪卫 shw2018 add 2019.08.28 -->
        <script type="text/javascript">
            var OriginTitile = document.title,
                st;
            document.addEventListener("visibilitychange", function () {
                document.hidden ? (document.title = "看不见我🙈~看不见我🙈~", clearTimeout(st)) : (document.title =
                    "(๑•̀ㅂ•́) ✧被发现了～", st = setTimeout(function () {
                        document.title = OriginTitile
                    }, 3e3))
            })
        </script>

        <!-- 鼠标点击烟花爆炸效果  洪卫 shw2018 add 2019.09.09 -->
        

        <!-- 背景雪花飘落特效洪卫 shw2018 add 2019.09.10 -->
        
            <script type="text/javascript">
            //只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>');
            }
            </script>
        

        <!-- 鼠标点击文字特效 洪卫 shw2018 add 2019.09.10-->
        
            <script src="/js/wenzi.js" type="text/javascript"></script>
        

        <!-- 背景雪花飘落特效 洪卫 shw2018 add 2019.09.10 -->
        
            <script type="text/javascript">
                var windowWidth = $(window).width();
                if (windowWidth > 768) {
                    document.write('<script type="text/javascript" src="/js/xuehuapiaoluo.js"><\/script>');
                }
            </script>
        

        <!-- 在线聊天工具  洪卫 shw2018 add 2019.09.11 -->
        
            <script src="//code.tidio.co/xxxxxxxxxxxxxxxxxxxxxxxxxxx.js"></script>
            <!--  在线聊天位置自定义  洪卫 shw2018 add 2019.09.13  -->
            <script> 
                $(document).ready(function () {

                    setInterval(change_Tidio, 50);  
                    function change_Tidio() { 

                        var tidio=$("#tidio-chat iframe");
                        if(tidio.css("display")=="block"&& $(window).width()>977 ){
                            document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"80px":"20px";   
                            document.getElementById("tidio-chat-iframe").style.right="-15px";   
                            document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                            document.getElementById("tidio-chat-iframe").style.zIndex="997";
                        } 
                        else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                            document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;   
                            document.getElementById("tidio-chat-iframe").style.right="-15px"; 
                            document.getElementById("tidio-chat-iframe").style.zIndex="997";
                        }
                        else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                            document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;   
                            document.getElementById("tidio-chat-iframe").style.zIndex="997";
                        }

                        if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                            document.getElementById("tidio-chat-iframe").style.zIndex="998";
                        }
                    } 
                }); 
            </script>
        

        <!-- 背景 canvas-nest  洪卫 shw 2018  add 2019.09.15-->
        
            <script type="text/javascript">
            var windowWidth = $(window).width();
            if (windowWidth > 992) {
                document.write('<script type="text/javascript" color="0,0,255" pointColor="0,0,255" opacity= "0.8" zIndex="--1" count="150"src="/libs/background/canvas-nest.js"><\/script>');
            }
            </script>
        

        <!-- 背景静止彩带  洪卫 shw 2018  add 2019.09.15-->
        

        <!-- 背景动态彩带 洪卫 shw 2018  add 2019.09.15-->
        
            <script type="text/javascript">
            var windowWidth = $(window).width();
            if (windowWidth > 992) {
                document.write('<script type="text/javascript" src="/libs/background/ribbon-dynamic.js"><\/script>');
            }
            </script>
        

    <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":150,"height":200},"mobile":{"show":false},"react":{"opacity":0.7}});</script><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=t;var i=n.imageLazyLoadSetting.isSPA,o=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function t(){i&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var a=0;a<r.length;a++)t=r[a],void 0,0<=(e=t.getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(n.innerHeight*o||document.documentElement.clientHeight*o)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}();var t,e}t(),n.addEventListener("scroll",function(){!function(t,e){clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)}(t,n)})}(this);</script></body>
</html>